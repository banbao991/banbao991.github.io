<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/14/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-DSA/SGJ/01" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/17/DSA/SGJ/01/" class="article-date">
  <time class="dt-published" datetime="2021-07-17T03:06:59.000Z" itemprop="datePublished">2021-07-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DSA/">DSA</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/17/DSA/SGJ/01/">数据结构与算法.宋国杰.01.引言与概论</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><h2 id="课程目标"><a href="#课程目标" class="headerlink" title="课程目标"></a>课程目标</h2><ul>
<li>逻辑结构<ul>
<li>图 $\supseteq$ 树 $\supseteq$ 线性</li>
</ul>
</li>
<li>存储结构<ul>
<li>顺序、链接</li>
<li>索引、散列</li>
</ul>
</li>
<li>运算<ul>
<li>增删查改</li>
<li>遍历、排序</li>
</ul>
</li>
<li>时间复杂度 vs 空间复杂度<ul>
<li>trade off</li>
</ul>
</li>
</ul>
<h2 id="解决问题的过程"><a href="#解决问题的过程" class="headerlink" title="解决问题的过程"></a>解决问题的过程</h2><ul>
<li>问题（Problem Problem ）<ul>
<li>从输入到出的一种函数映射</li>
</ul>
</li>
<li>数据结构（Data Structure）<ul>
<li>数据的逻辑结构及在计算机中存储表示 ，以及相应操作</li>
</ul>
</li>
<li>算法（Algorithm）<ul>
<li>对特定问题求解过程的描述 方法</li>
</ul>
</li>
<li>程序（Program）<ul>
<li>算法在计机程序设语言中的实现</li>
</ul>
</li>
</ul>
<h1 id="概论"><a href="#概论" class="headerlink" title="概论"></a>概论</h1><h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><ul>
<li>涉及数据之间的<strong>逻辑关系</strong>、数据在计算机中的<strong>存储表示</strong>和在这种结构上一组能执行的<strong>操作（运算）</strong></li>
<li>三要素<ul>
<li>逻辑结构、存储（物理）结构、运算</li>
</ul>
</li>
</ul>
<h3 id="逻辑结构"><a href="#逻辑结构" class="headerlink" title="逻辑结构"></a>逻辑结构</h3><ul>
<li>Logical Structure</li>
<li>具体问题的<strong>数学抽象</strong>，反映<strong>事物组成</strong>和<strong>逻辑关系</strong></li>
</ul>
<h4 id="逻辑结构的表示"><a href="#逻辑结构的表示" class="headerlink" title="逻辑结构的表示"></a>逻辑结构的表示</h4><ul>
<li>用<strong>一组数据</strong>（表示为<strong>结点</strong>集合 K），及数据间的<strong>二元关系</strong>（<strong>关系</strong>集合 R）表示：**(K, R)**</li>
<li>K 由<strong>有限个</strong>结点组成，代表一组有明确结构的数据集</li>
<li>R 是定义在集合 K 上的一组关系，每个关系 r $\in$ R 都是 <strong>K$\times$K 上的二元关系</strong>，描述结点间的逻辑关系</li>
</ul>
<h4 id="结点的类型"><a href="#结点的类型" class="headerlink" title="结点的类型"></a>结点的类型</h4><ul>
<li>基本数据类型<ul>
<li>整数类型 (integer)、实数类型 (real) 、字符类型 (char)、指针类型 (pointer)</li>
</ul>
</li>
<li>复合数据类型<ul>
<li>由基本数据类型组合而成的结构<ul>
<li>数组 、结构类型等</li>
</ul>
</li>
<li>复合数据类型本身，又可参与定义更为复杂的结点类型</li>
</ul>
</li>
</ul>
<h4 id="结构-关系-的类型"><a href="#结构-关系-的类型" class="headerlink" title="结构(关系)的类型"></a>结构(关系)的类型</h4><ul>
<li>用 R 的性质来刻划数据结构的特点，并进行分类<ul>
<li>集合结构（set structure）</li>
<li>线性结构（linear structure）</li>
<li>树型结构（tree structure）</li>
<li>图结构（graph structure）</li>
</ul>
</li>
</ul>
<h5 id="线性结构"><a href="#线性结构" class="headerlink" title="线性结构"></a>线性结构</h5><ul>
<li>又被称为<strong>前驱关系</strong></li>
<li>关系 r 是<strong>有向的</strong></li>
<li>满足<strong>全序性</strong>、<strong>单索性</strong><ul>
<li>全序性：全部结点两两<strong>皆可比较前后</strong></li>
<li>单索性：每个结点都存在<strong>唯一</strong>一个<strong>直接前驱和直接后继结点</strong></li>
</ul>
</li>
</ul>
<h5 id="树形结构"><a href="#树形结构" class="headerlink" title="树形结构"></a>树形结构</h5><ul>
<li>又被称为<strong>层次结构</strong></li>
<li>每个结点可有多于一个 “直接后继”，但只有唯一的 “直接前驱”</li>
<li>最高层结点称为根（root）结点，无父结点</li>
</ul>
<h5 id="图形结构"><a href="#图形结构" class="headerlink" title="图形结构"></a>图形结构</h5><ul>
<li>又被称为<strong>网络结构</strong></li>
<li>图结构对关系 r 没有施加任何约束<ul>
<li>每个结点的直接前驱和直接后继数目没有要求</li>
</ul>
</li>
</ul>
<h4 id="逻辑结构设计方法"><a href="#逻辑结构设计方法" class="headerlink" title="逻辑结构设计方法"></a>逻辑结构设计方法</h4><ul>
<li><strong>自顶向下</strong>的设计逻辑<ul>
<li>先明确数据结点，及其主要关系 r</li>
<li>在分析关系 r 时，也要分析其数据结点的数据类型</li>
<li>如果数据结点的逻辑结构比较复杂，那么把它作为下一个层次，再分析下一层次的逻辑结构</li>
<li>递归分析，直至满足需求</li>
</ul>
</li>
</ul>
<h3 id="存储结构"><a href="#存储结构" class="headerlink" title="存储结构"></a>存储结构</h3><ul>
<li>亦称<strong>物理结构</strong>，是逻辑结构在计算机中的<strong>物理存储表示</strong></li>
<li>计算机主存储器<ul>
<li><strong>空间相邻</strong><ul>
<li>存储空间是一种具有非负整数地址编码的、空间相邻的单元集合，其基本存储单元是<strong>字节</strong></li>
</ul>
</li>
<li><strong>随机访问</strong><ul>
<li>计算机指令具有<strong>按地址随机访问</strong>存储空间内任意单元的能力，访问不同地址所需时间相同</li>
</ul>
</li>
</ul>
</li>
<li>存储结构建立一种<strong>逻辑结构到物理结构的映射</strong><ul>
<li><strong>逻辑结点映射</strong>：对于每一个结点 j $\in$ K 都对应一个唯一的存储区域 c $\in$ M</li>
<li><strong>逻辑关系映射</strong>：每一关系元组 $(j_1,j_2)\in r$（其中 $j_1,j_2\in K$ 是结点），亦即 $j_1,j_2$ 的逻辑关系映射为存储单元的地址顺序关系（或指针地址指向关系）</li>
</ul>
</li>
<li>四种基本存储映射方法<ul>
<li>顺序、链接、索引、散列</li>
</ul>
</li>
</ul>
<h4 id="顺序方法"><a href="#顺序方法" class="headerlink" title="顺序方法"></a>顺序方法</h4><ul>
<li>顺序存储<ul>
<li>结点按<strong>地址相邻关系</strong>顺序存储，结点间逻辑关系用存储单元的<strong>自然顺序</strong>关系来表达</li>
<li>数组是顺序存储法的具体实例</li>
</ul>
</li>
<li><strong>顺序存储是紧凑存储结构</strong><ul>
<li>紧凑：存储空间除存储有用数据外，<strong>不存储其他附加信息</strong></li>
<li>存储密度：存储结构所存储 “有用数据” 和该结构（包括附加信息）整个存储空间大小之比</li>
</ul>
</li>
<li>一维数组</li>
<li>二维数组：支持整数编码访问<ul>
<li>行优先存储</li>
<li>$M[i][j]&#x3D;M[0][0]+i\times \mathrm{sizeof}(M[0])\times \mathrm{sizeof}(M[0][0])$</li>
</ul>
</li>
</ul>
<h4 id="链接方法"><a href="#链接方法" class="headerlink" title="链接方法"></a>链接方法</h4><ul>
<li>利用存储结构中<strong>指针指向</strong>来表示两个结点间逻辑关系</li>
<li>可以表达任意的逻辑关系 r</li>
<li>将数据结点分为两部分：数据字段、指针字段<ul>
<li>数据字段：存放结点本身的数据</li>
<li>指针字段：存放指针，链接到某个<strong>后继结点</strong>，指向存储单元的开始地址</li>
<li>多个相关结点的依次链接就会形成<strong>链表</strong></li>
</ul>
</li>
<li>优点：<strong>增删容易</strong><ul>
<li>顺序方法对于经常增、删结点情形，往往遇到困难</li>
<li>链接方法结合动态存储可以解决这些复杂的问题</li>
</ul>
</li>
<li>缺点：<strong>定位困难</strong><ul>
<li>访问结点必须知道该结点的指针</li>
<li>否则需要沿着链接指针逐个搜索，花费时间较大</li>
</ul>
</li>
</ul>
<h4 id="索引方法"><a href="#索引方法" class="headerlink" title="索引方法"></a>索引方法</h4><img src="01/image-20210717131720697.png" style="zoom: 67%;" />

<ul>
<li>是顺序存储法的一种推广</li>
<li>索引方法是要建造一个由整数域 Z 映射到存储地址域 D 的函数 Y: Z $\to$ D，把结点的整数索引值 z $\in$ Z 映射到结点的存储地址d $\in$ D<ul>
<li>Y 称为索引函数</li>
</ul>
</li>
</ul>
<h4 id="散列方法"><a href="#散列方法" class="headerlink" title="散列方法"></a>散列方法</h4><ul>
<li>散列是索引方法的扩展</li>
<li>散列函数：将关键码 s 映射到非负整数 z<ul>
<li>h: s $\to$ z</li>
</ul>
</li>
<li>对任意的 s $\in$ S，散列函数 h(s)&#x3D;z，z $\in$ Z</li>
</ul>
<h3 id="抽象数据类型-ADT"><a href="#抽象数据类型-ADT" class="headerlink" title="抽象数据类型 (ADT)"></a>抽象数据类型 (ADT)</h3><ul>
<li>抽象问题得到解决，同类具体问题都可得到解决</li>
<li>ADT 是对多种可能的结构和实现的抽象</li>
<li>模块化思想的发展，提供了抽象数据类型的实现手段，简称 ADT (Abstract Data Type)<ul>
<li>可以看作是定义了一组操作的一个抽象模型</li>
</ul>
</li>
<li>一个抽象数据类型要包括哪些操作，这一点由设计者根据需要确定</li>
<li>用数学方法定义<strong>对象集合</strong>和<strong>运算集合</strong>，仅通过运算的性质刻画数据对象，而<strong>独立于计算机中可能的表示方法</strong></li>
<li>目的：<strong>隐藏运算实现的细节和内部数据结构</strong></li>
<li>三元组：&lt;数据对象，数据关系，数据操作&gt;</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ADT 抽象数据类型名 &#123;</span><br><span class="line">    数据对象D: &lt;数据对象的定义&gt;;</span><br><span class="line">    数据关系S: &lt;数据关系的定义&gt;;</span><br><span class="line">    数据操作P: &lt;基本操作的定义&gt;;</span><br><span class="line">&#125; ADT 抽象数据类型名</span><br></pre></td></tr></table></figure>



<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><ul>
<li>数据结构 + 算法 &#x3D; 程序设计</li>
<li>程序设计的实质：为计算机处理问题编制一组 “指令”</li>
<li>需要解决两个问题：算法和数据结构<ul>
<li>数据结构 &#x3D; 问题的数学模型</li>
<li>算法 &#x3D; 处理问题的策略</li>
</ul>
</li>
</ul>
<h3 id="算法的性质"><a href="#算法的性质" class="headerlink" title="算法的性质"></a>算法的性质</h3><ul>
<li>通用性<ul>
<li>对<strong>参数化输入</strong>进行问题求解 ，保证计算<strong>结果的正确性</strong></li>
</ul>
</li>
<li>有效性<ul>
<li>有限条指令序列能完成算法所要实现的功能</li>
</ul>
</li>
<li>确定性<ul>
<li>算法描述中的<strong>下一步应执行的骤必须明确</strong></li>
</ul>
</li>
<li>有穷性<ul>
<li>算法的执行必须在<strong>有限步</strong>内结束</li>
<li>换句话说 ，算法不能有死循环</li>
</ul>
</li>
</ul>
<h3 id="算法分类"><a href="#算法分类" class="headerlink" title="算法分类"></a>算法分类</h3><ul>
<li>穷举法<ul>
<li>万能，低效</li>
</ul>
</li>
<li>回溯法、搜索 (DFS, BFS)</li>
<li>贪心法<ul>
<li>最优子结构 —— 最优解</li>
<li>否则 ，只是快速得到次优解</li>
</ul>
</li>
<li>递归分治 (二分检索 、快速排序 、分治排序 )<ul>
<li>子结构不重复</li>
<li>分、治、合</li>
</ul>
</li>
<li>动态规划<ul>
<li>自底向上，利用中间结果，迅速构造</li>
<li>最优子结构、重复子结构、无后效性</li>
<li>搜索中分支定界的特例</li>
<li>空间换时间</li>
</ul>
</li>
</ul>
<h3 id="算法分析"><a href="#算法分析" class="headerlink" title="算法分析"></a>算法分析</h3><ul>
<li>算法分析是对一个算法需要多少<strong>计算时间</strong>和<strong>存储空间</strong>的定量分析</li>
<li>判断所提出的算法是否符合现实情况</li>
<li>时间和空间复杂性：trade off</li>
</ul>
<h4 id="算法复杂性度量"><a href="#算法复杂性度量" class="headerlink" title="算法复杂性度量"></a>算法复杂性度量</h4><ul>
<li>不能用绝对时间单位<ul>
<li>环境不同</li>
<li>语言不同</li>
<li>可扩展性不同：在不同输入规模上表现不同</li>
</ul>
</li>
<li>绝对运行时间的比较也是需要的</li>
<li>重要的不是具体的时间，而是<strong>算法复杂性</strong>与**输入数据规模(N)**之间的关系</li>
<li>用 “**输入规模(N)<strong>” 所需 “</strong>基本操作(B)**” 的量级来描述时间复杂性，与操作的具体数值无关</li>
</ul>
<h3 id="算法的渐进分析"><a href="#算法的渐进分析" class="headerlink" title="算法的渐进分析"></a>算法的渐进分析</h3><ul>
<li>大 $O$ 表示法<ul>
<li>如果存在正数 $c$ 和 $n_0$，使得对任意的 $n&gt;n_0$，都有 $f(n)\le cg(n)$</li>
<li>则称 $f(n)$ 在集合 $O(g(n))$ 中，或简称 $f(n)$ 是 $O(g(n))$ 的</li>
</ul>
</li>
<li>$\Omega$ 表示法<ul>
<li>如果存在正数 $c$ 和 $n_0$，使得对任意的 $n&gt;n_0$，都有 $f(n)\ge cg(n)$</li>
<li>则称 $f(n)$ 在集合 $\Omega(g(n))$ 中，或简称 $f(n)$ 是 $\Omega(g(n))$ 的</li>
</ul>
</li>
<li>$\Theta$ 表示法<ul>
<li>如果一个函数既在集合 $O(g(n))$ 中又在集合 $\Omega(g(n))$ 中，则称其为 $\Theta(g(n))$ 的</li>
<li>即存在正数 $c_1,c_2$ 和 $n_0$，使得对任意的 $n&gt;n_0$，都有 $c_1g(n)\le f(n)\le c_2g(n)$</li>
</ul>
</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">4</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (j = i<span class="number">-3</span>, sum = a[i<span class="number">-4</span>]; j &lt;= i; j++) &#123;</span><br><span class="line">        sum += a[j];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>外层循环进行 n-4 次</li>
<li>对每个 i 而言，内层循环只执行 4 次<ul>
<li>每次的操作次数和 i 的大小无关：11 次赋值操作</li>
</ul>
</li>
<li>整个代码总共进行1 + 11*(n-4) &#x3D; O(n)次</li>
<li>看似双重循环，其实线性时间</li>
</ul>
<h4 id="最坏、最好、平均情况"><a href="#最坏、最好、平均情况" class="headerlink" title="最坏、最好、平均情况"></a>最坏、最好、平均情况</h4><ul>
<li>算法分析受条件分支的影响<ul>
<li>算法的增长率估计往往由于算法中的条件分支而遇到困难</li>
<li>分支走向又受输入数据取值的影响，因此很多算法都无法得出独立于输入数据的渐进估计</li>
</ul>
</li>
<li>估计方法<ul>
<li>最坏情况估计</li>
<li>最好情况估计</li>
<li>平均情况估计</li>
</ul>
</li>
</ul>
<h5 id="平均情况"><a href="#平均情况" class="headerlink" title="平均情况"></a>平均情况</h5><ul>
<li>简单情况下，需要考虑每种输入情况的概率</li>
</ul>
<p>$$<br>\mathrm{C_{avg}&#x3D;\sum_{i}p(input_i)\times \mathrm{steps}(input_i)}<br>$$</p>
<ul>
<li>对于时间开销，一般不关注算法的最好估计，最坏估计是唯一的选择<ul>
<li>特别是处理应急事件，计算机系统必须在规定的响应时间内做完紧急事件处理</li>
</ul>
</li>
<li>对于多数算法而言，<strong>最坏情况和平均情况估计</strong>，它们的时间开销的公式虽然不同，但是往往只是<strong>常数因子大小</strong>的区别，或者常数项的大小区别。因此<strong>不会影响渐进分析的增长率函数估计</strong></li>
</ul>
<h4 id="时间和空间的折衷"><a href="#时间和空间的折衷" class="headerlink" title="时间和空间的折衷"></a>时间和空间的折衷</h4><ul>
<li>空间开销也可以实行类似的渐进分析方法<ul>
<li>指除<strong>数据本身之外</strong>的存储开销</li>
</ul>
</li>
<li>静态存储结构<ul>
<li>空间开销估计往往容易</li>
</ul>
</li>
<li>动态存储结构<ul>
<li>算法运行过程中会有数量级地增大或缩小</li>
<li>这种情况的空间开销的分析和估计是十分必要的</li>
</ul>
</li>
<li>时空折衷（Trade-off between Time and Space）<ul>
<li>空间换时间：为改善算法的时间开销，可通过增大空间开销而设计出时间开销小的算法</li>
<li>时间换空间：为缩小算法的空间开销，通过增大时间开销来换取存储空间的节省</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/17/DSA/SGJ/01/" data-id="cl9lj74a700b464tzeq443cwa" data-title="数据结构与算法.宋国杰.01.引言与概论" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DSA/" rel="tag">DSA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SGJ/" rel="tag">SGJ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DSA/SGJ/00" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/17/DSA/SGJ/00/" class="article-date">
  <time class="dt-published" datetime="2021-07-17T03:01:26.000Z" itemprop="datePublished">2021-07-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/0/">0</a>►<a class="article-category-link" href="/categories/DSA/">DSA</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/17/DSA/SGJ/00/">数据结构与算法.宋国杰.00.说明</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><ul>
<li>课程名：《数据结构与算法》</li>
<li>课程教师：宋国杰</li>
<li>慕课链接：<a target="_blank" rel="noopener" href="https://www.icourse163.org/course/PKU-1002534001">中国大学慕课</a></li>
<li>一些其他材料<ul>
<li><a target="_blank" rel="noopener" href="https://media.openjudge.cn/upload/DSMooc/DSCode_ZhangWangZhao2008_06.rar">课程源代码</a></li>
<li><a target="_blank" rel="noopener" href="http://dsalgo.openjudge.cn/">代码练习网站</a></li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/17/DSA/SGJ/00/" data-id="cl9lj74a500aq64tzg2i721kq" data-title="数据结构与算法.宋国杰.00.说明" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DSA/" rel="tag">DSA</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SGJ/" rel="tag">SGJ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/Papers/1997/MLT" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/CG/Papers/1997/MLT/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T13:43:30.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-Paper/">CG.Paper</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/CG/Papers/1997/MLT/">(论文)[1997] Metropolis Light Transport</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li>VEACH E., GUIBAS L. J.: Metropolis light transport. In Annual Conference Series (Proceedings of SIGGRAPH) (Aug. 1997), vol. 31, ACM Press, pp. 65–76. <a target="_blank" rel="noopener" href="https://dl.acm.org/doi/10.1145/258734.258775">doi:10&#x2F;bkjqj4</a>.</li>
</ul>
<p><span style="color:red;font-weight:bold">TODO 找时间得继续看看</span></p>
<h1 id="Metropolis-Light-Transport"><a href="#Metropolis-Light-Transport" class="headerlink" title="Metropolis Light Transport"></a>Metropolis Light Transport</h1><h2 id="Abstract"><a href="#Abstract" class="headerlink" title="Abstract"></a>Abstract</h2><ul>
<li>We present a new Monte Carlo method for solving the <strong>light transport</strong> problem, inspired by the <strong>Metropolis sampling method</strong> in computational physics.</li>
<li>MLT 是无偏的<ul>
<li>Our algorithm is <strong>unbiased</strong>, handles general geometric and scattering models, uses little storage, and can be orders of magnitude more efficient than previous unbiased approaches.</li>
</ul>
</li>
<li>优点<ul>
<li>在复杂场景中表现很好<ul>
<li>bright indirect light</li>
<li>small geometric holes</li>
<li>glossy surfaces.</li>
</ul>
</li>
<li>简单场景中和之前的方法相比也不错</li>
</ul>
</li>
<li>The key advantage of the Metropolis approach is that the <strong>path space is explored locally</strong>, by <strong>favoring mutations</strong> that make small changes to the current path<ul>
<li>First, the <strong>average cost per sample is small</strong> (typically only one or two rays).</li>
<li>Second, once an important path is found, <strong>the nearby paths are explored as well</strong>, thus amortizing the expense of finding such paths over many samples.</li>
<li>Third, <strong>the mutation set is easily extended</strong>. By constructing mutations that preserve certain properties of the path (e.g. which light source is used) while changing others, we can exploit various kinds of coherence in the scene. <strong>It is often possible to handle difficult lighting problems efficiently by designing a specialized mutation in this way.</strong></li>
</ul>
</li>
</ul>
<h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1 Introduction"></a>1 Introduction</h2><ul>
<li>current methods are optimized for a <strong>fairly narrow class</strong> of input scenes.</li>
<li>Monte Carlo methods<ul>
<li>generality and simplicity.</li>
<li>unbiased<ul>
<li>For these algorithms, <strong>any error in the solution</strong> is guaranteed to show up as <strong>random variations</strong> among the samples (e.g., as image noise).</li>
</ul>
</li>
</ul>
</li>
<li>有偏算法带来的问题<ul>
<li>Biased algorithms may produce results that are not noisy, but are nevertheless <strong>incorrect.</strong></li>
<li>This error is often noticeable visually, in the form of <strong>discontinuities</strong>, <strong>excessive blurring</strong>, or <strong>objectionable surface shading</strong>.</li>
</ul>
</li>
<li>Monte Carlo 算法的问题<ul>
<li>The problem is that for some environments, <strong>most paths do not contribute significantly to the image</strong>, e.g. because they <strong>strike surfaces with low reflectivity</strong>, or <strong>go through solid objects</strong>.</li>
<li>出问题的场景<ul>
<li>For example, imagine a brightly lit room next to a dark room containing the camera, with a door slightly ajar between them.<ul>
<li>两个房间，光源在一个房间中，相机在另一个房间中，两个房间之间有一扇半开的门</li>
</ul>
</li>
</ul>
</li>
<li>对如下现象都不太支持<ul>
<li>glossy surfaces, caustics, strong indirect lighting</li>
</ul>
</li>
</ul>
</li>
<li>Several techniques have been proposed to sample these difficult paths more efficiently.<ul>
<li><strong>bidirectional path tracing</strong> (BDPT)</li>
<li>Another idea is to <strong>build an approximate representation of the radiance in a scene</strong>, which is then used to <strong>modify the directional sampling</strong> of the basic path tracing algorithm.<ul>
<li>一些问题</li>
<li>inadequate directional resolution to handle concentrated indirect lighting</li>
<li>substantial(大量) space requirements.</li>
</ul>
</li>
</ul>
</li>
<li>MLT<ul>
<li>The algorithm samples paths according to the <strong>contribution</strong> they make to the ideal image, by means of a random walk through path space.</li>
</ul>
</li>
</ul>
<h2 id="2-Overview-of-the-MLT-algorithm"><a href="#2-Overview-of-the-MLT-algorithm" class="headerlink" title="2 Overview of the MLT algorithm"></a>2 Overview of the MLT algorithm</h2><img src="MLT/image-20210711121721776.png" style="zoom: 80%;" />

<ul>
<li>sample the paths <strong>from the light sources to the lens</strong></li>
<li>path $\bar{x}&#x3D;\mathrm{x}_0\mathrm{x}_1\cdots\mathrm{x}_k$<ul>
<li>$\mathrm{x}_0$ 是光源</li>
<li>长度 $k\ge1$</li>
</ul>
</li>
<li><strong>power (flux)</strong> that flows from the light sources to the image plane along a set of paths $D$.</li>
</ul>
<p>$$<br>\int_{D}f(\bar{x});d\mu(\mathrm{x})<br>$$</p>
<ul>
<li>$f$：<strong>image contribution function</strong></li>
<li>Our overall strategy is to <strong>sample paths with probability proportional</strong> to $f$, and r<strong>ecord the distribution of paths</strong> over the image plane</li>
<li>We generate a sequence of paths $\bar{X}_0,\bar{X}_1,\cdots,\bar{X}_N$, where each $\bar{X}<em>i$ is obtained by a <strong>random mutation</strong> to the path $\bar{X}</em>{i-1}$</li>
<li>The mutations can have almost any desired form<ul>
<li><strong>adding</strong>, <strong>deleting</strong>, or <strong>replacing</strong> a small number of vertices on the current path</li>
</ul>
</li>
<li><strong>each mutation has a chance of being rejected</strong>, depending on the relative contributions of the old and new paths.</li>
<li><strong>As each path is sampled, we update the current image</strong></li>
<li>算法如下</li>
</ul>
<img src="MLT/image-20210711122845982.png" style="zoom:80%;" />



<h2 id="3-The-Metropolis-sampling-algorithm"><a href="#3-The-Metropolis-sampling-algorithm" class="headerlink" title="3 The Metropolis sampling algorithm"></a>3 The Metropolis sampling algorithm</h2><ul>
<li><p>In 1953, Metropolis, Rosenbluth, Rosenbluth, Teller, and Teller introduced an algorithm for <strong>handling difficult sampling problems</strong> in computational physics</p>
</li>
<li><p>前提</p>
<ul>
<li>We are given a <strong>state space</strong> $\Omega$, and a <strong>non-negative function</strong> $f:\Omega\to \mathbb{R}^+$.</li>
<li>We are also given some <strong>initial state</strong> $\bar{X}_0\in\Omega$</li>
</ul>
</li>
<li><p>目标</p>
<ul>
<li>generate a random walk $\bar{X}_0,\bar{X}_1,\cdots,\bar{X}_N$ such that $\bar{X}_i$ is eventually distributed proportionally to $f$, no matter which state $\bar{X}_0$ we start with.</li>
</ul>
</li>
<li><p><strong>the Metropolis algorithm does not require that $f$ integrate to one</strong>.</p>
</li>
<li><p>Each sample $\bar{X}<em>i$ is obtained by making a <strong>random change</strong> to $\bar{X}</em>{i−1}$</p>
<ul>
<li>in our case, these are the <strong>path mutations</strong></li>
</ul>
</li>
<li><p>马尔科夫链</p>
<ul>
<li>This type of random walk, where $\bar{X}<em>i$ depends only on $X</em>{i−1}$, is called a <strong>Markov chain</strong>.</li>
</ul>
</li>
<li><p>We let $K(\bar{y}|\bar{x})$ denote the probability density of going to state $\bar{y}$, given that we are currently in state $\bar{x}$.</p>
<ul>
<li><strong>transition function</strong></li>
<li>satisfies the condition</li>
</ul>
</li>
</ul>
<p>$$<br>\int_{\Omega}K(\bar{y}|\bar{x});d\mu(\bar{y})&#x3D;1,\forall\bar{x}\in\Omega<br>$$</p>
<h3 id="The-stationary-distribution"><a href="#The-stationary-distribution" class="headerlink" title="The stationary distribution"></a>The stationary distribution</h3><ul>
<li>平稳分布（状态不变）</li>
<li>Each $\bar{X}<em>i$ is a random variable with some distribution $p_i$, which is determined from $p</em>{i−1}$ by the equation (1) With mild conditions on $K$</li>
</ul>
<p>$$<br>p_{i}(\bar{x})&#x3D;\int_{G}K(\bar{x}|\bar{y});p_{i}(\bar{y});d\mu(\bar{y})\qquad(1)<br>$$</p>
<ul>
<li>the $p_i$ will converge to a unique distribution $p$, called the <strong>stationary distribution</strong></li>
<li><strong>Note that p does not depend on the initial state $\bar{X}_0$</strong></li>
</ul>
<h3 id="Detailed-balance"><a href="#Detailed-balance" class="headerlink" title="Detailed balance"></a>Detailed balance</h3><ul>
<li>细致平衡</li>
<li>在实际的物理系统中，$K$ 是由物理约束决定的，给定初始状态便会变化到平稳分布</li>
<li><strong>The Metropolis algorithm works in the opposite direction.</strong><ul>
<li>The idea is to <strong>invent or construct a transition function $K$</strong> whose resulting stationary distribution will be proportional to the given $f$, and which will converge to $f$ as quickly as possible.</li>
<li>找到转移函数 $K$ ，希望他能够快速收敛到 $f$</li>
</ul>
</li>
<li>The technique is simple, and has an intuitive physical interpretation called <strong>detailed balance</strong>.</li>
<li>Given $\bar{X}_{i-1}$, we obtain $\bar{X}_i$ as follows.</li>
<li>First, we choose a tentative（试探性的） sample $X_i’$</li>
<li>This is represented by the <strong>tentative transition function</strong> $T$</li>
<li>where $T(\bar{y}|\bar{x})$ gives the probability density that $X_i’&#x3D;\bar{y}$ given that $X_i’&#x3D;\bar{x}$</li>
<li>The tentative sample is then either accepted or rejected, according to an acceptance probability  $a(\bar{y}|\bar{x})$  which will be defined below</li>
</ul>
<p>$$<br>X_i&#x3D;<br>\begin{cases}<br>X_i’    \qquad \mathrm{with;probability;a(\overline{X}<em>i’|\overline{X}</em>{i-1}})\<br>X_{i&#x3D;1} \quad \mathrm{otherwise}<br>\end{cases}<br>$$</p>
<ul>
<li>To see how to set $a(\bar{y}|\bar{x})$, <strong>suppose that we have already reached equilibrium</strong>, i.e. $p_{i−1}$ is proportional to $f$.</li>
<li>From $\bar{x}$ to $\bar{y}$, the transition density is proportional to $f(\bar{x});T(\bar{y}|\bar{x});a(\bar{y}|\bar{x})$, and a similar statement holds for the transition density from $\bar{y}$ to $\bar{x}$.</li>
<li><span id="eq3">细致平衡条件</span></li>
</ul>
<p>$$<br>f(\bar{x});T(\bar{y}|\bar{x});a(\bar{y}|\bar{x})&#x3D;f(\bar{y});T(\bar{x}|\bar{y});a(\bar{x}|\bar{y}),\qquad (3)<br>$$</p>
<ul>
<li><span id="eq4">细致平衡条件是平稳分布的充分条件</span></li>
</ul>
<p>$$<br>\begin{aligned}<br>p_{i}(\bar{x})&#x3D;&amp;\Big[1-\int_{\Omega}f(\bar{x});T(\bar{y}|\bar{x});a(\bar{y}|\bar{x});d\mu(\bar{y})\Big]p_{i-1}(\bar{x})\qquad(4)\<br>&amp;+\int_{\Omega}f(\bar{x});p_{i-1}(\bar{y})T(\bar{x}|\bar{y});a(\bar{x}|\bar{y});d\mu(\bar{y})\<br>&amp;&#x3D;p_{i-1}(\bar{x})\<br>\end{aligned}<br>$$</p>
<h3 id="The-acceptance-probability"><a href="#The-acceptance-probability" class="headerlink" title="The acceptance probability"></a>The acceptance probability</h3><ul>
<li><p>接受概率</p>
</li>
<li><p>Recall that $f$ is given, and $T$ was chosen arbitrarily. Thus, equation <a href="#eq3">(3)</a> is a condition on the ratio $a(\bar{y}|\bar{x})&#x2F;a(\bar{x}|\bar{y})$.</p>
</li>
<li><p>In order to reach equilibrium as quickly as possible, the best strategy is to make $a(\bar{x}|\bar{y})$ and $a(\bar{y}|\bar{x})$ <strong>as large as possible</strong></p>
</li>
</ul>
<p>$$<br>a(\bar{y}|\bar{x})&#x3D;\min\Big{1,\dfrac{f(\bar{y})T(\bar{x}|\bar{y})}{f(\bar{x})T(\bar{y}|\bar{x})}\Big}<br>$$</p>
<ul>
<li>According to this rule, transitions <strong>in one direction are always accepted</strong>, while <strong>in the other direction they are sometimes</strong><br>  <strong>rejected</strong>, such that the expected number of moves each way is the same.</li>
</ul>
<h3 id="Comparison-with-genetic-algorithms"><a href="#Comparison-with-genetic-algorithms" class="headerlink" title="Comparison with genetic algorithms"></a>Comparison with genetic algorithms</h3><ul>
<li>different purposes<ul>
<li>genetic algorithms solve optimization problems</li>
<li>while the Metropolis method solves sampling problems</li>
</ul>
</li>
<li>Genetic algorithms work with <strong>a population of individuals</strong>, while Metropolis <strong>stores only a single current state</strong>.</li>
<li>Finally, genetic algorithms have much more freedom in choosing the allowable mutations, since they do not need to compute the conditional probability of their actions</li>
</ul>
<h2 id="4-The-path-integral-formulation-of-light-transport"><a href="#4-The-path-integral-formulation-of-light-transport" class="headerlink" title="4 The path integral formulation of light transport"></a>4 The path integral formulation of light transport</h2><ul>
<li>Often the light transport problem is written as an integral equation, where we must solve for the equilibrium radiance function L.</li>
<li>However, it can also be written as a <strong>pure integration problem</strong>, <strong>over the domain of all transport paths</strong>.<ul>
<li><strong>The MLT algorithm is based on this formulation.</strong></li>
</ul>
</li>
</ul>
<h3 id="The-light-transport-equation"><a href="#The-light-transport-equation" class="headerlink" title="The light transport equation"></a>The light transport equation</h3><ul>
<li>We assume a geometric optics model where light is emitted, scattered, and absorbed only <strong>at surfaces</strong>, travels in straight lines between surfaces, and is perfectly incoherent.</li>
<li><strong>light transport equation</strong><ul>
<li>$\mathcal{M}$ is the union of all scene surfaces</li>
<li>$A$ is the area measure on $\mathcal{M}$</li>
<li>The function $G$ represents the throughput of a differential beam between $dA(\mathrm{x})$ and $dA(\mathrm{x’})$</li>
</ul>
</li>
</ul>
<p>$$<br>L(\mathrm{x’}\to\mathrm{x’’})&#x3D;L_e(\mathrm{x’}\to\mathrm{x’’})+\int_{\mathcal{M}}L(\mathrm{x}\to\mathrm{x’})f_s(\mathrm{x}\to\mathrm{x’}\to\mathrm{x’’}){\color{red}G(\mathrm{x}\leftrightarrow\mathrm{x’})};dA(\mathrm{x})<br>$$</p>
<ul>
<li>$G$ 如下<ul>
<li>where $\cos\theta_o$ and $\cos\theta_i’$ represent the angles between the segment $\mathrm{x}\leftrightarrow\mathrm{x’}$ and the surface normals at $\mathrm{x}$ and $\mathrm{x_0}$ respectively</li>
<li>$V$ 为可见性</li>
</ul>
</li>
</ul>
<p>$$<br>G(\mathrm{x}\leftrightarrow\mathrm{x’})&#x3D;V(\mathrm{x}\leftrightarrow\mathrm{x’})\dfrac{|\cos\theta_o\cos\theta_i’|}{\Vert\mathrm{x}-\mathrm{x’}\Vert^2}<br>$$</p>
<h3 id="The-measurement-equation"><a href="#The-measurement-equation" class="headerlink" title="The measurement equation"></a>The measurement equation</h3><ul>
<li>We consider only algorithms that compute an image directly, so that the measurements consist of many pixel values $m_1,\cdots,m_M$, where <strong>M is the number of pixels in the image</strong>.</li>
<li>Each measurement has the form</li>
</ul>
<p>$$<br>m_j&#x3D;\int_{\mathcal{M}\times\mathcal{M}}W_e^{(j)}(\mathrm{x}\to\mathrm{x}’)L(\mathrm{x}\to\mathrm{x}’)G(\mathrm{x}\leftrightarrow\mathrm{x}’);dA(\mathrm{x});dA(\mathrm{x}’)<br>$$</p>
<ul>
<li>where $W_e^{(j)}(\mathrm{x}\to\mathrm{x’})$ is a weight that indicates how much the light arriving at $\mathrm{x’}$ from the direction of $\mathrm{x}$ contributes to the value of the measurement<ul>
<li>For real sensors, $W_e^{(j)}(\mathrm{x}\to\mathrm{x’})$ is called the <strong>flux responsivity</strong> (with units of $[W^{-1}]$), but in graphics it is more often called an <strong>importance function</strong></li>
</ul>
</li>
</ul>
<h3 id="The-path-integral-formulation"><a href="#The-path-integral-formulation" class="headerlink" title="The path integral formulation"></a>The path integral formulation</h3><ul>
<li>By recursively expanding the transport equation (6), we can write measurements in the form</li>
</ul>
<p>$$<br>\begin{aligned}<br>m_j&#x3D;&amp;\int_{\mathcal{M}^2}L(\mathrm{x}_0\to\mathrm{x}_1)G(\mathrm{x}_0\leftrightarrow\mathrm{x}_1)W_e^{(j)}(\mathrm{x}_0\to\mathrm{x}_1);dA(\mathrm{x}_0);dA(\mathrm{x}<em>1)\<br>&amp;+\int</em>{\mathcal{M}^3}L(\mathrm{x}_0\to\mathrm{x}_1)G(\mathrm{x}_0\leftrightarrow\mathrm{x}_1)f_s(\mathrm{x}_0\leftrightarrow\mathrm{x}_1\leftrightarrow\mathrm{x}_2)G(\mathrm{x}_1\leftrightarrow\mathrm{x}_2)W_e^{(j)}(\mathrm{x}_1\to\mathrm{x}_2);dA(\mathrm{x}_0);dA(\mathrm{x}_1);dA(\mathrm{x}_2)\<br>&amp;\cdots\<br>\end{aligned}<br>$$</p>
<ul>
<li>The goal is to write this expression in the form, so that we can handle it as a pure integration problem.</li>
</ul>
<p>$$<br>m_j&#x3D;\int_{\Omega}f_j(\bar{x});d\mu(\bar{x})<br>$$</p>
<ul>
<li>let $\Omega_k$ be the set of all paths of the form $\bar{x}&#x3D;\mathrm{x}_0\mathrm{x}_1\cdots\mathrm{x}_k$, where $k\ge1$ and $x_i\in\mathcal{M}$ for each $i$.</li>
</ul>
<p>$$<br>d\mu_k(\mathrm{x}_0\cdots\mathrm{x}_k)&#x3D;dA(\mathrm{x}_0)\cdots;dA(\mathrm{x}_k)<br>$$</p>
<ul>
<li>we let $\Omega$ be the union of all the $\Omega_k$ and define a measure $\mu$ on $\Omega_k$ by<ul>
<li>感觉可以把 $D$ 理解为路径全空间</li>
</ul>
</li>
</ul>
<p>$$<br>\mu(D)&#x3D;\sum_{k&#x3D;1}^{\infty}\mu_k(D;\cap\Omega_k)<br>$$</p>
<ul>
<li>We call $f_j$ the <strong>measurement contribution function</strong></li>
<li>例子</li>
</ul>
<p>$$<br>f_j(\mathrm{x}_0\mathrm{x}_1)&#x3D;L_e(\mathrm{x}_0\to\mathrm{x}_1)G(\mathrm{x}_0\leftrightarrow\mathrm{x}_1)W_e^{(j)}(\mathrm{x}_0\to\mathrm{x}_1)<br>$$</p>
<img src="MLT/image-20210711121721776.png" style="zoom: 80%;" />

<ul>
<li>上面转化的目的<ul>
<li>The most significant aspect is that we <strong>have removed the sum over different path lengths</strong>, and <strong>replaced it with a single integral over an abstract measure space of paths</strong>.</li>
</ul>
</li>
</ul>
<h2 id="5-Metropolis-light-transport"><a href="#5-Metropolis-light-transport" class="headerlink" title="5 Metropolis light transport"></a>5 Metropolis light transport</h2><ul>
<li>一些准备工作<ul>
<li>First, we must formulate the light transport problem so that it fits the Metropolis framework.</li>
<li>Second, we must show how to avoid <strong>start-up bias</strong>, a problem which affects many Metropolis applications.</li>
<li>Most importantly, we must design a suitable set of <strong>mutations</strong> on paths, such that the Metropolis method will work efficiently.</li>
</ul>
</li>
</ul>
<h3 id="5-1-Reduction-to-the-Metropolis-framework"><a href="#5-1-Reduction-to-the-Metropolis-framework" class="headerlink" title="5.1 Reduction to the Metropolis framework"></a>5.1 Reduction to the Metropolis framework</h3><ul>
<li>Observe that each integrand $f_j$ has the form $f_j(\bar{x})&#x3D;w_j(\bar{x})f(\bar{x})$<ul>
<li>$w_j$ represents the filter function for pixel $j$</li>
<li>$f$ represents all the other factors of $f_j$ (which are the same for all pixels).</li>
</ul>
</li>
<li>In physical terms, $\int_Df(\bar{x});d\mu(\bar{x})$ represents the <strong>radiant powe</strong>r received by the image area of the image plane along <strong>a set $D$ of paths</strong>.</li>
<li>Note that $w_j$ depends only on the last edge $\mathrm{x}_{k-1}\mathrm{x}_k$ of the path, which we call the <strong>lens edge</strong>.</li>
<li>An image can now be computed by sampling $N$ paths $\mathrm{X}_i$ according to some distribution $p$, and using the identity</li>
</ul>
<p>$$<br>m_j&#x3D;E\Big[\dfrac{1}{N}\sum_{i&#x3D;1}^{N}\dfrac{w_j(\bar{X}_i)f(\bar{X}_i)}{p(\bar{X}_i)}\Big]<br>$$</p>
<ul>
<li><span style="color:red">If we could</span> let $p&#x3D;\dfrac{1}{b}f$ (where $b$ is the normalization constant $\int_\Omega f(\bar{x});d\mu(\bar{x})$, the estimate for each pixel would be</li>
</ul>
<p>$$<br>m_j&#x3D;E\Big[\dfrac{1}{N}\sum_{i&#x3D;1}^{N}b;w_j(\bar{X}_i)\Big]<br>$$</p>
<ul>
<li><strong>This equation can be evaluated efficiently for all pixels at  once, since each path contributes to only a few pixel values.</strong></li>
<li>问题：This idea requires the evaluation of $b$, and the ability to sample from a distribution proportional to $f$.<ul>
<li><strong>Both of these are hard problems.</strong></li>
<li>For the <strong>second</strong> part, the Metropolis algorithm will help<ul>
<li>however, the samples $\bar{X}_i$ will have the desired distribution only in the limit as $i\to\infty$</li>
<li>Metropolis 应用中丢弃前 k 个 sample，直到结果大概收敛到 equilibrium distribution<ul>
<li>k 的预测也是个问题</li>
<li><strong>start-up bias</strong>：如果选取的 k 太小，结果将很大程度上受到 $\bar{X}_0$ 的影响</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Eliminating-start-up-bias"><a href="#Eliminating-start-up-bias" class="headerlink" title="Eliminating start-up bias"></a>Eliminating start-up bias</h4><ul>
<li>The idea is to start the walk in a random initial state $\bar{X}_0$, <strong>which is sampled from some convenient path distribution $p_0$</strong><ul>
<li>we use bidirectional path tracing for this purpose</li>
<li>初始路径通过其他采样方式采出</li>
</ul>
</li>
<li>To compensate for the fact that $p_0$ is <strong>not the desired distribution</strong> $\dfrac{1}{b}f$, the sample $\bar{X}_0$ is assigned a weight: $W_0&#x3D;\dfrac{f(\bar{X}_0)}{p_0(\bar{X}_0)}$</li>
<li>Thus <strong>after one sample</strong>, the estimate for pixel $j$ is $W_0w_j(\bar{X}_0)$<ul>
<li>N&#x3D;1 代入即可</li>
<li>$\bar{X}_0$ 已知的条件下，这些都是可以计算的</li>
</ul>
</li>
<li>接下来可以根据 Metropolis algorithm 进行采样得到 $\bar{X}_1,\cdots,\bar{X}_N$<ul>
<li>mutating $\bar{X}_0$</li>
<li>using $f$ as the target density</li>
</ul>
</li>
<li>Each of the $\bar{X}_i$ has a different distribution $p_i$, which only approaches $\dfrac{1}{b}f$ as $i\to\infty$</li>
<li>To <strong>avoid bias</strong>, however, it is sufficient to assign these samples the same weight $W_i&#x3D;W_0$ as the original sample, where the following estimate is used for pixel $j$</li>
</ul>
<p>$$<br>m_j&#x3D;E\Big[\dfrac{1}{N}\sum_{i&#x3D;1}^{N}w_j(\bar{X}_i){W_i}\Big]<br>$$</p>
<ul>
<li><strong>unbiased</strong><ul>
<li>如果 $p_0&#x3D;\dfrac{1}{b}f,W_0&#x3D;b$，那么结果一定是 equilibrium.</li>
<li>对于一般的 $p_0$<ul>
<li>$W_0&#x3D;\dfrac{f}{p_0}$ leads to exactly the same distribution of weighta mong the starting paths, and so we should expect that these <strong>initial conditions are unbiased as well</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>unbiased 证明如下</li>
<li>首先证明如下等式在每一步中都成立</li>
</ul>
<p>$$<br>\int_{\mathbb{R}}w;q_i(w,\bar{x});dw&#x3D;f(\bar{x})<br>$$</p>
<ul>
<li>where $q_i$ is the joint probability distribution of the i-th weighted sample $(W_i,\bar{X}i)$</li>
<li>$q_0$ 是成立的<ul>
<li>$q_0(w,\bar{x})&#x3D;\delta(w-\dfrac{f(\bar{x})}{p_0(\bar{x})})p_0(\bar{x})$<ul>
<li>$\delta$ denotes the Dirac delta distribution</li>
</ul>
</li>
<li>$W_0&#x3D;\dfrac{f(\bar{X}_0)}{p_0(\bar{X}_0)}$</li>
</ul>
</li>
<li>由上面的等式 <a href="#eq4">(4)</a><ul>
<li>Next, observe that (4) is still true with $p_j$ replaced by $q_i(w,\bar{x})$ (since the mutations set $W_i&#x3D;W_{i−1}$).</li>
<li>$\int_{\mathbb{R}}w;q_i(w,\bar{x});dw&#x3D;\int_{\mathbb{R}}w;q_{i-1}(w,\bar{x});dw$</li>
</ul>
</li>
</ul>
<p>$$<br>\begin{aligned}<br>E\Big[w_j(\bar{X}<em>i){W_i}\Big]&amp;&#x3D;\int</em>{\Omega}\int_{\mathbb{R}}w;w_j(\bar{x});q_i(w,\bar{x});dw;d\mu(\bar{x})\<br>&amp;&#x3D;\int_{\Omega};w_j(\bar{x});f(\bar{x});d\mu(\bar{x})\<br>&amp;&#x3D;m_j\<br>\end{aligned}<br>$$</p>
<ul>
<li>期望计算：$E(XY)&#x3D;\iint xyf(x,y)dxdy$</li>
</ul>
<h4 id="Initialization"><a href="#Initialization" class="headerlink" title="Initialization"></a>Initialization</h4><ul>
<li>In practice, <strong>initializing the MLT algorithm with a single sample does not work well</strong></li>
<li>If we generate only one path $\bar{X}_0$ (e.g. using bidirectional path tracing), <strong>it is quite likely that $W_0&#x3D;0$</strong> (e.g. the path goes through a wall).<ul>
<li><strong>结果为全黑</strong></li>
</ul>
</li>
<li><strong>The strategy we have implemented is to sample a moderately large number of paths $\bar{X}_0^{(1)},\cdots,\bar{X}_0^{(n)}$, with corresponding weights $W_0^{(1)},\cdots,W_0^{(n)}$</strong></li>
<li>We then resample the $\bar{X}_0^{(i)}$ to obtain a much smaller number $n’$ of equally-weighted paths<ul>
<li>chosen with equal spacing in the cumulative weight distribution of the $\bar{X}_0^{(i)}$</li>
<li>These are used as <strong>independent seeds</strong> for the <strong>Metropolis phase</strong> of the algorithm</li>
</ul>
</li>
<li>The value of n is determined indirectly, by generating a fixed number of eye and light subpaths (e.g. 10000 pairs), and considering all the ways to link the vertices of each pair.<ul>
<li>Note that it is not necessary to save all of these paths for the resampling step</li>
<li><strong>they can be regenerated by restarting the random number generator with the same seed.</strong></li>
</ul>
</li>
<li>It is often reasonable to choose <strong>$n’&#x3D;1$</strong> (a single Metropolis seed).</li>
<li>实际测试中，初始化这一步的开销很小</li>
<li>two phase<ul>
<li>The initialization phase <strong>estimates the overall image brightness</strong></li>
<li>while the Metropolis phase determines <strong>the relative pixel intensities across the image</strong></li>
</ul>
</li>
</ul>
<h4 id="Convergence-tests"><a href="#Convergence-tests" class="headerlink" title="Convergence tests"></a>Convergence tests</h4><ul>
<li>Another reason to run several copies of the algorithm in parallel is that it facilitates（促进） convergence testing.<ul>
<li>We cannot apply the usual variance tests to samples generated by a single run of the Metropolis algorithm, since consecutive samples are <strong>highly correlated</strong>.</li>
</ul>
</li>
<li>To test for convergence, the Metropolis phase runs with $n’$ independent seed paths, whose contributions to the image are recorded separately (in the form of $n’$ separate images).</li>
</ul>
<h4 id="Spectral-sampling"><a href="#Spectral-sampling" class="headerlink" title="Spectral sampling"></a>Spectral sampling</h4><ul>
<li>Effectively, each color component $h$ is sampled with an estimator of the form $h&#x2F;p$, where $p$ is proportional to the luminance.</li>
</ul>
<h3 id="5-2-Designing-a-mutation-strategy"><a href="#5-2-Designing-a-mutation-strategy" class="headerlink" title="5.2 Designing a mutation strategy"></a>5.2 Designing a mutation strategy</h3><ul>
<li>MLT 的问题<ul>
<li><strong>consecutive samples are correlated</strong>, which leads to <strong>higher variance</strong> than we would get with independent samples.<ul>
<li>连续被拒绝导致存在未收敛的相同样本，影响 variance</li>
</ul>
</li>
<li>This can happen either because <strong>the proposed mutations to the path are very small</strong>, or because <strong>too many mutations are rejected.</strong></li>
</ul>
</li>
<li>This problem can be minimized by choosing a suitable set of path mutations.</li>
<li>一些 mutation 需要具备的特征</li>
<li><strong>High acceptance probability</strong><ul>
<li>acceptance probability is small $\to$ long path sequences $\to$  many samples at the same point on the image plane $\to$ appears as noise</li>
</ul>
</li>
<li><strong>Large changes to the path</strong><ul>
<li>small mutations 还是可能会导致 highly correlated</li>
</ul>
</li>
<li><strong>Ergodicity</strong><ul>
<li>If the allowable mutations are too restricted, it is possible for the random walk to get \stuck” in some subregion of the path space.<ul>
<li>比如下面的 figure 2</li>
</ul>
</li>
<li>To minimize correlation between the sample locations on the image plane, <strong>it is desirable for mutations to change the lens edge $\mathrm{x}<em>{k-1}\mathrm{x}</em>{k}$</strong></li>
</ul>
</li>
</ul>
<img src="MLT/image-20210711232730897.png" style="zoom:80%;" />

<ul>
<li><strong>Stratification</strong><ul>
<li>This is commonly known as the “balls in bins” effect:<ul>
<li>if we randomly throw n balls into n bins, we cannot expect one ball per bin.</li>
<li>Many bins may be empty, while the fullest bin is likely to contain $\Theta({n\log n})$ balls</li>
<li>In an image, this unevenness in the distribution produces noise.</li>
</ul>
</li>
<li>For some kinds of mutations, this effect is difficult to avoid.</li>
<li><strong>However, it is worthwhile to consider mutations for which some form of stratification is possible.</strong></li>
</ul>
</li>
<li><strong>Low cost</strong><ul>
<li>Generally, this is measured by <strong>the number of rays cast,</strong> since the other costs are relatively small</li>
</ul>
</li>
</ul>
<h3 id="5-3-Good-mutation-strategies"><a href="#5-3-Good-mutation-strategies" class="headerlink" title="5.3 Good mutation strategies"></a>5.3 Good mutation strategies</h3><h4 id="5-3-1-Bidirectional-mutations"><a href="#5-3-1-Bidirectional-mutations" class="headerlink" title="5.3.1 Bidirectional mutations"></a>5.3.1 Bidirectional mutations</h4><ul>
<li></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/CG/Papers/1997/MLT/" data-id="cl9lj74bt00lt64tz8krg7amm" data-title="(论文)[1997] Metropolis Light Transport" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MCMC/" rel="tag">MCMC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MLT/" rel="tag">MLT</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/Papers/2005/ERPT" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/08/CG/Papers/2005/ERPT/" class="article-date">
  <time class="dt-published" datetime="2021-07-08T06:38:46.000Z" itemprop="datePublished">2021-07-08</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-Paper/">CG.Paper</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/08/CG/Papers/2005/ERPT/">(论文)[2005] Energy redistribution path tracing</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Energy-redistribution-path-tracing"><a href="#Energy-redistribution-path-tracing" class="headerlink" title="Energy redistribution path tracing"></a>Energy redistribution path tracing</h1><ul>
<li><strong><span style="color:red;">TODO</span></strong></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/08/CG/Papers/2005/ERPT/" data-id="cl9lj74bs00ln64tzev792pmr" data-title="(论文)[2005] Energy redistribution path tracing" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/Papers/2020/pathdifferential-mcmc" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/07/06/CG/Papers/2020/pathdifferential-mcmc/" class="article-date">
  <time class="dt-published" datetime="2021-07-06T09:05:43.000Z" itemprop="datePublished">2021-07-06</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-Paper/">CG.Paper</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/07/06/CG/Papers/2020/pathdifferential-mcmc/">(论文)[2020] Path Differential-Informed Stratified MCMC and Adaptive Forward Path Sampling</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><p>Tobias Zirr and Carsten Dachsbacher. 2020. Path Differential-Informed Stratified MCMC and Adaptive Forward Path Sampling. ACM Trans. Graph. 39,6, Article 246 (December 2020), 19 pages. <a target="_blank" rel="noopener" href="https://doi.org/10.1145/3414685.3417856">https://doi.org/10.1145/3414685.3417856</a></p>
</li>
<li><p>结果图</p>
</li>
</ul>
<img src="pathdifferential-mcmc/image-20210706183728776.png" style="zoom:80%;" />



<p><span style="color:red;font-weight:bold">没看懂 emmmm, TODO</span></p>
<h1 id="Path-Differential-Informed-Stratified-MCMC-and-Adaptive-Forward-Path-Sampling"><a href="#Path-Differential-Informed-Stratified-MCMC-and-Adaptive-Forward-Path-Sampling" class="headerlink" title="Path Differential-Informed Stratified MCMC and Adaptive Forward Path Sampling"></a>Path Differential-Informed Stratified MCMC and Adaptive Forward Path Sampling</h1><ul>
<li>we apply <strong>our theoretical framework</strong> to <strong>optimize</strong> an <strong>adaptive MCMC algorithm</strong> that only uses <strong>forward path construction</strong>.</li>
</ul>
<h2 id="1-INTRODUCTION"><a href="#1-INTRODUCTION" class="headerlink" title="1 INTRODUCTION"></a>1 INTRODUCTION</h2><ul>
<li>MLT：Markov Chain Monte Carlo (MCMC) light transport</li>
<li>MCMC 在工业界用的比较少<ul>
<li>The <strong>quality</strong> of results is oftentimes <strong>hard to control and nonuniform</strong>.</li>
</ul>
</li>
<li>对给出路径的方差估计<ul>
<li>We derive a novel analytic function that <strong>conservatively estimates variance</strong> caused by <strong>a given path sample</strong>.</li>
</ul>
</li>
<li>As a proof of concept, we apply the gained insights to both stratification and optimal adaptive sampling in the context of MCMC:<ul>
<li>We <strong>stratify</strong> the <strong>target function</strong> of the Markov Chain (akin to Hoberock et al. [2010]) using our analytic variance bounds.</li>
<li>We <strong>optimize</strong> the shape of proposal distributions in path space MCMC and by this push the capabilities of forward path tracing, to compete with other <strong>bi-directional</strong> methods.</li>
<li>We complement the resulting small step based on forward path construction by embedding a full path tracer with minimal changes, importing established MC variance reduction and sample reuse, such as multiple importance sampling (MIS), next event estimation (NEE), and shared path prefixes.</li>
</ul>
</li>
<li>Our MCMC renderer effectively becomes an <strong>adaptive path tracer</strong>, with the usual benefits of reduced <strong>algorithmic complexity</strong>, avoiding efforts to ensure reciprocity (e.g. for shading normals), and focussed sampling efforts due to tracing from the camera.</li>
</ul>
<h2 id="2-BACKGROUND"><a href="#2-BACKGROUND" class="headerlink" title="2 BACKGROUND"></a>2 BACKGROUND</h2><ul>
<li>The goal of MC and MCMC rendering methods is to compute the light transported on all possible paths $X&#x3D;(\mathrm{x}_1,\cdots,\mathrm{x}_k$) (for all vertex counts $k\ge2$) in a path space $\Omega$ to the individual pixels of a sensor.</li>
<li>light trasport</li>
<li>For a given path $X$ the measurement contribution $f(X)$ [Veach 1998] (w.r.t. the area measure $\mathrm{d}A$ on all scene surfaces M) is evaluated and the measurement for the j-th pixel with sensitivity $h_j(X)$ is computed by a path integral in the rendering equation</li>
</ul>
<p>$$<br>I_j&#x3D;\int_{\Omega}h_j(X)f(X);\mathrm{dX},;; \mathrm{dX}&#x3D;\prod_{i&#x3D;1}^k\mathrm{dA_i}<br>$$</p>
<h3 id="Integration-by-Stochastic-Sampling"><a href="#Integration-by-Stochastic-Sampling" class="headerlink" title="Integration by Stochastic Sampling"></a>Integration by Stochastic Sampling</h3><ul>
<li>随机抽样积分法</li>
<li>MC（蒙特卡洛积分）<ul>
<li>stochastic path sampling</li>
<li>good importance sampling<ul>
<li>in order to <strong>sample high-throughput paths frequently</strong> and to <strong>reduce variance of the result</strong></li>
</ul>
</li>
<li>Multiple Importance Sampling (MIS) [Veach and Guibas 1995]</li>
</ul>
</li>
<li>MCMC<ul>
<li>MCMC rendering algorithms, introduced as <strong>Metropolis Light Transport</strong> (MLT) [Veach and Guibas 1997], make use of the Metropolis-Hastings algorithm resp. the generalizing Reversible Jump (RJ) framework [Geyer 2003; Green 1995, 2003] to enable correlated path sampling while maintaining a controlled distribution that allows MC integration.</li>
<li>MCMC + MIS（减小方差）</li>
<li>Primary Sample Space MLT (PSSMLT) [Kelemen et al. 2002]</li>
</ul>
</li>
</ul>
<h3 id="Generalizations-and-Mixed-Proposals-in-MCMC"><a href="#Generalizations-and-Mixed-Proposals-in-MCMC" class="headerlink" title="Generalizations and Mixed Proposals in MCMC"></a>Generalizations and Mixed Proposals in MCMC</h3><h3 id="Multiple-Proposals-in-MCMC"><a href="#Multiple-Proposals-in-MCMC" class="headerlink" title="Multiple Proposals in MCMC"></a>Multiple Proposals in MCMC</h3><ul>
<li>Multiple Try Framework [Liu et al. 2000] (MT)</li>
</ul>
<h3 id="Stratification-in-MCMC"><a href="#Stratification-in-MCMC" class="headerlink" title="Stratification in MCMC"></a>Stratification in MCMC</h3><ul>
<li>Stratification, the targeted distribution of samples across pixels and into regions (strata) with potential relevance to the image, is an important feature of MC estimators to accelerate the convergence of MC estimates.</li>
</ul>
<h3 id="Stratification-of-Markov-Chain-Initiation"><a href="#Stratification-of-Markov-Chain-Initiation" class="headerlink" title="Stratification of Markov Chain Initiation"></a>Stratification of Markov Chain Initiation</h3><ul>
<li>ERPT framework</li>
</ul>
<h3 id="Short-term-Stratification-and-Step-Sizes"><a href="#Short-term-Stratification-and-Step-Sizes" class="headerlink" title="Short-term Stratification and Step Sizes"></a>Short-term Stratification and Step Sizes</h3><ul>
<li>Zsolnai and Szirmay-Kalos [2013] propose scene-wide automatic parameter tuning, which by its nature has limited local adaptivity.</li>
</ul>
<h3 id="Path-Differentials-in-Light-Transport"><a href="#Path-Differentials-in-Light-Transport" class="headerlink" title="Path Differentials in Light Transport"></a>Path Differentials in Light Transport</h3><h3 id="Path-Guiding"><a href="#Path-Guiding" class="headerlink" title="Path Guiding"></a>Path Guiding</h3><h2 id="3-OVERVIEW-OF-OUR-METHOD"><a href="#3-OVERVIEW-OF-OUR-METHOD" class="headerlink" title="3 OVERVIEW OF OUR METHOD"></a>3 OVERVIEW OF OUR METHOD</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/07/06/CG/Papers/2020/pathdifferential-mcmc/" data-id="cl9lj74dy01b964tzbabk6g25" data-title="(论文)[2020] Path Differential-Informed Stratified MCMC and Adaptive Forward Path Sampling" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MCMC/" rel="tag">MCMC</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-book/directory/BoYiYuSheHui" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/28/book/directory/BoYiYuSheHui/" class="article-date">
  <time class="dt-published" datetime="2021-06-28T06:01:29.000Z" itemprop="datePublished">2021-06-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/book-directory/">book.directory</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/28/book/directory/BoYiYuSheHui/">博弈与社会目录</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="博弈与社会"><a href="#博弈与社会" class="headerlink" title="博弈与社会"></a>博弈与社会</h1><h2 id="第一章-导论-个体理性与社会最优"><a href="#第一章-导论-个体理性与社会最优" class="headerlink" title="第一章 导论 个体理性与社会最优"></a>第一章 导论 个体理性与社会最优</h2><h3 id="第一节-社会的基本问题"><a href="#第一节-社会的基本问题" class="headerlink" title="第一节 社会的基本问题"></a>第一节 社会的基本问题</h3><h4 id="1-1-协调问题"><a href="#1-1-协调问题" class="headerlink" title="1.1 协调问题"></a>1.1 协调问题</h4><h4 id="1-2-合作问题"><a href="#1-2-合作问题" class="headerlink" title="1.2 合作问题"></a>1.2 合作问题</h4><h4 id="1-3-协调与合作交织"><a href="#1-3-协调与合作交织" class="headerlink" title="1.3 协调与合作交织"></a>1.3 协调与合作交织</h4><h4 id="1-4-正式制度与非正式制度"><a href="#1-4-正式制度与非正式制度" class="headerlink" title="1.4 正式制度与非正式制度"></a>1.4 正式制度与非正式制度</h4><h3 id="第二节-个体理性行为"><a href="#第二节-个体理性行为" class="headerlink" title="第二节 个体理性行为"></a>第二节 个体理性行为</h3><h4 id="2-1-博弈论的方法论"><a href="#2-1-博弈论的方法论" class="headerlink" title="2.1 博弈论的方法论"></a>2.1 博弈论的方法论</h4><h4 id="2-2-工具理性假设"><a href="#2-2-工具理性假设" class="headerlink" title="2.2 工具理性假设"></a>2.2 工具理性假设</h4><h4 id="2-3-有限理性"><a href="#2-3-有限理性" class="headerlink" title="2.3 有限理性"></a>2.3 有限理性</h4><h4 id="2-4-理性人假设的意义"><a href="#2-4-理性人假设的意义" class="headerlink" title="2.4 理性人假设的意义"></a>2.4 理性人假设的意义</h4><h3 id="第三节-社会最优与帕累托标准"><a href="#第三节-社会最优与帕累托标准" class="headerlink" title="第三节 社会最优与帕累托标准"></a>第三节 社会最优与帕累托标准</h3><h4 id="3-1-帕累托效率标准"><a href="#3-1-帕累托效率标准" class="headerlink" title="3.1 帕累托效率标准"></a>3.1 帕累托效率标准</h4><h4 id="3-2-效率的卡尔多-希克斯标准"><a href="#3-2-效率的卡尔多-希克斯标准" class="headerlink" title="3.2 效率的卡尔多-希克斯标准"></a>3.2 效率的卡尔多-希克斯标准</h4><h4 id="3-3-效率标准在法律上的应用"><a href="#3-3-效率标准在法律上的应用" class="headerlink" title="3.3 效率标准在法律上的应用"></a>3.3 效率标准在法律上的应用</h4><h3 id="本章提要"><a href="#本章提要" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第二章-纳什均衡与囚徒困境博弈"><a href="#第二章-纳什均衡与囚徒困境博弈" class="headerlink" title="第二章 纳什均衡与囚徒困境博弈"></a>第二章 纳什均衡与囚徒困境博弈</h2><h3 id="第一节-博弈论的基本概念"><a href="#第一节-博弈论的基本概念" class="headerlink" title="第一节 博弈论的基本概念"></a>第一节 博弈论的基本概念</h3><h3 id="第二节-囚徒困境博弈"><a href="#第二节-囚徒困境博弈" class="headerlink" title="第二节 囚徒困境博弈"></a>第二节 囚徒困境博弈</h3><h4 id="2-1-囚徒困境：个人理性与集体理性的矛盾"><a href="#2-1-囚徒困境：个人理性与集体理性的矛盾" class="headerlink" title="2.1 囚徒困境：个人理性与集体理性的矛盾"></a>2.1 囚徒困境：个人理性与集体理性的矛盾</h4><h4 id="2-2-囚徒困境举例"><a href="#2-2-囚徒困境举例" class="headerlink" title="2.2 囚徒困境举例"></a>2.2 囚徒困境举例</h4><h4 id="2-3-囚徒困境的一般形式"><a href="#2-3-囚徒困境的一般形式" class="headerlink" title="2.3 囚徒困境的一般形式"></a>2.3 囚徒困境的一般形式</h4><h3 id="第三节-理性化选择"><a href="#第三节-理性化选择" class="headerlink" title="第三节 理性化选择"></a>第三节 理性化选择</h3><h4 id="3-1-理性人不选择坏战略"><a href="#3-1-理性人不选择坏战略" class="headerlink" title="3.1 理性人不选择坏战略"></a>3.1 理性人不选择坏战略</h4><h4 id="3-2-理性作为共同知识"><a href="#3-2-理性作为共同知识" class="headerlink" title="3.2 理性作为共同知识"></a>3.2 理性作为共同知识</h4><h3 id="第四节-纳什均衡与一致预期"><a href="#第四节-纳什均衡与一致预期" class="headerlink" title="第四节 纳什均衡与一致预期"></a>第四节 纳什均衡与一致预期</h3><h4 id="4-1-纳什均衡"><a href="#4-1-纳什均衡" class="headerlink" title="4.1 纳什均衡"></a>4.1 纳什均衡</h4><h4 id="4-2-应用举例：寻租行为和产权制度"><a href="#4-2-应用举例：寻租行为和产权制度" class="headerlink" title="4.2 应用举例：寻租行为和产权制度"></a>4.2 应用举例：寻租行为和产权制度</h4><h4 id="4-3-混合策略下的纳什均衡"><a href="#4-3-混合策略下的纳什均衡" class="headerlink" title="4.3 混合策略下的纳什均衡"></a>4.3 混合策略下的纳什均衡</h4><h3 id="本章提要-1"><a href="#本章提要-1" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第三章-多重均衡与制度和文化"><a href="#第三章-多重均衡与制度和文化" class="headerlink" title="第三章 多重均衡与制度和文化"></a>第三章 多重均衡与制度和文化</h2><h3 id="第一节-多重均衡问题"><a href="#第一节-多重均衡问题" class="headerlink" title="第一节 多重均衡问题"></a>第一节 多重均衡问题</h3><h4 id="1-1-产品标准化问题"><a href="#1-1-产品标准化问题" class="headerlink" title="1.1 产品标准化问题"></a>1.1 产品标准化问题</h4><h4 id="1-2-交通博弈"><a href="#1-2-交通博弈" class="headerlink" title="1.2 交通博弈"></a>1.2 交通博弈</h4><h4 id="1-3-约会博弈"><a href="#1-3-约会博弈" class="headerlink" title="1.3 约会博弈"></a>1.3 约会博弈</h4><h4 id="1-4-资源争夺博弈"><a href="#1-4-资源争夺博弈" class="headerlink" title="1.4 资源争夺博弈"></a>1.4 资源争夺博弈</h4><h4 id="1-5-分蛋糕问题"><a href="#1-5-分蛋糕问题" class="headerlink" title="1.5 分蛋糕问题"></a>1.5 分蛋糕问题</h4><h3 id="第二节-聚点均衡和均衡选择"><a href="#第二节-聚点均衡和均衡选择" class="headerlink" title="第二节 聚点均衡和均衡选择"></a>第二节 聚点均衡和均衡选择</h3><h4 id="2-1-聚点均衡"><a href="#2-1-聚点均衡" class="headerlink" title="2.1 聚点均衡"></a>2.1 聚点均衡</h4><h4 id="2-2-帕累托标准"><a href="#2-2-帕累托标准" class="headerlink" title="2.2 帕累托标准"></a>2.2 帕累托标准</h4><h3 id="第三节-法律和社会规范的协调作用"><a href="#第三节-法律和社会规范的协调作用" class="headerlink" title="第三节 法律和社会规范的协调作用"></a>第三节 法律和社会规范的协调作用</h3><h4 id="3-1-交通规则的演进"><a href="#3-1-交通规则的演进" class="headerlink" title="3.1 交通规则的演进"></a>3.1 交通规则的演进</h4><h4 id="3-2-规则间的冲突和协调"><a href="#3-2-规则间的冲突和协调" class="headerlink" title="3.2 规则间的冲突和协调"></a>3.2 规则间的冲突和协调</h4><h4 id="3-3-协调中的信息"><a href="#3-3-协调中的信息" class="headerlink" title="3.3 协调中的信息"></a>3.3 协调中的信息</h4><h4 id="3-4-规则的正义性"><a href="#3-4-规则的正义性" class="headerlink" title="3.4 规则的正义性"></a>3.4 规则的正义性</h4><h3 id="第四节-路径依赖的困惑"><a href="#第四节-路径依赖的困惑" class="headerlink" title="第四节 路径依赖的困惑"></a>第四节 路径依赖的困惑</h3><h4 id="4-1-键盘的寓言"><a href="#4-1-键盘的寓言" class="headerlink" title="4.1 键盘的寓言"></a>4.1 键盘的寓言</h4><h4 id="4-2-VHS的秘密"><a href="#4-2-VHS的秘密" class="headerlink" title="4.2 VHS的秘密"></a>4.2 VHS的秘密</h4><h4 id="4-3-微软神话"><a href="#4-3-微软神话" class="headerlink" title="4.3 微软神话"></a>4.3 微软神话</h4><h4 id="4-4-大学改革的童话"><a href="#4-4-大学改革的童话" class="headerlink" title="4.4 大学改革的童话"></a>4.4 大学改革的童话</h4><h3 id="本章提要-2"><a href="#本章提要-2" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第四章-威胁与承诺"><a href="#第四章-威胁与承诺" class="headerlink" title="第四章 威胁与承诺"></a>第四章 威胁与承诺</h2><h3 id="第一节-威胁的可信与不可信"><a href="#第一节-威胁的可信与不可信" class="headerlink" title="第一节 威胁的可信与不可信"></a>第一节 威胁的可信与不可信</h3><h4 id="1-1-动态博弈的描述"><a href="#1-1-动态博弈的描述" class="headerlink" title="1.1 动态博弈的描述"></a>1.1 动态博弈的描述</h4><h4 id="1-2-作为行动计划的战略"><a href="#1-2-作为行动计划的战略" class="headerlink" title="1.2 作为行动计划的战略"></a>1.2 作为行动计划的战略</h4><h4 id="1-3-威胁的可信性"><a href="#1-3-威胁的可信性" class="headerlink" title="1.3 威胁的可信性"></a>1.3 威胁的可信性</h4><h3 id="第二节-序贯理性"><a href="#第二节-序贯理性" class="headerlink" title="第二节 序贯理性"></a>第二节 序贯理性</h3><h4 id="2-1-动态博弈中的理性要求"><a href="#2-1-动态博弈中的理性要求" class="headerlink" title="2.1 动态博弈中的理性要求"></a>2.1 动态博弈中的理性要求</h4><h4 id="2-2-子博弈"><a href="#2-2-子博弈" class="headerlink" title="2.2 子博弈"></a>2.2 子博弈</h4><h4 id="2-3-逆向归纳与理性共识"><a href="#2-3-逆向归纳与理性共识" class="headerlink" title="2.3 逆向归纳与理性共识"></a>2.3 逆向归纳与理性共识</h4><h4 id="2-4-反事实悖论"><a href="#2-4-反事实悖论" class="headerlink" title="2.4 反事实悖论"></a>2.4 反事实悖论</h4><h3 id="第三节-承诺行为"><a href="#第三节-承诺行为" class="headerlink" title="第三节 承诺行为"></a>第三节 承诺行为</h3><h4 id="3-1-承诺的作用"><a href="#3-1-承诺的作用" class="headerlink" title="3.1 承诺的作用"></a>3.1 承诺的作用</h4><h4 id="3-2-承诺的成本"><a href="#3-2-承诺的成本" class="headerlink" title="3.2 承诺的成本"></a>3.2 承诺的成本</h4><h3 id="第四节-宪政与民主"><a href="#第四节-宪政与民主" class="headerlink" title="第四节 宪政与民主"></a>第四节 宪政与民主</h3><h4 id="4-1-有限政府"><a href="#4-1-有限政府" class="headerlink" title="4.1 有限政府"></a>4.1 有限政府</h4><h4 id="4-2-民主作为一种承诺"><a href="#4-2-民主作为一种承诺" class="headerlink" title="4.2 民主作为一种承诺"></a>4.2 民主作为一种承诺</h4><h3 id="本章提要-3"><a href="#本章提要-3" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第五章-讨价还价与耐心"><a href="#第五章-讨价还价与耐心" class="headerlink" title="第五章 讨价还价与耐心"></a>第五章 讨价还价与耐心</h2><h3 id="第一节-讨价还价问题"><a href="#第一节-讨价还价问题" class="headerlink" title="第一节 讨价还价问题"></a>第一节 讨价还价问题</h3><h4 id="1-1-合作与冲突"><a href="#1-1-合作与冲突" class="headerlink" title="1.1 合作与冲突"></a>1.1 合作与冲突</h4><h4 id="1-2-合作博弈与非合作博弈"><a href="#1-2-合作博弈与非合作博弈" class="headerlink" title="1.2 合作博弈与非合作博弈"></a>1.2 合作博弈与非合作博弈</h4><h3 id="第二节-谈判砝码与谈判能力"><a href="#第二节-谈判砝码与谈判能力" class="headerlink" title="第二节 谈判砝码与谈判能力"></a>第二节 谈判砝码与谈判能力</h3><h4 id="2-1-蛋糕的大小与分配"><a href="#2-1-蛋糕的大小与分配" class="headerlink" title="2.1 蛋糕的大小与分配"></a>2.1 蛋糕的大小与分配</h4><h4 id="2-2-纳什谈判解"><a href="#2-2-纳什谈判解" class="headerlink" title="2.2 纳什谈判解"></a>2.2 纳什谈判解</h4><h4 id="2-3-边际贡献与谈判能力"><a href="#2-3-边际贡献与谈判能力" class="headerlink" title="2.3 边际贡献与谈判能力"></a>2.3 边际贡献与谈判能力</h4><h4 id="2-4-改变谈判砝码"><a href="#2-4-改变谈判砝码" class="headerlink" title="2.4 改变谈判砝码"></a>2.4 改变谈判砝码</h4><h4 id="2-5-应用举例：国有企业改制中的资产定价"><a href="#2-5-应用举例：国有企业改制中的资产定价" class="headerlink" title="2.5 应用举例：国有企业改制中的资产定价"></a>2.5 应用举例：国有企业改制中的资产定价</h4><h3 id="第三节-轮流出价与耐心"><a href="#第三节-轮流出价与耐心" class="headerlink" title="第三节 轮流出价与耐心"></a>第三节 轮流出价与耐心</h3><h4 id="3-1-有限次谈判与后动优势"><a href="#3-1-有限次谈判与后动优势" class="headerlink" title="3.1 有限次谈判与后动优势"></a>3.1 有限次谈判与后动优势</h4><h4 id="3-2-无限期谈判与耐心"><a href="#3-2-无限期谈判与耐心" class="headerlink" title="3.2 无限期谈判与耐心"></a>3.2 无限期谈判与耐心</h4><h4 id="3-3-耐心与公平"><a href="#3-3-耐心与公平" class="headerlink" title="3.3 耐心与公平"></a>3.3 耐心与公平</h4><h4 id="3-4-谈判成本"><a href="#3-4-谈判成本" class="headerlink" title="3.4 谈判成本"></a>3.4 谈判成本</h4><h4 id="3-5-谈判与信息"><a href="#3-5-谈判与信息" class="headerlink" title="3.5 谈判与信息"></a>3.5 谈判与信息</h4><h3 id="第四节-谈判中的社会规范"><a href="#第四节-谈判中的社会规范" class="headerlink" title="第四节 谈判中的社会规范"></a>第四节 谈判中的社会规范</h3><h4 id="4-1-最后通牒博弈"><a href="#4-1-最后通牒博弈" class="headerlink" title="4.1 最后通牒博弈"></a>4.1 最后通牒博弈</h4><h4 id="4-2-社会规范"><a href="#4-2-社会规范" class="headerlink" title="4.2 社会规范"></a>4.2 社会规范</h4><h3 id="本章提要-4"><a href="#本章提要-4" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第六章-重复博弈和合作行为"><a href="#第六章-重复博弈和合作行为" class="headerlink" title="第六章 重复博弈和合作行为"></a>第六章 重复博弈和合作行为</h2><h3 id="第一节-走出囚徒困境"><a href="#第一节-走出囚徒困境" class="headerlink" title="第一节 走出囚徒困境"></a>第一节 走出囚徒困境</h3><h4 id="1-1-重复博弈"><a href="#1-1-重复博弈" class="headerlink" title="1.1 重复博弈"></a>1.1 重复博弈</h4><h4 id="1-2-战略空间"><a href="#1-2-战略空间" class="headerlink" title="1.2 战略空间"></a>1.2 战略空间</h4><h4 id="1-3-合作的价值与耐心"><a href="#1-3-合作的价值与耐心" class="headerlink" title="1.3 合作的价值与耐心"></a>1.3 合作的价值与耐心</h4><h3 id="第二节-合作与惩罚"><a href="#第二节-合作与惩罚" class="headerlink" title="第二节 合作与惩罚"></a>第二节 合作与惩罚</h3><h4 id="2-1-针锋相对"><a href="#2-1-针锋相对" class="headerlink" title="2.1 针锋相对"></a>2.1 针锋相对</h4><h4 id="2-2-永不原谅"><a href="#2-2-永不原谅" class="headerlink" title="2.2 永不原谅"></a>2.2 永不原谅</h4><h4 id="2-3-信息与合作"><a href="#2-3-信息与合作" class="headerlink" title="2.3 信息与合作"></a>2.3 信息与合作</h4><h4 id="2-4-胡萝卜加大棒"><a href="#2-4-胡萝卜加大棒" class="headerlink" title="2.4 胡萝卜加大棒"></a>2.4 胡萝卜加大棒</h4><h4 id="2-5-皇帝女儿不愁嫁"><a href="#2-5-皇帝女儿不愁嫁" class="headerlink" title="2.5 皇帝女儿不愁嫁"></a>2.5 皇帝女儿不愁嫁</h4><h4 id="2-6-过犹不及"><a href="#2-6-过犹不及" class="headerlink" title="2.6 过犹不及"></a>2.6 过犹不及</h4><h3 id="第三节-大社会中的合作"><a href="#第三节-大社会中的合作" class="headerlink" title="第三节 大社会中的合作"></a>第三节 大社会中的合作</h3><h4 id="3-1-多重关系下的合作"><a href="#3-1-多重关系下的合作" class="headerlink" title="3.1 多重关系下的合作"></a>3.1 多重关系下的合作</h4><h4 id="3-2-长期参与人"><a href="#3-2-长期参与人" class="headerlink" title="3.2 长期参与人"></a>3.2 长期参与人</h4><h4 id="3-3-和尚与庙"><a href="#3-3-和尚与庙" class="headerlink" title="3.3 和尚与庙"></a>3.3 和尚与庙</h4><h4 id="3-4-联合抵制的社会规范"><a href="#3-4-联合抵制的社会规范" class="headerlink" title="3.4 联合抵制的社会规范"></a>3.4 联合抵制的社会规范</h4><h4 id="3-5-敌友规则"><a href="#3-5-敌友规则" class="headerlink" title="3.5 敌友规则"></a>3.5 敌友规则</h4><h4 id="3-6-连带责任"><a href="#3-6-连带责任" class="headerlink" title="3.6 连带责任"></a>3.6 连带责任</h4><h3 id="本章提要-5"><a href="#本章提要-5" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第七章-不完全信息与声誉"><a href="#第七章-不完全信息与声誉" class="headerlink" title="第七章 不完全信息与声誉"></a>第七章 不完全信息与声誉</h2><h3 id="第一节-连锁店悖论"><a href="#第一节-连锁店悖论" class="headerlink" title="第一节 连锁店悖论"></a>第一节 连锁店悖论</h3><h4 id="1-1-连锁店悖论"><a href="#1-1-连锁店悖论" class="headerlink" title="1.1 连锁店悖论"></a>1.1 连锁店悖论</h4><h4 id="1-2-奖惩与合作"><a href="#1-2-奖惩与合作" class="headerlink" title="1.2 奖惩与合作"></a>1.2 奖惩与合作</h4><h3 id="第二节-信息不完全与声誉机制"><a href="#第二节-信息不完全与声誉机制" class="headerlink" title="第二节 信息不完全与声誉机制"></a>第二节 信息不完全与声誉机制</h3><h4 id="2-1-单方信息不完全与声誉机制"><a href="#2-1-单方信息不完全与声誉机制" class="headerlink" title="2.1 单方信息不完全与声誉机制"></a>2.1 单方信息不完全与声誉机制</h4><h4 id="2-2-双方信息不完全下的声誉机制"><a href="#2-2-双方信息不完全下的声誉机制" class="headerlink" title="2.2 双方信息不完全下的声誉机制"></a>2.2 双方信息不完全下的声誉机制</h4><h3 id="第三节-声誉模型应用举例"><a href="#第三节-声誉模型应用举例" class="headerlink" title="第三节 声誉模型应用举例"></a>第三节 声誉模型应用举例</h3><h4 id="3-1-解开连锁店悖论"><a href="#3-1-解开连锁店悖论" class="headerlink" title="3.1 解开连锁店悖论"></a>3.1 解开连锁店悖论</h4><h4 id="3-2-大智若愚"><a href="#3-2-大智若愚" class="headerlink" title="3.2 大智若愚"></a>3.2 大智若愚</h4><h4 id="3-3-政府的声誉"><a href="#3-3-政府的声誉" class="headerlink" title="3.3 政府的声誉"></a>3.3 政府的声誉</h4><h4 id="3-4-“刑不上大夫”"><a href="#3-4-“刑不上大夫”" class="headerlink" title="3.4 “刑不上大夫”"></a>3.4 “刑不上大夫”</h4><h3 id="第四节-声誉的积累"><a href="#第四节-声誉的积累" class="headerlink" title="第四节 声誉的积累"></a>第四节 声誉的积累</h3><h4 id="4-1-贝叶斯法则"><a href="#4-1-贝叶斯法则" class="headerlink" title="4.1 贝叶斯法则"></a>4.1 贝叶斯法则</h4><h4 id="4-2-假作真来真亦假"><a href="#4-2-假作真来真亦假" class="headerlink" title="4.2 假作真来真亦假"></a>4.2 假作真来真亦假</h4><h4 id="4-3-大学的名声"><a href="#4-3-大学的名声" class="headerlink" title="4.3 大学的名声"></a>4.3 大学的名声</h4><h3 id="本章提要-6"><a href="#本章提要-6" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第八章-逆向选择与品牌和政府管制"><a href="#第八章-逆向选择与品牌和政府管制" class="headerlink" title="第八章 逆向选择与品牌和政府管制"></a>第八章 逆向选择与品牌和政府管制</h2><h3 id="第一节-非对称信息问题及其后果"><a href="#第一节-非对称信息问题及其后果" class="headerlink" title="第一节 非对称信息问题及其后果"></a>第一节 非对称信息问题及其后果</h3><h4 id="1-1-非对称信息问题"><a href="#1-1-非对称信息问题" class="headerlink" title="1.1 非对称信息问题"></a>1.1 非对称信息问题</h4><h4 id="1-2-逆向选择"><a href="#1-2-逆向选择" class="headerlink" title="1.2 逆向选择"></a>1.2 逆向选择</h4><h4 id="1-3-金融市场中的逆向选择"><a href="#1-3-金融市场中的逆向选择" class="headerlink" title="1.3 金融市场中的逆向选择"></a>1.3 金融市场中的逆向选择</h4><h4 id="1-4-生活中其他一些逆向选择现象"><a href="#1-4-生活中其他一些逆向选择现象" class="headerlink" title="1.4 生活中其他一些逆向选择现象"></a>1.4 生活中其他一些逆向选择现象</h4><h3 id="第二节-非对称信息与品牌价值"><a href="#第二节-非对称信息与品牌价值" class="headerlink" title="第二节 非对称信息与品牌价值"></a>第二节 非对称信息与品牌价值</h3><h4 id="2-1-解决非对称信息的市场机制"><a href="#2-1-解决非对称信息的市场机制" class="headerlink" title="2.1 解决非对称信息的市场机制"></a>2.1 解决非对称信息的市场机制</h4><h4 id="2-2-行业与品牌价值"><a href="#2-2-行业与品牌价值" class="headerlink" title="2.2 行业与品牌价值"></a>2.2 行业与品牌价值</h4><h4 id="2-3-技术进步与品牌"><a href="#2-3-技术进步与品牌" class="headerlink" title="2.3 技术进步与品牌"></a>2.3 技术进步与品牌</h4><h4 id="2-4-收入水平与品牌价值"><a href="#2-4-收入水平与品牌价值" class="headerlink" title="2.4 收入水平与品牌价值"></a>2.4 收入水平与品牌价值</h4><h3 id="第三节-非对称信息与政府管制"><a href="#第三节-非对称信息与政府管制" class="headerlink" title="第三节 非对称信息与政府管制"></a>第三节 非对称信息与政府管制</h3><h4 id="3-1-解决非对称信息的非市场机制"><a href="#3-1-解决非对称信息的非市场机制" class="headerlink" title="3.1 解决非对称信息的非市场机制"></a>3.1 解决非对称信息的非市场机制</h4><h4 id="3-2-政府管制与信誉"><a href="#3-2-政府管制与信誉" class="headerlink" title="3.2 政府管制与信誉"></a>3.2 政府管制与信誉</h4><h3 id="本章提要-7"><a href="#本章提要-7" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第九章-信号传递与社会规范"><a href="#第九章-信号传递与社会规范" class="headerlink" title="第九章 信号传递与社会规范"></a>第九章 信号传递与社会规范</h2><h3 id="第一节-信号传递机制"><a href="#第一节-信号传递机制" class="headerlink" title="第一节 信号传递机制"></a>第一节 信号传递机制</h3><h4 id="1-1-学历与能力"><a href="#1-1-学历与能力" class="headerlink" title="1.1 学历与能力"></a>1.1 学历与能力</h4><h4 id="1-2-信号传递的一般模型"><a href="#1-2-信号传递的一般模型" class="headerlink" title="1.2 信号传递的一般模型"></a>1.2 信号传递的一般模型</h4><h3 id="第二节-经济和社会生活中的种种信号"><a href="#第二节-经济和社会生活中的种种信号" class="headerlink" title="第二节 经济和社会生活中的种种信号"></a>第二节 经济和社会生活中的种种信号</h3><h4 id="2-1-广告的信号传递作用"><a href="#2-1-广告的信号传递作用" class="headerlink" title="2.1 广告的信号传递作用"></a>2.1 广告的信号传递作用</h4><h4 id="2-2-资本市场中的信号传递"><a href="#2-2-资本市场中的信号传递" class="headerlink" title="2.2 资本市场中的信号传递"></a>2.2 资本市场中的信号传递</h4><h4 id="2-3-资本雇佣劳动"><a href="#2-3-资本雇佣劳动" class="headerlink" title="2.3 资本雇佣劳动"></a>2.3 资本雇佣劳动</h4><h4 id="2-4-生活中的信号传递"><a href="#2-4-生活中的信号传递" class="headerlink" title="2.4 生活中的信号传递"></a>2.4 生活中的信号传递</h4><h3 id="第三节-社会规范的信号传递作用"><a href="#第三节-社会规范的信号传递作用" class="headerlink" title="第三节 社会规范的信号传递作用"></a>第三节 社会规范的信号传递作用</h3><h4 id="3-1-如何理解送礼"><a href="#3-1-如何理解送礼" class="headerlink" title="3.1 如何理解送礼"></a>3.1 如何理解送礼</h4><h4 id="3-2-婚姻契约"><a href="#3-2-婚姻契约" class="headerlink" title="3.2 婚姻契约"></a>3.2 婚姻契约</h4><h4 id="3-3-浪费性消费"><a href="#3-3-浪费性消费" class="headerlink" title="3.3 浪费性消费"></a>3.3 浪费性消费</h4><h4 id="3-4-礼仪和法律的作用"><a href="#3-4-礼仪和法律的作用" class="headerlink" title="3.4 礼仪和法律的作用"></a>3.4 礼仪和法律的作用</h4><h4 id="3-5-信息不对称与观念变迁"><a href="#3-5-信息不对称与观念变迁" class="headerlink" title="3.5 信息不对称与观念变迁"></a>3.5 信息不对称与观念变迁</h4><h3 id="本章提要-8"><a href="#本章提要-8" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第十章-机制设计与收入分配"><a href="#第十章-机制设计与收入分配" class="headerlink" title="第十章 机制设计与收入分配"></a>第十章 机制设计与收入分配</h2><h3 id="第一节-机制设计理论"><a href="#第一节-机制设计理论" class="headerlink" title="第一节 机制设计理论"></a>第一节 机制设计理论</h3><h4 id="1-1-如何让人说真话"><a href="#1-1-如何让人说真话" class="headerlink" title="1.1 如何让人说真话"></a>1.1 如何让人说真话</h4><h4 id="1-2-混同均衡和分离均衡"><a href="#1-2-混同均衡和分离均衡" class="headerlink" title="1.2 混同均衡和分离均衡"></a>1.2 混同均衡和分离均衡</h4><h4 id="1-3-部分保险与全额保险"><a href="#1-3-部分保险与全额保险" class="headerlink" title="1.3 部分保险与全额保险"></a>1.3 部分保险与全额保险</h4><h3 id="第二节-价格歧视"><a href="#第二节-价格歧视" class="headerlink" title="第二节 价格歧视"></a>第二节 价格歧视</h3><h4 id="2-1-卖方的无知"><a href="#2-1-卖方的无知" class="headerlink" title="2.1 卖方的无知"></a>2.1 卖方的无知</h4><h4 id="2-2-两部收费制与信息租金"><a href="#2-2-两部收费制与信息租金" class="headerlink" title="2.2 两部收费制与信息租金"></a>2.2 两部收费制与信息租金</h4><h4 id="2-3-穷人受罪与吓唬富人"><a href="#2-3-穷人受罪与吓唬富人" class="headerlink" title="2.3 穷人受罪与吓唬富人"></a>2.3 穷人受罪与吓唬富人</h4><h3 id="第三节-拍卖机制设计和公共产品偏好"><a href="#第三节-拍卖机制设计和公共产品偏好" class="headerlink" title="第三节 拍卖机制设计和公共产品偏好"></a>第三节 拍卖机制设计和公共产品偏好</h3><h4 id="3-1-四种基本拍卖方式"><a href="#3-1-四种基本拍卖方式" class="headerlink" title="3.1 四种基本拍卖方式"></a>3.1 四种基本拍卖方式</h4><h4 id="3-2-说实话的拍卖机制"><a href="#3-2-说实话的拍卖机制" class="headerlink" title="3.2 说实话的拍卖机制"></a>3.2 说实话的拍卖机制</h4><h4 id="3-3-公共产品的偏好显示"><a href="#3-3-公共产品的偏好显示" class="headerlink" title="3.3 公共产品的偏好显示"></a>3.3 公共产品的偏好显示</h4><h3 id="第四节-平等与效率"><a href="#第四节-平等与效率" class="headerlink" title="第四节 平等与效率"></a>第四节 平等与效率</h3><h4 id="4-1-平等与效率矛盾的根源"><a href="#4-1-平等与效率矛盾的根源" class="headerlink" title="4.1 平等与效率矛盾的根源"></a>4.1 平等与效率矛盾的根源</h4><h4 id="4-2-莫里斯最优收入税理论"><a href="#4-2-莫里斯最优收入税理论" class="headerlink" title="4.2 莫里斯最优收入税理论"></a>4.2 莫里斯最优收入税理论</h4><h4 id="4-3-国有企业高素质员工的流失"><a href="#4-3-国有企业高素质员工的流失" class="headerlink" title="4.3 国有企业高素质员工的流失"></a>4.3 国有企业高素质员工的流失</h4><h3 id="第五节-大学教师的选拔机制"><a href="#第五节-大学教师的选拔机制" class="headerlink" title="第五节 大学教师的选拔机制"></a>第五节 大学教师的选拔机制</h3><h4 id="5-1-鱼目混珠与自投罗网"><a href="#5-1-鱼目混珠与自投罗网" class="headerlink" title="5.1 鱼目混珠与自投罗网"></a>5.1 鱼目混珠与自投罗网</h4><h4 id="5-2-解决武大郎开店问题"><a href="#5-2-解决武大郎开店问题" class="headerlink" title="5.2 解决武大郎开店问题"></a>5.2 解决武大郎开店问题</h4><h3 id="本章提要-9"><a href="#本章提要-9" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第十一章-道德风险与腐败"><a href="#第十一章-道德风险与腐败" class="headerlink" title="第十一章 道德风险与腐败"></a>第十一章 道德风险与腐败</h2><h3 id="第一节-从腐败谈起"><a href="#第一节-从腐败谈起" class="headerlink" title="第一节 从腐败谈起"></a>第一节 从腐败谈起</h3><h3 id="第二节-委托-代理模型"><a href="#第二节-委托-代理模型" class="headerlink" title="第二节 委托-代理模型"></a>第二节 委托-代理模型</h3><h4 id="2-1-利益冲突"><a href="#2-1-利益冲突" class="headerlink" title="2.1 利益冲突"></a>2.1 利益冲突</h4><h4 id="2-2-信息不对称"><a href="#2-2-信息不对称" class="headerlink" title="2.2 信息不对称"></a>2.2 信息不对称</h4><h4 id="2-3-风险态度"><a href="#2-3-风险态度" class="headerlink" title="2.3 风险态度"></a>2.3 风险态度</h4><h4 id="2-4-有限责任"><a href="#2-4-有限责任" class="headerlink" title="2.4 有限责任"></a>2.4 有限责任</h4><h3 id="第三节-激励机制的设计"><a href="#第三节-激励机制的设计" class="headerlink" title="第三节 激励机制的设计"></a>第三节 激励机制的设计</h3><h4 id="3-1-激励与保险的冲突"><a href="#3-1-激励与保险的冲突" class="headerlink" title="3.1 激励与保险的冲突"></a>3.1 激励与保险的冲突</h4><h4 id="3-2-激励的强度"><a href="#3-2-激励的强度" class="headerlink" title="3.2 激励的强度"></a>3.2 激励的强度</h4><h4 id="3-3-相对绩效比较"><a href="#3-3-相对绩效比较" class="headerlink" title="3.3 相对绩效比较"></a>3.3 相对绩效比较</h4><h4 id="3-4-论功行赏与任人唯贤"><a href="#3-4-论功行赏与任人唯贤" class="headerlink" title="3.4 论功行赏与任人唯贤"></a>3.4 论功行赏与任人唯贤</h4><h4 id="3-5-大学教员的激励"><a href="#3-5-大学教员的激励" class="headerlink" title="3.5 大学教员的激励"></a>3.5 大学教员的激励</h4><h3 id="第四节-政府官员的激励"><a href="#第四节-政府官员的激励" class="headerlink" title="第四节 政府官员的激励"></a>第四节 政府官员的激励</h3><h4 id="4-1-难以监督的官员"><a href="#4-1-难以监督的官员" class="headerlink" title="4.1 难以监督的官员"></a>4.1 难以监督的官员</h4><h4 id="4-2-腐败方程式"><a href="#4-2-腐败方程式" class="headerlink" title="4.2 腐败方程式"></a>4.2 腐败方程式</h4><h4 id="4-3-腐败的蔓延"><a href="#4-3-腐败的蔓延" class="headerlink" title="4.3 腐败的蔓延"></a>4.3 腐败的蔓延</h4><h4 id="4-4-腐败的治理"><a href="#4-4-腐败的治理" class="headerlink" title="4.4 腐败的治理"></a>4.4 腐败的治理</h4><h3 id="本章提要-10"><a href="#本章提要-10" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第十二章-演化博弈与自发秩序"><a href="#第十二章-演化博弈与自发秩序" class="headerlink" title="第十二章 演化博弈与自发秩序"></a>第十二章 演化博弈与自发秩序</h2><h3 id="第一节-演化博弈的基本要素"><a href="#第一节-演化博弈的基本要素" class="headerlink" title="第一节 演化博弈的基本要素"></a>第一节 演化博弈的基本要素</h3><h4 id="1-1-从生物进化到社会演进"><a href="#1-1-从生物进化到社会演进" class="headerlink" title="1.1 从生物进化到社会演进"></a>1.1 从生物进化到社会演进</h4><h4 id="1-2-演化稳定战略"><a href="#1-2-演化稳定战略" class="headerlink" title="1.2 演化稳定战略"></a>1.2 演化稳定战略</h4><h4 id="1-3-生物进化与社会演化的不同"><a href="#1-3-生物进化与社会演化的不同" class="headerlink" title="1.3 生物进化与社会演化的不同"></a>1.3 生物进化与社会演化的不同</h4><h4 id="1-4-单元均衡与多元均衡"><a href="#1-4-单元均衡与多元均衡" class="headerlink" title="1.4 单元均衡与多元均衡"></a>1.4 单元均衡与多元均衡</h4><h3 id="第二节-演化博弈举例"><a href="#第二节-演化博弈举例" class="headerlink" title="第二节 演化博弈举例"></a>第二节 演化博弈举例</h3><h4 id="2-1-协调博弈"><a href="#2-1-协调博弈" class="headerlink" title="2.1 协调博弈"></a>2.1 协调博弈</h4><h4 id="2-2-婚姻博弈"><a href="#2-2-婚姻博弈" class="headerlink" title="2.2 婚姻博弈"></a>2.2 婚姻博弈</h4><h4 id="2-3-鹰鸽博弈"><a href="#2-3-鹰鸽博弈" class="headerlink" title="2.3 鹰鸽博弈"></a>2.3 鹰鸽博弈</h4><h3 id="第三节-囚徒困境与合作文化的演进"><a href="#第三节-囚徒困境与合作文化的演进" class="headerlink" title="第三节 囚徒困境与合作文化的演进"></a>第三节 囚徒困境与合作文化的演进</h3><h4 id="3-1-针锋相对者生存"><a href="#3-1-针锋相对者生存" class="headerlink" title="3.1 针锋相对者生存"></a>3.1 针锋相对者生存</h4><h4 id="3-2-弱稳定与强稳定"><a href="#3-2-弱稳定与强稳定" class="headerlink" title="3.2 弱稳定与强稳定"></a>3.2 弱稳定与强稳定</h4><h4 id="3-3-合作文化的破坏"><a href="#3-3-合作文化的破坏" class="headerlink" title="3.3 合作文化的破坏"></a>3.3 合作文化的破坏</h4><h3 id="第四节-自发秩序与产权制度的演化"><a href="#第四节-自发秩序与产权制度的演化" class="headerlink" title="第四节 自发秩序与产权制度的演化"></a>第四节 自发秩序与产权制度的演化</h3><h4 id="4-1-自发秩序"><a href="#4-1-自发秩序" class="headerlink" title="4.1 自发秩序"></a>4.1 自发秩序</h4><h4 id="4-2-产权博弈"><a href="#4-2-产权博弈" class="headerlink" title="4.2 产权博弈"></a>4.2 产权博弈</h4><h4 id="4-3-惯例的出现"><a href="#4-3-惯例的出现" class="headerlink" title="4.3 惯例的出现"></a>4.3 惯例的出现</h4><h4 id="4-4-从惯例到规范"><a href="#4-4-从惯例到规范" class="headerlink" title="4.4 从惯例到规范"></a>4.4 从惯例到规范</h4><h3 id="本章提要-11"><a href="#本章提要-11" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第十三章-法律与社会规范"><a href="#第十三章-法律与社会规范" class="headerlink" title="第十三章 法律与社会规范"></a>第十三章 法律与社会规范</h2><h3 id="第一节-法律的有效性"><a href="#第一节-法律的有效性" class="headerlink" title="第一节 法律的有效性"></a>第一节 法律的有效性</h3><h3 id="第二节-法律与社会规范的不同"><a href="#第二节-法律与社会规范的不同" class="headerlink" title="第二节 法律与社会规范的不同"></a>第二节 法律与社会规范的不同</h3><h3 id="第三节-法律和社会规范的基本功能"><a href="#第三节-法律和社会规范的基本功能" class="headerlink" title="第三节 法律和社会规范的基本功能"></a>第三节 法律和社会规范的基本功能</h3><h4 id="3-1-三种社会规范"><a href="#3-1-三种社会规范" class="headerlink" title="3.1 三种社会规范"></a>3.1 三种社会规范</h4><h4 id="3-2-作为激励机制的法律与社会规范"><a href="#3-2-作为激励机制的法律与社会规范" class="headerlink" title="3.2 作为激励机制的法律与社会规范"></a>3.2 作为激励机制的法律与社会规范</h4><h4 id="3-3-作为协调预期的法律与社会规范"><a href="#3-3-作为协调预期的法律与社会规范" class="headerlink" title="3.3 作为协调预期的法律与社会规范"></a>3.3 作为协调预期的法律与社会规范</h4><h4 id="3-4-作为信号传递机制的法律与社会规范"><a href="#3-4-作为信号传递机制的法律与社会规范" class="headerlink" title="3.4 作为信号传递机制的法律与社会规范"></a>3.4 作为信号传递机制的法律与社会规范</h4><h3 id="第四节-社会规范的遵守与违反"><a href="#第四节-社会规范的遵守与违反" class="headerlink" title="第四节 社会规范的遵守与违反"></a>第四节 社会规范的遵守与违反</h3><h4 id="4-1-人们为什么遵守社会规范"><a href="#4-1-人们为什么遵守社会规范" class="headerlink" title="4.1 人们为什么遵守社会规范"></a>4.1 人们为什么遵守社会规范</h4><h4 id="4-2-人们为什么违反社会规范"><a href="#4-2-人们为什么违反社会规范" class="headerlink" title="4.2 人们为什么违反社会规范"></a>4.2 人们为什么违反社会规范</h4><h4 id="4-3-二阶囚徒困境问题"><a href="#4-3-二阶囚徒困境问题" class="headerlink" title="4.3 二阶囚徒困境问题"></a>4.3 二阶囚徒困境问题</h4><h3 id="第五节-社会规范和法律的社会条件"><a href="#第五节-社会规范和法律的社会条件" class="headerlink" title="第五节 社会规范和法律的社会条件"></a>第五节 社会规范和法律的社会条件</h3><h4 id="5-1-影响法律和社会规范相对有效性的因素"><a href="#5-1-影响法律和社会规范相对有效性的因素" class="headerlink" title="5.1 影响法律和社会规范相对有效性的因素"></a>5.1 影响法律和社会规范相对有效性的因素</h4><h4 id="5-2-法治国家和国家法治"><a href="#5-2-法治国家和国家法治" class="headerlink" title="5.2 法治国家和国家法治"></a>5.2 法治国家和国家法治</h4><h3 id="本章提要-12"><a href="#本章提要-12" class="headerlink" title="本章提要"></a>本章提要</h3><h2 id="第十四章-制度企业家与儒家社会规范"><a href="#第十四章-制度企业家与儒家社会规范" class="headerlink" title="第十四章 制度企业家与儒家社会规范"></a>第十四章 制度企业家与儒家社会规范</h2><h3 id="第一节-制度企业家"><a href="#第一节-制度企业家" class="headerlink" title="第一节 制度企业家"></a>第一节 制度企业家</h3><h4 id="1-1-游戏规则的创新者"><a href="#1-1-游戏规则的创新者" class="headerlink" title="1.1 游戏规则的创新者"></a>1.1 游戏规则的创新者</h4><h4 id="1-2-风险与理念"><a href="#1-2-风险与理念" class="headerlink" title="1.2 风险与理念"></a>1.2 风险与理念</h4><h3 id="第二节-轴心时代的制度企业家"><a href="#第二节-轴心时代的制度企业家" class="headerlink" title="第二节 轴心时代的制度企业家"></a>第二节 轴心时代的制度企业家</h3><h4 id="2-1-为天下立道"><a href="#2-1-为天下立道" class="headerlink" title="2.1 为天下立道"></a>2.1 为天下立道</h4><h4 id="2-2-人类的行为准则"><a href="#2-2-人类的行为准则" class="headerlink" title="2.2 人类的行为准则"></a>2.2 人类的行为准则</h4><h4 id="2-3-成功者的轨迹"><a href="#2-3-成功者的轨迹" class="headerlink" title="2.3 成功者的轨迹"></a>2.3 成功者的轨迹</h4><h3 id="第三节-儒家社会规范"><a href="#第三节-儒家社会规范" class="headerlink" title="第三节 儒家社会规范"></a>第三节 儒家社会规范</h3><h4 id="3-1-作为社会规范和法律的混合体的礼"><a href="#3-1-作为社会规范和法律的混合体的礼" class="headerlink" title="3.1 作为社会规范和法律的混合体的礼"></a>3.1 作为社会规范和法律的混合体的礼</h4><h4 id="3-2-协调预期与定分止争"><a href="#3-2-协调预期与定分止争" class="headerlink" title="3.2 协调预期与定分止争"></a>3.2 协调预期与定分止争</h4><h4 id="3-3-君子与激励机制"><a href="#3-3-君子与激励机制" class="headerlink" title="3.3 君子与激励机制"></a>3.3 君子与激励机制</h4><h4 id="3-4-儒家文化作为古代社会游戏规则的价值"><a href="#3-4-儒家文化作为古代社会游戏规则的价值" class="headerlink" title="3.4 儒家文化作为古代社会游戏规则的价值"></a>3.4 儒家文化作为古代社会游戏规则的价值</h4><h4 id="3-5-古典儒家的法治精神与中国的未来"><a href="#3-5-古典儒家的法治精神与中国的未来" class="headerlink" title="3.5 古典儒家的法治精神与中国的未来"></a>3.5 古典儒家的法治精神与中国的未来</h4><h3 id="本章提要-13"><a href="#本章提要-13" class="headerlink" title="本章提要"></a>本章提要</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/28/book/directory/BoYiYuSheHui/" data-id="cl9lj74bo00kx64tz86rq2yjf" data-title="博弈与社会目录" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/book/" rel="tag">book</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/Papers/2020/Glints" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/26/CG/Papers/2020/Glints/" class="article-date">
  <time class="dt-published" datetime="2021-06-26T03:32:59.000Z" itemprop="datePublished">2021-06-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-Paper/">CG.Paper</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/26/CG/Papers/2020/Glints/">(论文)[2020] Specular Manifold Sampling for Rendering High-Frequency Caustics and Glints</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Specular-Manifold-Sampling-for-Rendering-High-Frequency-Caustics-and-Glints"><a href="#Specular-Manifold-Sampling-for-Rendering-High-Frequency-Caustics-and-Glints" class="headerlink" title="Specular Manifold Sampling for Rendering High-Frequency Caustics and Glints"></a>Specular Manifold Sampling for Rendering High-Frequency Caustics and Glints</h1><ul>
<li>Tizian Zeltner, Iliyan Georgiev, and Wenzel Jakob. 2020. Specular Manifold Sampling for Rendering High-Frequency Caustics and Glints. ACM Trans. Graph. 39, 4, Article 149 (July 2020), 15 pages. <a target="_blank" rel="noopener" href="https://doi.org/10.1145/3386569.3392408">https://doi.org/10.1145/3386569.3392408</a></li>
<li>效果图<ul>
<li>ordinary unidirectional path tracer</li>
<li>我们新提出的 specular manifold sampling 策略</li>
</ul>
</li>
</ul>
<p><img src="/Glints/image-20210701170858478.png"></p>
<ul>
<li>our method supports<ul>
<li>high-frequency <strong>normal- or displacement-mapped geometry</strong>,</li>
<li>samples specular-diffuse-specular (“<strong>SDS</strong>”) paths,</li>
<li>and is compatible with standard <strong>Monte Carlo methods</strong> including unidirectional path tracing</li>
</ul>
</li>
<li>Both <strong>unbiased</strong> and <strong>biased</strong> variants of our approach can be constructed</li>
</ul>
<h2 id="1-INTRODUCTION"><a href="#1-INTRODUCTION" class="headerlink" title="1 INTRODUCTION"></a>1 INTRODUCTION</h2><ul>
<li>specular path<ul>
<li><strong>difficult to find</strong></li>
</ul>
</li>
<li>论文的方法<ul>
<li><strong>glints</strong> and <strong>SDS</strong> paths—in an <strong>unbiased</strong> manner</li>
</ul>
</li>
<li>论文的贡献<ul>
<li>(1) A <strong>unified</strong> manifold sampling strategy for rendering <strong>reflective and refractive caustics.</strong>**</li>
<li>(2) A specialized variant for rendering glints, which reduces memory usage hundred-fold compared to prior work.</li>
<li>(3) A biased variant of the method with reduced variance.</li>
<li>(4) A <strong>two-pass</strong> sampling strategy for normal-mapped surfaces.</li>
<li>(5) Changes to the specular manifold constraints of Jakob and Marschner [2012] that <strong>improve robustness and convergence.</strong></li>
</ul>
</li>
<li>问题<ul>
<li>variance increases significantly for longer specular chains, hence our experiments mainly focus on <strong>short chains with 1 or 2 vertices.</strong></li>
</ul>
</li>
</ul>
<h2 id="2-PRIOR-WORK"><a href="#2-PRIOR-WORK" class="headerlink" title="2 PRIOR WORK"></a>2 PRIOR WORK</h2><ul>
<li>path tracing</li>
<li>photon mapping</li>
<li>Newton-Raphson iteration</li>
<li>tree structure</li>
<li>论文的参考算法<ul>
<li>Our algorithm is closely related to Jakob and Marschner’s manifold exploration (ME) method [2012], which is a Markov chain Monte Carlo (MCMC) <strong>perturbation</strong> strategy that analyzes the differential geometry of the manifold of valid specular paths to make proposals in the framework of Metropolis Light Transport [Veach 1998].</li>
</ul>
</li>
<li>MNEE<ul>
<li>Starting with an <strong>incorrect initial specular path</strong>, MNEE <strong>iteratively</strong> attempts to walk towards a valid solution via projection and tangential steps on the specular manifold.</li>
<li>最多找到一个解</li>
</ul>
</li>
<li>论文算法<ul>
<li>The proposed method, named <strong>specular manifold sampling (SMS)</strong>, is a generalization of the MNEE approach: using a <strong>stochastic initialization</strong> and <strong>an unbiased sampling weight estimator</strong>, we are able to find solutions on complex geometry where manifold-based techniques were previously inapplicable.<ul>
<li>论文的算法是 MNEE 的泛化，能够解决复杂几何形体表面的路径采样问题</li>
</ul>
</li>
<li>We also propose a simple 2-stage stochastic initialization for normal-mapped surfaces and demonstrate that SMS straightforwardly generalizes to the related problem of glint rendering.We provide a brief review</li>
</ul>
</li>
</ul>
<h2 id="3-BACKGROUND"><a href="#3-BACKGROUND" class="headerlink" title="3 BACKGROUND"></a>3 BACKGROUND</h2><ul>
<li>light transport path<ul>
<li>$\bar{\mathrm{x}}&#x3D;\mathrm{x}_0,…,\mathrm{x}_n$</li>
<li>端点 $\mathrm{x}_1,\mathrm{x}_n$ non-specular</li>
<li>中间路径是 specular 的</li>
<li>下图是一个例子：$\mathrm{x_n}$ 是光源</li>
</ul>
</li>
</ul>
<img src="Glints/image-20210704003429567.png" style="zoom: 50%;" />

<ul>
<li>Snell’ law：折射定律</li>
<li><span id="eq1">上述路径的约束条件</span><ul>
<li>$T(x_i)$ is a 3 × 2 matrix of tangent vectors</li>
<li>向量都归一化了</li>
</ul>
</li>
</ul>
<p>$$<br>\mathrm{c}<em>i(\mathrm{x}</em>{i-1},\mathrm{x}<em>i,\mathrm{x}</em>{i+1})&#x3D;\mathrm{T}(\mathrm{x}_i)^T\mathrm{h}(\mathrm{x}_i,\overrightarrow{\mathrm{x}<em>i\mathrm{x}</em>{i-1}},\overrightarrow{\mathrm{x}<em>i\mathrm{x}</em>{i+1}});;;(1)<br>$$</p>
<ul>
<li>联立<ul>
<li>$\mathrm{C}(\bar{x})&#x3D;[\mathrm{c}<em>2,…,\mathrm{c}</em>{n−1}]^T$</li>
<li>The function is normally parameterized via the UV coordinates $\mathrm{uv}_i$ of specular vertices,</li>
</ul>
</li>
<li>求解<ul>
<li>$\mathrm{C}(\mathrm{\overline{uv}})&#x3D;0$</li>
<li>牛顿迭代法求解：$\mathrm{\overline{uv}}_{i+1}&#x3D;(\nabla\mathrm{C}(\mathrm{\overline{uv}}_i))^{-1}\cdot\mathrm{C}(\mathrm{\overline{uv}}_i)$</li>
</ul>
</li>
</ul>
<img src="Glints/image-20210704154651129.png" style="zoom: 67%;" />



<h3 id="3-1-Manifold-next-event-estimation-MNEE"><a href="#3-1-Manifold-next-event-estimation-MNEE" class="headerlink" title="3.1 Manifold next-event estimation(MNEE)"></a>3.1 Manifold next-event estimation(MNEE)</h3><ul>
<li><p>问题</p>
<ul>
<li>简单形体有效<ul>
<li>spheres or cylinders</li>
<li>where a single solution indeed suffices to render most specular paths.</li>
</ul>
</li>
<li>不知道怎么初始化<ul>
<li>refractive caustics 可以（Hanika et al.），但是不知道怎么推广到折射</li>
</ul>
</li>
<li>Finally, MNEE does not support paths that give rise to specular glints.</li>
</ul>
</li>
<li><p>算法</p>
</li>
</ul>
<img src="Glints/image-20210705135529611.png" style="zoom: 80%;" />



<h2 id="4-METHOD"><a href="#4-METHOD" class="headerlink" title="4 METHOD"></a>4 METHOD</h2><ul>
<li>pecular manifold sampling (SMS)<ul>
<li><strong>initially</strong> focusing on <strong>a simple unbiased algorithm</strong> that generalizes to cases where <strong>multiple specular paths</strong> connect two given endpoints.</li>
</ul>
</li>
<li>几种扩展算法（模块化、可随意组装的）<ul>
<li>the first reduces variance at the cost of nonzero bias</li>
<li>the second replaces Jakob and Marschner’s specular manifold constraints with improved variants,</li>
<li>the third samples paths in two stages to improve performance on normal-mapped surfaces, and the last streamlines the algorithm for glint rendering.</li>
</ul>
</li>
<li>组装例子</li>
</ul>
<img src="Glints/image-20210704162403713.png" style="zoom:67%;" />



<h3 id="4-1-Finding-all-solutions"><a href="#4-1-Finding-all-solutions" class="headerlink" title="4.1 Finding all solutions"></a>4.1 Finding all solutions</h3><ul>
<li><p>初始化</p>
<ul>
<li>We initially restrict ourselves to specular chains with a single smooth reflection or refraction.</li>
</ul>
</li>
<li><p>思路</p>
<ul>
<li>whereas MNEE performs manifold walks using a fixed initialization, SMS <strong>randomly samples the initial guess</strong> from a <strong>probability distribution</strong> $p(\overline{\mathrm{x}}_0)$.</li>
<li>Newton’s method exhibits quadratic convergence when the starting point is sufficiently close to a root, hence all solutions will be found with a nonzero probability—however, the probability of successful convergence is unknown.</li>
</ul>
</li>
<li><p>初始化选择的自由度很高</p>
<ul>
<li>we assume that the implementation of this sampling strategy takes two uniformly distributed random numbers $\xi (\xi_1,\xi_2)\in [0,1)^2 &#x3D;:\mathcal{U}$ as input and warps them to the desired distribution.</li>
<li>目标是使得初始的采样路径 $\xi$ 离正确的结果比较近，这样牛顿法才有效</li>
</ul>
</li>
<li><p>When inspecting the convergence behavior of these manifold walks on the primary sample space $\mathcal{U}$, we generally observe multiple basins of convergence $\mathcal{B}_k\subseteq \mathcal{U}$, each containing a point $\xi^{k}$ identified with a corresponding solution vertex $x_2^{(k)}$.</p>
</li>
<li><p>Fig. 4.</p>
<ul>
<li>(a): Multiple solutions of the specular path constraint form a superposition of caustics in the Ring scene.</li>
<li>(b): Color map showing the number of solutions at each shading point.</li>
<li>(c): The three solution paths at a particular point.</li>
<li>(d): The basins of convergence (in primary sample space) corresponding to those solution paths. All manifold walks started at a point (black dot) inside a region converge to the associated solution (colored dot).</li>
</ul>
</li>
</ul>
<img src="Glints/image-20210704171907849.png" style="zoom:67%;" />

<ul>
<li>Newton’s method is known to produce convergence basins that potentially have an extremely <strong>complex geometric structure</strong> [Hubbard et al. 2001] and can even be <strong>fractal</strong>.</li>
<li>An unbiased estimator is then given by a standard MC ratio $\dfrac{f(\overline{x})}{p(\overline{x})}$</li>
<li>Since the samples $\xi$ are <strong>uniformly distributed</strong>, this probability is simply the area of the associated convergence basin on $\mathcal{U}$</li>
</ul>
<p>$$<br>p_k&#x3D;\int_{\mathcal{U}}\mathbb{1}_{\mathcal{B}_k}(\xi);\mathrm{d}\xi<br>$$</p>
<ul>
<li>但是这个是不可行的，$\mathcal{B}_k$ 可能有复杂的几何结构</li>
<li>简单的无偏估计如下</li>
</ul>
<p>$$<br>\langle p_k\rangle&#x3D;\dfrac{1}{N}\sum_{i&#x3D;1}^N\mathbb{1}_{\mathcal{B}_k}(\xi)<br>$$</p>
<ul>
<li>这个估计存在一些问题 $\mathbb{E}[\dfrac{1}{X}]\ne\dfrac{1}{\mathbb{E}[X]}$<ul>
<li>引入 bias</li>
<li>for example, $\langle p_k\rangle$ can equal zero if all N tries fail to converge to the basin $\mathcal{B}_k$<ul>
<li>$\langle \dfrac{1}{p_k}\rangle\to\infty$</li>
</ul>
</li>
</ul>
</li>
<li>Fortunately, an unbiased estimator for the inverse ⟨1&#x2F;pk ⟩ can be created using a simple <strong>iterative approach</strong>.</li>
</ul>
<h3 id="4-2-Unbiased-SMS"><a href="#4-2-Unbiased-SMS" class="headerlink" title="4.2 Unbiased SMS"></a>4.2 Unbiased SMS</h3><ul>
<li>turning the inverse into a geometric series(几何级数) moves the problematic integral from the denominator(分母) to the numerator(分子)</li>
</ul>
<p>$$<br>\dfrac{1}{p_k}&#x3D;\dfrac{1}{\int_{\mathcal{U}}\mathbb{1}_{\mathcal{B}<em>k}(\xi);\mathrm{d}\xi}&#x3D;\dfrac{1}{1-a}&#x3D;\sum</em>{i&#x3D;0}^{\infty}a^i<br>$$</p>
<p>$$<br>a&#x3D;1-\int_{\mathcal{U}}\mathbb{1}_{\mathcal{B}_k}(\xi);\mathrm{d}\xi,;|a|&lt;1<br>$$</p>
<ul>
<li>那么就会有</li>
</ul>
<p>$$<br>\langle\dfrac{1}{p_k}\rangle&#x3D;1+\sum_{i&#x3D;1}^{\infty}\prod_{j&#x3D;1}^{i}\langle a\rangle_j<br>$$</p>
<ul>
<li>$\langle a\rangle_j&#x3D;0$ when manifold walk $j$ has converged to root $\xi_k$</li>
<li>$\langle a\rangle_j&#x3D;1$ if it has found another root or diverged</li>
<li><strong>Unbiased SMS is trivially added to any existing implementation of MNEE.</strong></li>
<li>算法如下</li>
</ul>
<img src="Glints/image-20210705134445300.png" style="zoom: 80%;" />

<ul>
<li>复杂度和几何形体相关<ul>
<li>when the geometry is complex, many solutions may exist, and their convergence basins<br>  also occupy smaller area in primary sample space.</li>
</ul>
</li>
<li>方差<ul>
<li>Furthermore, the variance of such an estimator for a specific solution pk based on a geometric distribution is equal to $\dfrac{1-p_k}{p_k^2}$ , which can become very large when $p_k\approx 0$.</li>
</ul>
</li>
</ul>
<h3 id="4-3-Biased-SMS"><a href="#4-3-Biased-SMS" class="headerlink" title="4.3 Biased SMS"></a>4.3 Biased SMS</h3><ul>
<li>引入 bias，但是同时降低了  variance，减小了运行时间</li>
<li>The biased variant of our method (Alg. 3) replaces the unbounded number of trial iterations by a fixed budget of M samples.</li>
<li>we simply cluster the M samples into a set of unique solutions $\mathrm{x}_2^{(l)}(l &#x3D; 1,\cdots, L)$.</li>
<li>A biased estimate of the reciprocal is then given by the <strong>relative number of occurrences nl of each solution</strong>, which also avoids the potential issues with a <strong>division by zero</strong> discussed earlier.</li>
</ul>
<p>$$<br>\dfrac{1}{M}\sum_{l&#x3D;1}^{L}n_l\dfrac{f(\mathrm{x}_2^{(l)})}{p(\mathrm{x}<em>2^{(l)})}\approx\dfrac{1}{M}\sum</em>{l&#x3D;1}^{L}n_lf(\mathrm{x}<em>2^{(l)})\dfrac{M}{n_l}&#x3D;\sum</em>{l&#x3D;1}^{L}f(\mathrm{x}_2^{(l)})<br>$$</p>
<ul>
<li>Compared to the original unbiased approach, this variant has a <strong>fixed iteration count</strong>, and it <strong>exploits the information provided by all samples</strong>.</li>
<li>有偏但是是一致的<ul>
<li>Note that it is <strong>consistent</strong> and will converge to the true solution as $M\to\infty$</li>
</ul>
</li>
<li>论文中 bias 体现为能量损失<ul>
<li>In our experiments, we observe that the resulting bias is manifested as energy loss</li>
<li>焦散很暗</li>
</ul>
</li>
<li>算法如下</li>
</ul>
<img src="C:/Users/神秘嘉宾990/AppData/Roaming/Typora/typora-user-images/image-20210705145554518.png" style="zoom: 80%;" />

<ul>
<li>MNEE 和 biased SMS<ul>
<li>When setting $M&#x3D;1$, biased SMS is closely related to a biased version of MNEE where no MIS is applied to account for paths that cannot be sampled using the manifold walk.</li>
<li><strong>但是是不等价的</strong></li>
<li>Consider a situation where only one valid solution exists but the straight-line initialization doesn’t converge to it.<ul>
<li>In this case, <strong>MNEE</strong> can produce <strong>arbitrarily high variance</strong>—or in case of point lights will miss the contribution entirely.</li>
<li><strong>SMS</strong> however will still find the solution with <strong>non-zero probability</strong>.</li>
</ul>
</li>
</ul>
</li>
<li>向量化并行<ul>
<li>modern SIMD instruction sets, such as AVX512.</li>
</ul>
</li>
</ul>
<h3 id="4-4-Improved-specular-manifold-constraints"><a href="#4-4-Improved-specular-manifold-constraints" class="headerlink" title="4.4 Improved specular manifold constraints"></a>4.4 Improved specular manifold constraints</h3><ul>
<li>One significant difference of our method compared to all previous applications of manifold walks is that we require the Newton solver to take <strong>very large steps</strong> starting from an <strong>invalid</strong> state.<ul>
<li><strong>MNEE</strong> renders <strong>refractive caustics</strong> with a straight-line initialization that is generally <strong>already very close to the final solution</strong>.</li>
<li>applications of manifold walks to MCMC rendering [Jakob and Marschner 2012; Lehtinen et al. 2013] <strong>only make small perturbations to existing valid paths</strong></li>
</ul>
</li>
<li>因此上述的两种方法收敛很快</li>
<li>我们的方法到现在为止，随机的初始化导致收敛很慢（即使是在简单的集合外形上也出现问题）<ul>
<li>manifold walks would often converge surprisingly poorly when initialized randomly</li>
</ul>
</li>
<li>导致收敛出现问题的原因<ul>
<li>when <strong>taking large steps</strong>, Newton iterations based on the <strong>original specular manifold constraint</strong>s often produce <strong>invalid back-facing solutions</strong> that impede convergence.</li>
<li>back-facing：下图中的 invalid 路径，光照从内部反射，这是不可能的</li>
</ul>
</li>
<li>The main issue here is how the specular manifold constraint in <a href="#eq1">Eq. (1)</a> encodes specular configurations via <strong>half-vector projections</strong>.</li>
<li>While this term conveniently subsumes both reflective and refractive cases with one equation, the formulation <strong>does not distinguish</strong> between front- and back-facing solutions</li>
</ul>
<img src="Glints/image-20210705202223912.png" style="zoom:80%;" />

<ul>
<li>我们提出了一个新的约束条件，区分折射和反射<ul>
<li>scattered direction $S(\omega,\mathrm{n},\eta)$</li>
<li>incident direction $\omega$</li>
<li>surface normal $\mathrm{n}$</li>
</ul>
</li>
</ul>
<img src="Glints/image-20210705204937896.png" style="zoom:80%;" />

<ul>
<li>度量条件：$\mathrm{\omega}_o&#x3D;S(\omega_i,\mathrm{n},\eta)$<ul>
<li>具体我们使用 $2\mathrm{D}$ 度量方式（实验发现效果比较好）</li>
<li>we therefore measure a difference in the spherical coordinates of both vectors</li>
</ul>
</li>
</ul>
<img src="Glints/image-20210705205329933.png" style="zoom:80%;" />

<ul>
<li>$\theta(\omega) &#x3D; \cos^{−1}(\omega_z)$</li>
<li>$\phi(\omega)&#x3D;\mathrm{atan};2(\omega_y,\omega_x)$</li>
<li>一个其他问题<ul>
<li>Note that the scattering operation $\mathrm{S}(\cdot)$ can fail in configurations with <strong>total internal reflection</strong>.</li>
<li>In such cases we are still able to evaluate the constraint for the opposite light direction by taking the difference between $\mathrm{\omega}_o$ and $S(\omega_i,\mathrm{n},\eta)$</li>
</ul>
</li>
</ul>
<h3 id="4-5-Two-stage-manifold-walks"><a href="#4-5-Two-stage-manifold-walks" class="headerlink" title="4.5 Two-stage manifold walks"></a>4.5 Two-stage manifold walks</h3><ul>
<li>we observe that <strong>the more complex caustic</strong> is a <strong>superposition</strong>(叠加) of <strong>many different solutions</strong> with <strong>a fairly localized effect</strong>(局部效应)</li>
<li>The space $\mathcal{U}$ is <strong>largely empty,</strong> containing only <strong>a few small convergence basins</strong> that are clustered together. The probability of finding a valid solution is therefore low.<ul>
<li>采样概率小</li>
</ul>
</li>
</ul>
<img src="Glints/image-20210706132923125.png" style="zoom:80%;" />

<ul>
<li>Furthermore, estimating the reciprocal probability depends on our ability to <strong>find the same solution once more</strong>, which is even less likely.</li>
<li>Unbiased SMS estimates therefore tend be slow and noisy, while biased SMS loses a considerable amount of energy.<ul>
<li>采样概率小导致的问题</li>
</ul>
</li>
<li>为了解决上述问题，我们提出一种利用先验知识找初始路径的方法。</li>
<li>consider a <strong>caustic</strong> generated by a smooth planar surface(光滑平面产生的焦散)<ul>
<li>我们观察到，当表面的几何结构不太复杂时，焦散都是有一个比较大的收敛域产生的</li>
<li>当表面几何结构变得复杂的时候，大的收敛域分割为多个小的收敛域</li>
</ul>
</li>
<li>Our <strong>two-stage</strong> sampling approach performs <strong>two manifold walks</strong><ul>
<li>the first stage <strong>ignores the specified normal map</strong> and finds specular paths on the original smooth surface.<ul>
<li>Such a smooth manifold walk will converge to a point that roughly lies at the center of the cluster of solutions</li>
<li>具体使用的策略：<strong>offset manifold walk</strong> [Jakob and Marschner 2012]</li>
</ul>
</li>
<li>a second manifold walk, on the bumpy surface, started from there takes us all the way to a solution.</li>
</ul>
</li>
</ul>
<h3 id="4-6-Glints"><a href="#4-6-Glints" class="headerlink" title="4.6 Glints"></a>4.6 Glints</h3><ul>
<li>Our method generalizes straightforwardly to the problem of rendering glints, which are miniscule subpixel reflections of a light source with <strong>narrow angular support</strong> (e.g. the sun) on <strong>high-frequency specular microgeometry</strong>.</li>
<li>标准的 MC 方法开销太大<ul>
<li><strong>millions of samples per pixel</strong> may be needed to obtain an acceptable result</li>
</ul>
</li>
<li>Our method <strong>generates random starting points</strong> within the <strong>pixel</strong> and then runs <strong>unbiased or biased SMS</strong> to find solutions</li>
<li>之前的方法<ul>
<li>introduced a small amount of <strong>intrinsic roughness</strong> to relax the problem</li>
</ul>
</li>
<li>we solve the unmodified problem with a discrete set of solutions to find a path $\mathrm{\bar{x}}&#x3D;\mathrm{x} _0,\mathrm{x}_1,\mathrm{x}_2$ connecting the camera to a sampled emitter position <strong>via a single specular reflection</strong>.<ul>
<li>单次反射</li>
</ul>
</li>
<li>一些和之前一样的假设<ul>
<li>Like prior work, we assume that the endpoints $\mathrm{x} _0$ and $\mathrm{x} _2$ are <strong>distant</strong>, in which case changes in the half-vector across<br>  the parallelogram are minimal.</li>
</ul>
</li>
<li>这些假设简化搜索<ul>
<li>in particular, the specular manifold constraint can be simplified to a function that attempts to <strong>equate this fixed half-vector</strong> and <strong>the local shading normal</strong>, both expressed in 2D slope space.</li>
</ul>
</li>
<li>泛化与鲁棒性<ul>
<li>To robustly apply our glint rendering technique in scenes with <strong>complex lighting</strong> (e.g. <strong>high-frequency environment maps</strong>), we further combine our SMS strategy with <strong>standard BSDF sampling</strong> in a multiple importance sampling (<strong>MIS</strong>) framework.</li>
<li>效果很好</li>
</ul>
</li>
</ul>
<img src="Glints/image-20210706141100580.png" style="zoom:80%;" />



<h3 id="4-7-Integration-into-rendering-algorithms"><a href="#4-7-Integration-into-rendering-algorithms" class="headerlink" title="4.7 Integration into rendering algorithms"></a>4.7 Integration into rendering algorithms</h3><h2 id="5-RESULTS"><a href="#5-RESULTS" class="headerlink" title="5 RESULTS"></a>5 RESULTS</h2><ul>
<li>详见论文</li>
</ul>
<h2 id="6-CONCLUSION"><a href="#6-CONCLUSION" class="headerlink" title="6 CONCLUSION"></a>6 CONCLUSION</h2><ul>
<li><strong>Our article focuses mainly on the generation of subpaths with a single specular vertex</strong>.</li>
<li>While our method in principle also generalizes to more complex path classes with multiple specular reflection, performance using our current strategy for choosing starting points remains suboptimal and could be an interesting topic for future work.</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/26/CG/Papers/2020/Glints/" data-id="cl9lj74dy01b864tz437n71b1" data-title="(论文)[2020] Specular Manifold Sampling for Rendering High-Frequency Caustics and Glints" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Glints/" rel="tag">Glints</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DB/MySQL/json_format" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/23/DB/MySQL/json_format/" class="article-date">
  <time class="dt-published" datetime="2021-06-23T06:37:39.000Z" itemprop="datePublished">2021-06-23</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB-MySQL/">DB.MySQL</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/23/DB/MySQL/json_format/">MySQL 聚合成 json 格式化输出</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Json-格式化输出"><a href="#Json-格式化输出" class="headerlink" title="Json 格式化输出"></a>Json 格式化输出</h1><h2 id="MySQL-实现"><a href="#MySQL-实现" class="headerlink" title="MySQL 实现"></a>MySQL 实现</h2><ul>
<li>将我们的数据库按照 json 的格式，格式化输出</li>
<li>管理员模式开启 MySQL 服务</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 名字和安装时相关</span></span><br><span class="line">net <span class="built_in">start</span> MYSQL80</span><br></pre></td></tr></table></figure>

<ul>
<li>进入命令行模式</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 得输入密码</span></span><br><span class="line">mysql <span class="literal">-u</span> root <span class="literal">-p</span></span><br></pre></td></tr></table></figure>



<h3 id="建表"><a href="#建表" class="headerlink" title="建表"></a>建表</h3><ul>
<li>新建数据库并使用</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database json_format;</span><br><span class="line">use json_format;</span><br></pre></td></tr></table></figure>

<ul>
<li>导入数据<ul>
<li><a href="/resources/DB/code/elective_create_insert.sql">代码</a></li>
<li>一些修改<ul>
<li>约束条件在插入数据之后</li>
<li>一些数据补全，缺省的补为 null</li>
<li>第 3 个约束条件笔误，最后面是 tno</li>
</ul>
</li>
</ul>
</li>
<li>查看有哪些表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> tables;</span><br></pre></td></tr></table></figure>

<p><img src="/json_format/image-20210623161121083.png"></p>
<h3 id="输出为-json"><a href="#输出为-json" class="headerlink" title="输出为 json"></a>输出为 json</h3><ul>
<li>新建一个表，用于输出结果</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu_info (</span><br><span class="line">    info json</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<ul>
<li>原始数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br></pre></td></tr></table></figure>

<p><img src="/json_format/image-20210623161033888.png"></p>
<ul>
<li>如下指令可以生成除了课程之外的 json 数据</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> CONCAT(<span class="string">&#x27;&#123;&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&quot;sno&quot;: &quot;&#x27;</span>, s.sno, <span class="string">&#x27;&quot;,&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&quot;name&quot;: &quot;&#x27;</span>, s.sname, <span class="string">&#x27;&quot;,&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&quot;course&quot;: &#x27;</span>, <span class="string">&#x27;[]&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&#125;&#x27;</span>) info</span><br><span class="line"><span class="keyword">from</span> student s</span><br></pre></td></tr></table></figure>

<p><img src="/json_format/image-20210623155952954.png"></p>
<ul>
<li>接着只需要生成课程数据即可</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    s.sno,</span><br><span class="line">    group_concat(</span><br><span class="line">        CONCAT(<span class="string">&#x27;&#123;&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;&quot;cname&quot;: &quot;&#x27;</span>, c.cname, <span class="string">&#x27;&quot;,&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;&quot;grade&quot;: &#x27;</span>, sc.grade,</span><br><span class="line">               <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">    ) course_info</span><br><span class="line"><span class="keyword">from</span> student s, sc, course c</span><br><span class="line"><span class="keyword">where</span> s.sno <span class="operator">=</span> sc.sno <span class="keyword">and</span> sc.cno <span class="operator">=</span> c.cno</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> sno;</span><br></pre></td></tr></table></figure>

<ul>
<li>结果如下</li>
</ul>
<p><img src="/json_format/image-20210623155429773.png" alt="image-20210623160857468"></p>
<ul>
<li>接着我们把上面两个结合在一起即可</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 插入数据部分</span></span><br><span class="line"><span class="comment">-- insert stu_info</span></span><br><span class="line"><span class="keyword">select</span> CONCAT(<span class="string">&#x27;&#123;&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&quot;sno&quot;: &quot;&#x27;</span>, s.sno, <span class="string">&#x27;&quot;,&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&quot;name&quot;: &quot;&#x27;</span>, s.sname, <span class="string">&#x27;&quot;,&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&quot;course&quot;: &#x27;</span>, <span class="string">&#x27;[&#x27;</span> , M.course_info, <span class="string">&#x27;]&#x27;</span>,</span><br><span class="line">              <span class="string">&#x27;&#125;&#x27;</span>) info</span><br><span class="line"><span class="keyword">from</span> student s, (</span><br><span class="line">    <span class="keyword">select</span></span><br><span class="line">    s.sno,</span><br><span class="line">    group_concat(</span><br><span class="line">        CONCAT(<span class="string">&#x27;&#123;&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;&quot;cname&quot;: &quot;&#x27;</span>, c.cname, <span class="string">&#x27;&quot;,&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;&quot;grade&quot;: &#x27;</span>, sc.grade,</span><br><span class="line">               <span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">    ) course_info</span><br><span class="line">    <span class="keyword">from</span> student s, sc, course c</span><br><span class="line">    <span class="keyword">where</span> s.sno <span class="operator">=</span> sc.sno <span class="keyword">and</span> sc.cno <span class="operator">=</span> c.cno</span><br><span class="line">    <span class="keyword">group</span> <span class="keyword">by</span> sno</span><br><span class="line">) M</span><br><span class="line"><span class="keyword">where</span> s.sno <span class="operator">=</span> M.sno;</span><br></pre></td></tr></table></figure>

<p><img src="/json_format/image-20210623155754129.png"></p>
<ul>
<li>我们可以把上面的数据插入到一个表里，然后输出成 json 文件即可<ul>
<li>上面代码取消第二行的注释即可</li>
</ul>
</li>
<li>输出结果<ul>
<li>如下命令得开权限，否则会报错</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> CONCAT(</span><br><span class="line">    <span class="string">&#x27;&#123;&#x27;</span>, <span class="string">&#x27;\&quot;students\&quot;: &#x27;</span>, <span class="string">&#x27;[&#x27;</span> , group_concat(info), <span class="string">&#x27;]&#x27;</span>, <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">) stu_infos</span><br><span class="line"><span class="keyword">from</span> stu_info</span><br><span class="line"><span class="keyword">into</span> outfile <span class="string">&#x27;D:MyTemp/stu_infos.json&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>会有字符串缺失的问题<ul>
<li>可以修改最长字符串大小</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 设置最长字符串大小</span></span><br><span class="line"><span class="keyword">set</span> SESSION group_concat_max_len<span class="operator">=</span><span class="number">10000</span>;</span><br><span class="line"><span class="comment">-- 查看最长字符串大小</span></span><br><span class="line"><span class="keyword">show</span> variables <span class="keyword">like</span> <span class="string">&#x27;group_concat_max_len&#x27;</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li>可以直接在外面执行命令，直接命令行<ul>
<li><code>-N</code> 表示取消表头</li>
<li>另外一种解决方法是输出的时候，每行一条 json 数据</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -N -h 127.0.0.1 -u root -p  --default-character-set=UTF8 -e &quot;set SESSION group_concat_max_len=10000; select CONCAT(&#x27;&#123;&#x27;, &#x27;\&quot;students\&quot;: &#x27;, &#x27;[&#x27; , group_concat(info), &#x27;]&#x27;, &#x27;&#125;&#x27;) stu_infos from stu_info&quot; json_format &gt; D:/MyTemp/stu_infos.json</span><br></pre></td></tr></table></figure>

<ul>
<li>结果如下</li>
</ul>
<p><img src="/json_format/image-20210623165125466.png"></p>
<ul>
<li>格式化结果如下</li>
</ul>
<p><img src="/json_format/image-20210623165357814.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/23/DB/MySQL/json_format/" data-id="cl9lj74am00dv64tz4yzhcjza" data-title="MySQL 聚合成 json 格式化输出" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DB/SQLServer/json.practice" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/22/DB/SQLServer/json.practice/" class="article-date">
  <time class="dt-published" datetime="2021-06-22T15:57:00.000Z" itemprop="datePublished">2021-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB-SQLServer/">DB.SQLServer</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/22/DB/SQLServer/json.practice/">SQL Server json 查询练习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Json-查询"><a href="#Json-查询" class="headerlink" title="Json 查询"></a>Json 查询</h1><ul>
<li><a target="_blank" rel="noopener" href="https://docs.microsoft.com/zh-cn/sql/relational-databases/json/json-data-sql-server?view=sql-server-ver15">官网教程</a></li>
</ul>
<h2 id="SQL-Server-json-功能使用"><a href="#SQL-Server-json-功能使用" class="headerlink" title="SQL Server json 功能使用"></a>SQL Server json 功能使用</h2><ul>
<li>新建数据库 <code>json_test</code> 并使用</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database json_test</span><br><span class="line">use json_test</span><br></pre></td></tr></table></figure>

<ul>
<li>每一条 json 的格式如下</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span> <span class="attr">&quot;_id&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;01001&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;city&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;AGAWAM&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;loc&quot;</span> <span class="punctuation">:</span> <span class="punctuation">[</span> <span class="number">-72.622739</span><span class="punctuation">,</span> <span class="number">42.070206</span> <span class="punctuation">]</span><span class="punctuation">,</span> <span class="attr">&quot;pop&quot;</span> <span class="punctuation">:</span> <span class="number">15338</span><span class="punctuation">,</span> <span class="attr">&quot;state&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;MA&quot;</span> <span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>将 json 文件修改为标准格式<ul>
<li>逗号分隔，最外面加上大括号</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123; &quot;_id&quot; : &quot;01001&quot;, &quot;city&quot; : &quot;AGAWAM&quot;, &quot;loc&quot; : [ <span class="number">-72.622739</span>, <span class="number">42.070206</span> ], &quot;pop&quot; : <span class="number">15338</span>, &quot;state&quot; : &quot;MA&quot; &#125;,</span><br><span class="line">    &#123; &quot;_id&quot; : &quot;99950&quot;, &quot;city&quot; : &quot;KETCHIKAN&quot;, &quot;loc&quot; : [ <span class="number">-133.18479</span>, <span class="number">55.942471</span> ], &quot;pop&quot; : <span class="number">422</span>, &quot;state&quot; : &quot;AK&quot; &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h3 id="读成数据项"><a href="#读成数据项" class="headerlink" title="读成数据项"></a>读成数据项</h3><ul>
<li>按照格式新建一个表用于存储</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test(</span><br><span class="line">    id <span class="type">int</span>,</span><br><span class="line">    city nvarchar(<span class="number">20</span>),</span><br><span class="line">    locx <span class="type">float</span>,</span><br><span class="line">    locy <span class="type">float</span>,</span><br><span class="line">    pop <span class="type">int</span>,</span><br><span class="line">    state <span class="type">char</span>(<span class="number">10</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用如下命令将数据读入表中<ul>
<li>OPENJSON</li>
<li>OPENROWSET</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable">@json</span> NVARCHAR(MAX)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="variable">@json</span> <span class="operator">=</span> BulkColumn</span><br><span class="line"><span class="keyword">from</span> OPENROWSET (BULK <span class="string">&#x27;D:/MyTemp/zips.json&#x27;</span>, SINGLE_CLOB) <span class="keyword">as</span> j</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> test</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> OPENJSON(<span class="variable">@json</span>)</span><br><span class="line"><span class="keyword">with</span> (</span><br><span class="line">    id <span class="type">int</span> <span class="string">&#x27;strict $._id&#x27;</span>,</span><br><span class="line">    city nvarchar(<span class="number">30</span>) <span class="string">&#x27;$.city&#x27;</span>,</span><br><span class="line">    locx <span class="type">float</span> <span class="string">&#x27;$.loc[0]&#x27;</span>,</span><br><span class="line">    locy <span class="type">float</span> <span class="string">&#x27;$.loc[1]&#x27;</span>,</span><br><span class="line">    pop <span class="type">int</span> <span class="string">&#x27;$.pop&#x27;</span>,</span><br><span class="line">    state <span class="type">char</span>(<span class="number">10</span>) <span class="string">&#x27;$.state&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>导入数据库之后便可以使用之前简单的查询方式执行了</li>
</ul>
<h4 id="简单查询"><a href="#简单查询" class="headerlink" title="简单查询"></a>简单查询</h4><h5 id="查询-1"><a href="#查询-1" class="headerlink" title="查询 1"></a>查询 1</h5><ul>
<li>简单查看数据库有多少行</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> test</span><br><span class="line"><span class="comment">-- 29353</span></span><br></pre></td></tr></table></figure>



<h5 id="查询-2"><a href="#查询-2" class="headerlink" title="查询 2"></a>查询 2</h5><ul>
<li>查询前 6 条记录<ul>
<li>SQL Server 不支持 limit，使用 top 查询</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">6</span> <span class="operator">*</span> <span class="keyword">from</span> test</span><br></pre></td></tr></table></figure>

<p><img src="/json.practice/image-20210623130431989.png"></p>
<h5 id="查询-3"><a href="#查询-3" class="headerlink" title="查询 3"></a>查询 3</h5><ul>
<li>统计不同状态（state）的条目</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> state, <span class="built_in">count</span>(<span class="operator">*</span>) num</span><br><span class="line"><span class="keyword">from</span> test</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> state</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<ul>
<li>结果如下<ul>
<li>一共有 51 种状态</li>
<li>其中最多的是 TX（1671条），最少的是 DC（24）条</li>
<li>（条目太多了，这里只显示首尾几条）</li>
</ul>
</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">state      num</span><br><span class="line">---------- -----------</span><br><span class="line">TX                1671</span><br><span class="line">NY                1595</span><br><span class="line">CA                1516</span><br><span class="line">PA                1458</span><br><span class="line">...                ...</span><br><span class="line">HI                  80</span><br><span class="line">RI                  69</span><br><span class="line">DE                  53</span><br><span class="line">DC                  24</span><br><span class="line"></span><br><span class="line">(51 行受影响)</span><br></pre></td></tr></table></figure>



<h5 id="查询-4"><a href="#查询-4" class="headerlink" title="查询 4"></a>查询 4</h5><ul>
<li>找到 pop 值最大的 6 个城市</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">6</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> test</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> pop <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<ul>
<li>pop 值最大的是 CHICAGO，值为 112047</li>
</ul>
<p><img src="/json.practice/image-20210623132642510.png"></p>
<h3 id="读成-json-格式"><a href="#读成-json-格式" class="headerlink" title="读成 json 格式"></a>读成 json 格式</h3><ul>
<li>新建数据表</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test2 (</span><br><span class="line">    info nvarchar(max)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>将每一条按照 json 的格式读入</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable">@json</span> nvarchar(max)</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="variable">@json</span> <span class="operator">=</span> BulkColumn</span><br><span class="line"><span class="keyword">from</span> OPENROWSET (BULK <span class="string">&#x27;D:/MyTemp/zips.json&#x27;</span>, SINGLE_CLOB) <span class="keyword">as</span> j</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> test2</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">value</span> <span class="keyword">as</span> info</span><br><span class="line"><span class="keyword">from</span> OPENJSON(<span class="variable">@json</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>重复上面的查询</li>
</ul>
<h5 id="查询-1-1"><a href="#查询-1-1" class="headerlink" title="查询 1"></a>查询 1</h5><ul>
<li>简单查看数据库有多少行</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> test2</span><br><span class="line"><span class="comment">-- 29353</span></span><br></pre></td></tr></table></figure>



<h5 id="查询-2-1"><a href="#查询-2-1" class="headerlink" title="查询 2"></a>查询 2</h5><ul>
<li>查询前 6 条记录</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">6</span> <span class="operator">*</span> <span class="keyword">from</span> test2</span><br></pre></td></tr></table></figure>

<p><img src="/json.practice/image-20210623135414634.png"></p>
<h5 id="查询-3-1"><a href="#查询-3-1" class="headerlink" title="查询 3"></a>查询 3</h5><ul>
<li>统计不同状态（state）的条目</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">JSON_VALUE</span>(info, <span class="string">&#x27;$.state&#x27;</span>) state, <span class="built_in">count</span>(<span class="operator">*</span>) num</span><br><span class="line"><span class="keyword">from</span> test2</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> <span class="built_in">JSON_VALUE</span>(info, <span class="string">&#x27;$.state&#x27;</span>)</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<ul>
<li>结果是一样的，不过由于格式的原因，显示出来看起来很奇怪</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">state      num</span><br><span class="line"><span class="comment">---------- -----------</span></span><br><span class="line">TX                <span class="number">1671</span></span><br><span class="line">NY                <span class="number">1595</span></span><br><span class="line">CA                <span class="number">1516</span></span><br><span class="line">PA                <span class="number">1458</span></span><br><span class="line">...                ...</span><br><span class="line">HI                  <span class="number">80</span></span><br><span class="line">RI                  <span class="number">69</span></span><br><span class="line">DE                  <span class="number">53</span></span><br><span class="line">DC                  <span class="number">24</span></span><br><span class="line"></span><br><span class="line">(<span class="number">51</span> 行受影响)</span><br></pre></td></tr></table></figure>

<ul>
<li>以上的查询方法很慢</li>
<li>优化查询如下（输出是一样的）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> state, <span class="built_in">count</span>(<span class="operator">*</span>) num</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">JSON_VALUE</span>(info, <span class="string">&#x27;$.state&#x27;</span>) state</span><br><span class="line">    <span class="keyword">from</span> test2</span><br><span class="line">) M</span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> state</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> num <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>



<h5 id="查询-4-1"><a href="#查询-4-1" class="headerlink" title="查询 4"></a>查询 4</h5><ul>
<li>找到 pop 值最大的 6 个城市</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">6</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> test2</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> <span class="built_in">JSON_VALUE</span>(info, <span class="string">&#x27;$.pop&#x27;</span>) <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<p><img src="/json.practice/image-20210623140626496.png"></p>
<ul>
<li>格式化输出如下<ul>
<li>注意这里需要使用 cast 把 pop 转化为 int，否在会被当作字符串，排序失效</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> top <span class="number">6</span> city, pop</span><br><span class="line"><span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">JSON_VALUE</span>(info, <span class="string">&#x27;$.city&#x27;</span>) city, <span class="built_in">cast</span>(<span class="built_in">JSON_VALUE</span>(info, <span class="string">&#x27;$.pop&#x27;</span>) <span class="keyword">as</span> <span class="type">int</span>) pop</span><br><span class="line">    <span class="keyword">from</span> test2</span><br><span class="line">) M</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> pop <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>




      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/22/DB/SQLServer/json.practice/" data-id="cl9lj74a600ay64tzhzzhd5ls" data-title="SQL Server json 查询练习" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQLServer/" rel="tag">SQLServer</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DB/SQLServer/Wolf.Sheep.Vegetable.River" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/06/22/DB/SQLServer/Wolf.Sheep.Vegetable.River/" class="article-date">
  <time class="dt-published" datetime="2021-06-22T15:48:43.000Z" itemprop="datePublished">2021-06-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB-SQLServer/">DB.SQLServer</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/06/22/DB/SQLServer/Wolf.Sheep.Vegetable.River/">SQL Server 递归查询.狼羊过河问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="狼羊过河问题"><a href="#狼羊过河问题" class="headerlink" title="狼羊过河问题"></a>狼羊过河问题</h1><h2 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h2><ul>
<li>一个人带着一只狼、一只羊、一棵白菜要过河，小船一次只能容下一个人和一样动植物</li>
<li>人不在场的时候，狼要吃掉羊、羊要吃掉白菜</li>
<li>问应当如何渡河？</li>
</ul>
<h2 id="SQL-Server-求解"><a href="#SQL-Server-求解" class="headerlink" title="SQL Server 求解"></a>SQL Server 求解</h2><ul>
<li>安装之后命令行直接输入如下命令便可进入 SQL Server 命令行模式</li>
</ul>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlcmd</span><br></pre></td></tr></table></figure>

<ul>
<li>新建数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database River;</span><br></pre></td></tr></table></figure>

<ul>
<li>使用数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use River;</span><br></pre></td></tr></table></figure>



<h3 id="状态表"><a href="#状态表" class="headerlink" title="状态表"></a>状态表</h3><ul>
<li>新建一个数据库表 <code>STATE</code> 用于存储可行的状态，state 表示当前河岸的状态</li>
<li>使用一个 4 位的二级制数表示状态</li>
<li>低 4 位分别表示人（3）、狼（2）、羊（1）、菜（0）</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> STATE (</span><br><span class="line">    state tinyint</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>使用循环把可行的状态插入表中</li>
<li>可行的状态，满足以下一个条件即可<ul>
<li>人在</li>
<li>人不在，但是不存在狼羊或羊菜同时存在的情况</li>
</ul>
</li>
<li>最大的状态为 0b1111 &#x3D; 15<ul>
<li>判断人不在：state &lt; 0b1000<ul>
<li>0b1000 &#x3D; 8</li>
</ul>
</li>
<li>判断狼羊都在：state &amp; 0b0110 &#x3D;&#x3D; 0b0110<ul>
<li>0b0110 &#x3D; 6</li>
</ul>
</li>
<li>判断羊菜都在：state &amp; 0b0011 &#x3D;&#x3D; 0b0011<ul>
<li>0b0011 &#x3D; 3</li>
</ul>
</li>
</ul>
</li>
<li>同时对岸也得满足这个条件</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="variable">@i</span> <span class="type">int</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable">@j</span> <span class="type">int</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">set</span> <span class="variable">@i</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line">while <span class="variable">@i</span><span class="operator">&lt;=</span><span class="number">15</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@j</span><span class="operator">=</span><span class="number">15</span><span class="operator">-</span><span class="variable">@i</span></span><br><span class="line">    <span class="comment">/* 当前岸 */</span></span><br><span class="line">    if ((<span class="variable">@i</span> <span class="operator">&gt;=</span> <span class="number">8</span>) <span class="keyword">or</span> <span class="keyword">not</span> ((<span class="variable">@i</span> <span class="operator">&amp;</span> <span class="number">6</span> <span class="operator">=</span> <span class="number">6</span>) <span class="keyword">or</span> (<span class="variable">@i</span> <span class="operator">&amp;</span> <span class="number">3</span> <span class="operator">=</span> <span class="number">3</span>)))</span><br><span class="line">    <span class="keyword">and</span></span><br><span class="line">    <span class="comment">/* 对岸 */</span></span><br><span class="line">    ((<span class="variable">@j</span> <span class="operator">&gt;=</span> <span class="number">8</span>) <span class="keyword">or</span> <span class="keyword">not</span> ((<span class="variable">@j</span> <span class="operator">&amp;</span> <span class="number">6</span> <span class="operator">=</span> <span class="number">6</span>) <span class="keyword">or</span> (<span class="variable">@j</span> <span class="operator">&amp;</span> <span class="number">3</span> <span class="operator">=</span> <span class="number">3</span>)))</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">insert</span> STATE <span class="keyword">values</span> (<span class="variable">@i</span>)</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@i</span><span class="operator">=</span><span class="variable">@i</span><span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>通过如下指令，我们可以看到一共有 10 个状态</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="operator">*</span>) <span class="keyword">from</span> STATE</span><br></pre></td></tr></table></figure>



<h3 id="路径表"><a href="#路径表" class="headerlink" title="路径表"></a>路径表</h3><ul>
<li>新建一个表，用于表示相邻边</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> PATH(</span><br><span class="line">    state_from  tinyint,</span><br><span class="line">    state_to    tinyint,</span><br><span class="line">    path        <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>对 STATE 表做笛卡尔积，挑选出可行边，保存在 PATH 中，path 字段记录中间节点</li>
<li>可行边，同时满足以下所有条件<ul>
<li>满足下列两个条件之一<ul>
<li>state_from - state_to 中有人，且最多有一件物品，同时 state_to 中不能有 state_from 没有的东西<ul>
<li>人过河</li>
</ul>
</li>
<li>state_to - state_from 中有人，且最多有一件物品，同时 state_from 中不能有 state_to 没有的东西<ul>
<li>人从对岸回来</li>
</ul>
</li>
</ul>
</li>
<li>state_from、state_to 都是合法的<ul>
<li>这个由 STATE 表保证了</li>
</ul>
</li>
</ul>
</li>
<li>实际解决<ul>
<li>state_from - state_to 中有人（最高位为 1）<ul>
<li>打表：1-0&#x3D;1，1-1&#x3D;0，0-1&#x3D;0，0-0&#x3D;0<ul>
<li>state_from - state_to &#x3D; state_from &amp; ~state_to &gt;&#x3D; 0b1000 &#x3D; 8</li>
</ul>
</li>
</ul>
</li>
<li>最多只有一件物品<ul>
<li>state_from - state_to 的低三位只有一位为 1，或者全为 0</li>
</ul>
</li>
<li>state_to 中不能有 state_from 没有的东西<ul>
<li>state_to &amp; ~state_from &#x3D;&#x3D; 0</li>
</ul>
</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> PATH</span><br><span class="line"><span class="keyword">select</span> S1.state, S2.state, &quot;&quot;</span><br><span class="line"><span class="keyword">from</span> STATE S1, STATE S2</span><br><span class="line"><span class="keyword">where</span> (</span><br><span class="line">    (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">&gt;=</span> <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">and</span></span><br><span class="line">    (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">=</span> <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">and</span> (</span><br><span class="line">        (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">or</span> (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">or</span> (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">or</span> (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">4</span>)</span><br><span class="line">    )</span><br><span class="line">) <span class="keyword">or</span> (</span><br><span class="line">    (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">&gt;=</span> <span class="number">8</span>)</span><br><span class="line">    <span class="keyword">and</span></span><br><span class="line">    (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">=</span> <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">and</span> (</span><br><span class="line">        (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">or</span> (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">or</span> (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">or</span> (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">&amp;</span> <span class="number">7</span> <span class="operator">=</span> <span class="number">4</span>)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>可以做一个简单的优化</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> PATH</span><br><span class="line"><span class="keyword">select</span> S1.state, S2.state, &quot;&quot;</span><br><span class="line"><span class="keyword">from</span> STATE S1, STATE S2</span><br><span class="line"><span class="keyword">where</span> (</span><br><span class="line">    (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">=</span> <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">and</span> (</span><br><span class="line">        (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">=</span> <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">or</span>(S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">=</span> <span class="number">9</span>)</span><br><span class="line">        <span class="keyword">or</span> (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">=</span> <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">or</span> (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">=</span> <span class="number">12</span>)</span><br><span class="line">    )</span><br><span class="line">) <span class="keyword">or</span> (</span><br><span class="line">    (S1.state <span class="operator">&amp;</span> <span class="operator">~</span>S2.state <span class="operator">=</span> <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">and</span> (</span><br><span class="line">        (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">=</span> <span class="number">8</span>)</span><br><span class="line">        <span class="keyword">or</span>(S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">=</span> <span class="number">9</span>)</span><br><span class="line">        <span class="keyword">or</span> (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">=</span> <span class="number">10</span>)</span><br><span class="line">        <span class="keyword">or</span> (S2.state <span class="operator">&amp;</span> <span class="operator">~</span>S1.state <span class="operator">=</span> <span class="number">12</span>)</span><br><span class="line">    )</span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h3 id="求解"><a href="#求解" class="headerlink" title="求解"></a>求解</h3><ul>
<li>我们简单的用一个表 <code>ANSWER</code> 记录结果</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> ANSWER(</span><br><span class="line">    path    <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li>找一条路径满足起始点为 0b1111&#x3D;15，终点为 0b0000&#x3D;0，输出这条路径</li>
<li>我们需要进行一个环路检测，我们简单的使用一个变量记录路径，不允许路径上的点重复出现</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> MultiBouncePath(state_from, state_to, path) <span class="keyword">as</span> (</span><br><span class="line">    <span class="keyword">select</span> state_from, state_to, <span class="built_in">cast</span>(path <span class="keyword">as</span> <span class="type">varchar</span>)</span><br><span class="line">    <span class="keyword">from</span> PATH</span><br><span class="line"></span><br><span class="line">    <span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 注意顺序 M,P, 末尾增长边 */</span></span><br><span class="line">    <span class="keyword">select</span> M.state_from , P.state_to, <span class="built_in">cast</span>(M.path <span class="operator">+</span> <span class="string">&#x27;,&#x27;</span> <span class="operator">+</span> <span class="built_in">cast</span>(M.state_to <span class="keyword">as</span> <span class="type">varchar</span>) <span class="keyword">as</span> <span class="type">varchar</span>)</span><br><span class="line">    <span class="keyword">from</span> MultiBouncePath M, PATH P</span><br><span class="line">    <span class="comment">/* M.path 中找不到子串 P.state_t 说明路径上没有这个点 */</span></span><br><span class="line">    <span class="keyword">where</span> M.state_to <span class="operator">=</span> P.state_from <span class="keyword">and</span> CHARINDEX(<span class="built_in">cast</span>(P.state_to <span class="keyword">as</span> <span class="type">varchar</span>) ,M.path) <span class="operator">=</span> <span class="number">0</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> ANSWER</span><br><span class="line"><span class="keyword">select</span> (<span class="built_in">cast</span>(state_from <span class="keyword">as</span> <span class="type">varchar</span>) <span class="operator">+</span> path <span class="operator">+</span> &quot;,&quot; <span class="operator">+</span> <span class="built_in">cast</span>(state_to <span class="keyword">as</span> <span class="type">varchar</span>))</span><br><span class="line"><span class="keyword">from</span> MultiBouncePath</span><br><span class="line"><span class="keyword">where</span> state_from <span class="operator">=</span> <span class="number">15</span> <span class="keyword">and</span> state_to <span class="operator">=</span> <span class="number">0</span></span><br></pre></td></tr></table></figure>

<ul>
<li>我们可以查看具体的路径</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> ANSWER</span><br></pre></td></tr></table></figure>

<ul>
<li>结果如下<ul>
<li>15,5,13,4,14,2,10,0</li>
<li>15,5,13,1,11,2,10,0</li>
</ul>
</li>
<li>我们将其转化为我们能够直接读得懂的内容</li>
<li>增加一个标识 ID</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> ANSWER <span class="keyword">add</span> ID <span class="type">int</span> <span class="keyword">identity</span>(<span class="number">1</span>,<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>辅助实现</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> ANSWER</span><br><span class="line"><span class="keyword">set</span> path <span class="operator">=</span> path <span class="operator">+</span> <span class="string">&#x27;,&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>定义一个从数字到状态的转换函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 架构名.函数名 */</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">function</span> dbo.to_zh(</span><br><span class="line"><span class="variable">@num1</span> <span class="type">int</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">returns</span> <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@ans1</span> <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@ans2</span> <span class="type">varchar</span>(<span class="number">100</span>)</span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@disc</span> <span class="type">varchar</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@index</span> <span class="type">varchar</span>(<span class="number">10</span>)</span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@disc</span> <span class="operator">=</span> &quot;人狼羊菜&quot;</span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@index</span> <span class="operator">=</span> &quot;8421&quot;</span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@ans1</span> <span class="operator">=</span> &quot;&quot;</span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@ans2</span> <span class="operator">=</span> &quot;&quot;</span><br><span class="line">    <span class="keyword">declare</span> <span class="variable">@i</span> <span class="type">int</span></span><br><span class="line">    <span class="keyword">set</span> <span class="variable">@i</span> <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    while(<span class="variable">@i</span> <span class="operator">&lt;=</span> <span class="number">4</span>)</span><br><span class="line">    <span class="keyword">begin</span></span><br><span class="line">        if ((<span class="variable">@num1</span> <span class="operator">&amp;</span> (ASCII(<span class="built_in">SUBSTRING</span>(<span class="variable">@index</span>, <span class="variable">@i</span>, <span class="number">1</span>)) <span class="operator">-</span> ASCII(&quot;0&quot;))) <span class="operator">&gt;</span> <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">set</span> <span class="variable">@ans1</span> <span class="operator">=</span> <span class="variable">@ans1</span> <span class="operator">+</span> <span class="built_in">SUBSTRING</span>(<span class="variable">@disc</span>, <span class="variable">@i</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">set</span> <span class="variable">@ans2</span> <span class="operator">=</span> <span class="variable">@ans2</span> <span class="operator">+</span> <span class="built_in">SUBSTRING</span>(<span class="variable">@disc</span>, <span class="variable">@i</span>, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">set</span> <span class="variable">@i</span> <span class="operator">=</span> <span class="variable">@i</span> <span class="operator">+</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable">@ans1</span> <span class="operator">+</span> &quot;|&quot; <span class="operator">+</span> <span class="variable">@ans2</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ul>
<li>取出一个结果进行输出<ul>
<li>master..spt_values 是系统中一个表</li>
</ul>
</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> dbo.to_zh(M.item) <span class="keyword">from</span> (</span><br><span class="line">    <span class="keyword">select</span> <span class="built_in">SUBSTRING</span>(ans.path, number, CHARINDEX(<span class="string">&#x27;,&#x27;</span>, ans.path <span class="operator">+</span> <span class="string">&#x27;,&#x27;</span>, number) <span class="operator">-</span> number) <span class="keyword">as</span> item</span><br><span class="line">    <span class="keyword">from</span> ANSWER ans, master..spt_values</span><br><span class="line">    <span class="comment">/* 查第 1 条记录*/</span></span><br><span class="line">    <span class="keyword">where</span> ID <span class="operator">=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">and</span> number <span class="operator">&gt;=</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">and</span> number <span class="operator">&lt;</span> len(ans.path)</span><br><span class="line">    <span class="keyword">and</span> type <span class="operator">=</span> <span class="string">&#x27;p&#x27;</span></span><br><span class="line">    <span class="keyword">and</span> <span class="built_in">SUBSTRING</span>(<span class="string">&#x27;,&#x27;</span> <span class="operator">+</span> ans.path, number, <span class="number">1</span>)<span class="operator">=</span><span class="string">&#x27;,&#x27;</span></span><br><span class="line">) M</span><br></pre></td></tr></table></figure>

<ul>
<li>输出结果如下</li>
<li>15,5,13,4,14,2,10,0</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">人狼羊菜|</span><br><span class="line">狼菜|人羊</span><br><span class="line">人狼菜|羊</span><br><span class="line">狼|人羊菜</span><br><span class="line">人狼羊|菜</span><br><span class="line">羊|人狼菜</span><br><span class="line">人羊|狼菜</span><br><span class="line">|人狼羊菜</span><br></pre></td></tr></table></figure>

<ul>
<li>15,5,13,1,11,2,10,0</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">人狼羊菜<span class="operator">|</span></span><br><span class="line">狼菜<span class="operator">|</span>人羊</span><br><span class="line">人狼菜<span class="operator">|</span>羊</span><br><span class="line">菜<span class="operator">|</span>人狼羊</span><br><span class="line">人羊菜<span class="operator">|</span>狼</span><br><span class="line">羊<span class="operator">|</span>人狼菜</span><br><span class="line">人羊<span class="operator">|</span>狼菜</span><br><span class="line"><span class="operator">|</span>人狼羊菜</span><br></pre></td></tr></table></figure>



<h2 id="其他-SQL-Server-相关"><a href="#其他-SQL-Server-相关" class="headerlink" title="其他 SQL Server 相关"></a>其他 SQL Server 相关</h2><ul>
<li>删除整个表中的条目</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">truncate</span> <span class="keyword">table</span> STATE</span><br></pre></td></tr></table></figure>

<ul>
<li>删除函数</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> dbo.to_zh</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/06/22/DB/SQLServer/Wolf.Sheep.Vegetable.River/" data-id="cl9lj74a700b164tz8gch8qow" data-title="SQL Server 递归查询.狼羊过河问题" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/SQLServer/" rel="tag">SQLServer</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/13/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/15/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/0/">0</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algebra/">Algebra</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-Kits/">C++.Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG/">CG</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Algorithm/">CG.Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES101/">CG.GAMES101</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES102/">CG.GAMES102</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES103/">CG.GAMES103</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES104/">CG.GAMES104</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES202/">CG.GAMES202</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES203/">CG.GAMES203</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Kits/">CG.Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-LS/">CG.LS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-PBRT/">CG.PBRT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Paper/">CG.Paper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CV/">CV</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-CLJ/">DB.CLJ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-MySQL/">DB.MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-SQLServer/">DB.SQLServer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DSA/">DSA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kits/">Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-CXQ/">OS.CXQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-OSTEP/">OS.OSTEP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-xv6-labs/">OS.xv6-labs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-xv6-source-code/">OS.xv6-source-code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TODO/">TODO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/book-directory/">book.directory</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/computation-pyr/">computation.pyr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/csharp-kits/">csharp.kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/csharp-tds/">csharp.tds</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/images/">images</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/installation/">installation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mitsuba/">mitsuba</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nothing/">nothing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-Maya/">software.Maya</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-ps/">software.ps</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-vscode/">software.vscode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/win/">win</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algebra/" rel="tag">Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFS/" rel="tag">BFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BST/" rel="tag">BST</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BVH/" rel="tag">BVH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CG-Algorithm/" rel="tag">CG-Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CV/" rel="tag">CV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Code/" rel="tag">Code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DFS/" rel="tag">DFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DP/" rel="tag">DP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DSA/" rel="tag">DSA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dijkstra/" rel="tag">Dijkstra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EG/" rel="tag">EG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Floyd/" rel="tag">Floyd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GI/" rel="tag">GI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Glints/" rel="tag">Glints</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HDR/" rel="tag">HDR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HQX/" rel="tag">HQX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Heap/" rel="tag">Heap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kits/" rel="tag">Kits</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LCA/" rel="tag">LCA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LLG/" rel="tag">LLG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MCMC/" rel="tag">MCMC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MIS/" rel="tag">MIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MLT/" rel="tag">MLT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maya/" rel="tag">Maya</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NEE/" rel="tag">NEE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PBRT/" rel="tag">PBRT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Radiometry/" rel="tag">Radiometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RayTracing/" rel="tag">RayTracing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SAH/" rel="tag">SAH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SDF/" rel="tag">SDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SGJ/" rel="tag">SGJ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLServer/" rel="tag">SQLServer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STL/" rel="tag">STL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shadow/" rel="tag">Shadow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WHM/" rel="tag">WHM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WX/" rel="tag">WX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/" rel="tag">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/computation/" rel="tag">computation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csharp/" rel="tag">csharp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/images/" rel="tag">images</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/installation/" rel="tag">installation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitsuba/" rel="tag">mitsuba</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobaxterm/" rel="tag">mobaxterm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nothing/" rel="tag">nothing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obs/" rel="tag">obs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/occlusion/" rel="tag">occlusion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ps/" rel="tag">ps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/software/" rel="tag">software</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tree/" rel="tag">tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win/" rel="tag">win</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xv6/" rel="tag">xv6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%88%86/" rel="tag">二分</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%83%E5%AE%87%E5%AE%99/" rel="tag">元宇宙</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%A0%E4%BD%95/" rel="tag">几何</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/" rel="tag">可见性</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" rel="tag">并查集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" rel="tag">拓扑排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%99%AE%E5%90%95%E5%85%8B%E5%9D%90%E6%A0%87/" rel="tag">普吕克坐标</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" rel="tag">最小生成树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="tag">最短路</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="tag">线段树</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algebra/" style="font-size: 10px;">Algebra</a> <a href="/tags/BFS/" style="font-size: 10px;">BFS</a> <a href="/tags/BST/" style="font-size: 10px;">BST</a> <a href="/tags/BVH/" style="font-size: 12.5px;">BVH</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/CG/" style="font-size: 20px;">CG</a> <a href="/tags/CG-Algorithm/" style="font-size: 10px;">CG-Algorithm</a> <a href="/tags/CV/" style="font-size: 10.63px;">CV</a> <a href="/tags/Code/" style="font-size: 14.38px;">Code</a> <a href="/tags/DB/" style="font-size: 19.38px;">DB</a> <a href="/tags/DFS/" style="font-size: 12.5px;">DFS</a> <a href="/tags/DP/" style="font-size: 13.13px;">DP</a> <a href="/tags/DSA/" style="font-size: 11.25px;">DSA</a> <a href="/tags/Dijkstra/" style="font-size: 10px;">Dijkstra</a> <a href="/tags/EG/" style="font-size: 12.5px;">EG</a> <a href="/tags/Floyd/" style="font-size: 10.63px;">Floyd</a> <a href="/tags/GI/" style="font-size: 11.25px;">GI</a> <a href="/tags/Glints/" style="font-size: 10px;">Glints</a> <a href="/tags/HDR/" style="font-size: 10px;">HDR</a> <a href="/tags/HQX/" style="font-size: 10px;">HQX</a> <a href="/tags/Heap/" style="font-size: 10px;">Heap</a> <a href="/tags/Kits/" style="font-size: 13.75px;">Kits</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/LLG/" style="font-size: 12.5px;">LLG</a> <a href="/tags/MCMC/" style="font-size: 10.63px;">MCMC</a> <a href="/tags/MIS/" style="font-size: 10px;">MIS</a> <a href="/tags/MLT/" style="font-size: 10px;">MLT</a> <a href="/tags/Maya/" style="font-size: 10px;">Maya</a> <a href="/tags/MySQL/" style="font-size: 11.88px;">MySQL</a> <a href="/tags/NEE/" style="font-size: 10px;">NEE</a> <a href="/tags/OS/" style="font-size: 17.5px;">OS</a> <a href="/tags/PBRT/" style="font-size: 10px;">PBRT</a> <a href="/tags/Paper/" style="font-size: 15.63px;">Paper</a> <a href="/tags/Radiometry/" style="font-size: 10px;">Radiometry</a> <a href="/tags/RayTracing/" style="font-size: 10px;">RayTracing</a> <a href="/tags/SAH/" style="font-size: 10px;">SAH</a> <a href="/tags/SDF/" style="font-size: 10px;">SDF</a> <a href="/tags/SGJ/" style="font-size: 10.63px;">SGJ</a> <a href="/tags/SQL/" style="font-size: 13.13px;">SQL</a> <a href="/tags/SQLServer/" style="font-size: 10.63px;">SQLServer</a> <a href="/tags/STL/" style="font-size: 11.25px;">STL</a> <a href="/tags/Shadow/" style="font-size: 10px;">Shadow</a> <a href="/tags/WHM/" style="font-size: 16.88px;">WHM</a> <a href="/tags/WX/" style="font-size: 11.88px;">WX</a> <a href="/tags/YLQ/" style="font-size: 18.13px;">YLQ</a> <a href="/tags/book/" style="font-size: 10.63px;">book</a> <a href="/tags/computation/" style="font-size: 18.75px;">computation</a> <a href="/tags/csharp/" style="font-size: 16.25px;">csharp</a> <a href="/tags/images/" style="font-size: 10px;">images</a> <a href="/tags/installation/" style="font-size: 11.88px;">installation</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/linux/" style="font-size: 11.25px;">linux</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mitsuba/" style="font-size: 11.88px;">mitsuba</a> <a href="/tags/mobaxterm/" style="font-size: 10px;">mobaxterm</a> <a href="/tags/nothing/" style="font-size: 10.63px;">nothing</a> <a href="/tags/obs/" style="font-size: 10px;">obs</a> <a href="/tags/occlusion/" style="font-size: 15px;">occlusion</a> <a href="/tags/ps/" style="font-size: 10px;">ps</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/tree/" style="font-size: 11.25px;">tree</a> <a href="/tags/vscode/" style="font-size: 10.63px;">vscode</a> <a href="/tags/win/" style="font-size: 10.63px;">win</a> <a href="/tags/xv6/" style="font-size: 16.25px;">xv6</a> <a href="/tags/%E4%BA%8C%E5%88%86/" style="font-size: 10.63px;">二分</a> <a href="/tags/%E5%85%83%E5%AE%87%E5%AE%99/" style="font-size: 10.63px;">元宇宙</a> <a href="/tags/%E5%87%A0%E4%BD%95/" style="font-size: 10px;">几何</a> <a href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/" style="font-size: 11.88px;">可见性</a> <a href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" style="font-size: 10.63px;">并查集</a> <a href="/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">拓扑排序</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">排序</a> <a href="/tags/%E6%99%AE%E5%90%95%E5%85%8B%E5%9D%90%E6%A0%87/" style="font-size: 10px;">普吕克坐标</a> <a href="/tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" style="font-size: 10px;">最小生成树</a> <a href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/" style="font-size: 13.13px;">最短路</a> <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" style="font-size: 10px;">线段树</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/23/CG/WHM-GAMES103/11/">GAMES103.王华民.11.Incompressible Fluid Dynamics and Eulerian Fluids</a>
          </li>
        
          <li>
            <a href="/2022/10/23/CG/Papers/2021/bvh-survey-3/">(论文)[2021] A Survey on Bounding Volume Hierarchies for Ray Tracing(4)</a>
          </li>
        
          <li>
            <a href="/2022/04/28/CG/Kits/MIS-NEE/">NEE、MIS(多重重要性采样)</a>
          </li>
        
          <li>
            <a href="/2022/04/18/CG/WHM-GAMES103/10/">GAMES103.王华民.10.Surface Waves</a>
          </li>
        
          <li>
            <a href="/2022/04/17/CG/WHM-GAMES103/09-1/">GAMES103.王华民.09.Collision Handling(1)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>