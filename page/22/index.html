<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/22/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-OS/xv6-source-code/01-Exception" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/28/OS/xv6-source-code/01-Exception/" class="article-date">
  <time class="dt-published" datetime="2021-03-28T05:00:00.000Z" itemprop="datePublished">2021-03-28</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/OS-xv6-source-code/">OS.xv6-source-code</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/28/OS/xv6-source-code/01-Exception/">xv6-riscv-源代码阅读.中断与异常</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="XV6-源代码阅读——中断与异常"><a href="#XV6-源代码阅读——中断与异常" class="headerlink" title="XV6 源代码阅读——中断与异常"></a>XV6 源代码阅读——中断与异常</h1><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>阅读的代码是 <code>xv6-riscv</code> 版本的</li>
<li>涉及到的文件如下<ul>
<li><code>kernel</code><ul>
<li><code>kernelvsc.S</code>、<code>proc.c</code>、<code>start.c</code>、<code>syscall.c</code>、<code>trampoline.S</code>、<code>trap.c</code>、<code>riscv.h</code>、<code>entry.S</code></li>
</ul>
</li>
<li><code>user</code><ul>
<li><code>sh.c</code>、<code>initcode.S</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="问题回答"><a href="#问题回答" class="headerlink" title="问题回答"></a>问题回答</h2><h3 id="1-问题-1"><a href="#1-问题-1" class="headerlink" title="(1) 问题 1"></a>(1) 问题 1</h3><h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><ul>
<li>什么是用户态和内核态？两者有何区别？什么是中断和系统调用？两者有何区别？计算机在运行时，是如何确定当前处于用户态还是内核态的？</li>
</ul>
<h4 id="回答"><a href="#回答" class="headerlink" title="回答"></a>回答</h4><ul>
<li>在 RISC-V 中，有 3 种权限不同的模式（Machine mode、Supervisor mode、User mode）<ul>
<li>machine mode 拥有所有的特权，一般在启动时候用于配置电脑的环境</li>
<li>supervisor mode 的权限相对低些，可以执行特权指令，例如是否使能中断等</li>
<li>user mode 的权限级别最低，完成一些特殊功能的时候需要通过系统调用进入 supervisor mode</li>
</ul>
</li>
<li>内核态可以运行在 machine mode 和 supervisor mode 下，用户态只能运行在 user mode</li>
<li>中断与系统调用<ul>
<li>中断分为外中断和内中断，外中断包括 I&#x2F;O 中断、时钟中断等，内中断包括异常、系统调用和中止</li>
<li>系统调用指的是处于用户态下的程序需要完成一些只有内核态才能完成的功能时，通过系统调用的方式进入内核态，从而实现功能的行为<ul>
<li>主动调用，返回到下一条指令</li>
<li>一种中断，需要利用中断的机制来实现</li>
</ul>
</li>
</ul>
</li>
<li>在 RISC-V 中，通过寄存器 sstatus 中保存的 SPP 位来判断是处于内核态 (1) 还是用户态 (0)</li>
</ul>
<h3 id="2-问题-2"><a href="#2-问题-2" class="headerlink" title="(2) 问题 2"></a>(2) 问题 2</h3><h4 id="问题-1"><a href="#问题-1" class="headerlink" title="问题"></a>问题</h4><ul>
<li>什么是中断描述符，中断描述符表？在XV6 里是用什么数据结构表示的？</li>
</ul>
<h4 id="回答-1"><a href="#回答-1" class="headerlink" title="回答"></a>回答</h4><ul>
<li>RISC-V 中直接在 stvec 寄存器中设定中断处理程序的基地址，然后根据引起中断的不同原因分别进行操作，stvec 可以有两种取值 uservec &#x2F; kernelvec</li>
<li>如果是一种系统调用的话，在 uservec 中通过 syscall 进行具体功能的调用，参数通过 a 类寄存器传递，具体的系统调用号保存在寄存器 a7 里面，然后在进行 syscall 的时候，直接在数组通过系统调用号索引出具体的系统调用函数</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># user/initcode.S</span><br><span class="line">start:</span><br><span class="line">  la a0, init</span><br><span class="line">  la a1, argv</span><br><span class="line">  li a7, SYS_exec</span><br><span class="line">  ecall # ecall 陷入内核, 然后执行 uservec(在第三部分提具体的机制)</span><br></pre></td></tr></table></figure>





<h3 id="3-一次中断的过程"><a href="#3-一次中断的过程" class="headerlink" title="(3) 一次中断的过程"></a>(3) 一次中断的过程</h3><ul>
<li>我们使用 trap 来泛指中断<ul>
<li>系统调用（system call）：用户态程序通过调用 <code>ecall</code> 进入内核态实现功能</li>
<li>异常（exception）：用户态或者内核态程序的操作非法（除零、地址无效等）</li>
<li>设备中断（device interrupt）：例如硬件读写等</li>
</ul>
</li>
<li>Xv6 trap 的处理过程主要有 4 步<ul>
<li>RISC-V CPU 硬件做一些相关工作</li>
<li>为内核执行 C 代码准备一个向量组</li>
<li>C trap 处理程序</li>
<li>最后通过 system call 或者 device-driver 进行处理</li>
</ul>
</li>
<li>硬件在中断中做的事情如下<ul>
<li>判断 trap 类型，如果是设备中断而且寄存器 sstatus 中的 SIE 位为 0 ，那么结束（下列都不执行）</li>
<li>将寄存器 sstatus 中的 SIE 位设置为 0（关掉设备中断）</li>
<li>将 pc 拷贝到寄存器 sepc 中</li>
<li>保存当前模式（user&#x2F;supervisor）到 sstatus 的 SPP 位中</li>
<li>将 scause 寄存器设置为引起 trap 的原因</li>
<li>设置模式为 supervisor mode</li>
<li>将寄存器 stvec 的内容拷贝到 pc 中<ul>
<li>stvec 寄存器保存 trap 处理程序的地址</li>
</ul>
</li>
<li>开始按照新的 pc 执行代码</li>
</ul>
</li>
<li>硬件在中断中的行为<ul>
<li>没有切换页表、没有切换栈、没有保存其他寄存器</li>
<li>这样的话相对高效，不是所有程序都需要切换页表的，而且不同程序保存寄存器的方式也不一样，硬件只做必要的事情</li>
</ul>
</li>
<li>Xv6 在实现 trap 的时候将其分为如下 3 类，分别对应不同的处理程序<ul>
<li>traps from kernel space</li>
<li>traps from user space</li>
<li>timer interrupts</li>
</ul>
</li>
<li>我们接下来探讨这 3 类 trap 的不同实现</li>
</ul>
<h4 id="Traps-from-kernel-mode"><a href="#Traps-from-kernel-mode" class="headerlink" title="Traps from kernel mode"></a>Traps from kernel mode</h4><ul>
<li>在内核模式下，trap 只有两类：exceptions 、device  interrupt</li>
<li>当一个 trap 发生的时候，首先硬件开始工作，配置好上面提到的环境信息</li>
<li>此时 stvec 指向了 kernelvec 的起始地址</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># kernel/kernelvec.S</span><br><span class="line">.globl kerneltrap</span><br><span class="line">.globl kernelvec</span><br><span class="line">.align 4</span><br><span class="line">kernelvec:</span><br><span class="line">        # 在栈上开辟一块空间用于保存寄存器</span><br><span class="line">        addi sp, sp, -256</span><br><span class="line">        sd ra, 0(sp)</span><br><span class="line">        # ... 保存所有寄存器</span><br><span class="line">        sd t6, 240(sp)</span><br><span class="line"></span><br><span class="line">        # 调用 C 处理程序</span><br><span class="line">        call kerneltrap</span><br><span class="line"></span><br><span class="line">        # 恢复寄存器到之前的状态</span><br><span class="line">        ld ra, 0(sp)</span><br><span class="line">        # ... 恢复所有的寄存器(除了 tp)</span><br><span class="line">        ld t6, 240(sp)</span><br><span class="line"></span><br><span class="line">        # 恢复栈指针</span><br><span class="line">        addi sp, sp, 256</span><br><span class="line"></span><br><span class="line">        # 返回到之前的运行状态</span><br><span class="line">        sret</span><br></pre></td></tr></table></figure>

<ul>
<li>kernelvec 首先在栈上开辟一块空间，将所有的寄存器都保存下来<ul>
<li>因为本身就是在内核栈中，直接保存在栈上就行了</li>
</ul>
</li>
<li>调用 trap 的处理程序 kerneltrap</li>
<li>返回后恢复所有寄存器到原来的状态<ul>
<li>不需要恢复 tp（thread pointer）</li>
</ul>
</li>
<li>kerneltrap 的代码如下</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// kernel/trap.c</span></span><br><span class="line"><span class="type">void</span>  <span class="title function_">kerneltrap</span><span class="params">()</span> &#123;</span><br><span class="line">  <span class="type">int</span> which_dev = <span class="number">0</span>;</span><br><span class="line">  uint64 sepc = r_sepc();</span><br><span class="line">  uint64 sstatus = r_sstatus();</span><br><span class="line">  uint64 scause = r_scause();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((sstatus &amp; SSTATUS_SPP) == <span class="number">0</span>)</span><br><span class="line">    panic(<span class="string">&quot;kerneltrap: not from supervisor mode&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span>(intr_get() != <span class="number">0</span>)</span><br><span class="line">    panic(<span class="string">&quot;kerneltrap: interrupts enabled&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>((which_dev = devintr()) == <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;scause %p\n&quot;</span>, scause);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sepc=%p stval=%p\n&quot;</span>, r_sepc(), r_stval());</span><br><span class="line">    panic(<span class="string">&quot;kerneltrap&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// give up the CPU if this is a timer interrupt.</span></span><br><span class="line">  <span class="keyword">if</span>(which_dev == <span class="number">2</span> &amp;&amp; myproc() != <span class="number">0</span> &amp;&amp; myproc()-&gt;state == RUNNING)</span><br><span class="line">    yield();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// the yield() may have caused some traps to occur,</span></span><br><span class="line">  <span class="comment">// so restore trap registers for use by kernelvec.S&#x27;s sepc instruction.</span></span><br><span class="line">  w_sepc(sepc);</span><br><span class="line">  w_sstatus(sstatus);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>kerneltrap 首先保存寄存器 sstatus、sepc<ul>
<li>因为可能在 yield() 的时候出发新的 trap，因此需要保存这些寄存器的值</li>
</ul>
</li>
<li>权限判断，触发 kerneltrap 的必须是内核态</li>
<li>判断现在的 sstatus 寄存器的 SIE 位是否为 1（是否打开设备中断）<ul>
<li>如果打开了说明之前有可能出错，正常情况下应该是关闭的</li>
<li>出错原因？</li>
</ul>
</li>
<li>判断 trap 的原因【通过 devintr() 函数判断】<ul>
<li>如果是 exceptions ，那么肯定是内核出现错误了</li>
<li>如果是 device interrupt 的话，那么一定是时钟中断，调用 yield() 让出执行权</li>
</ul>
</li>
<li>最后恢复寄存器 sstatus、sepc 的值</li>
</ul>
<h5 id="一个问题"><a href="#一个问题" class="headerlink" title="一个问题"></a>一个问题</h5><ul>
<li>如果 yield() 的时候触发了 trap 怎么进入 kerneltrap 呢？在 user mode 下，stvec 指向的是 usertrap？<ul>
<li>在调用 usertrap 的时候设置 stvec 为 kerneltrap 即可</li>
<li>由于 RISC-V 硬件在进入 trap 的时候会关闭中断，因此就算有一小段时间 stvec 的值不正确也没事</li>
<li>具体 yield() 的机制还没学习 &#x2F;&#x2F; TODO</li>
</ul>
</li>
</ul>
<h4 id="Traps-from-user-space"><a href="#Traps-from-user-space" class="headerlink" title="Traps from user space"></a>Traps from user space</h4><ul>
<li>除了上面提到的两种 trap 之外，用户态下的 trap 还有通过 syscall 触发的系统调用</li>
<li>大体的运作逻辑是这样<ul>
<li>uservec、usertrap、 usertrapret、userret</li>
</ul>
</li>
<li>这一部分相对复杂的原因硬件在进入 trap 的时候是没有切换页表的，因此我们在查找具体的页表内容的时候需要通过当前进程中保存的页表地址取计算得到</li>
<li>首先系统进入 trap 之后，硬件会做上面提到的工作<ul>
<li>但是此时，stvec 指向的地址是 uservec</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># trampoline.S</span><br><span class="line">uservec:</span><br><span class="line">    # 交换 a0 和 sscratch 寄存器的值</span><br><span class="line">        # so that a0 is TRAPFRAME</span><br><span class="line">        csrrw a0, sscratch, a0</span><br><span class="line"></span><br><span class="line">        # 将寄存器保存到当前进程的 trapframe 中</span><br><span class="line">        sd ra, 40(a0)</span><br><span class="line">        # ... 保存寄存去</span><br><span class="line">        sd t6, 280(a0)</span><br><span class="line"></span><br><span class="line">        # 同时也保存 a0</span><br><span class="line">        csrr t0, sscratch</span><br><span class="line">        sd t0, 112(a0)</span><br><span class="line"></span><br><span class="line">        # 从 user mode 的 traptable 中恢复一些内核的信息</span><br><span class="line">        ld sp, 8(a0)</span><br><span class="line">        ld tp, 32(a0)</span><br><span class="line">        ld t0, 16(a0)</span><br><span class="line">        ld t1, 0(a0)</span><br><span class="line">        csrw satp, t1</span><br><span class="line">        sfence.vma zero, zero</span><br><span class="line"></span><br><span class="line">        # a0 is no longer valid, since the kernel page</span><br><span class="line">        # table does not specially map p-&gt;tf.</span><br><span class="line"></span><br><span class="line">        # jump to usertrap(), which does not return</span><br><span class="line">        jr t0</span><br></pre></td></tr></table></figure>

<ul>
<li>在进行系统调用之前，p-&gt;trapframe 的起始地址会被保存在 sscratch 寄存器中</li>
<li>因此在运行 usertrap 的时候可以利用 sscatch 寄存器中保存的值找到 user mode 下的页表地址</li>
<li>usertrap 首先将所有的寄存器保存在 p-&gt;trapframe 中</li>
<li>然后将内核页表的地址修改为和用户的页表地址一致</li>
<li>跳转到 usertrap 执行</li>
<li>usertrap 代码如下（基本思路和之前差不多）</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> <span class="title function_">usertrap</span><span class="params">(<span class="type">void</span>)</span> &#123;</span><br><span class="line">  <span class="type">int</span> which_dev = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span>((r_sstatus() &amp; SSTATUS_SPP) != <span class="number">0</span>)</span><br><span class="line">    panic(<span class="string">&quot;usertrap: not from user mode&quot;</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置 stvec 为 kernelvec</span></span><br><span class="line">  w_stvec((uint64)kernelvec);</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> <span class="title">proc</span> *<span class="title">p</span> =</span> myproc();</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 保存PC, 否则可能会有其他的 usertrap 修改它</span></span><br><span class="line">  p-&gt;trapframe-&gt;epc = r_sepc();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(r_scause() == <span class="number">8</span>)&#123;</span><br><span class="line">    <span class="comment">// system call</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(p-&gt;killed)</span><br><span class="line">      <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 系统调用返回下一条命令</span></span><br><span class="line">    p-&gt;trapframe-&gt;epc += <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 做完寄存器的操作之后打开设备中断</span></span><br><span class="line">    intr_on();</span><br><span class="line"></span><br><span class="line">    syscall(); <span class="comment">// 系统调用</span></span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>((which_dev = devintr()) != <span class="number">0</span>)&#123;</span><br><span class="line">    <span class="comment">// ok</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;usertrap(): unexpected scause %p pid=%d\n&quot;</span>, r_scause(), p-&gt;pid);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;            sepc=%p stval=%p\n&quot;</span>, r_sepc(), r_stval());</span><br><span class="line">    p-&gt;killed = <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span>(p-&gt;killed)</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// give up the CPU if this is a timer interrupt.</span></span><br><span class="line">  <span class="keyword">if</span>(which_dev == <span class="number">2</span>)</span><br><span class="line">    yield();</span><br><span class="line"></span><br><span class="line">  usertrapret();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>usertrap 的流程如下<ul>
<li>判断权限（要求是用户态）</li>
<li>重新修改 stvec 为 kernelvec<ul>
<li>当前所处的状态是内核态</li>
<li>之前提到的 yield 问题</li>
</ul>
</li>
<li>保存一些状态值，避免新的 usertrap 会修改它<ul>
<li>PC 等</li>
</ul>
</li>
<li>判断具体引起 trap 的原因<ul>
<li>如果是 syscall<ul>
<li>判断进程是否存活</li>
<li>修改 PC &#x3D; PC + 4（系统调用返回下一条命令）</li>
<li>打开设备中断</li>
<li>syscall 进行系统调用</li>
</ul>
</li>
<li>如果是 exception<ul>
<li>杀死进程并报错</li>
</ul>
</li>
<li>如果是 device interrupt<ul>
<li>yield</li>
</ul>
</li>
</ul>
</li>
<li>最后调用 usertrapret 返回<ul>
<li>这一部分主要恢复之前保存的状态</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Time-interrupt"><a href="#Time-interrupt" class="headerlink" title="Time interrupt"></a>Time interrupt</h4><ul>
<li>具体的机制和上面谈到的一样</li>
<li>time interrupt 的启动<ul>
<li>在操作系统启动的时候，开启 time interrupt</li>
</ul>
</li>
</ul>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><ul>
<li>很多的设计都是一些 trade-off<ul>
<li>例如在 RISC-V 中，只让硬件做简单的工作，而不用进行一些复杂的操作（页表切换、栈切换等）</li>
<li>这样的设计让不需要做复杂操作的程序运行得更快了（例如 kernelvec）</li>
<li>但是同时需要做上述操作的程序处理起来就更加复杂，而且不是硬件直接做的话，速度上也会有所下降（例如 uservec）</li>
</ul>
</li>
<li>很多设计的思想其实是相通的，例如这里的 kernelvec 调用的时候需要自己保存一些状态，避免在此时再次引发 trap 的时候修改这些状态量。这和编译器上面递归函数调用的时候需要保存参数等是一致的。</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2019/xv6/book-riscv-rev0.pdf">https://pdos.csail.mit.edu/6.828/2019/xv6/book-riscv-rev0.pdf</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/mit-pdos/xv6-riscv">https://github.com/mit-pdos/xv6-riscv</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/28/OS/xv6-source-code/01-Exception/" data-id="cl9lj74b700hq64tz3wx38ncs" data-title="xv6-riscv-源代码阅读.中断与异常" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xv6/" rel="tag">xv6</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES202/02" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/27/CG/YLQ-GAMES202/02/" class="article-date">
  <time class="dt-published" datetime="2021-03-27T05:52:49.000Z" itemprop="datePublished">2021-03-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES202/">CG.GAMES202</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/27/CG/YLQ-GAMES202/02/">GAMES202.闫令琪.02.基础知识</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YK4y1T7yY">https://www.bilibili.com/video/BV1YK4y1T7yY</a></li>
<li>Recap of CG Basics</li>
</ul>
<h1 id="基础知识回顾"><a href="#基础知识回顾" class="headerlink" title="基础知识回顾"></a>基础知识回顾</h1><h2 id="硬件渲染管线"><a href="#硬件渲染管线" class="headerlink" title="硬件渲染管线"></a>硬件渲染管线</h2><ul>
<li>Basic GPU hardware pipeline</li>
</ul>
<h3 id="管线"><a href="#管线" class="headerlink" title="管线"></a>管线</h3><ul>
<li>vertex processing</li>
<li>triangle processing</li>
<li>rasterization</li>
<li>fragment processing</li>
<li>framebuffer operation</li>
</ul>
<h3 id="关键步骤"><a href="#关键步骤" class="headerlink" title="关键步骤"></a>关键步骤</h3><ul>
<li>Model, View, Projection transforms</li>
<li>Sampling triangle coverage</li>
<li>Z-Buffer Visibility Tests</li>
<li>Shading<ul>
<li>Blinn-Phong</li>
</ul>
</li>
<li>Texture mapping &amp; interpolation<ul>
<li>重心坐标系</li>
</ul>
</li>
</ul>
<h3 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h3><ul>
<li>纹理坐标的 $(u,v)$ 是怎么参数化出来的？<ul>
<li>立方体贴图的思维</li>
<li>通用的要求<ul>
<li>纹理扭曲小</li>
<li>纹理映射到物体之后，每个部分的拉伸尽量相近</li>
</ul>
</li>
<li><strong>参数化问题</strong><ul>
<li>困难的几何问题</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="OpenGL"><a href="#OpenGL" class="headerlink" title="OpenGL"></a>OpenGL</h2><ul>
<li>Is a set of APIs that call the GPU pipeline from CPU<ul>
<li>一系列让 CPU 调用 GPU 的 API</li>
</ul>
</li>
<li>跨平台</li>
<li>其他的 API<ul>
<li>DirectX<ul>
<li>Windows</li>
</ul>
</li>
<li>Vulkan</li>
</ul>
</li>
<li>OpenGL 的问题<ul>
<li>碎片化，版本更迭平缓，不同版本有不同的特性</li>
<li>C 风格，很难使用</li>
<li>早先不能 Debug</li>
</ul>
</li>
</ul>
<h3 id="OpenGL-的流程"><a href="#OpenGL-的流程" class="headerlink" title="OpenGL 的流程"></a>OpenGL 的流程</h3><h4 id="一个类比（画油画）"><a href="#一个类比（画油画）" class="headerlink" title="一个类比（画油画）"></a>一个类比（画油画）</h4><ul>
<li><strong>A. Place objects&#x2F;models</strong><ul>
<li>放置物体 $\leftrightarrow$ 模型位置，模型属性，模型变换的指定</li>
</ul>
</li>
<li><strong>B. Set position of an easel</strong><ul>
<li>放置画架 $\leftrightarrow$ 确定相机（视图变换），使用具体的哪一个 framebuffer</li>
</ul>
</li>
<li><strong>C. Attach a canvas to the easel</strong><ul>
<li>固定一个画布 $\leftrightarrow$  在一个 framebuffer 里面可以生成好几张纹理图</li>
<li>multiple rendering target：支持渲染多张纹理</li>
<li><strong>双缓冲技术</strong>：先将图片渲染好，没问题之后再将其显示在屏幕上<ul>
<li>早期直接渲染到屏幕上会出现撕裂的问题（上一帧渲染到一半，下一帧就开始渲染了）</li>
<li>垂直同步打开：不会有撕裂的问题</li>
<li><strong>垂直同步</strong><ul>
<li>打开后能防止游戏画面高速移动时画面撕裂的现象</li>
<li>打开后如果你的游戏画面 FPS 数能达到或超过你显示器的刷新率，这时你的游戏画面 FPS 数被限制为你显示器的刷新率</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>D. Paint to the canvas</strong><ul>
<li>在画布上画画 $\leftrightarrow$ shading（vertex&#x2F;fragment shader），rasterization</li>
<li>vertex&#x2F;fragment shader：<strong>并行</strong></li>
</ul>
</li>
<li><strong>E. (Attach other canvases to the easel and continue painting)</strong><ul>
<li>换一张画布继续画 $\leftrightarrow$ 换一个 framebuffer 继续绘制</li>
</ul>
</li>
<li><strong>F. (Use previous paintings for reference)</strong><ul>
<li>$\leftrightarrow$ Multiple passes，使用之前渲染得到的结果（纹理）</li>
</ul>
</li>
</ul>
<h4 id="OpenGL-做的事"><a href="#OpenGL-做的事" class="headerlink" title="OpenGL 做的事"></a>OpenGL 做的事</h4><ul>
<li>in each pass<ul>
<li>Specify objects, camera, MVP, etc.</li>
</ul>
<ul>
<li>Specify framebuffer and input&#x2F;output textures</li>
</ul>
<ul>
<li>Specify vertex &#x2F; fragment shaders</li>
<li>(When you have everything specified on the GPU) Render!</li>
</ul>
</li>
</ul>
<h2 id="OpenGL-Shading-Language-GLSL"><a href="#OpenGL-Shading-Language-GLSL" class="headerlink" title="OpenGL Shading Language (GLSL)"></a>OpenGL Shading Language (GLSL)</h2><ul>
<li>描述着色器怎么运作的</li>
<li>比较像 C 语言</li>
<li>有很长的历史<ul>
<li>早期：GPU 上写汇编语言</li>
<li>SGI 时期：Stanford Real-Time Shading Language</li>
<li>Still long ago：Cg from NVIDIA</li>
<li><strong>HLSL</strong> in <strong>DirectX</strong> (<strong>vertex</strong> + <strong>pixel</strong>)</li>
<li><strong>GLSL</strong> in <strong>OpenGL</strong> (<strong>vertex</strong> + <strong>fragment</strong>)</li>
</ul>
</li>
<li>最终还是编译成汇编语言的</li>
</ul>
<h3 id="使用-shader"><a href="#使用-shader" class="headerlink" title="使用 shader"></a>使用 shader</h3><ul>
<li>Create shader (Vertex and Fragment)</li>
</ul>
<ul>
<li><strong>Compile</strong> shader</li>
</ul>
<ul>
<li>Attach shader to <strong>program</strong></li>
<li><strong>Link</strong> program</li>
<li><strong>Use program</strong></li>
</ul>
<h3 id="一些关键字"><a href="#一些关键字" class="headerlink" title="一些关键字"></a>一些关键字</h3><ul>
<li>attribute：顶点属性</li>
<li>uniform：全局变量（CPU直接送过去）</li>
<li>varying：变量<ul>
<li>vertex shader 中为插值前的顶点值</li>
<li>fragment shader 中为插值后的片元值</li>
</ul>
</li>
<li>sample2D：采样器（纹理）</li>
<li>highp：表示高精度</li>
</ul>
<h3 id="Debugging-Shaders"><a href="#Debugging-Shaders" class="headerlink" title="Debugging Shaders"></a>Debugging Shaders</h3><ul>
<li>早期：NVIDIA Nsight with Visual Studio<ul>
<li>Needed multiple GPUs for debugging GLSL<ul>
<li>GLSL：多 GPU 才行</li>
</ul>
</li>
<li>Had to run in software simulation mode in HLSL<ul>
<li>HLSL：软件模拟</li>
</ul>
</li>
</ul>
</li>
<li>现在<ul>
<li>Nsight Graphics (cross platform, NVIDIA GPUs only)<ul>
<li>和 visual studio 分开的，跨平台</li>
</ul>
</li>
<li>RenderDoc (cross platform, no limitations on GPUs)<ul>
<li>软件，对 GPU 类型没有要求</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="经验"><a href="#经验" class="headerlink" title="经验"></a>经验</h4><ul>
<li>RGB 调试法<ul>
<li>想要输出一个值，可以把它作为颜色在屏幕中显示出来</li>
<li>利用软件提取出颜色即可</li>
</ul>
</li>
</ul>
<h2 id="渲染方程"><a href="#渲染方程" class="headerlink" title="渲染方程"></a>渲染方程</h2><ul>
<li>The Rendering Equation</li>
</ul>
<p>$$<br>L_o(p,\omega_o)&#x3D;<br>L_e(p,\omega_o)<br>+\int_{H^2}f_r(p,\omega_i\to\omega_o)L_i(p,\omega_i)V(p,\omega_i)\cos\theta_id\omega_i<br>$$</p>
<ul>
<li>outging radiance &#x3D; emission + $\sum$ BRDF x incident radiance x visibility<ul>
<li>是否把 $\cos\theta_i$ 这一项合入 BRDF<ul>
<li>BRDF</li>
<li>cosine-weighted BRDF</li>
</ul>
</li>
</ul>
</li>
<li>实时渲染的理解：显式考虑 visibility</li>
<li>环境光照：Environment Lighting<ul>
<li>cube map</li>
<li>circle map</li>
</ul>
</li>
<li>全局光照 &#x3D; 直接光照 + 间接光照<ul>
<li>直接光照：direct illumination</li>
<li>间接光照：indirect illumination<ul>
<li>one-bounce</li>
<li>two-bounce</li>
<li>$\cdots$</li>
</ul>
</li>
</ul>
</li>
<li>实时渲染的理论基础<ul>
<li>one-bounce 之后效果就好了很多，之后的添加只是在细节上更好</li>
<li>实时渲染主要就是模拟 one-bounce 的间接光照</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/27/CG/YLQ-GAMES202/02/" data-id="cl9lj749s008c64tz71k1bi0x" data-title="GAMES202.闫令琪.02.基础知识" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES202/01" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/27/CG/YLQ-GAMES202/01/" class="article-date">
  <time class="dt-published" datetime="2021-03-27T03:03:43.000Z" itemprop="datePublished">2021-03-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES202/">CG.GAMES202</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/27/CG/YLQ-GAMES202/01/">GAMES202.闫令琪.01.课程介绍</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YK4y1T7yY">https://www.bilibili.com/video/BV1YK4y1T7yY</a></li>
<li>Introduction and Overview</li>
</ul>
<h1 id="高质量实时渲染"><a href="#高质量实时渲染" class="headerlink" title="高质量实时渲染"></a>高质量实时渲染</h1><ul>
<li>Real-Time High Quality Rendering<ul>
<li><strong>Real-Time</strong></li>
<li><strong>High Quality</strong></li>
<li><strong>Rendering</strong></li>
</ul>
</li>
</ul>
<h2 id="高质量实时渲染概念"><a href="#高质量实时渲染概念" class="headerlink" title="高质量实时渲染概念"></a>高质量实时渲染概念</h2><h3 id="Real-Time"><a href="#Real-Time" class="headerlink" title="Real-Time"></a>Real-Time</h3><ul>
<li>一般：30 FPS<ul>
<li>frames per second</li>
</ul>
</li>
<li>虚拟现实 &#x2F; 增强现实<ul>
<li>Virtual &#x2F; Augmented Reality</li>
<li>VR &#x2F; AR</li>
<li><strong>90</strong> FPS</li>
</ul>
</li>
<li><strong>Interactivity</strong>：可以接受的交互速度<ul>
<li>互动性</li>
<li>Each frame generated on the fly</li>
</ul>
</li>
</ul>
<h3 id="High-Quality"><a href="#High-Quality" class="headerlink" title="High Quality"></a>High Quality</h3><ul>
<li>真实感<ul>
<li>高额的计算代价</li>
<li>trade off：高质量，实时</li>
</ul>
</li>
<li>要求<ul>
<li>渲染结果是正确的</li>
<li>近似正确的<ul>
<li>可以接受</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Rendering"><a href="#Rendering" class="headerlink" title="Rendering"></a>Rendering</h3><ul>
<li>渲染</li>
</ul>
<h2 id="话题"><a href="#话题" class="headerlink" title="话题"></a>话题</h2><ul>
<li>实时阴影&#x2F;环境光照<ul>
<li>Shadows (and env)</li>
</ul>
</li>
<li>实时全局光照<ul>
<li>Global Illum. (Scene&#x2F;image space, precomputed)</li>
</ul>
</li>
<li>实时高质量着色<ul>
<li>Physically based Shading</li>
</ul>
</li>
<li>实时光线追踪<ul>
<li>Real-time ray tracing</li>
</ul>
</li>
<li>参与介质渲染<ul>
<li>Participating Media Rendering</li>
</ul>
</li>
<li>非真实感渲染<ul>
<li>Non-Photorealistic Rendering</li>
<li>艺术效果</li>
</ul>
</li>
<li>反走样与超采样<ul>
<li>Antialiasing and supersampling</li>
<li>TAA：时间上的反走样</li>
<li>DLSS：深度学习方法超采样</li>
<li>TAAU</li>
</ul>
</li>
<li>游戏引擎<ul>
<li>工程性的东西<ul>
<li>原理在学术界比较简单</li>
<li>但是实现这样一个系统非常难</li>
</ul>
</li>
<li>实时渲染很大程度上是由游戏需求推动的</li>
</ul>
</li>
</ul>
<h2 id="不会涉及的内容"><a href="#不会涉及的内容" class="headerlink" title="不会涉及的内容"></a>不会涉及的内容</h2><ul>
<li>建模与引擎使用</li>
<li>离线渲染</li>
<li>neural rendering<ul>
<li>神经网络</li>
<li>做不到 high quality</li>
<li>做不到 real-time</li>
</ul>
</li>
<li>scene &#x2F; shader 优化</li>
<li>shader 逆向工程</li>
<li>高性能计算</li>
</ul>
<h2 id="科学与技术"><a href="#科学与技术" class="headerlink" title="科学与技术"></a>科学与技术</h2><ul>
<li>science !&#x3D; technology</li>
<li>Real-time rendering &#x3D; fast &amp; approximate offline rendering + systematic engineering<ul>
<li>实时渲染 &#x3D; 离线渲染的近似 + 系统的工程</li>
</ul>
</li>
<li>实时渲染的技术：工业界远高于学术界<ul>
<li>例如游戏公司可能最早发现游戏渲染中存在的问题</li>
</ul>
</li>
</ul>
<h2 id="Computer-Graphics-is-AWESOME"><a href="#Computer-Graphics-is-AWESOME" class="headerlink" title="Computer Graphics is AWESOME!"></a>Computer Graphics is AWESOME!</h2><h2 id="实时渲染的动机"><a href="#实时渲染的动机" class="headerlink" title="实时渲染的动机"></a>实时渲染的动机</h2><ul>
<li>photorealistic images<ul>
<li>照片级真实感</li>
</ul>
</li>
<li>离线渲染很慢</li>
<li>实时渲染做一些近似，得到可以接受的结果<ul>
<li>With proper approximations, we can generate plausible results but runs much faster</li>
</ul>
</li>
</ul>
<h2 id="实时渲染的发展史"><a href="#实时渲染的发展史" class="headerlink" title="实时渲染的发展史"></a>实时渲染的发展史</h2><ul>
<li>Interactive 3D graphics <strong>pipeline</strong> as in <strong>OpenGL</strong><ul>
<li>Earliest SGI machines (Clark 82) to today</li>
<li>Most of focus on <strong>more geometry</strong>, <strong>texture mapping</strong></li>
<li>Some tweaks for realism (<strong>shadow mapping</strong>, <strong>accum. buffer</strong>)</li>
</ul>
</li>
<li>20 years ago<ul>
<li>Interactive 3D geometry with <strong>simple texture mapping</strong>, <strong>fake shadows</strong> (OpenGL, DirectX)</li>
</ul>
</li>
<li>20 -&gt; 10 years ago<ul>
<li>A <strong>giant leap</strong> since the emergence of <strong>programmable shaders</strong> (2000)<ul>
<li>可编程渲染管线被研究出来之后，得到了飞速的发展</li>
</ul>
</li>
<li><strong>Complex environment lighting</strong>, <strong>real materials</strong> (velvet, satin, paints), <strong>soft shadows</strong></li>
<li>游戏渲染中还存在的一些问题<ul>
<li>dark：整个场景不够明亮</li>
<li>oily：油，高光部分不真实</li>
</ul>
</li>
</ul>
</li>
<li>Today<ul>
<li>“Stunning graphics”</li>
<li>Extended to Virtual Reality (VR) and even <strong>movies</strong><ul>
<li>用实时渲染的技术去做原来要用离线渲染制作的电影</li>
</ul>
</li>
<li>可以看一些游戏引擎的宣传片</li>
</ul>
</li>
</ul>
<h2 id="重要技术"><a href="#重要技术" class="headerlink" title="重要技术"></a>重要技术</h2><ul>
<li>Programmable graphics hardware (shaders) (20 years ago)<ul>
<li>可编程渲染管线</li>
</ul>
</li>
</ul>
<img src="01/image-20210327134650411.png" style="zoom:50%;" />

<ul>
<li>Precomputation-based methods (15 years ago)<ul>
<li>预先计算，复杂的计算在渲染之前</li>
<li>存储上的代价</li>
</ul>
</li>
<li>Interactive Ray Tracing (8-10 years ago: CUDA + OptiX)<ul>
<li>交互级的光线追踪</li>
<li>Hardware development allows ray tracing on GPUs at low sampling rates<ul>
<li>(~1 samples per pixel (SPP))</li>
</ul>
</li>
<li>Followed by post processing to denoise</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/27/CG/YLQ-GAMES202/01/" data-id="cl9lj749r008564tz7n3u2fvz" data-title="GAMES202.闫令琪.01.课程介绍" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES202/00" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/27/CG/YLQ-GAMES202/00/" class="article-date">
  <time class="dt-published" datetime="2021-03-27T02:50:53.000Z" itemprop="datePublished">2021-03-27</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/0/">0</a>►<a class="article-category-link" href="/categories/CG/">CG</a>►<a class="article-category-link" href="/categories/CG-GAMES202/">CG.GAMES202</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/27/CG/YLQ-GAMES202/00/">GAMES202.闫令琪.00.说明</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li>GAMES202：Real-Time High Quality Rendering<ul>
<li>高质量实时渲染</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://sites.cs.ucsb.edu/~lingqi/teaching/games202.html">课程主页</a></li>
<li>授课老师：闫令琪</li>
<li>视频地址：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YK4y1T7yY">B站</a></li>
<li>内容<ul>
<li>实时阴影&#x2F;环境光照<ul>
<li>Shadows (and env)</li>
</ul>
</li>
<li>实时全局光照<ul>
<li>Global Illum. (Scene&#x2F;image space, precomputed)</li>
</ul>
</li>
<li>实时高质量着色<ul>
<li>Physically based Shading</li>
</ul>
</li>
<li>实时光线追踪<ul>
<li>Real-time ray tracing</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/27/CG/YLQ-GAMES202/00/" data-id="cl9lj749q008264tz5y8qfgj1" data-title="GAMES202.闫令琪.00.说明" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OS/xv6-source-code/00" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/OS/xv6-source-code/00/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T05:00:00.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/0/">0</a>►<a class="article-category-link" href="/categories/OS-xv6-source-code/">OS.xv6-source-code</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/OS/xv6-source-code/00/">xv6-riscv-源代码阅读.说明</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li><p>xv6-riscv-源代码阅读</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/mit-pdos/xv6-riscv">源代码</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2020/xv6/book-riscv-rev1.pdf">参考文档</a></p>
</li>
<li><p>包括 5 个部分</p>
<ul>
<li>中断与异常</li>
<li>进程线程</li>
<li>同步机制</li>
<li>虚存管理</li>
<li>文件系统</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/26/OS/xv6-source-code/00/" data-id="cl9lj74b800hw64tzdlx5bhon" data-title="xv6-riscv-源代码阅读.说明" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xv6/" rel="tag">xv6</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OS/xv6-labs/00" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/OS/xv6-labs/00/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T04:00:00.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/0/">0</a>►<a class="article-category-link" href="/categories/OS-xv6-labs/">OS.xv6-labs</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/OS/xv6-labs/00/">xv6-labs-2020.说明</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>mit 操作系统课程 lab<ul>
<li><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2020/">官网</a></li>
<li><a target="_blank" rel="noopener" href="https://pdos.csail.mit.edu/6.828/2020/labs/">labs 目录</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/banbao990/xv6-labs-2020">代码</a></li>
<li>已经完成部分如下<ol>
<li style="list-style: none"><input type="checkbox" checked=""> lab0-utils </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab1-syscall </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab2-pagetable </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab3-traps </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab4-lazy-allocation </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab5-copyonwrite </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab6-multi-threading </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab7-lock </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab8-file-system </li>
<li style="list-style: none"><input type="checkbox" checked=""> lab9-mmap </li>
<li style="list-style: none"><input type="checkbox"> lab10-net </li>
</ol></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/26/OS/xv6-labs/00/" data-id="cl9lj74b900i864tz53ds34lk" data-title="xv6-labs-2020.说明" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/xv6/" rel="tag">xv6</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OS/OSTEP/05" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/OS/OSTEP/05/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T03:58:22.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/OS-OSTEP/">OS.OSTEP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/OS/OSTEP/05/">OSTEP 阅读笔记(Ch05.进程API)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第-5-章-插叙：进程-API"><a href="#第-5-章-插叙：进程-API" class="headerlink" title="第 5 章 插叙：进程 API"></a>第 5 章 插叙：进程 API</h1><ul>
<li>UNIX 系统中的进程 API</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fork();</span><br><span class="line">exec();</span><br><span class="line">wait();</span><br></pre></td></tr></table></figure>



<h2 id="5-1-fork"><a href="#5-1-fork" class="headerlink" title="5.1 fork()"></a>5.1 fork()</h2><ul>
<li>调用一次，返回两次<ul>
<li>父进程返回子进程的 pid</li>
<li>子进程返回 0</li>
</ul>
</li>
<li>父进程和子进程的运行顺序是不确定的</li>
<li>由于CPU 调度程序非常复杂，所以我们不能假设哪个进程会先运行</li>
</ul>
<h2 id="5-2-wait"><a href="#5-2-wait" class="headerlink" title="5.2 wait()"></a>5.2 wait()</h2><ul>
<li>等待子进程运行结束后再运行<ul>
<li>具体等待哪个子进程、几个子进程由调用参数决定</li>
</ul>
</li>
</ul>
<h2 id="5-3-exec"><a href="#5-3-exec" class="headerlink" title="5.3 exec()"></a>5.3 exec()</h2><ul>
<li>让子进程运行不一样的程序</li>
<li>调用一次，从不返回</li>
<li>没有创建新进程，而是直接将当前运行的程序替换为不同的运行程序</li>
<li>从可执行程序中加载代码和静态数据，并用它覆写自己的代码段（以及静态数据），重新初始化堆、栈及其他内存空间</li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">char</span> *myargs[<span class="number">3</span>];</span><br><span class="line">myargs[<span class="number">0</span>] = strdup(<span class="string">&quot;wc&quot;</span>);   <span class="comment">// program: &quot;wc&quot; (word count)</span></span><br><span class="line">myargs[<span class="number">1</span>] = strdup(<span class="string">&quot;p3.c&quot;</span>); <span class="comment">// argument: file to count</span></span><br><span class="line">myargs[<span class="number">2</span>] = <span class="literal">NULL</span>;           <span class="comment">// marks end of array</span></span><br><span class="line">execvp(myargs[<span class="number">0</span>], myargs);  <span class="comment">// runs word count</span></span><br></pre></td></tr></table></figure>



<h2 id="5-4-为什么这样设计-API"><a href="#5-4-为什么这样设计-API" class="headerlink" title="5.4 为什么这样设计 API"></a>5.4 为什么这样设计 API</h2><ul>
<li>UNIX shell<ul>
<li>给了shell 在 fork 之后 exec 之前运行代码的机会</li>
<li>这样可以改变运行时环境，实现有趣的功能</li>
</ul>
</li>
<li>重定向文件输出</li>
</ul>
<h2 id="5-5-其他-API"><a href="#5-5-其他-API" class="headerlink" title="5.5 其他 API"></a>5.5 其他 API</h2><ul>
<li>kill()</li>
<li>信号（signal）、</li>
<li><strong>查看 man 手册获取更多知识</strong></li>
</ul>
<h2 id="作业"><a href="#作业" class="headerlink" title="作业"></a>作业</h2><h4 id="1"><a href="#1" class="headerlink" title="(1)"></a>(1)</h4><h4 id="2"><a href="#2" class="headerlink" title="(2)"></a>(2)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span> &#123;</span><br><span class="line">    <span class="type">int</span> pid;</span><br><span class="line">    <span class="comment">// 当关闭了标准输出之后, open 找到的第一个可用的文件描述符就是 1</span></span><br><span class="line">    <span class="comment">// 此时 printf 输出到 open 打开的文件里</span></span><br><span class="line">    close(STDOUT_FILENO);</span><br><span class="line">    open(<span class="string">&quot;2.txt&quot;</span>, O_CREAT|O_WRONLY|O_TRUNC, S_IRWXU);</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Fork Error!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// child</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;cccccc&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// parent</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;pppppp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>子进程和父进程都能共访问 open() 返回的文件描述符，因为父子进程虽然i有自己的文件描述符列表，但是共享打开文件</li>
<li>父子进程同时写文件的时候不能保证谁先写入，我的 wsl 中结果为</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ppppppcccccc</span><br></pre></td></tr></table></figure>

<h4 id="3"><a href="#3" class="headerlink" title="(3)"></a>(3)</h4><h4 id="4"><a href="#4" class="headerlink" title="(4)"></a>(4)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv, <span class="type">char</span>** env)</span> &#123;</span><br><span class="line">    <span class="type">int</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Fork Error!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// child</span></span><br><span class="line">        <span class="type">char</span> *myargs[<span class="number">2</span>];</span><br><span class="line">        myargs[<span class="number">0</span>] = strdup(<span class="string">&quot;/bin/ls&quot;</span>);</span><br><span class="line">        myargs[<span class="number">1</span>] = <span class="literal">NULL</span>;</span><br><span class="line">        <span class="comment">// execl(myargs[0], myargs[0], NULL);</span></span><br><span class="line">        <span class="comment">// execle(myargs[0], myargs[0], NULL, env);</span></span><br><span class="line">        <span class="comment">// execlp(&quot;ls&quot;, myargs[0], NULL);</span></span><br><span class="line">        execv(myargs[<span class="number">0</span>], myargs);</span><br><span class="line">        <span class="comment">// execve(myargs[0], myargs, env);</span></span><br><span class="line">        <span class="comment">// execvp(&quot;ls&quot;, myargs);</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// parent</span></span><br><span class="line">        wait(<span class="literal">NULL</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>结果确实可以执行 ls 命令，输出当前目录下的文件按</li>
<li>我的输出如下</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">2.c  2.out  2.txt  4.c  4.out</span><br></pre></td></tr></table></figure>

<ul>
<li>同样的基本调用，不同的封装方式为了满足不同的应用场景需要</li>
<li>区别如下<ul>
<li>l：用参数列表的方式传递新程序的参数，最后一个参数需要显示的指定为 NULL</li>
<li>v：用数组的方式传递新程序的参数，数组最后一个值需要显示的指定为 NULL</li>
<li>e：设置新的环境变量，作为一个数组在最后一个参数传入</li>
<li>p：运行的可执行文件只需要传递文件名即可，否则需要传递全路径</li>
</ul>
</li>
</ul>
<h4 id="5"><a href="#5" class="headerlink" title="(5)"></a>(5)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv, <span class="type">char</span>** env)</span> &#123;</span><br><span class="line">    <span class="type">int</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Fork Error!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// child</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m child!\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// parent</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;wait&#x27;return pid: %d\n&quot;</span>, wait(<span class="literal">NULL</span>));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child&#x27;s pid: %d\n&quot;</span>, pid);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m father!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>输出如下</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">I&#x27;m child!</span><br><span class="line">wait&#x27;return pid: 323</span><br><span class="line">child&#x27;s pid: 323</span><br><span class="line">I&#x27;m father!</span><br></pre></td></tr></table></figure>

<ul>
<li><code>wait(NULL)</code> 返回等待的子进程的 pid</li>
<li>子进程使用 <code>wait(NULL)</code> 会返回 -1</li>
<li>使用 <code>man wait</code> 可以查看具体的含义<ul>
<li><code>wait(NULL)</code> 操作当一个子进程结束的就会返回其 pid，等效于 <code>waitpid(-1, &amp;wstatus, 0)</code></li>
</ul>
</li>
</ul>
<h4 id="6"><a href="#6" class="headerlink" title="(6)"></a>(6)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv, <span class="type">char</span>** env)</span> &#123;</span><br><span class="line">    <span class="type">int</span> pid;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Fork Error!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// child</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m child!\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// parent</span></span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;wait&#x27;return pid: %d\n&quot;</span>, waitpid(<span class="number">-1</span>, <span class="literal">NULL</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;child&#x27;s pid: %d\n&quot;</span>, pid);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m father!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>wait(NULL)</code> 等价于 <code>waitpid(-1, NULL, 0)</code></li>
</ul>
<h4 id="7"><a href="#7" class="headerlink" title="(7)"></a>(7)</h4><h4 id="8"><a href="#8" class="headerlink" title="(8)"></a>(8)</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fcntl.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv, <span class="type">char</span>** env)</span> &#123;</span><br><span class="line">    <span class="type">int</span> pid;</span><br><span class="line">    <span class="type">int</span> pipe_fd[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">if</span>(pipe(pipe_fd) == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Pipe Error!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    pid = fork();</span><br><span class="line">    <span class="keyword">if</span>(pid &lt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">&quot;Fork Error!\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(pid == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="comment">// child</span></span><br><span class="line">        dup2(pipe_fd[<span class="number">1</span>], STDOUT_FILENO);</span><br><span class="line">        close(pipe_fd[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m child!\n&quot;</span>);</span><br><span class="line">        close(pipe_fd[<span class="number">1</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// parent</span></span><br><span class="line">        <span class="type">char</span>* msg = <span class="literal">NULL</span>; <span class="comment">// 系统帮助 malloc, 要求 len 设置为 0</span></span><br><span class="line">        <span class="type">size_t</span> len = <span class="number">0</span>;</span><br><span class="line">        dup2(pipe_fd[<span class="number">0</span>], STDIN_FILENO);</span><br><span class="line">        close(pipe_fd[<span class="number">1</span>]);</span><br><span class="line">        getline(&amp;msg, &amp;len, <span class="built_in">stdin</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;I&#x27;m father!\nmessage from child: %s\n&quot;</span>, msg);</span><br><span class="line">        close(pipe_fd[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">free</span>(msg);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>输出如下</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">I&#x27;m father!</span><br><span class="line">message from child: I&#x27;m child!</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/26/OS/OSTEP/05/" data-id="cl9lj74b700hn64tz6ryxdisx" data-title="OSTEP 阅读笔记(Ch05.进程API)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OS/OSTEP/04" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/OS/OSTEP/04/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T03:52:15.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/OS-OSTEP/">OS.OSTEP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/OS/OSTEP/04/">OSTEP 阅读笔记(Ch04.进程)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第-4-章-抽象：进程"><a href="#第-4-章-抽象：进程" class="headerlink" title="第 4 章 抽象：进程"></a>第 4 章 抽象：进程</h1><ul>
<li>进程的非正式定义：<strong>进程就是运行中的程序</strong></li>
<li>操作系统通过虚拟化（virtualizing）CPU 来提供有许多 CPU 的假象<ul>
<li>让一个进程只运行一个<strong>时间片</strong>，然后切换到其他进程</li>
<li><strong>性能损失</strong></li>
</ul>
</li>
<li>时分共享（time sharing），空分共享（space sharing）</li>
<li>低级的机制（mechanism）+ 高级的策略（policy）<ul>
<li>低级方法或协议，实现了所需的功能</li>
<li>调度策略（scheduling policy）</li>
</ul>
</li>
</ul>
<h2 id="4-1-抽象：进程"><a href="#4-1-抽象：进程" class="headerlink" title="4.1 抽象：进程"></a>4.1 抽象：进程</h2><ul>
<li>进程的机器状态（machine state）：程序在运行时可以读取或更新的内容<ul>
<li>内存</li>
<li>寄存器<ul>
<li>通用寄存器</li>
<li>PC（Program Counter）程序计数器、栈指针（stack pointer）、帧指针（frame pointer）等</li>
</ul>
</li>
<li>打开文件列表</li>
</ul>
</li>
<li>一种好的设计方式：<strong>分离策略和机制</strong></li>
</ul>
<h2 id="4-2-进程-API"><a href="#4-2-进程-API" class="headerlink" title="4.2 进程 API"></a>4.2 进程 API</h2><ul>
<li>进程 API 所应包括的功能<ul>
<li>创建（create）</li>
<li>销毁（destroy）<ul>
<li>停止失控进程</li>
</ul>
</li>
<li>等待（wait）</li>
<li>其他控制（miscellaneous ccontrol）<ul>
<li>暂停进程</li>
</ul>
</li>
<li>状态（status）</li>
</ul>
</li>
</ul>
<h2 id="4-3-进程创建：更多细节"><a href="#4-3-进程创建：更多细节" class="headerlink" title="4.3 进程创建：更多细节"></a>4.3 进程创建：更多细节</h2><h3 id="程序如何转化为进程"><a href="#程序如何转化为进程" class="headerlink" title="程序如何转化为进程"></a>程序如何转化为进程</h3><ul>
<li>将代码和所有静态数据（例如初始化变量）从磁盘加载（load）到内存中<ul>
<li>早期：尽快加载</li>
<li>现在：lazy</li>
</ul>
</li>
<li>必须为运行时栈（run-time stack）分配内存<ul>
<li>C：用栈存放局部变量、函数参数和返回地址</li>
<li>操作系统也可能会用参数初始化栈，main() 函数的参数列表（2）</li>
</ul>
</li>
<li>可能为程序的堆（heap）分配一些内存<ul>
<li>C：malloc() &#x2F; free()</li>
</ul>
</li>
<li>执行一些其他初始化任务<ul>
<li>I&#x2F;O 相关<ul>
<li>Unix 默认情况下每个进程都有3 个打开的文件描述符（file descriptor），用于标准输入、输出和错误</li>
</ul>
</li>
</ul>
</li>
<li>启动程序</li>
</ul>
<h2 id="4-4-进程状态"><a href="#4-4-进程状态" class="headerlink" title="4.4 进程状态"></a>4.4 进程状态</h2><ul>
<li>3 状态<ul>
<li>运行（running）</li>
<li>就绪（ready）</li>
<li>阻塞（blocked）</li>
</ul>
</li>
</ul>
<img src="04/image-20210326105918960.png" style="zoom: 67%;" />

<ul>
<li>可能还会有其他状态<ul>
<li>初始（initial）：表示进程在创建时处于的状态</li>
<li>最终（final）：已退出但尚未清理的状态</li>
</ul>
</li>
</ul>
<h2 id="4-5-数据结构"><a href="#4-5-数据结构" class="headerlink" title="4.5 数据结构"></a>4.5 数据结构</h2><ul>
<li>进程列表（process list）</li>
<li>保存机器状态<ul>
<li>寄存器、内存（栈、堆）、打开文件列表</li>
</ul>
</li>
<li>保存进程信息<ul>
<li>进程状态</li>
<li>进程号、父进程等等</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/26/OS/OSTEP/04/" data-id="cl9lj74b600hk64tz2z39duzl" data-title="OSTEP 阅读笔记(Ch04.进程)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OS/OSTEP/02" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/OS/OSTEP/02/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T03:52:08.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/OS-OSTEP/">OS.OSTEP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/OS/OSTEP/02/">OSTEP 阅读笔记(Ch02.操作系统介绍)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="第二章-操作系统介绍"><a href="#第二章-操作系统介绍" class="headerlink" title="第二章 操作系统介绍"></a>第二章 操作系统介绍</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ul>
<li>操作系统中最重要的 3 个概念<ul>
<li>虚拟化（virtualization）</li>
<li>并发（concurrency）</li>
<li>持久性（persistence）</li>
</ul>
</li>
<li>运行程序：执行指令</li>
<li>操作系统的出现，是为了让系统更加易于使用、能够高效地运行</li>
<li>操作系统利用虚拟化技术（virtualization），将物理资源抽象为更通用、强大的虚拟形式<ul>
<li>虚拟化技术允许多个程序同时运行，并让他们似乎有着自己独立的物理设备</li>
<li>但是实际的物理设备是有限的，</li>
</ul>
</li>
<li>方便应用程序调用一些物理设备（还有保护的原因），操作系统为用户提供了很多<strong>系统调用</strong>，用于运行程序、访问内存和设备等</li>
<li>Virtualizing the CPU<ul>
<li>可以多个程序一起运行（顺序由操作系统调度）</li>
</ul>
</li>
<li>Virtualizing Memory<ul>
<li>让每个程序认为自己有独立的地址空间（虚存空间）</li>
<li>代码输出的地址是虚拟地址</li>
</ul>
</li>
<li>Concurrency<ul>
<li>多线程是一种并发</li>
<li>非原子操作可能会引发错误</li>
<li>操作系统需要处理并发问题</li>
</ul>
</li>
<li>Persistence<ul>
<li>由于断电或者系统崩溃等问题，需要持久存储数据</li>
<li>文件系统：操作系统中操理磁盘的软件</li>
<li>操作系统中没有虚拟磁盘，程序共享文件<ul>
<li>硬件驱动程序很复杂，硬件相关（Windows中加入了硬件抽象层 HAL）</li>
</ul>
</li>
<li>处理系统崩溃<ul>
<li>日志</li>
</ul>
</li>
<li>性能优化<ul>
<li>写时复制</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="设计目标"><a href="#设计目标" class="headerlink" title="设计目标"></a>设计目标</h2><ul>
<li>处理上述问题</li>
<li>抽象（层）</li>
<li>高性能</li>
<li>保护与隔离</li>
<li>能源效率</li>
<li>安全</li>
</ul>
<h2 id="历史"><a href="#历史" class="headerlink" title="历史"></a>历史</h2><ul>
<li>早期<ul>
<li>只是一些库</li>
</ul>
</li>
<li>限制应用程序功能<ul>
<li>系统调用、权限分级</li>
</ul>
</li>
<li>multiprogramming<ul>
<li>调度程序</li>
<li>内存保护</li>
</ul>
</li>
<li>PC：低成本、速度快、大众化</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/26/OS/OSTEP/02/" data-id="cl9lj74b600hh64tzhlbiavdf" data-title="OSTEP 阅读笔记(Ch02.操作系统介绍)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-OS/OSTEP/00" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/26/OS/OSTEP/00/" class="article-date">
  <time class="dt-published" datetime="2021-03-26T03:50:44.000Z" itemprop="datePublished">2021-03-26</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/0/">0</a>►<a class="article-category-link" href="/categories/OS-OSTEP/">OS.OSTEP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/26/OS/OSTEP/00/">OSTEP 阅读笔记(说明)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><ul>
<li>书名<ul>
<li>Operating Systems: Three Easy Pieces</li>
<li>操作系统导论</li>
</ul>
</li>
<li>官网 <ul>
<li><a target="_blank" rel="noopener" href="https://pages.cs.wisc.edu/~remzi/OSTEP/?source=techstories.org">https://pages.cs.wisc.edu/~remzi/OSTEP/?source=techstories.org</a></li>
</ul>
</li>
<li>英文版 pdf 和 作业<ul>
<li><a target="_blank" rel="noopener" href="https://pages.cs.wisc.edu/~remzi/OSTEP/Homework/homework.html">https://pages.cs.wisc.edu/~remzi/OSTEP/Homework/homework.html</a></li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/26/OS/OSTEP/00/" data-id="cl9lj74b500hb64tz4cyvgxpo" data-title="OSTEP 阅读笔记(说明)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/OS/" rel="tag">OS</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/21/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/20/">20</a><a class="page-number" href="/page/21/">21</a><span class="page-number current">22</span><a class="page-number" href="/page/23/">23</a><a class="page-number" href="/page/24/">24</a><span class="space">&hellip;</span><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/23/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/0/">0</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algebra/">Algebra</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-Kits/">C++.Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG/">CG</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Algorithm/">CG.Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES101/">CG.GAMES101</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES102/">CG.GAMES102</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES103/">CG.GAMES103</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES104/">CG.GAMES104</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES202/">CG.GAMES202</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES203/">CG.GAMES203</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Kits/">CG.Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-LS/">CG.LS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-PBRT/">CG.PBRT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Paper/">CG.Paper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CV/">CV</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-CLJ/">DB.CLJ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-MySQL/">DB.MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-SQLServer/">DB.SQLServer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DSA/">DSA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kits/">Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-CXQ/">OS.CXQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-OSTEP/">OS.OSTEP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-xv6-labs/">OS.xv6-labs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-xv6-source-code/">OS.xv6-source-code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TODO/">TODO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/book-directory/">book.directory</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/computation-pyr/">computation.pyr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/csharp-kits/">csharp.kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/csharp-tds/">csharp.tds</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/images/">images</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/installation/">installation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mitsuba/">mitsuba</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nothing/">nothing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-Maya/">software.Maya</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-ps/">software.ps</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-vscode/">software.vscode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/win/">win</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algebra/" rel="tag">Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFS/" rel="tag">BFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BST/" rel="tag">BST</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BVH/" rel="tag">BVH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CG-Algorithm/" rel="tag">CG-Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CV/" rel="tag">CV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Code/" rel="tag">Code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DFS/" rel="tag">DFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DP/" rel="tag">DP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DSA/" rel="tag">DSA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dijkstra/" rel="tag">Dijkstra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EG/" rel="tag">EG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Floyd/" rel="tag">Floyd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GI/" rel="tag">GI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Glints/" rel="tag">Glints</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HDR/" rel="tag">HDR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HQX/" rel="tag">HQX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Heap/" rel="tag">Heap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kits/" rel="tag">Kits</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LCA/" rel="tag">LCA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LLG/" rel="tag">LLG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MCMC/" rel="tag">MCMC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MIS/" rel="tag">MIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MLT/" rel="tag">MLT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maya/" rel="tag">Maya</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NEE/" rel="tag">NEE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PBRT/" rel="tag">PBRT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Radiometry/" rel="tag">Radiometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RayTracing/" rel="tag">RayTracing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SAH/" rel="tag">SAH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SDF/" rel="tag">SDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SGJ/" rel="tag">SGJ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLServer/" rel="tag">SQLServer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STL/" rel="tag">STL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shadow/" rel="tag">Shadow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WHM/" rel="tag">WHM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WX/" rel="tag">WX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/" rel="tag">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/computation/" rel="tag">computation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csharp/" rel="tag">csharp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/images/" rel="tag">images</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/installation/" rel="tag">installation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitsuba/" rel="tag">mitsuba</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobaxterm/" rel="tag">mobaxterm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nothing/" rel="tag">nothing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obs/" rel="tag">obs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/occlusion/" rel="tag">occlusion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ps/" rel="tag">ps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/software/" rel="tag">software</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tree/" rel="tag">tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win/" rel="tag">win</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xv6/" rel="tag">xv6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%88%86/" rel="tag">二分</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%83%E5%AE%87%E5%AE%99/" rel="tag">元宇宙</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%A0%E4%BD%95/" rel="tag">几何</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/" rel="tag">可见性</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" rel="tag">并查集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" rel="tag">拓扑排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%99%AE%E5%90%95%E5%85%8B%E5%9D%90%E6%A0%87/" rel="tag">普吕克坐标</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" rel="tag">最小生成树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="tag">最短路</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="tag">线段树</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algebra/" style="font-size: 10px;">Algebra</a> <a href="/tags/BFS/" style="font-size: 10px;">BFS</a> <a href="/tags/BST/" style="font-size: 10px;">BST</a> <a href="/tags/BVH/" style="font-size: 12.5px;">BVH</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/CG/" style="font-size: 20px;">CG</a> <a href="/tags/CG-Algorithm/" style="font-size: 10px;">CG-Algorithm</a> <a href="/tags/CV/" style="font-size: 10.63px;">CV</a> <a href="/tags/Code/" style="font-size: 14.38px;">Code</a> <a href="/tags/DB/" style="font-size: 19.38px;">DB</a> <a href="/tags/DFS/" style="font-size: 12.5px;">DFS</a> <a href="/tags/DP/" style="font-size: 13.13px;">DP</a> <a href="/tags/DSA/" style="font-size: 11.25px;">DSA</a> <a href="/tags/Dijkstra/" style="font-size: 10px;">Dijkstra</a> <a href="/tags/EG/" style="font-size: 12.5px;">EG</a> <a href="/tags/Floyd/" style="font-size: 10.63px;">Floyd</a> <a href="/tags/GI/" style="font-size: 11.25px;">GI</a> <a href="/tags/Glints/" style="font-size: 10px;">Glints</a> <a href="/tags/HDR/" style="font-size: 10px;">HDR</a> <a href="/tags/HQX/" style="font-size: 10px;">HQX</a> <a href="/tags/Heap/" style="font-size: 10px;">Heap</a> <a href="/tags/Kits/" style="font-size: 13.75px;">Kits</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/LLG/" style="font-size: 12.5px;">LLG</a> <a href="/tags/MCMC/" style="font-size: 10.63px;">MCMC</a> <a href="/tags/MIS/" style="font-size: 10px;">MIS</a> <a href="/tags/MLT/" style="font-size: 10px;">MLT</a> <a href="/tags/Maya/" style="font-size: 10px;">Maya</a> <a href="/tags/MySQL/" style="font-size: 11.88px;">MySQL</a> <a href="/tags/NEE/" style="font-size: 10px;">NEE</a> <a href="/tags/OS/" style="font-size: 17.5px;">OS</a> <a href="/tags/PBRT/" style="font-size: 10px;">PBRT</a> <a href="/tags/Paper/" style="font-size: 15.63px;">Paper</a> <a href="/tags/Radiometry/" style="font-size: 10px;">Radiometry</a> <a href="/tags/RayTracing/" style="font-size: 10px;">RayTracing</a> <a href="/tags/SAH/" style="font-size: 10px;">SAH</a> <a href="/tags/SDF/" style="font-size: 10px;">SDF</a> <a href="/tags/SGJ/" style="font-size: 10.63px;">SGJ</a> <a href="/tags/SQL/" style="font-size: 13.13px;">SQL</a> <a href="/tags/SQLServer/" style="font-size: 10.63px;">SQLServer</a> <a href="/tags/STL/" style="font-size: 11.25px;">STL</a> <a href="/tags/Shadow/" style="font-size: 10px;">Shadow</a> <a href="/tags/WHM/" style="font-size: 16.88px;">WHM</a> <a href="/tags/WX/" style="font-size: 11.88px;">WX</a> <a href="/tags/YLQ/" style="font-size: 18.13px;">YLQ</a> <a href="/tags/book/" style="font-size: 10.63px;">book</a> <a href="/tags/computation/" style="font-size: 18.75px;">computation</a> <a href="/tags/csharp/" style="font-size: 16.25px;">csharp</a> <a href="/tags/images/" style="font-size: 10px;">images</a> <a href="/tags/installation/" style="font-size: 11.88px;">installation</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/linux/" style="font-size: 11.25px;">linux</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mitsuba/" style="font-size: 11.88px;">mitsuba</a> <a href="/tags/mobaxterm/" style="font-size: 10px;">mobaxterm</a> <a href="/tags/nothing/" style="font-size: 10.63px;">nothing</a> <a href="/tags/obs/" style="font-size: 10px;">obs</a> <a href="/tags/occlusion/" style="font-size: 15px;">occlusion</a> <a href="/tags/ps/" style="font-size: 10px;">ps</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/tree/" style="font-size: 11.25px;">tree</a> <a href="/tags/vscode/" style="font-size: 10.63px;">vscode</a> <a href="/tags/win/" style="font-size: 10.63px;">win</a> <a href="/tags/xv6/" style="font-size: 16.25px;">xv6</a> <a href="/tags/%E4%BA%8C%E5%88%86/" style="font-size: 10.63px;">二分</a> <a href="/tags/%E5%85%83%E5%AE%87%E5%AE%99/" style="font-size: 10.63px;">元宇宙</a> <a href="/tags/%E5%87%A0%E4%BD%95/" style="font-size: 10px;">几何</a> <a href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/" style="font-size: 11.88px;">可见性</a> <a href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" style="font-size: 10.63px;">并查集</a> <a href="/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">拓扑排序</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">排序</a> <a href="/tags/%E6%99%AE%E5%90%95%E5%85%8B%E5%9D%90%E6%A0%87/" style="font-size: 10px;">普吕克坐标</a> <a href="/tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" style="font-size: 10px;">最小生成树</a> <a href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/" style="font-size: 13.13px;">最短路</a> <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" style="font-size: 10px;">线段树</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/23/CG/WHM-GAMES103/11/">GAMES103.王华民.11.Incompressible Fluid Dynamics and Eulerian Fluids</a>
          </li>
        
          <li>
            <a href="/2022/10/23/CG/Papers/2021/bvh-survey-3/">(论文)[2021] A Survey on Bounding Volume Hierarchies for Ray Tracing(4)</a>
          </li>
        
          <li>
            <a href="/2022/04/28/CG/Kits/MIS-NEE/">NEE、MIS(多重重要性采样)</a>
          </li>
        
          <li>
            <a href="/2022/04/18/CG/WHM-GAMES103/10/">GAMES103.王华民.10.Surface Waves</a>
          </li>
        
          <li>
            <a href="/2022/04/17/CG/WHM-GAMES103/09-1/">GAMES103.王华民.09.Collision Handling(1)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>