<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/23/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-DB/CLJ/01" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/DB/CLJ/01/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T15:53:33.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/DB-CLJ/">DB.CLJ</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/DB/CLJ/01/">数据库概论.陈立军.01.数据库系统简介</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="数据库系统简介"><a href="#数据库系统简介" class="headerlink" title="数据库系统简介"></a>数据库系统简介</h1><ul>
<li><strong>数据项</strong>：数据记录中最小的、不可分的有名数据单位（姓名、性别）</li>
<li><strong>数据元素</strong> 由若干个数据项组成</li>
<li><strong>数据与信息</strong><ul>
<li>数据是信息的符号表示，或称载体</li>
<li>信息是数据的内涵，是数据的语义解释</li>
</ul>
</li>
</ul>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><ul>
<li>按照逻辑关系组织起来的一批数据，按一定的存储方法把它存储在计算机中，并在这些数据上定义了一个运算的集合</li>
<li><strong>逻辑结构</strong>：数据之间存在的逻辑关系<ul>
<li>表、树、图</li>
</ul>
</li>
<li><strong>物理结构</strong>：数据在计算机内的存储方式<ul>
<li>顺序方式、链接方式</li>
</ul>
</li>
</ul>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><ul>
<li>具有相同数据结构的数据属同一类，同一类数据的全体称为一个数据类型</li>
<li>数据类型说明了数据在数据分类中的<strong>归属</strong>，用以限定该数据的<strong>变化范围</strong></li>
</ul>
<h3 id="数据类型分类"><a href="#数据类型分类" class="headerlink" title="数据类型分类"></a>数据类型分类</h3><p><img src="/01/1616586993177.png"></p>
<ul>
<li><strong>数据结构＋算法＝程序</strong></li>
</ul>
<h2 id="数据独立性"><a href="#数据独立性" class="headerlink" title="数据独立性"></a>数据独立性</h2><ul>
<li>当数据结构发生变化时，通过系统提供的映象（转换）功能，使应用程序不必改变</li>
<li><strong>物理独立性</strong>：当数据<strong>存储结构</strong>发生变化时，使应用程序不必改变</li>
<li><strong>逻辑独立性</strong>：当数据<strong>逻辑结构</strong>发生变化时，使应用程序不必改变</li>
</ul>
<h2 id="数据管理"><a href="#数据管理" class="headerlink" title="数据管理"></a>数据管理</h2><ul>
<li>数据定义、数据操作、数据约束</li>
<li><strong>数据定义</strong><ul>
<li>逻辑结构、物理结构等</li>
</ul>
</li>
<li><strong>数据操作</strong><ul>
<li>查询、更新等</li>
</ul>
</li>
<li><strong>数据约束</strong><ul>
<li>对客观事物的合理反映、数据一致性等</li>
</ul>
</li>
<li>数据独立性的实现视角：将数据管理从应用程序中剥离出来</li>
<li><strong>数据管理</strong>：对数据的分类、组织、编码、存储、检索和维护</li>
</ul>
<img src="01/1616587588951.png" style="zoom:80%;" />



<h2 id="数据管理的发展阶段"><a href="#数据管理的发展阶段" class="headerlink" title="数据管理的发展阶段"></a>数据管理的发展阶段</h2><ul>
<li>各阶段的技术及应用背景<ul>
<li>计算机应用范围</li>
<li>外存储设备</li>
<li>数据管理软件</li>
</ul>
</li>
<li>各个阶段的差别体现<ul>
<li>谁管理数据</li>
<li>数据面向谁</li>
<li>数据与应用的独立性</li>
</ul>
</li>
</ul>
<h3 id="人工管理阶段"><a href="#人工管理阶段" class="headerlink" title="人工管理阶段"></a>人工管理阶段</h3><ul>
<li><strong>计算机主要用于科学计算</strong><ul>
<li>数据量小、结构简单，如高阶方程、曲线拟和等</li>
</ul>
</li>
<li><strong>外存为顺序存取设备</strong><ul>
<li>磁带、卡片、纸带</li>
</ul>
</li>
<li>磁带的特点<ul>
<li>廉价地存放大容量数据</li>
<li>顺序访问；1%所需，100%访问</li>
</ul>
</li>
<li><strong>没有操作系统，没有数据管理软件</strong><ul>
<li>用户用<strong>机器指令编码</strong>，<strong>通过纸带机输入程序和数据</strong>，程序运行完毕后，由用户取走纸带和运算结果，再让下一用户上机操作</li>
</ul>
</li>
<li><strong>用户完全负责数据管理工作</strong><ul>
<li>数据的组织、存储结构、存取方法、输入输出等</li>
</ul>
</li>
<li><strong>数据完全面向特定的应用程序</strong><ul>
<li>每个用户使用自己的数据，数据不保存，用完就撤走</li>
</ul>
</li>
<li><strong>数据与程序没有独立性</strong><ul>
<li>存取数据的子程序随着存储结构的改变而改变</li>
</ul>
</li>
</ul>
<h3 id="文件系统阶段"><a href="#文件系统阶段" class="headerlink" title="文件系统阶段"></a>文件系统阶段</h3><ul>
<li><p><strong>计算机不但用于科学计算，还用于管理</strong></p>
</li>
<li><p><strong>外存有了磁盘、磁鼓等直接存取设备</strong></p>
<ul>
<li>无须顺序存取</li>
<li>由地址直接访问所需记录</li>
</ul>
</li>
<li><p><strong>产生了操作系统</strong></p>
<ul>
<li>管理和控制计算机软硬件资源的计算机程序</li>
</ul>
</li>
<li><p>文件系统的<strong>功能</strong></p>
<ul>
<li>文件存储空间的管理</li>
<li>目录管理</li>
<li>文件读写管理</li>
<li>文件保护</li>
<li>向用户提供操作接口</li>
</ul>
</li>
<li><p><strong>文件系统解放了用户对外存的访问</strong></p>
</li>
<li><p>文件系统提供了一定的物理独立性</p>
</li>
<li><p>文件系统的 <strong>数据定义独立性</strong></p>
<ul>
<li><strong>数据与程序紧密结合</strong><ul>
<li>数据的逻辑结构改变则必须修改应用程序</li>
</ul>
</li>
<li><strong>数据分散管理</strong><ul>
<li>许多文件，许多数据格式</li>
</ul>
</li>
<li><strong>数据的语义信息只能由程序来解释</strong><ul>
<li>数据的组织方式以及按何种含义进行处理，只有全权管理它的程序知道</li>
</ul>
</li>
<li><strong>数据共享困难</strong><ul>
<li>一个应用若想共享另一个应用生成的数据，必须同另一个应用沟通，了解数据的语义与组织方式</li>
</ul>
</li>
</ul>
</li>
<li><p>文件系统的 <strong>数据完整性独立性</strong></p>
<ul>
<li>由于数据存在很多<strong>副本</strong>，给数据的修改与维护带来了困难，容易造成数据的不一致性</li>
<li><strong>数据完整性难于维护</strong></li>
</ul>
</li>
<li><p>文件系统的 <strong>数据操作独立性</strong></p>
<ul>
<li>记录之间无联系</li>
<li>用户自己编程实现</li>
<li>对每个查询都重新编码</li>
</ul>
</li>
<li><p><strong>困难的本质</strong></p>
<ul>
<li>文件系统眼中的数据：<strong>字符流</strong></li>
<li>面对一串字符流，要从中找到目标对象，你需要对其解析、遍历、匹配等</li>
</ul>
</li>
<li><p>基于文件系统的查询</p>
<ul>
<li>分别组织几个文件，存储各类对象的记录</li>
<li>ad hoc query</li>
</ul>
</li>
<li><p>基于文件系统维护数据完整性</p>
<ul>
<li>insert，delete</li>
<li>很复杂，需要修改大量文件</li>
<li>容易出错</li>
</ul>
</li>
</ul>
<h3 id="数据库系统阶段"><a href="#数据库系统阶段" class="headerlink" title="数据库系统阶段"></a>数据库系统阶段</h3><ul>
<li><strong>外存有了大容量磁盘，光盘</strong></li>
<li><strong>数据管理需求旺盛</strong><ul>
<li>数据量大，关系复杂，共享性要求强（多种应用、不同语言共享数据）</li>
</ul>
</li>
<li>软件相对于硬件：从 Feature 到 future<ul>
<li>软件价格上升，硬件价格下降，编制和维护软件及应用程序成本相对增加，其中维护的成本更高，力求降低</li>
</ul>
</li>
<li>数据<strong>不是依赖于处理过程的附属品</strong>，而是现实世界中<strong>独立存在的对象</strong></li>
</ul>
<h4 id="数据库系统阶段的特点"><a href="#数据库系统阶段的特点" class="headerlink" title="数据库系统阶段的特点"></a>数据库系统阶段的特点</h4><ul>
<li><p>有了数据库管理系统</p>
</li>
<li><p>面向全组织，面向现实世界</p>
</li>
<li><p>独立性较强</p>
</li>
<li><p>由 DBMS 统一存取，维护数据语义及结构</p>
<ul>
<li>DBMS：DataBase Management System ，数据库管理系统</li>
</ul>
</li>
<li><p><strong>面向全组织的数据结构</strong></p>
<ul>
<li>支持<strong>全企业的应用</strong>而<strong>不是某一个应用</strong></li>
<li>数据反映了客观事物间的<strong>本质联系</strong>，而不是着眼于面向某个应用，是有结构的数据</li>
<li><strong>文件系统</strong>只是记录的<strong>内部有结构</strong>，一个文件的记录之间是个线性序列，<strong>记录之间无联系</strong></li>
<li>数据库系统眼中的数据：<strong>结构化数据</strong></li>
</ul>
</li>
<li><p><strong>数据的冗余度小，易扩充</strong></p>
<ul>
<li><strong>冗余度小</strong><ul>
<li>数据面向整个系统，而不是面向某一应用，数据集中管理，数据共享</li>
</ul>
</li>
<li><strong>集中管理</strong><ul>
<li>节省存储空间，减少存取时间，避免数据之间的不相容性和不一致性</li>
</ul>
</li>
<li><strong>易扩充性</strong><ul>
<li>每个应用选用数据库的一个子集，只要重新选取不同子集或者加上一小部分数据，就可以满足新的应用要求</li>
</ul>
</li>
</ul>
</li>
<li><p>数据库的<strong>高数据独立性</strong></p>
<ul>
<li>把数据库定义和描述从应用程序中分离出去</li>
<li>数据描述是分级的（全局逻辑、局部逻辑、存储）</li>
<li>数据存取由系统管理，用户不必考虑存取路径等细节，从而简化了应用程序(SQL)</li>
</ul>
</li>
<li><p><strong>统一的数据控制功能</strong></p>
<ul>
<li>安全性控制（Security）<ul>
<li>保护数据以防止不合法的使用所造成的数据泄露和破坏</li>
<li>措施：用户标识与鉴定，存取控制</li>
</ul>
</li>
<li>完整性控制（Integrity）<ul>
<li>数据的正确性、有效性、相容性</li>
<li>措施：完整性约束条件定义和检查</li>
</ul>
</li>
<li>并发控制（Concurrency）<ul>
<li>对多用户并发操作加以控制，防止其互相干扰而得到错误的结果并使数据库完整性遭到破坏</li>
<li>措施：封锁</li>
</ul>
</li>
<li>恢复控制（Recovery）<ul>
<li>将数据库从故障中恢复到某个一致状态</li>
<li>措施：冗余</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="数据库与文件系统的对比"><a href="#数据库与文件系统的对比" class="headerlink" title="数据库与文件系统的对比"></a>数据库与文件系统的对比</h3><img src="01/1616589550344.png" style="zoom: 67%;" />



<h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><ul>
<li>数据建模过程<ul>
<li>用户 – 计算机</li>
<li>现实世界 –（概念化）– 信息世界 – （形式化）– 计算机世界</li>
<li>应用 – 概念数据模型 – 结构数据模型</li>
</ul>
</li>
</ul>
<h3 id="数据模型定义"><a href="#数据模型定义" class="headerlink" title="数据模型定义"></a>数据模型定义</h3><ul>
<li><strong>数据模型</strong>：数据库系统中用于提供信息表示和操作手段的形式构架</li>
</ul>
<h4 id="概念数据模型"><a href="#概念数据模型" class="headerlink" title="概念数据模型"></a>概念数据模型</h4><ul>
<li>按<strong>用户的观点</strong>来对数据和信息建模</li>
<li>用于组织信息世界的概念，表现从现实世界中抽象出来的事物以及它们之间的联系</li>
<li>这类模型<strong>强调其语义表达能力</strong>，概念简单、清晰，易于用户理解</li>
<li>概念数据模型是<strong>现实世界到信息世界的抽象</strong>，是用户与数据库设计人员之间进行交流的语言</li>
<li>例子<ul>
<li><strong>E&#x2F;R 模型</strong>：实体、联系、属性</li>
<li><strong>ODL</strong>：属性、管线、类</li>
</ul>
</li>
</ul>
<h4 id="结构数据模型"><a href="#结构数据模型" class="headerlink" title="结构数据模型"></a>结构数据模型</h4><ul>
<li>从<strong>计算机实现</strong>的观点来对数据建模<ul>
<li>是信息世界中的概念和联系在计算机世界中的表示方法</li>
</ul>
</li>
<li>有严格形式化定义，以便于在计算机上实现<ul>
<li>层次模型、网状模型、关系模型、面向对象模型</li>
</ul>
</li>
<li>结构数据模型的三要素<ul>
<li><strong>数据结构、数据操作、数据约束条件</strong></li>
</ul>
</li>
<li><strong>数据结构</strong>：描述系统的<strong>静态特性</strong>，即组成数据库的对象类型<ul>
<li><strong>数据本身</strong>：类型、内容、性质。如关系模型中的域、属性，关系等</li>
<li>数据之间的<strong>联系</strong>。如关系模型中的外码</li>
<li>一般按数据结构的类型来<strong>命名</strong>数据模型</li>
</ul>
</li>
<li><strong>数据操作</strong>：描述系统的<strong>动态特性</strong><ul>
<li>一般有检索、更新（插入、删除、修改）操作</li>
<li>数据模型要定义操作含义、操作符号、操作规则，以及实现操作的语言</li>
</ul>
</li>
<li><strong>数据约束条件</strong>：完整性规则的集合<ul>
<li>规定数据库状态及状态变化所应满足的<strong>条件</strong></li>
<li>保证数据的正确、有效、相容</li>
</ul>
</li>
</ul>
<h5 id="层次模型"><a href="#层次模型" class="headerlink" title="层次模型"></a>层次模型</h5><ul>
<li>用<strong>树</strong>结构表示实体之间联系</li>
<li>树由<strong>结点</strong>和<strong>连线</strong>组成<ul>
<li>结点：实体型</li>
<li>连线：两实体型间的一对多联系</li>
</ul>
</li>
<li>树的特性<ul>
<li>每棵树有且仅有一个结点无父结点，称为树的根</li>
<li>树中的其它结点都有且仅有一个父结点</li>
</ul>
</li>
<li>层次模型的特点<ul>
<li><strong>结构简单，易于实现</strong></li>
<li><strong>支持的联系种类太少</strong><ul>
<li>只支持<strong>二元</strong>一对多联系</li>
<li>只允许实体集间的<strong>一种</strong>联系，不支持实体集间的多种联系</li>
</ul>
</li>
<li><strong>数据操纵不方便</strong><ul>
<li>子结点的存取只能通过父结点来进行</li>
<li>插入、删除复杂，父结点的删除导致子结点的删除，丢失必要的信息</li>
</ul>
</li>
</ul>
</li>
<li>代表产品：IBM 的 <strong>IMS 数据库</strong>，<strong>1969</strong> 年研制成功</li>
<li>IMS 的数据存储<ul>
<li><strong>邻接法</strong>：自顶向下、自左向右排列（<strong>层次遍历</strong>）</li>
<li><strong>层次序列法</strong>：自顶向下、自左向右链接（<strong>中序遍历</strong>）</li>
<li><strong>子女-兄弟指引元法</strong>：指向最大的子女，指向最近的兄弟（每个结点包括数据域、两个指针）</li>
</ul>
</li>
</ul>
<h5 id="网状模型"><a href="#网状模型" class="headerlink" title="网状模型"></a>网状模型</h5><ul>
<li>是一个满足下列条件的<strong>有向图</strong><ul>
<li>可以有一个以上的结点无父结点</li>
<li>至少有一个结点有多于一个的父结点（排除树）</li>
</ul>
</li>
<li>存储结构<ul>
<li>通过<strong>指针</strong>表达联系</li>
</ul>
</li>
<li>特点<ul>
<li>表达的联系种类丰富</li>
<li>性能良好，存取效率高</li>
<li>结构复杂，语言复杂</li>
</ul>
</li>
<li>典型代表：IDMS，IMAGE</li>
</ul>
<h5 id="关系模型"><a href="#关系模型" class="headerlink" title="关系模型"></a>关系模型</h5><ul>
<li>用<strong>二维表</strong>来表示实体及其相互联系</li>
<li><strong>特点</strong><ul>
<li><strong>简单</strong>：表的概念直观、单一，用户易理解</li>
<li><strong>非过程化的数据请求</strong>：数据请求可以不指明路径</li>
<li><strong>数据独立性高</strong>：用户只需提出”做什么”，无须说明 “怎么做”</li>
<li><strong>坚实的理论基础</strong>：（曾经的）效率低</li>
</ul>
</li>
</ul>
<h5 id="面向对象模型"><a href="#面向对象模型" class="headerlink" title="面向对象模型"></a>面向对象模型</h5><ul>
<li><strong>嵌套表</strong>：用嵌套表表示<strong>复杂实体</strong>（我的类型我定义）<ul>
<li><strong>平面表</strong>：把嵌套表展开</li>
</ul>
</li>
</ul>
<h2 id="数据库模式"><a href="#数据库模式" class="headerlink" title="数据库模式"></a>数据库模式</h2><h3 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h3><ul>
<li><strong>元数据</strong>（meta-data)：描述数据的数据<ul>
<li>描述数据的含义和性质，以便更好地理解、管理和使用数据的数据，信息检索的入口</li>
</ul>
</li>
<li>例子</li>
</ul>
<table>
<thead>
<tr>
<th align="center">数据</th>
<th align="center">元数据</th>
</tr>
</thead>
<tbody><tr>
<td align="center">数据库概论</td>
<td align="center">课程名</td>
</tr>
<tr>
<td align="center">《数据库系统概念》</td>
<td align="center">参考教材</td>
</tr>
</tbody></table>
<h3 id="数据库模式-1"><a href="#数据库模式-1" class="headerlink" title="数据库模式"></a>数据库模式</h3><ul>
<li><strong>模式</strong>：数据的抽象，数据的描述<ul>
<li>模式：数据管理的基石</li>
</ul>
</li>
<li><strong>数据字典</strong>：存取和管理数据的依据<ul>
<li>对于数据模型中的数据对象或者项目的描述的集合</li>
</ul>
</li>
</ul>
<h4 id="实例与模式的关系"><a href="#实例与模式的关系" class="headerlink" title="实例与模式的关系"></a>实例与模式的关系</h4><img src="01/1616594843050.png" style="zoom:67%;" />

<ul>
<li><strong>型</strong>，<strong>值</strong></li>
<li>例子</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">person</span>&#123;</span><br><span class="line">    string name;</span><br><span class="line">    string address;</span><br><span class="line">&#125;;</span><br><span class="line">person TOM;</span><br></pre></td></tr></table></figure>

<ul>
<li>TOM 是<strong>变量</strong></li>
<li>person 是<strong>其类型</strong></li>
<li>TOM 在某时刻的<strong>值</strong>是<strong>实例</strong></li>
</ul>
<h4 id="数据库模式的分级设计"><a href="#数据库模式的分级设计" class="headerlink" title="数据库模式的分级设计"></a>数据库模式的分级设计</h4><ul>
<li>Why<ul>
<li>提高数据的<strong>物理独立性</strong>和<strong>逻辑独立性</strong></li>
<li>将数据库的用户观点（用户看到的数据库）与数据库的物理方面（实际存储的数据库）区分开来</li>
</ul>
</li>
</ul>
<h5 id="三级模式"><a href="#三级模式" class="headerlink" title="三级模式"></a>三级模式</h5><ul>
<li>由 CODASYL 美国数据系统语言协商会提出</li>
<li>三级模式：<strong>外模式</strong>、<strong>模式</strong>、<strong>存储模式</strong></li>
<li>三级模式之间有<strong>两级映象</strong></li>
</ul>
<img src="01/1616595098025.png" style="zoom: 67%;" />

<ul>
<li>外模式（Sub-Schema）<ul>
<li>用户的<strong>数据视图</strong></li>
<li>数据的<strong>局部逻辑结构</strong>，<strong>模式的子集</strong></li>
</ul>
</li>
<li>模式（Schema）<ul>
<li>所有用户的<strong>公共数据视图</strong></li>
<li>数据库中全体数据的<strong>全局逻辑结构</strong>和<strong>特性的描述</strong></li>
</ul>
</li>
<li>内模式（Storage Schema）<ul>
<li><strong>存储模式</strong>，数据的<strong>物理结构</strong>及<strong>存储方式</strong></li>
<li>位置、压缩、分区、合并、索引</li>
</ul>
</li>
</ul>
<h6 id="两级模式映像"><a href="#两级模式映像" class="headerlink" title="两级模式映像"></a>两级模式映像</h6><ul>
<li>外模式 &#x2F; 模式映象<ul>
<li>定义某个外模式和模式之间的对应关系</li>
<li>映象<strong>定义通常包含在各外模式</strong>中</li>
<li>当模式改变时，修改外模式 &#x2F; 模式映象，使外模式保持不变，从而应用程序可以保持不变，称为数据的<strong>逻辑独立性</strong></li>
</ul>
</li>
<li>模式 &#x2F; 内模式映象<ul>
<li>定义数据逻辑结构与存储结构之间的对应关系</li>
<li>存储结构改变时，修改模式 &#x2F; 内模式映象，使模式保持不变，从而应用程序可以保持不变，称为数据的<strong>物理独立性</strong></li>
</ul>
</li>
</ul>
<h2 id="数据库系统的构成"><a href="#数据库系统的构成" class="headerlink" title="数据库系统的构成"></a>数据库系统的构成</h2><img src="01/1616595674183.png" style="zoom:67%;" />





<h3 id="几个相关概念"><a href="#几个相关概念" class="headerlink" title="几个相关概念"></a>几个相关概念</h3><ul>
<li><strong>数据库</strong><ul>
<li>数据的集合</li>
<li>由 DBMS 统一管理，多用户共享</li>
</ul>
</li>
<li><strong>数据库管理系统 DBMS</strong><ul>
<li>系统软件，对<strong>数据库</strong>进行统一<strong>管理</strong>和<strong>控制</strong></li>
</ul>
</li>
<li><strong>数据库系统</strong><ul>
<li>带有数据库的整个计算机系统，包括硬件、软件、数据、人员</li>
</ul>
</li>
</ul>
<h3 id="DBMS-的层次结构"><a href="#DBMS-的层次结构" class="headerlink" title="DBMS 的层次结构"></a>DBMS 的层次结构</h3><img src="01/1616596572946.png" style="zoom:67%;" />

<h3 id="DBMS-的数据定义功能"><a href="#DBMS-的数据定义功能" class="headerlink" title="DBMS 的数据定义功能"></a>DBMS 的数据定义功能</h3><ul>
<li>DDL 语言<ul>
<li>Data Description Language</li>
<li>描述外模式、模式、内模式（源模式）</li>
</ul>
</li>
<li>模式翻译程序<ul>
<li>把源模式翻译成目标模式，存入数据字典中</li>
<li>源模式 –（模式翻译程序）– 目标模式（保存在数据字典中）</li>
</ul>
</li>
</ul>
<h3 id="DBMS-的数据存取功能"><a href="#DBMS-的数据存取功能" class="headerlink" title="DBMS 的数据存取功能"></a>DBMS 的数据存取功能</h3><ul>
<li>DML 语言<ul>
<li>Data manipulation Language</li>
<li>对数据库进行检索、插入、修改、删除</li>
</ul>
</li>
<li>DML 类型<ul>
<li><strong>宿主型</strong>：DML不独立使用，嵌入到高级语言（主语言）程序中使用</li>
<li><strong>自含型</strong>：独立使用，交互式命令方式</li>
</ul>
</li>
<li>DML 语句执行方式<ul>
<li>宿主型：<strong>预编译和增强编译</strong></li>
<li>自含型：<strong>解释执行</strong></li>
</ul>
</li>
</ul>
<h3 id="DBMS的数据控制功能"><a href="#DBMS的数据控制功能" class="headerlink" title="DBMS的数据控制功能"></a>DBMS的数据控制功能</h3><ul>
<li><strong>数据库运行管理</strong><ul>
<li>并发控制、存取控制、完整性约束条件检查和执行，日志组织和管理，事务管理和自动恢复</li>
</ul>
</li>
<li><strong>数据组织存储和管理</strong><ul>
<li>用户数据、索引、数据字典的组织、存储和管理，包括文件结构、存取方式、数据之间联系的实现</li>
</ul>
</li>
<li><strong>数据库建立和维护功能</strong><ul>
<li>数据的装入、转换、卸出</li>
<li>数据库的转储、恢复、性能监视和分析</li>
</ul>
</li>
</ul>
<h3 id="数据库系统的用户"><a href="#数据库系统的用户" class="headerlink" title="数据库系统的用户"></a>数据库系统的用户</h3><ul>
<li><strong>最终用户</strong><ul>
<li>通过应用系统的用户接口（菜单等）使用数据库</li>
</ul>
</li>
<li><strong>应用程序员</strong><ul>
<li>通过应用系统的用户接口（菜单等）使用数据库</li>
</ul>
</li>
<li><strong>系统分析员</strong><ul>
<li>负责应用系统的需求分析和规范定义，确定系统软硬件配置，参与数据库模式设计</li>
</ul>
</li>
<li><strong>数据库管理员 DBA</strong><ul>
<li>负责数据库的全面管理和控制</li>
</ul>
</li>
</ul>
<h2 id="数据库系统的用户界面"><a href="#数据库系统的用户界面" class="headerlink" title="数据库系统的用户界面"></a>数据库系统的用户界面</h2><ul>
<li>面向浏览器的基于菜单的界面</li>
<li>基于表单的界面</li>
<li>图形用户界面</li>
<li>自然语言界面</li>
<li>语音输入和输出</li>
<li>面向DBA的界面</li>
</ul>
<h2 id="DBA-的职责"><a href="#DBA-的职责" class="headerlink" title="DBA 的职责"></a>DBA 的职责</h2><ul>
<li><strong>建库</strong><ul>
<li>确定模式、外模式、存储结构、存取策略</li>
<li>负责数据的整理和装入</li>
</ul>
</li>
<li><strong>用库</strong><ul>
<li>定义完整性约束条件</li>
<li>规定数据的保密级别、用户权限</li>
<li>监督和控制数据库的运行情况</li>
<li>制定后援和恢复策略，负责故障恢复</li>
</ul>
</li>
<li><strong>改进</strong><ul>
<li>监督分析系统的性能（空间利用率，处理效率）</li>
<li>数据库重组织，物理上重组织，以提高性能</li>
<li>数据库重构造，设计上较大改动，模式和内模式修改</li>
</ul>
</li>
</ul>
<h2 id="数据管理能力成熟度评估模型"><a href="#数据管理能力成熟度评估模型" class="headerlink" title="数据管理能力成熟度评估模型"></a>数据管理能力成熟度评估模型</h2><ul>
<li>DCMM：Data Capability Maturity Model</li>
</ul>
<img src="01/1616597979333.png" style="zoom: 67%;" />



<h2 id="数据库的若干研究方向"><a href="#数据库的若干研究方向" class="headerlink" title="数据库的若干研究方向"></a>数据库的若干研究方向</h2><ul>
<li>新的数据库管理系统</li>
<li>新的数据库应用</li>
<li>特种数据库</li>
<li>领域数据库</li>
</ul>
<h3 id="新的数据模型"><a href="#新的数据模型" class="headerlink" title="新的数据模型"></a>新的数据模型</h3><ul>
<li>面向对象数据库</li>
<li>对象-关系数据库</li>
<li>XML数据库</li>
<li>图数据库</li>
<li>序列数据库</li>
<li>数组数据库</li>
<li>矩阵数据库</li>
</ul>
<h3 id="新的体系结构"><a href="#新的体系结构" class="headerlink" title="新的体系结构"></a>新的体系结构</h3><ul>
<li>分布式数据库<ul>
<li>网络+数据库，对等(P2P)数据库，集群</li>
</ul>
</li>
<li>并行数据库<ul>
<li>数据划分、操作并行</li>
</ul>
</li>
<li>NoSQL 数据库<ul>
<li>互联网应用：海量、快速、多样</li>
<li>CAP、存储模型、分区、容错、map&#x2F;reduce</li>
</ul>
</li>
<li>数据流管理系统<ul>
<li>实时监视：传感网络、股市行情、交通状况…</li>
</ul>
</li>
</ul>
<h3 id="新的硬件平台"><a href="#新的硬件平台" class="headerlink" title="新的硬件平台"></a>新的硬件平台</h3><ul>
<li>主存数据库</li>
<li>闪存数据库</li>
<li>嵌入数据库</li>
<li>GPU，FPGA，多核处理器</li>
</ul>
<h3 id="新的数据库应用"><a href="#新的数据库应用" class="headerlink" title="新的数据库应用"></a>新的数据库应用</h3><ul>
<li>商业智能<ul>
<li>从事务型操作转向分析型操作</li>
<li>决策支持：数据仓库、数据挖掘、OLAP</li>
</ul>
</li>
<li>信息集成<ul>
<li>“turn the Web into database”</li>
<li>各式信息门户、知识图谱</li>
</ul>
</li>
<li>社会测量<ul>
<li>社会媒体，社会网络，推荐系统</li>
</ul>
</li>
</ul>
<h3 id="移动数据库"><a href="#移动数据库" class="headerlink" title="移动数据库"></a>移动数据库</h3><ul>
<li>分布式数据库的扩展</li>
<li>传感网络、物联网</li>
<li>手机、汽车、PDA…</li>
<li>信息访问的即时性和就地性</li>
<li>移动：数据库+无线网络（偶尔断连）</li>
</ul>
<h3 id="主动数据库"><a href="#主动数据库" class="headerlink" title="主动数据库"></a>主动数据库</h3><ul>
<li><strong>被动服务</strong>：<strong>命令驱动</strong></li>
<li><strong>主动服务</strong>：<strong>事件驱动</strong></li>
<li>实时监控系统：异常情况主动处理 …</li>
<li>信息推送系统：RSS 新闻聚合服务</li>
<li>大规模触发器、复杂事件处理</li>
</ul>
<h3 id="演绎数据库"><a href="#演绎数据库" class="headerlink" title="演绎数据库"></a>演绎数据库</h3><ul>
<li>人工智能 + 数据库</li>
<li>专家系统</li>
<li>事实＋推理规则</li>
<li>规则计算：递归查询</li>
</ul>
<h3 id="时态数据库"><a href="#时态数据库" class="headerlink" title="时态数据库"></a>时态数据库</h3><ul>
<li><strong>快照数据库</strong>：只记录实体的<strong>当前信息</strong></li>
<li>管理被处理事件的历史性信息</li>
<li>管理数据库系统中元事件的时态信息</li>
<li>数据仓库的前驱？</li>
</ul>
<h3 id="模糊数据库"><a href="#模糊数据库" class="headerlink" title="模糊数据库"></a>模糊数据库</h3><ul>
<li>处理模糊对象：高矮胖瘦、好恶优劣…</li>
<li>模糊数学：L.A.Zadeh</li>
<li>模糊隶属函数</li>
<li>模糊专家系统，模拟计算 ……</li>
</ul>
<h3 id="实时数据库"><a href="#实时数据库" class="headerlink" title="实时数据库"></a>实时数据库</h3><ul>
<li>对数据的 “定时” 存取和对 “短暂有效” 数据的存取</li>
<li>工厂生产过程控制、证券交易、雷达跟踪 …</li>
<li>给数据和事务安装定时装置</li>
<li>基于优先级调度事务的执行</li>
</ul>
<h3 id="概率数据库"><a href="#概率数据库" class="headerlink" title="概率数据库"></a>概率数据库</h3><ul>
<li>关键之一：概率查询的合理定义</li>
<li>关键之二：对 Possible world 的高效搜索算法</li>
</ul>
<h3 id="领域数据库"><a href="#领域数据库" class="headerlink" title="领域数据库"></a>领域数据库</h3><ul>
<li>生物数据库<ul>
<li>序列、图、高维数据…</li>
</ul>
</li>
<li>空间数据库<ul>
<li>几何数据、空间查询</li>
</ul>
</li>
<li>多媒体数据库</li>
<li>天文数据库：虚拟天文台</li>
<li>CAD数据库<ul>
<li>面向对象数据库</li>
</ul>
</li>
</ul>
<h2 id="DBMS-的运行过程"><a href="#DBMS-的运行过程" class="headerlink" title="DBMS 的运行过程"></a>DBMS 的运行过程</h2><img src="01/1616598580054.png" style="zoom:67%;" />

<ul>
<li>Step1：用户向 DBMS <strong>发出</strong>调用数据库数据的<strong>命令</strong></li>
<li>Step2：DBMS 对命令进行<strong>语法检查、语义检查、存取权限检查</strong>，<strong>决定是否执行该命令</strong></li>
<li>Step3：DBMS 执行<strong>查询优化</strong>，把命令转换为一串单记录的存取操作序列</li>
<li>Step4：<strong>执行存取操作序列</strong>（反复执行以下各步，直至结束）</li>
<li>Step5：DBMS 首先在<strong>缓冲区</strong>内查找记录，若找到转10，否则转6</li>
<li>Step6：DBMS 查看存储模式，决定从<strong>哪个文件存取哪个物理记录</strong></li>
<li>Step7：DBMS 根据 6 的结果，<strong>向操作系统发出读取记录的命令</strong></li>
<li>Step8：<strong>操作系统</strong>执行<strong>读取数据</strong>的命令</li>
<li>Step9：<strong>操作系统</strong>将<strong>数据</strong>从<strong>数据库存储区</strong>送到<strong>系统缓冲区</strong></li>
<li>Step10：DBMS 根据<strong>用户命令</strong>和<strong>数据字典</strong>的内容<strong>导出用户所要读取的数据格式</strong></li>
<li>Step11：DBMS 将数据记录从<strong>系统缓冲区传送到用户工作区</strong></li>
<li>Step12：DBMS将执行状态信息<strong>返回给用户</strong></li>
</ul>
<h2 id="补充内容"><a href="#补充内容" class="headerlink" title="补充内容"></a>补充内容</h2><ul>
<li>多维数组的应用场景<ul>
<li>联机分析处理、多维分析<ul>
<li>通过关系数据库的多表连接实现，效率比较低</li>
<li>多维数组，数组定位快，但是比较稀疏</li>
</ul>
</li>
<li>多维数组体现了局部性<ul>
<li>存储时空数据</li>
<li>通常出现在科研领域：遥感数据、图像数据等</li>
</ul>
</li>
</ul>
</li>
<li>搜索引擎查询和数据库查询的区别<ul>
<li>数据库查询：局部化查询</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/DB/CLJ/01/" data-id="cl9lj74ao00e764tz8m4iaq5a" data-title="数据库概论.陈立军.01.数据库系统简介" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DB/" rel="tag">DB</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DB/CLJ/00" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/DB/CLJ/00/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T15:52:58.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/0/">0</a>►<a class="article-category-link" href="/categories/DB-CLJ/">DB.CLJ</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/DB/CLJ/00/">数据库概论.陈立军.00.说明</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="1-说明"><a href="#1-说明" class="headerlink" title="1. 说明"></a>1. 说明</h1><ul>
<li>课程：《数据库概论》</li>
<li>授课老师：陈立军</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/DB/CLJ/00/" data-id="cl9lj74an00e364tzhfs11p3m" data-title="数据库概论.陈立军.00.说明" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/DB/" rel="tag">DB</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES101/09" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/24/CG/YLQ-GAMES101/09/" class="article-date">
  <time class="dt-published" datetime="2021-03-24T06:12:23.000Z" itemprop="datePublished">2021-03-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES101/">CG.GAMES101</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/24/CG/YLQ-GAMES101/09/">GAMES101.闫令琪.09.相机与透镜(Lecture 19)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90798049">https://www.bilibili.com/video/av90798049</a></li>
</ul>
<h1 id="相机与透镜"><a href="#相机与透镜" class="headerlink" title="相机与透镜"></a>相机与透镜</h1><ul>
<li>Cameras, Lenses and Light Fields</li>
<li>成像方法<ul>
<li>Imaging &#x3D; Synthesis + Capture<ul>
<li>Synthesis：合成</li>
<li>Capture：捕捉（相机等）</li>
</ul>
</li>
</ul>
</li>
<li>Transient Imaging：研究光在极短时间内的传播</li>
<li>Computational Photography：计算摄像学</li>
</ul>
<h2 id="相机"><a href="#相机" class="headerlink" title="相机"></a>相机</h2><ul>
<li>camera</li>
</ul>
<h3 id="相机的内部构造"><a href="#相机的内部构造" class="headerlink" title="相机的内部构造"></a>相机的内部构造</h3><ul>
<li>Cross-section of Nikon D3, 14-24mm F2.8 lens</li>
</ul>
<img src="09/20210325205247864.png" style="zoom:60%;" />

<ul>
<li>镜头、透镜组、机身、感光元件</li>
</ul>
<h3 id="小孔成像"><a href="#小孔成像" class="headerlink" title="小孔成像"></a>小孔成像</h3><ul>
<li>小孔成像</li>
</ul>
<p><img src="/09/image-20210325210156037.png"></p>
<ul>
<li>基于小孔成像原理的相机<ul>
<li>pinhole：针孔摄像机</li>
</ul>
</li>
</ul>
<h3 id="透镜相机"><a href="#透镜相机" class="headerlink" title="透镜相机"></a>透镜相机</h3><ul>
<li>透镜（组）</li>
</ul>
<p><img src="/09/image-20210325210237129.png"></p>
<h3 id="快门"><a href="#快门" class="headerlink" title="快门"></a>快门</h3><ul>
<li>shutter</li>
<li>Shutter Exposes Sensor For Precise Duration</li>
<li>控制光在多少分之一秒内进入相机</li>
</ul>
<img src="09/image-20210325210458008.png" style="zoom:50%;" />



<h3 id="传感器"><a href="#传感器" class="headerlink" title="传感器"></a>传感器</h3><ul>
<li>sensor</li>
<li>Sensor Accumulates Irradiance During Exposure</li>
<li>传感器记录的是 <strong>irradiance</strong></li>
</ul>
<img src="09/image-20210325210703438.png" style="zoom:80%;" />



<ul>
<li><strong>不使用小孔&#x2F;透镜无法成像</strong></li>
</ul>
<img src="09/image-20210325210900934.png" style="zoom:60%;" />

<ul>
<li><strong>传感器记录的是 irradiance 而不是 radiance</strong></li>
<li>结果是<strong>模糊</strong>的</li>
<li>但是目前有人在研究一些能够记录 radiance 的传感器<ul>
<li>暂时认为传感器只能记录 irradiance</li>
</ul>
</li>
</ul>
<h3 id="针孔摄像机"><a href="#针孔摄像机" class="headerlink" title="针孔摄像机"></a>针孔摄像机</h3><ul>
<li>照片是没有深度概念的<ul>
<li>也就是说整张照片都是锐利的，没有一个地方会是虚化的</li>
<li><strong>不模糊</strong></li>
</ul>
</li>
<li>光线跟踪用的模型就是针孔摄像机</li>
<li>光线跟踪模拟透镜（组）的效果，可以渲染出带有景深的图片</li>
</ul>
<h3 id="视场"><a href="#视场" class="headerlink" title="视场"></a>视场</h3><ul>
<li>FOV<ul>
<li>Field of View</li>
</ul>
</li>
<li>focal length：焦距</li>
<li>针孔摄像机的 FOV 定义如下</li>
</ul>
<p>$$<br>FOV&#x3D;2\arctan(\dfrac{h}{2f})<br>$$</p>
<img src="09/image-20210325211605543.png" style="zoom:70%;" />

<ul>
<li>其他定义 FOV 的方式（市场）<ul>
<li>将胶片的大小规定为 35 mm 格式（36 mm  x 24 mm），用此时的焦距等效表示 FOV</li>
<li>对角线的长度为 $12\sqrt{13}$</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="center">焦距&#x2F;mm</th>
<th align="center">视场（角）</th>
</tr>
</thead>
<tbody><tr>
<td align="center">17</td>
<td align="center">104</td>
</tr>
<tr>
<td align="center">50</td>
<td align="center">47</td>
</tr>
<tr>
<td align="center">200</td>
<td align="center">12</td>
</tr>
</tbody></table>
<ul>
<li><strong>手机的焦距</strong>：等效成 35 mm 格式的胶片的情况下的焦距<ul>
<li>FOV 不变，等效计算焦距</li>
</ul>
</li>
<li>传感器（sensor）和胶片（film），我们暂时混淆使用，有一一对应关系<ul>
<li>但是在渲染中，sensor 保存的是 irradiance，film 决定存成怎么样的图片格式</li>
</ul>
</li>
<li>小传感器在保持 FOV 不变：减小焦距<ul>
<li>手机</li>
<li>成像相对不清晰</li>
</ul>
</li>
</ul>
<h3 id="曝光"><a href="#曝光" class="headerlink" title="曝光"></a>曝光</h3><ul>
<li>exposure</li>
<li>$H &#x3D; T \times E$<ul>
<li>exposure &#x3D; time x irradiance</li>
</ul>
</li>
<li>T：受到快门的控制</li>
<li>E：受到光圈（aperture）、焦距（focal length）等的控制</li>
</ul>
<h4 id="曝光控制"><a href="#曝光控制" class="headerlink" title="曝光控制"></a>曝光控制</h4><h5 id="光圈大小"><a href="#光圈大小" class="headerlink" title="光圈大小"></a>光圈大小</h5><ul>
<li>aperture size</li>
<li>f-stop &#x2F; f-number<ul>
<li>我们在这里不区分这两个概念</li>
<li>数越大，光圈越小</li>
</ul>
</li>
<li>光圈用的大，某些区域会变模糊；光圈用的小，整张图片相对锐利</li>
<li>写法：FN，F&#x2F;N</li>
<li>N 的含义（非正式理解）：光圈直径的<strong>倒数</strong></li>
</ul>
<h5 id="快门速度"><a href="#快门速度" class="headerlink" title="快门速度"></a>快门速度</h5><ul>
<li>shutter speed</li>
<li>通常用一个开放快门的时间来表示</li>
<li>快门时间长：运动模糊<ul>
<li>motion blur</li>
<li>在快门打开的时间内，物体产生了一段移动，传感器记录了这整段过程，相当于做了平均效果</li>
<li><strong>机械式快门</strong></li>
<li><strong>手抖</strong>：类似的结果</li>
</ul>
</li>
<li>运动模糊的好处<ul>
<li>让人感觉运动很快</li>
<li>anti-aliasing，反走样的效果（时间上采样）</li>
</ul>
</li>
<li>rolling shutter<ul>
<li>different parts of photo taken at different times</li>
<li>快门打开的速度比物体运动速度慢</li>
<li>例子：<strong>螺旋桨扭曲</strong></li>
</ul>
</li>
</ul>
<h5 id="ISO-增益"><a href="#ISO-增益" class="headerlink" title="ISO 增益"></a>ISO 增益</h5><ul>
<li>ISO gain</li>
<li>感光度</li>
<li>后期处理：硬件或者软件</li>
<li>Change the amplification (analog and&#x2F;or digital) between sensor values and digital image values</li>
<li>ISO 值越大，同时噪声也会被得放大<ul>
<li>为什么会有噪声：简单的理解，光子数少（photon mapping 算法中的理解）</li>
</ul>
</li>
<li><strong>线性</strong></li>
</ul>
<h5 id="各种参数的影响"><a href="#各种参数的影响" class="headerlink" title="各种参数的影响"></a>各种参数的影响</h5><p><img src="/09/image-20210325232058567.png"></p>
<ul>
<li>f-stop 和 shutter speed 的补偿（只是在曝光度方面上的补偿）<ul>
<li>f-stop：放大两倍（面积放大 4 倍）</li>
<li>shutter speed：缩小到原来的 $\dfrac{1}{4}$（时间变长 4 倍）</li>
<li>但是拍出来的效果并不是一模一样<ul>
<li>大光圈会引起浅景深的问题</li>
<li>长曝光会引发运动模糊</li>
<li>trade off</li>
</ul>
</li>
</ul>
</li>
<li>depth of field：景深</li>
</ul>
<h3 id="高速摄影"><a href="#高速摄影" class="headerlink" title="高速摄影"></a>高速摄影</h3><ul>
<li>High-Speed Photograph</li>
<li>每秒钟拍摄更高的帧数，放映的时候按照正常的帧率播放</li>
<li>shutter speed 更快</li>
<li>更大的光圈<ul>
<li>ISO 会引入噪声</li>
</ul>
</li>
</ul>
<h3 id="长曝光摄影-x2F-延时摄影"><a href="#长曝光摄影-x2F-延时摄影" class="headerlink" title="长曝光摄影&#x2F;延时摄影"></a>长曝光摄影&#x2F;延时摄影</h3><ul>
<li>Long-Exposure Photograph</li>
<li><a target="_blank" rel="noopener" href="https://www.demilked.com/best-long-exposure-photos/">https://www.demilked.com/best-long-exposure-photos/</a></li>
<li>拉丝效果</li>
</ul>
<h2 id="透镜"><a href="#透镜" class="headerlink" title="透镜"></a>透镜</h2><ul>
<li>Thin Lens Approximation<ul>
<li>薄镜头近似</li>
</ul>
</li>
<li>相机一般使用透镜组</li>
<li>非理想透镜<ul>
<li>aberration（像差）</li>
</ul>
</li>
</ul>
<p><img src="/09/image-20210325235217199.png"></p>
<h3 id="理想的薄透镜"><a href="#理想的薄透镜" class="headerlink" title="理想的薄透镜"></a>理想的薄透镜</h3><img src="09/image-20210325235622130.png" style="zoom:70%;" />

<ul>
<li>一些假设<ul>
<li>All parallel rays entering a lens pass through its focal point.<ul>
<li>平行于光轴的光线过焦点</li>
</ul>
</li>
<li>All rays through a focal point will be in parallel after passing the lens.<ul>
<li>焦点发出的光线平行于光轴射出</li>
</ul>
</li>
<li>Focal length can be arbitrarily changed.<ul>
<li>薄透镜的焦距可以任意改变</li>
<li>现实中利用透镜组实现</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="其他物理规律"><a href="#其他物理规律" class="headerlink" title="其他物理规律"></a>其他物理规律</h4><img src="09/image-20210325235913646.png" style="zoom:50%;" />

<ul>
<li>经过光心的光线传播方向不变<ul>
<li>chief ray</li>
</ul>
</li>
</ul>
<img src="09/image-20210326000524663.png" style="zoom:60%;" />

<ul>
<li>物距 $z_o$，相距 $z_i$</li>
<li>Gaussian Thin Lens Equation</li>
</ul>
<p>$$<br>\dfrac{1}{f}&#x3D;\dfrac{1}{z_o}+\dfrac{1}{z_i}<br>$$</p>
<ul>
<li>推导</li>
</ul>
<p>$$<br>\dfrac{z_o-f}{h_o}&#x3D;\dfrac{f}{h_i}<br>$$</p>
<p>$$<br>\dfrac{z_i-f}{h_i}&#x3D;\dfrac{f}{h_o}<br>$$</p>
<p>$$<br>\dfrac{h_i}{h_o}&#x3D;\dfrac{f}{z_o-f}&#x3D;\dfrac{z_i-f}{f}<br>$$</p>
<p>$$<br>\dfrac{1}{f}&#x3D;\dfrac{1}{z_o}+\dfrac{1}{z_i}<br>$$</p>
<ul>
<li>在线演示<ul>
<li><a target="_blank" rel="noopener" href="http://graphics.stanford.edu/courses/cs178-10/applets/gaussian.html">http://graphics.stanford.edu/courses/cs178-10/applets/gaussian.html</a></li>
</ul>
</li>
</ul>
<h3 id="Defocus-Blur"><a href="#Defocus-Blur" class="headerlink" title="Defocus Blur"></a>Defocus Blur</h3><ul>
<li>CoC：Circle of Conclusion<ul>
<li>弥散圆</li>
<li>CoC 指的是弥散圆的大小栈光圈大小的比例</li>
</ul>
</li>
</ul>
<img src="09/image-20210326002924795.png" style="zoom:67%;" />

<ul>
<li>给定像平面（Sensor Plane），可以计算出对焦平面（Focal Plane）<ul>
<li>利用上面的 Gaussian Thin Lens Equation</li>
<li>如果物体恰好在对焦平面上，像点恰好在像平面上</li>
</ul>
</li>
<li>对薄透镜来说，如果物体离得比对焦平面远，那么像点会变近<ul>
<li>此时在 Sensor Plane 上会形成一个弥散圆（COC）</li>
<li>会变模糊</li>
</ul>
</li>
</ul>
<p>$$<br>\dfrac{C}{A}&#x3D;\dfrac{d’}{z_i}&#x3D;\dfrac{|z_s-z_i|}{z_i}<br>$$</p>
<ul>
<li>CoC 表面看到的东西模糊不模糊，直接和光圈（A）相关<ul>
<li>A 越大，C 越大</li>
<li>解释了大光圈引起的模糊现象（景深效果）</li>
</ul>
</li>
</ul>
<h3 id="F-Stop"><a href="#F-Stop" class="headerlink" title="F-Stop"></a>F-Stop</h3><ul>
<li>精确定义<ul>
<li>The f-number of a lens is defined as the focal length divided by the diameter of the aperture</li>
<li>焦距除以光圈的直径</li>
</ul>
</li>
<li>f-stop：N</li>
</ul>
<p>$$<br>C&#x3D;A\dfrac{|z_s-z_i|}{z_i}&#x3D;\dfrac{f}{N}\dfrac{|z_s-z_i|}{z_i}<br>$$</p>
<ul>
<li>f-stop 越大，CoC 越小<ul>
<li>小光圈拍的照片更清楚</li>
</ul>
</li>
</ul>
<h3 id="光线经过薄透镜"><a href="#光线经过薄透镜" class="headerlink" title="光线经过薄透镜"></a>光线经过薄透镜</h3><ul>
<li>Ray Tracing Ideal Thin Lenses</li>
</ul>
<img src="09/image-20210326004721312.png" style="zoom:67%;" />



<ul>
<li>一种方式<ul>
<li>确定 sensor 的大小、透镜属性（焦距、光圈大小）</li>
<li>定义感兴趣的平面（焦平面）$z_o$</li>
<li>求出相距 $z_i$</li>
</ul>
</li>
<li>渲染<ul>
<li>对 sensor 上的任意一个点 $x’$ 做循环</li>
<li>随机在透镜上选择另外一个点 $x’’$</li>
<li>计算出出射光线的经过点 $x’’’$：通过 Gaussian Thin Lens Equation</li>
<li>出射光线 $x’’\to x’’’$，和之前的渲染方式一样</li>
</ul>
</li>
</ul>
<h3 id="景深"><a href="#景深" class="headerlink" title="景深"></a>景深</h3><ul>
<li>Depth of Field</li>
<li>大&#x2F;小光圈会影响模糊的范围</li>
</ul>
<img src="09/image-20210326005516472.png" style="zoom:60%;" />



<ul>
<li>在成像平面附近一段区域内 CoC 足够小，这一段区域就被称为是 Depth of Focus<ul>
<li>反求出物体距离的范围，这便是景深 Depth of Field</li>
<li>成像清晰的一段范围</li>
</ul>
</li>
</ul>
<img src="09/image-20210326005847613.png" style="zoom:60%;" />

<ul>
<li><strong>光圈越小，景深越大</strong></li>
<li>在线演示<ul>
<li><a target="_blank" rel="noopener" href="http://graphics.stanford.edu/courses/cs178/applets/dof.html">http://graphics.stanford.edu/courses/cs178/applets/dof.html</a></li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/24/CG/YLQ-GAMES101/09/" data-id="cl9lj74a300aa64tzgoou53xb" data-title="GAMES101.闫令琪.09.相机与透镜(Lecture 19)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES101/08" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/22/CG/YLQ-GAMES101/08/" class="article-date">
  <time class="dt-published" datetime="2021-03-22T07:54:48.000Z" itemprop="datePublished">2021-03-22</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES101/">CG.GAMES101</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/22/CG/YLQ-GAMES101/08/">GAMES101.闫令琪.08.高级光线传播与复杂外观建模(Lecture 18)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90798049">https://www.bilibili.com/video/av90798049</a></li>
</ul>
<h1 id="高级光线传播"><a href="#高级光线传播" class="headerlink" title="高级光线传播"></a>高级光线传播</h1><ul>
<li>Advanced Light Transport</li>
<li>Unbiased light transport methods<ul>
<li>Bidirectional path tracing (BDPT)</li>
<li>Metropolis light transport (MLT)</li>
</ul>
</li>
<li>Biased light transport methods<ul>
<li>Photon mapping</li>
<li>Vertex connection and merging (VCM)</li>
</ul>
</li>
<li>Instant radiosity (VPL &#x2F; many light methods)</li>
</ul>
<h2 id="有偏无偏估计"><a href="#有偏无偏估计" class="headerlink" title="有偏无偏估计"></a>有偏无偏估计</h2><ul>
<li>无偏估计 unbiased</li>
<li>An <strong>unbiased</strong> Monte Carlo technique does not have any systematic error<ul>
<li>不管样本数是多少个，无偏估计的期望总是正确的</li>
<li>The expected value of an unbiased estimator will always be the correct value, no matter how many samples are used.</li>
</ul>
</li>
<li>有偏估计 biased<ul>
<li>一致的 consistent<ul>
<li>当使用的样本数很多时，期望会收敛到正确的值</li>
<li>the expected value converges to the correct value as infinite #samples are used.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="渲染中的有偏无偏"><a href="#渲染中的有偏无偏" class="headerlink" title="渲染中的有偏无偏"></a>渲染中的有偏无偏</h3><ul>
<li><p>An easier understanding bias in rendering</p>
<ul>
<li>Biased &#x3D;&#x3D; blurry</li>
<li>Consistent &#x3D;&#x3D; not blurry with infinite #samples</li>
</ul>
</li>
<li><p>有偏：模糊</p>
<ul>
<li>一致性：无限的条件下是不模糊的</li>
</ul>
</li>
</ul>
<h2 id="无偏的"><a href="#无偏的" class="headerlink" title="无偏的"></a>无偏的</h2><h3 id="双向路径追踪-BDPT"><a href="#双向路径追踪-BDPT" class="headerlink" title="双向路径追踪(BDPT)"></a>双向路径追踪(BDPT)</h3><ul>
<li>Bidirectional Path Tracing (BDPT)</li>
</ul>
<img src="08/1616402891446.png" style="zoom:50%;" />

<ul>
<li>光源出发发射出半路径，视点出发发射出半路径，BDPT 把这两条路径连接起来<ul>
<li>思想简单</li>
<li><strong>实现复杂</strong></li>
<li>相对较慢</li>
</ul>
</li>
<li>有些情况下 BDPT 效果非常好（下图）<ul>
<li>下图的特点：first-bounce 是 diffuse 的<ul>
<li>如果用之前的路径追踪方法，不容易控制光线打到光源上</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="08/1616402997421.png" style="zoom:60%;" />



<h3 id="Metropolis-Light-Transport-MLT"><a href="#Metropolis-Light-Transport-MLT" class="headerlink" title="Metropolis Light Transport(MLT)"></a>Metropolis Light Transport(MLT)</h3><ul>
<li>Metropolis：人名</li>
<li>利用 MCMC 方法实现<ul>
<li>MCMC：Markov Chain Mente Carlo</li>
<li>根据当前的样本生成下一个样本<ul>
<li>之前的蒙特卡洛方法不考虑当前样本的影响</li>
</ul>
</li>
</ul>
</li>
<li>对于之前的蒙特卡洛采样方法，<strong>当你用于采样的 PDF 和原来的函数一致的时候，效果是最好的（方差最小）</strong></li>
<li>MCMC 方法能够生成一些样本，使得这些样本的分布和原来的函数一致</li>
<li>Jumping from the current sample to the next with some PDF</li>
<li><strong>Very good</strong> at <strong>locally</strong> exploring difficult light paths</li>
<li>能够在找到蓝色光路的条件下很快找到红色的光路</li>
</ul>
<img src="08/1616403640009.png" style="zoom: 67%;" />

<ul>
<li>Works great with difficult light paths<ul>
<li>很适合复杂光路查找的情景</li>
<li>当找到一条光路之后，很快生成其他可能的光路</li>
</ul>
</li>
<li>两个例子（很难找光路）<ul>
<li>半开着门</li>
<li>焦散现象 caustic</li>
</ul>
</li>
</ul>
<img src="08/1616403852845.png" style="zoom: 67%;" />

<ul>
<li>缺点<ul>
<li>Difficult to estimate the convergence rate<ul>
<li>很难估计收敛速度</li>
</ul>
</li>
<li>Does not guarantee equal convergence rate per pixel<ul>
<li>所有点的收敛速度不能保证一致</li>
</ul>
</li>
<li>So, usually produces “dirty” results</li>
<li>Therefore, usually not used to render animations<ul>
<li>这样这种方法在很难用于渲染动画</li>
<li>相邻两帧可能有些点收敛了，有些没收敛，导致抖动</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="有偏的"><a href="#有偏的" class="headerlink" title="有偏的"></a>有偏的</h2><h3 id="光子映射"><a href="#光子映射" class="headerlink" title="光子映射"></a>光子映射</h3><ul>
<li>photon mapping</li>
<li>Very good at handling Specular-Diffuse-Specular (<strong>SDS</strong>) paths and <strong>generating caustics</strong><ul>
<li>SDS：例如之前在水底的反射</li>
</ul>
</li>
<li>很适合渲染焦散的场景<ul>
<li>焦散（caustics）：由于光线的聚焦产生的非常强的图案</li>
<li>只是聚焦，没有发散的意思</li>
</ul>
</li>
</ul>
<p><img src="/08/1616404163843.png"></p>
<h4 id="一种实现方法"><a href="#一种实现方法" class="headerlink" title="一种实现方法"></a>一种实现方法</h4><ul>
<li>两步的方法（2-stage）</li>
</ul>
<h5 id="1-Stage-1-photon-tracing"><a href="#1-Stage-1-photon-tracing" class="headerlink" title="(1) Stage 1: photon tracing"></a>(1) Stage 1: photon tracing</h5><ul>
<li>Emitting photons from the light source, bouncing them around, then recording photons on diffuse surfaces<ul>
<li>从光源辐射出很多的光子，反射，直到光子打到 diffuse 的材质上</li>
<li>整理光子，记录光子的位置</li>
</ul>
</li>
</ul>
<h5 id="2-Stage-2-photon-collection"><a href="#2-Stage-2-photon-collection" class="headerlink" title="(2) Stage 2: photon collection"></a>(2) Stage 2: photon collection</h5><ul>
<li>Shoot sub-paths from the camera, bouncing them around, until they hit diffuse surfaces</li>
<li>从视点辐射出很多光线，反射，直到打到 diffuse 的材质上</li>
</ul>
<h5 id="3-计算"><a href="#3-计算" class="headerlink" title="(3) 计算"></a>(3) 计算</h5><ul>
<li><strong>local density estimation</strong><ul>
<li>局部密度估计</li>
</ul>
</li>
<li>ideas：光子分布越集中的地方，应该更亮</li>
<li>对于任何的一个着色点，取其最近的 N 个光子，求出包围他们的球体在表面占的面积<ul>
<li>求出其密度</li>
</ul>
</li>
</ul>
<h5 id="评价"><a href="#评价" class="headerlink" title="评价"></a>评价</h5><ul>
<li>N 太小你会看到有噪声（noisy），N 比较大（但是不是无限）会看到图片模糊（blurry）</li>
</ul>
<h5 id="问题的产生"><a href="#问题的产生" class="headerlink" title="问题的产生"></a>问题的产生</h5><ul>
<li>局部密度估计应该是 $\dfrac{dN}{dA}$，而不是 $\dfrac{\Delta N}{\Delta A}$</li>
<li>当 $\Delta A$ 足够小的时候上面两个值才相等</li>
<li>解决方法：发射出更多的光子，这样还是收集 N 个光子的话，面积就更小<ul>
<li>发射出的光子足够多，结果就是正确的（一致性 consistent）</li>
</ul>
</li>
<li>只有当 N 是无限的情况下，才是完全正确的，N 不是无限的时候，多少会有点糊</li>
</ul>
<h4 id="另外的方法"><a href="#另外的方法" class="headerlink" title="另外的方法"></a>另外的方法</h4><ul>
<li>取一个固定大小的范围，统计光子数量，然后计算局部密度</li>
<li>始终是<strong>有偏的</strong>，而且不是<strong>一致</strong>的</li>
</ul>
<h3 id="Vertex-Connection-and-Merging-VCM"><a href="#Vertex-Connection-and-Merging-VCM" class="headerlink" title="Vertex Connection and Merging(VCM)"></a>Vertex Connection and Merging(VCM)</h3><ul>
<li>把 BDPT 和 photon mapping 结合在一起</li>
<li>ideas<ul>
<li>Let’s not waste the sub-paths in BDPT if <strong>their end points cannot be connected</strong> but <strong>can be merged</strong></li>
<li>Use photon mapping to handle the merging of nearby “photons”</li>
</ul>
</li>
</ul>
<img src="08/1616406256091.png" style="zoom:50%;" />

<ul>
<li>在 BDPT 基础上，如果有这样的 path<ul>
<li>端点在同一个面上（不可能通过反射连接起来）</li>
<li>端点离得的足够近</li>
</ul>
</li>
<li>此时认为从光源发出来的是光子，利用光子映射的方法进行计算（原来认为是一条 sub-path）</li>
</ul>
<h2 id="实时辐射度算法"><a href="#实时辐射度算法" class="headerlink" title="实时辐射度算法"></a>实时辐射度算法</h2><ul>
<li>Instant Radiosity (IR)</li>
<li>也被称为 many-light approaches</li>
<li>思想：已经被照亮的面可以当作光源</li>
<li>算法：<ul>
<li>Shoot light sub-paths and assume the end point of each sub-path is a Virtual Point Light (VPL)<ul>
<li>从光源打出一些光线，光线停在某一个表面上，把光线端点当作虚拟光源</li>
</ul>
</li>
<li>Render the scene as usual using these VPLs<ul>
<li>使用虚拟的光源计算光照</li>
</ul>
</li>
</ul>
</li>
<li>可以得到间接光照的结果</li>
<li>优点<ul>
<li>很快</li>
<li>漫反射场景中表现较好</li>
</ul>
</li>
<li>问题<ul>
<li>对于 glossy 材质的物体不能很好渲染</li>
<li>当 VPLs 和待渲染的点离得较近的时候，会出现一些奇怪的高亮<ul>
<li>和平方项有关，距离很近的时候，相当于除了一个很小的数</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="08/1616517146224.png" style="zoom: 80%;" />



<h2 id="现状"><a href="#现状" class="headerlink" title="现状"></a>现状</h2><ul>
<li>暂时没有一个方法能够解决所有问题</li>
<li>工业界：path tracing 居多，不高端，但是可靠</li>
</ul>
<h1 id="复杂外观建模"><a href="#复杂外观建模" class="headerlink" title="复杂外观建模"></a>复杂外观建模</h1><ul>
<li>Advanced Appearance Modeling</li>
<li>Non-surface models 非表面模型<ul>
<li>Participating media 散射介质</li>
<li>Hair &#x2F; fur &#x2F; fiber (BCSDF) 头发&#x2F;毛发&#x2F;纤维</li>
<li>Granular material 沙子</li>
</ul>
</li>
<li>Surface models 表面模型<ul>
<li>Translucent material (BSSRDF)  半透明</li>
<li>Cloth 布料</li>
<li>Detailed material (non-statistical BRDF) 细节化的模型</li>
</ul>
</li>
<li>Procedural appearance 程序化生成的模型</li>
</ul>
<h2 id="非表面模型"><a href="#非表面模型" class="headerlink" title="非表面模型"></a>非表面模型</h2><h3 id="散射介质"><a href="#散射介质" class="headerlink" title="散射介质"></a>散射介质</h3><ul>
<li>Participating media<ul>
<li>散射介质 &#x2F; 参与介质</li>
</ul>
</li>
<li>Fog （雾），Cloud （云）<ul>
<li>不是在表面上，定义在空间中</li>
</ul>
</li>
<li>当光线穿越过散射介质的时候，光线会被 <strong>吸收&#x2F;散射</strong></li>
</ul>
<img src="08/1616555378102.png" style="zoom:80%;" />

<ul>
<li>怎么散射？<ul>
<li>Phase Function（相位函数）<ul>
<li>类似于 BRDF 规定了怎么反射，PF 规定了怎么散射</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="08/1616556350070.png" style="zoom:80%;" />



<h4 id="渲染方式"><a href="#渲染方式" class="headerlink" title="渲染方式"></a>渲染方式</h4><ul>
<li>随机选择一个方向去反射</li>
<li>随机选择一个方向直走</li>
<li>对于路径上的所有点（shading point），跟光源相连</li>
<li>不仅需要考虑渲染方程，需要考虑光线和体积之间的作用<ul>
<li>思想是一样的，产生一些光线的路径</li>
</ul>
</li>
</ul>
<h3 id="毛发"><a href="#毛发" class="headerlink" title="毛发"></a>毛发</h3><ul>
<li>光线和曲线的作用</li>
<li>两种高光：有色、无色</li>
</ul>
<h4 id="Kajiya-Ray-Model"><a href="#Kajiya-Ray-Model" class="headerlink" title="Kajiya-Ray Model"></a>Kajiya-Ray Model</h4><ul>
<li>类似于之前的 specular + diffuse，光线打到圆柱上<ul>
<li>散射出一个圆锥</li>
<li>同时又有一部分散射到四面八方</li>
</ul>
</li>
</ul>
<img src="08/1616557193280.png" style="zoom:50%;" />



<h4 id="Marschner-Model"><a href="#Marschner-Model" class="headerlink" title="Marschner Model"></a>Marschner Model</h4><img src="08/1616557433440.png" style="zoom: 67%;" />

<ul>
<li><strong>广泛应用的模型</strong></li>
<li>R: reflection, T: transmission<ul>
<li>R：有一部分被直接反射</li>
<li>TT：有一部分被穿透头发，然后再穿透出来</li>
<li>TRT：穿透，反射，穿透</li>
</ul>
</li>
<li>头发是一个玻璃柱（小段），内部有色素（会吸收能量）</li>
</ul>
<img src="08/1616557623819.png" style="zoom:50%;" />

<ul>
<li><strong>计算量很大</strong>，头发渲染非常难</li>
</ul>
<h3 id="动物毛发"><a href="#动物毛发" class="headerlink" title="动物毛发"></a>动物毛发</h3><ul>
<li>使用头发的渲染模型渲染的效果不好</li>
</ul>
<img src="08/1616557872091.png" style="zoom: 80%;" />

<ul>
<li>生物结构<ul>
<li>动物毛发的髓质比较大，光线更容易发生<strong>散射</strong></li>
</ul>
</li>
</ul>
<img src="08/1616557930395.png" style="zoom:60%;" />

<ul>
<li>加入髓质的效果</li>
</ul>
<img src="08/1616558220862.png" style="zoom:50%;" />



<h4 id="Double-Cylinder-Model"><a href="#Double-Cylinder-Model" class="headerlink" title="Double Cylinder Model"></a>Double Cylinder Model</h4><ul>
<li>双层圆柱模型（闫令琪提出）</li>
<li>精确的描述髓质的作用<ul>
<li>Cortex：absorbs</li>
<li>Medulla：scatters</li>
</ul>
</li>
<li>效果会更亮<ul>
<li>s：scatter 散射</li>
</ul>
</li>
</ul>
<img src="08/1616558389562.png" style="zoom:60%;" />

<ul>
<li>效果图</li>
</ul>
<img src="08/1616559546400.png" style="zoom:67%;" />





<h3 id="颗粒材质"><a href="#颗粒材质" class="headerlink" title="颗粒材质"></a>颗粒材质</h3><ul>
<li>Granular</li>
<li>一粒一粒的材质<ul>
<li>糖、盐、沙子</li>
</ul>
</li>
<li><strong>计算量很大</strong></li>
</ul>
<h2 id="表面模型"><a href="#表面模型" class="headerlink" title="表面模型"></a>表面模型</h2><h3 id="Translucent-Material"><a href="#Translucent-Material" class="headerlink" title="Translucent Material"></a>Translucent Material</h3><ul>
<li>semi-transparent：半透明材质，光线经过物体的时候发生<strong>吸收</strong></li>
<li>translucent：光线经过物体的时候发生<strong>吸收和散射</strong></li>
</ul>
<img src="08/1616559215018.png" style="zoom:80%;" />

<ul>
<li>例子<ul>
<li>Jade：玉石</li>
<li>Jellyfish：水母</li>
<li>人的耳朵</li>
</ul>
</li>
<li>次表面散射：subsurface scattering</li>
</ul>
<h4 id="BSSRDF"><a href="#BSSRDF" class="headerlink" title="BSSRDF"></a>BSSRDF</h4><ul>
<li>对 BRDF 概念的延伸</li>
<li>$S(x_i,\omega_i,x_o,\omega_o)$：从点 $x_i$ 处入射，入射方向为 $\omega_i$，从点 $x_o$ 处出射，出射方向为 $\omega_o$</li>
<li>渲染方程需要修改，需要对整个表面进行积分</li>
</ul>
<p>$$<br>L\left(x_{o}, \omega_{o}\right)&#x3D;\int_{A} \int_{H^{2}} S\left(x_{i}, \omega_{i}, x_{o}, \omega_{o}\right) L_{i}\left(x_{i}, \omega_{i}\right) \cos \theta_{i} \mathrm{d} \omega_{i} \mathrm{d} A<br>$$</p>
<ul>
<li>计算量很大</li>
</ul>
<h5 id="Dipole-Approximation"><a href="#Dipole-Approximation" class="headerlink" title="Dipole Approximation"></a>Dipole Approximation</h5><ul>
<li>Jensen et al. 2001</li>
<li>模仿次表面反射，效果差不多，但是计算量小很多</li>
<li>现实观察<ul>
<li>光线打到物体上，好像物体底下出现了一个光源，这个光源会照亮其周围的一片</li>
<li>物理上的真实：上方还需要有一个光源</li>
</ul>
</li>
</ul>
<img src="08/1616559823614.png" style="zoom:60%;" />



<h5 id="BSSRDF-效果"><a href="#BSSRDF-效果" class="headerlink" title="BSSRDF 效果"></a>BSSRDF 效果</h5><ul>
<li>更接近物理真实，效果更好</li>
</ul>
<img src="08/1616560024307.png" style="zoom: 50%;" />

<ul>
<li>惊人效果<ul>
<li><a target="_blank" rel="noopener" href="https://cgelves.com/10-most-realistic-human-3d-models-that-will-wow-you/">https://cgelves.com/10-most-realistic-human-3d-models-that-will-wow-you/</a></li>
</ul>
</li>
</ul>
<h3 id="Cloth"><a href="#Cloth" class="headerlink" title="Cloth"></a>Cloth</h3><ul>
<li>布料</li>
<li>布料的层级<ul>
<li>纤维 fibers</li>
<li>股 ply</li>
<li>线 yarn</li>
<li>布料 cloth</li>
</ul>
</li>
</ul>
<img src="08/1616560289100.png" style="zoom:50%;" />

<ul>
<li>表面模型和针织的方向、图案有关</li>
<li>根据形状计算 BRDF</li>
<li>有些材质不能解决<ul>
<li>天鹅绒，不在平面上</li>
</ul>
</li>
</ul>
<img src="08/1616560435020.png" style="zoom:57%;" />

<ul>
<li>更准确的做法：空间分布的体积<ul>
<li>空间体积划分，最终好像就在渲染云一样</li>
<li><strong>计算量很大</strong></li>
</ul>
</li>
<li>逐纤维渲染<ul>
<li>计算量很大</li>
</ul>
</li>
</ul>
<h3 id="Detailed-Appearance"><a href="#Detailed-Appearance" class="headerlink" title="Detailed Appearance"></a>Detailed Appearance</h3><ul>
<li>渲染的结果看着不真实的原因之一：过于完美</li>
<li>真实世界很复杂</li>
<li>手动加入划痕，刷（各向异性）</li>
<li>微表面模型<ul>
<li>表面法线分布：$D(h)$</li>
<li>简单的正态分布等过于完美<ul>
<li>法线贴图</li>
</ul>
</li>
</ul>
</li>
<li>计算复杂度很高，需要渲染很久<ul>
<li>原因是表面都是<strong>镜面</strong>，很难让从视点发出的光线打到光源</li>
<li>很难找到一条合理的光路</li>
</ul>
</li>
<li>解决方式：BRDF over a pixel<ul>
<li>一个像素出去的光线会覆盖一个区域内的微表面（patch），我们将这一部分区域的分布拿出来，替代原本的光滑的法线，并且用在微表面模型里</li>
<li>p-NDFs</li>
</ul>
</li>
</ul>
<img src="08/1616565254723.png" style="zoom:60%;" />

<ul>
<li>海面的模拟：波光粼粼的效果</li>
</ul>
<h3 id="波动光学"><a href="#波动光学" class="headerlink" title="波动光学"></a>波动光学</h3><ul>
<li>Waved Optics</li>
<li>当物体的尺寸和光的波长相近的时候，会发生衍射、干涉等现象的发生（光不再沿直线传播）</li>
<li>例子：<ul>
<li>小黑屋里面，关掉所光源，只用一个点光源照亮金属片，会发现金属片的表面有各种各样不同颜色的点</li>
</ul>
</li>
<li>波动光学解出的 BRDF，效果很好（能够模拟出上面的情况）</li>
</ul>
<h2 id="程序化外观"><a href="#程序化外观" class="headerlink" title="程序化外观"></a>程序化外观</h2><ul>
<li>noise function</li>
<li>Compute a noise function on the fly.<ul>
<li>随用随取（不需要生成）</li>
</ul>
</li>
<li>木头纹理</li>
<li>Perlin Noise</li>
<li>Houdini：程序化生成材质（需要生成）</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/22/CG/YLQ-GAMES101/08/" data-id="cl9lj74a300ag64tzdsn89h0k" data-title="GAMES101.闫令琪.08.高级光线传播与复杂外观建模(Lecture 18)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES101/07" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/21/CG/YLQ-GAMES101/07/" class="article-date">
  <time class="dt-published" datetime="2021-03-21T14:33:15.000Z" itemprop="datePublished">2021-03-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES101/">CG.GAMES101</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/21/CG/YLQ-GAMES101/07/">GAMES101.闫令琪.07.材质与外观(Lecture 17)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90798049">https://www.bilibili.com/video/av90798049</a></li>
</ul>
<h1 id="材质与外观"><a href="#材质与外观" class="headerlink" title="材质与外观"></a>材质与外观</h1><ul>
<li>Materials and Appearances</li>
</ul>
<h2 id="常见材质"><a href="#常见材质" class="headerlink" title="常见材质"></a>常见材质</h2><ul>
<li>光柱、头发、海浪、布、蝴蝶的鳞片、鱼肉</li>
<li>光线传播和材质紧密相关</li>
<li>Weta 的  Manuka渲染器<ul>
<li>比较成熟的渲染器</li>
<li>支持 40 多种材质</li>
</ul>
</li>
</ul>
<h2 id="Material-x3D-x3D-BRDF"><a href="#Material-x3D-x3D-BRDF" class="headerlink" title="Material &#x3D;&#x3D; BRDF"></a>Material &#x3D;&#x3D; BRDF</h2><ul>
<li>材质：反射不同光的方式</li>
</ul>
<h2 id="漫反射材质"><a href="#漫反射材质" class="headerlink" title="漫反射材质"></a>漫反射材质</h2><ul>
<li>Diffuse &#x2F; Lambertian Material</li>
</ul>
<img src="07/1616377559351.png" style="zoom:50%;" />

<ul>
<li>能量守恒：不发光、不吸收光<ul>
<li>进出的 irradiance 相同</li>
</ul>
</li>
<li>及射入射光在每个方向上均匀分布，出射光也在每个方向上均匀分布，那么就有</li>
</ul>
<p>$$<br>L_o&#x3D;L_i<br>$$</p>
<ul>
<li>通过 BRDF 得到以下结论</li>
</ul>
<p>$$<br>\begin{aligned} L_{o}\left(\omega_{o}\right) &amp;&#x3D;\int_{H^{2}} f_{r} L_{i}\left(\omega_{i}\right) \cos \theta_{i} \mathrm{d} \omega_{i} \ &amp;&#x3D;f_{r} L_{i} \int_{H^{2}} \cos \theta_{i} \mathrm{d} \omega_{i} \ &amp;&#x3D;\pi f_{r} L_{i} \end{aligned}<br>$$</p>
<p>$$<br>f_r&#x3D;\dfrac{1}{\pi}<br>$$</p>
<ul>
<li>引入一个反射系数（albedo 反射率 ）$\rho\in[0,1]$，完全不反射 - 完全反射</li>
</ul>
<p>$$<br>f_r&#x3D;\dfrac{\rho}{\pi}<br>$$</p>
<h2 id="Glossy-材质"><a href="#Glossy-材质" class="headerlink" title="Glossy 材质"></a>Glossy 材质</h2><ul>
<li>Glossy material</li>
<li>抛光金属材质<ul>
<li>有高光，但是高光没那么强</li>
</ul>
</li>
</ul>
<img src="07/1616377650494.png" style="zoom:50%;" />

<ul>
<li>例子</li>
</ul>
<img src="07/1616377852715.png" style="zoom:80%;" />



<h2 id="理想反射-x2F-折射材质"><a href="#理想反射-x2F-折射材质" class="headerlink" title="理想反射&#x2F;折射材质"></a>理想反射&#x2F;折射材质</h2><ul>
<li>Ideal reflective &#x2F; refractive material (BSDF*)<ul>
<li>BSDF： Bidirectional Scattering Distribution Function<ul>
<li>双向散射分布函数</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="07/1616377902337.png" style="zoom:50%;" />



<h2 id="反射光线的计算"><a href="#反射光线的计算" class="headerlink" title="反射光线的计算"></a>反射光线的计算</h2><img src="07/1616393053065.png" style="zoom:50%;" />

<ul>
<li>$\theta$<ul>
<li>这里可以看出半角矢量更加<strong>好算</strong></li>
</ul>
</li>
</ul>
<p>$$<br>\vec{\omega_i} + \vec{\omega_o}&#x3D;2\cos\theta\ \vec{n}&#x3D;2(\vec{\omega_i}\cdot\vec{n})\vec{n}<br>$$</p>
<ul>
<li>$\phi$<ul>
<li>局部坐标系，表面俯视</li>
</ul>
</li>
</ul>
<p>$$<br>\phi_o&#x3D;(\phi_i+\pi)\mod2\pi<br>$$</p>
<h2 id="折射"><a href="#折射" class="headerlink" title="折射"></a>折射</h2><ul>
<li>Specular Refraction</li>
<li>几何光学角度</li>
<li>焦散 caustics</li>
</ul>
<p><img src="/07/1616393489347.png"></p>
<h3 id="折射定律"><a href="#折射定律" class="headerlink" title="折射定律"></a>折射定律</h3><ul>
<li>Snell’ Law</li>
</ul>
<img src="07/1616393583720.png" style="zoom:50%;" />

<ul>
<li>$\theta$</li>
</ul>
<p>$$<br>\eta_i\sin\theta_i&#x3D;\eta_t\sin\theta_t<br>$$</p>
<ul>
<li>$\phi$</li>
</ul>
<p>$$<br>\phi_o&#x3D;(\phi_i+\pi)\mod2\pi<br>$$</p>
<ul>
<li>一些常见介质的折射率</li>
</ul>
<table>
<thead>
<tr>
<th align="center">介质 medium</th>
<th align="center">折射率 n</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Vacuum（真空）</td>
<td align="center">1.0</td>
</tr>
<tr>
<td align="center">Air (sea level)</td>
<td align="center">1.00029</td>
</tr>
<tr>
<td align="center">Water (20°C)</td>
<td align="center">1.333</td>
</tr>
<tr>
<td align="center">Glass</td>
<td align="center">1.5-1.6</td>
</tr>
<tr>
<td align="center"><strong>Diamond</strong></td>
<td align="center"><strong>2.42</strong></td>
</tr>
</tbody></table>
<ul>
<li>计算折射角的余弦</li>
</ul>
<p>$$<br>\begin{aligned}<br>\cos\theta_t&amp;&#x3D;\sqrt{1-\sin^2\theta_t}\<br>&amp;&#x3D;\sqrt{1-(\dfrac{\eta_i\sin\theta_i}{\eta_t})^2}\<br>&amp;&#x3D;\sqrt{1-(\dfrac{\eta_i}{\eta_t})^2(1-\cos\theta_i)^2}\<br>\end{aligned}<br>$$</p>
<ul>
<li>可能无解：<strong>全反射</strong><ul>
<li>$1-(\dfrac{\eta_i}{\eta_t})^2(1-\cos\theta_i)^2&lt;0$</li>
<li>${\color{red}\eta_i&gt;\eta_t}$</li>
</ul>
</li>
<li>Snell’s Window &#x2F; Circle<ul>
<li>水里向上看只能看到一个锥形的区域</li>
</ul>
</li>
</ul>
<img src="07/1616394304086.png" style="zoom:50%;" />

<ul>
<li>模型中可能发生全反射</li>
<li>对于<strong>球体</strong>，具有对称性，折射进去的光一定能够折射出来</li>
<li>BSDF &#x3D; BRDF + BTDF<ul>
<li>散射 &#x3D; 反射 + 折射</li>
</ul>
</li>
</ul>
<h2 id="菲涅尔项"><a href="#菲涅尔项" class="headerlink" title="菲涅尔项"></a>菲涅尔项</h2><ul>
<li>Fresnel Reflection &#x2F; Term</li>
<li>不同的视角看过去，反射程度不一样</li>
</ul>
<p><img src="/07/1616394626724.png"></p>
<h3 id="电介质-x2F-绝缘体"><a href="#电介质-x2F-绝缘体" class="headerlink" title="电介质&#x2F;绝缘体"></a>电介质&#x2F;绝缘体</h3><ul>
<li>Dielectric，$\eta&#x3D;1.5$</li>
<li>S，P 两种极化</li>
<li>垂直的时候反射弱</li>
</ul>
<img src="07/1616394762467.png"  />



<h3 id="导体"><a href="#导体" class="headerlink" title="导体"></a>导体</h3><ul>
<li>Conductor</li>
<li>垂直的时候也很强<ul>
<li>古代照镜子用<strong>铜镜</strong></li>
</ul>
</li>
</ul>
<p><img src="/07/1616394928127.png"></p>
<h3 id="精确计算菲涅尔项"><a href="#精确计算菲涅尔项" class="headerlink" title="精确计算菲涅尔项"></a>精确计算菲涅尔项</h3><ul>
<li>需要考虑极化现象</li>
</ul>
<p>$$<br>R_s&#x3D;\left|\dfrac{n_i\cos\theta_i-n_t\cos\theta_t}{n_i\cos\theta_i+n_t\cos\theta_t}\right|^2<br>$$</p>
<p>$$<br>R_t&#x3D;\left|\dfrac{n_i\cos\theta_t-n_t\cos\theta_i}{n_i\cos\theta_t+n_t\cos\theta_i}\right|^2<br>$$</p>
<p>$$<br>R_{eff}&#x3D;\dfrac{R_s+R_t}{2}<br>$$</p>
<h3 id="估计菲涅尔项"><a href="#估计菲涅尔项" class="headerlink" title="估计菲涅尔项"></a>估计菲涅尔项</h3><ul>
<li>Schlick’s approximation</li>
<li>$\theta:0\to\dfrac{\pi}{2},R(\theta):R_0\to1$</li>
</ul>
<p>$$<br>R(\theta) &#x3D;R_{0}+\left(1-R_{0}\right)(1-\cos \theta)^{5}<br>$$</p>
<p>$$<br>R_{0} &#x3D;\left(\frac{n_{1}-n_{2}}{n_{1}+n_{2}}\right)^{2}<br>$$</p>
<h2 id="微表面模型"><a href="#微表面模型" class="headerlink" title="微表面模型"></a>微表面模型</h2><ul>
<li>Microfacet Material</li>
<li>假设：离得足够远的时候，看不到物体细节，只能看到他们最终对整个表面的作用</li>
<li>微表面理论</li>
<li>Rough surface<ul>
<li>Macroscale: flat &amp; rough<ul>
<li>远处看：<strong>粗糙的平面</strong></li>
</ul>
</li>
<li>Microscale: bumpy &amp; <strong>specular</strong><ul>
<li>近处看：能看出凹凸不平的表面，每一个小的微元都是完全的<strong>镜面</strong>物体</li>
<li>物理中可用于解释漫反射<ul>
<li>表面中有很多微小的镜子，朝向大小各异，最终形成各个方向均匀反射的结果</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Individual elements of surface act like <strong>mirrors</strong><ul>
<li>Known as Microfacets</li>
<li>Each microfacet has <strong>its own normal</strong></li>
</ul>
</li>
</ul>
<h2 id="Microfacet-BRDF"><a href="#Microfacet-BRDF" class="headerlink" title="Microfacet BRDF"></a>Microfacet BRDF</h2><ul>
<li>微表面中<strong>法线的分布</strong></li>
</ul>
<img src="07/1616396101074.png" style="zoom:50%;" />

<ul>
<li>BRDF<ul>
<li>$\mathbf{F}$：菲涅尔项（Fresnel term）</li>
<li>$\mathbf{G}$：shadowing-masking term<ul>
<li>也称为几何项</li>
<li>微表面的自遮挡</li>
<li>grazing angle：几乎和表面方向平行<ul>
<li>此时容易发生自遮挡现象</li>
</ul>
</li>
</ul>
</li>
<li>$\mathbf{D}$：表面法线的一个分布<ul>
<li>注意微表面时镜面（mirror）</li>
<li>只有半角矢量和法线一致的微表面才能将光线从入射方向传送到出射方向</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>$$<br>f(\mathbf{i}, \mathbf{o})&#x3D;\frac{\mathbf{F}(\mathbf{i}, \mathbf{h}) \mathbf{G}(\mathbf{i}, \mathbf{o}, \mathbf{h}) \mathbf{D}(\mathbf{h})}{4(\mathbf{n}, \mathbf{i})(\mathbf{n}, \mathbf{o})}<br>$$</p>
<img src="07/1616396858635.png" style="zoom: 80%;" />

<ul>
<li>效果十分强大</li>
<li>基于微表面有很多模型，是一类模型的统称</li>
<li>PBR：Physically Based Rendering &#x2F; Shading</li>
<li>缺点 ：Diffuse比较少，有时需要手动加</li>
</ul>
<h2 id="各向同性-x2F-各向异性材质"><a href="#各向同性-x2F-各向异性材质" class="headerlink" title="各向同性&#x2F;各向异性材质"></a>各向同性&#x2F;各向异性材质</h2><ul>
<li>Isotropic &#x2F; Anisotropic Materials (BRDFs)</li>
<li>各向同性（Isotropic）：微表面的方向性很弱</li>
<li>各向异性（Anisotropic）：微表面具有一定的方向性</li>
</ul>
<img src="07/1616397220727.png" style="zoom: 50%;" />

<ul>
<li>各向异性 BRDF<ul>
<li>入射角和出射角的相对位置不变（同时仰角不变），方位角发生旋转，结果 BRDF 不同</li>
<li>Reflection depends on azimuthal angle<ul>
<li>BRDF 依赖于方位角</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>$$<br>f_{r}\left(\theta_{i}, \phi_{i} ; \theta_{r}, \phi_{r}\right) \neq f_{r}\left(\theta_{i}, \theta_{r}, \phi_{r}-\phi_{i}\right)<br>$$</p>
<ul>
<li>生活中的各向异性材质<ul>
<li>brushed metal<ul>
<li>锅底、门把手</li>
</ul>
</li>
<li>Nylon</li>
<li>Velvet（天鹅绒）<ul>
<li>刷往一个方向（自己人为构造各向异性）</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="BRDF-的性质"><a href="#BRDF-的性质" class="headerlink" title="BRDF 的性质"></a>BRDF 的性质</h2><ul>
<li>非负性（Non-negativity）<ul>
<li>是一个分布</li>
</ul>
</li>
<li>线性（Linearity）<ul>
<li>可加的</li>
</ul>
</li>
<li>可逆性（Reciprocity principle）<ul>
<li>光路的可逆性</li>
</ul>
</li>
<li>能量守恒（Energy conservation）<ul>
<li>球面积分小于等于 1（可能有吸收）</li>
</ul>
</li>
<li>各向异性前提下<ul>
<li>4 维输入变为 3 维的（只和方位角的相对位置有关）</li>
</ul>
</li>
</ul>
<p>$$<br>f_{r}\left(\theta_{i}, \phi_{i} ; \theta_{r}, \phi_{r}\right) &#x3D;f_{r}\left(\theta_{i}, \theta_{r}, \phi_{r}-\phi_{i}\right)<br>$$</p>
<p>$$<br>f_{r}\left(\theta_{i}, \phi_{i} ; \theta_{r}, \phi_{r}\right) &#x3D;f_{r}\left(\theta_{i}, \theta_{r}, |\phi_{r}-\phi_{i}\right|)<br>$$</p>
<h2 id="测量-BRDF"><a href="#测量-BRDF" class="headerlink" title="测量 BRDF"></a>测量 BRDF</h2><ul>
<li>动机：<ul>
<li>菲涅尔项和实际的不太匹配</li>
</ul>
</li>
<li>测量方法</li>
</ul>
<img src="07/1616398969252.png" style="zoom:50%;" />

<ul>
<li>算法</li>
</ul>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">foreach outgoing direction wo</span><br><span class="line">    move light to illuminate surface with a thin beam from wo</span><br><span class="line">    for each incoming direction wi</span><br><span class="line">        move sensor to be at direction wi from surface</span><br><span class="line">    measure incident radiance</span><br></pre></td></tr></table></figure>

<ul>
<li>降低复杂度<ul>
<li>各向同性：4D $\to$ 3D</li>
<li>可逆性：减少一半</li>
</ul>
</li>
<li>挑战<ul>
<li>Accurate measurements at grazing angles<ul>
<li>Important due to Fresnel effects</li>
</ul>
</li>
<li>Measuring with dense enough sampling to capture high frequency specularities</li>
<li>Retro-reflection</li>
<li>Spatially-varying reflectance, …</li>
</ul>
</li>
</ul>
<h2 id="BRDF-的存储"><a href="#BRDF-的存储" class="headerlink" title="BRDF 的存储"></a>BRDF 的存储</h2><h3 id="存储要求"><a href="#存储要求" class="headerlink" title="存储要求"></a>存储要求</h3><ul>
<li>Compact representation</li>
<li>Accurate representation of measured data</li>
<li>Efficient evaluation for arbitrary pairs of directions</li>
<li>Good distributions available for importance sampling</li>
</ul>
<h3 id="Tabular-Representation"><a href="#Tabular-Representation" class="headerlink" title="Tabular Representation"></a>Tabular Representation</h3><ul>
<li>BRDF 库</li>
<li>最早都是各向同性的</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/21/CG/YLQ-GAMES101/07/" data-id="cl9lj74a200a564tzcynygevu" data-title="GAMES101.闫令琪.07.材质与外观(Lecture 17)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/Papers/2020/PathCuts" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/20/CG/Papers/2020/PathCuts/" class="article-date">
  <time class="dt-published" datetime="2021-03-20T04:14:32.000Z" itemprop="datePublished">2021-03-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-Paper/">CG.Paper</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/20/CG/Papers/2020/PathCuts/">(论文)[2020] Path Cuts, Efficient Rendering of Pure Specular Light Transport</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Path-Cuts-Efficient-Rendering-of-Pure-Specular-Light-Transport"><a href="#Path-Cuts-Efficient-Rendering-of-Pure-Specular-Light-Transport" class="headerlink" title="Path Cuts: Efficient Rendering of Pure Specular Light Transport"></a>Path Cuts: Efficient Rendering of Pure Specular Light Transport</h1><h2 id="Key-Words"><a href="#Key-Words" class="headerlink" title="Key Words"></a>Key Words</h2><ul>
<li>点光源，针孔摄像机，pure specular，multi-bounce，path-space</li>
<li>reflections and refractions<ul>
<li>反射和折射</li>
</ul>
</li>
</ul>
<h2 id="1-Introduction"><a href="#1-Introduction" class="headerlink" title="1. Introduction"></a>1. Introduction</h2><ul>
<li>传统的渲染方法，<strong>蒙特卡洛方法</strong>找到一条从光源到相机的路径</li>
<li>none of them are able to find multi-bounce pure specular light paths from a point light to a pinhole camera</li>
<li>之前的方法<ul>
<li>初始化为一条不可接受的的路径（可能是不太正确的路径，但是很接近最终解）</li>
<li>根据求解器求解出一条正确的路径（牛顿法）</li>
<li>可以解决，但是有<strong>局部性问题</strong></li>
</ul>
</li>
<li>Walter’s method：全局的方法<ul>
<li>using a hierarchical data structure on top of meshes with interpolated normals, but only works for <strong>a single refraction</strong>.</li>
</ul>
</li>
<li>论文的方法<ul>
<li>we enumerate the discrete set of admissible pure specular paths of <strong>a given length</strong> and <strong>type</strong><br>  connecting the light and the camera. We <strong>globally</strong> slice the path space into small regions</li>
<li>within a region we solve the <strong>local</strong> problem of refining the path to become admissible</li>
</ul>
</li>
<li>解决的问题<ul>
<li>We use a path space hierarchy combined with interval arithmetic bounds to efficiently prune non-contributing regions of path space, and to slice the path space into regions small enough that local refinement becomes feasible.<ul>
<li>路径空间划分，剪枝，每个小区域求局部解</li>
</ul>
</li>
<li>We use an automatic differentiation tool and a Newton-based solver to find an admissible specular path within a given path space region, and splat its contribution onto the image plane.<ul>
<li>自动微分工具，基于牛顿法的求解器</li>
<li>给定一个区域内的求解，然后在全局上加入它的贡献</li>
</ul>
</li>
<li>We show that our purely specular solution can be used to initialize paths for other algorithms, such as an MCMC-based approach to render with small but non-zero roughness.<ul>
<li>论文算法的到的路径可以用于其他算法初始值的设定</li>
</ul>
</li>
</ul>
</li>
<li>评价<ul>
<li>ours is the <strong>first</strong> approach to directly focus on multi-bounce purely specular paths on <strong>complex geometric surfaces given by triangle meshes</strong> with interpolated normals.</li>
</ul>
</li>
</ul>
<h2 id="2-相关工作"><a href="#2-相关工作" class="headerlink" title="2. 相关工作"></a>2. 相关工作</h2><ul>
<li>费马原理，牛顿法求解中间结点<ul>
<li>优化问题，最大化&#x2F;最小化长度</li>
</ul>
</li>
<li>Walter<ul>
<li>费马定理在现实场景中不太使用（图元的不同法线、几何）</li>
<li>the admissible paths are simply the ones whose vertices align the normal vector with the (refractive) half vector.</li>
<li>limited to a <strong>single</strong> refractive surface event<ul>
<li>不容易扩展到 k-bounce</li>
</ul>
</li>
</ul>
</li>
<li>Markov chain Monte Carlo<ul>
<li>this method does not work for pure specular paths</li>
<li>and requires the Markov chain light transport setting to be applicable.</li>
</ul>
</li>
<li>Manifold next event estimation (MNEE)<ul>
<li>the method can connect any shading point on a non-specular surface, through one or more refractions, to a light source sample.</li>
<li>没有全局搜索</li>
<li>存在局部性问题，多解则不能很好工作</li>
</ul>
</li>
<li>half vector space light transport (HSLT)<ul>
<li>a path is represented by its start and end point constraints and a sequence of generalized half vectors</li>
<li>HSLT does not require a specular&#x2F;non-specular classification of the path vertices</li>
</ul>
</li>
<li>最近的工作<ul>
<li>Recently, concurrent work by Zeltner et al. [2020] presented a specular manifold sampling technique, which is able to handle <strong>glints</strong>, <strong>reflective&#x2F;refractive caustics</strong>, and <strong>specular-diffuse-specular light transport</strong></li>
<li>解决闪烁，焦散问题</li>
</ul>
</li>
<li><strong>Interval arithmetic</strong></li>
<li><strong>Glint rendering methods</strong></li>
<li><strong>Lightcuts</strong><ul>
<li>虚拟光源</li>
<li>层次结构</li>
</ul>
</li>
<li>Inspired by the idea of lightcuts, we propose path cuts to organize all the triangles, <strong>whether geometric or tessellated from bump&#x2F;normal maps</strong>, into a <strong>hierarchy</strong>.</li>
<li>We use the path cuts to efficiently prune non-contributing areas of the path space; i.e. regions where the alignment of the normal and half vectors is guaranteed to be impossible.</li>
</ul>
<h2 id="3-PATH-SPACE-TRAVERSAL-USING-PATH-CUTS"><a href="#3-PATH-SPACE-TRAVERSAL-USING-PATH-CUTS" class="headerlink" title="3. PATH SPACE TRAVERSAL USING PATH CUTS"></a>3. PATH SPACE TRAVERSAL USING PATH CUTS</h2><ul>
<li>For each number of <strong>bounces k</strong> the problem needs to be solved independently</li>
<li>different <strong>path types</strong> of a given length are themselves independent.</li>
</ul>
<h3 id="基本量"><a href="#基本量" class="headerlink" title="基本量"></a>基本量</h3><ul>
<li>k-bounces<ul>
<li>path vertices：k+2<ul>
<li>light（L），k-bounces，pinhole camera（E）</li>
</ul>
</li>
<li>k+1 segments</li>
</ul>
</li>
<li>bounce point：$x_i$</li>
<li>场景由 n 个带有插值法线的<strong>三角形</strong>组成 $T_i$</li>
<li>scene surface：$\mathcal{M}$</li>
</ul>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ul>
<li>Our idea is to first isolate all k-tuples of triangles that could give rise to an admissible path, then find those paths within the k-tuple using a root solver. In this section, we focus on the first part, finding potentially contributing k-tuples of triangles.</li>
<li>then find those paths within the k-tuple using a root solver.</li>
<li>In this section, we focus on the first part, finding potentially contributing k-tuples of triangles.</li>
</ul>
<h3 id="3-1-Path-cuts-for-hierarchical-pruning"><a href="#3-1-Path-cuts-for-hierarchical-pruning" class="headerlink" title="3.1 Path cuts for hierarchical pruning"></a>3.1 Path cuts for hierarchical pruning</h3><ul>
<li>brute-force：暴搜<ul>
<li>$O(n^k)$</li>
</ul>
</li>
<li>树层次结构 tree hierarchy $\mathcal{H}$<ul>
<li>Each node $S_i\in\mathcal{H}$  represents a surface <strong>patch</strong> on $\mathcal{M}$, and records the 3D interval (bounding box) $N_i$ of all surface normals and the 3D interval (bounding box) $P_i$ of all surface positions in this patch.</li>
<li><strong>Note that this “root” path cut is for the entire image, as our method is independent of pixels.</strong></li>
</ul>
</li>
<li>找路径时考虑 $\mathcal{H^k}&#x3D;\mathcal{H}\times\mathcal{H}\times\cdots\times\mathcal{H}$</li>
<li>假使我们选中了 $(S_{j_1},\cdots,S_{j_K})\in\mathcal{H^k}$</li>
<li>“thick path”<ul>
<li>the set of all paths from the light to the camera whose vertices are within the corresponding nodes</li>
<li>恰好在上面的结点中</li>
</ul>
</li>
</ul>
<p>$$<br>L\to(x_1\in S_{j_1})\to(x_2\in S_{j_2})\to\cdots\to(x_k\in S_{j_k})\to E<br>$$</p>
<ul>
<li><strong>We denote such a “thick path” as a path cut, in analogy to multidimensional lightcuts.</strong></li>
</ul>
<h4 id="Insight"><a href="#Insight" class="headerlink" title="Insight"></a>Insight</h4><ul>
<li>if we can quickly determine whether a path cut potentially contains an admissible specular path, we can use this information to prune the path space to quickly converge to contributing paths.</li>
<li>怎么判断 path cut 是否含有一个可接受的结果（specular path）？</li>
<li>conservative（保守）<ul>
<li>existence of one or more admissible paths has to be always correctly detected.</li>
<li>The reverse need not be true: if we cannot prove non-existence, we can always subdivide the path cut.</li>
</ul>
</li>
</ul>
<h3 id="3-2-Validating-a-path-cut"><a href="#3-2-Validating-a-path-cut" class="headerlink" title="3.2 Validating a path cut"></a>3.2 Validating a path cut</h3><ul>
<li><p>a pure specular path is admissible</p>
<ul>
<li>at each surface bounce, the normal vector is aligned with the (reflective or refractive) half vector.</li>
</ul>
</li>
<li><p>test locally</p>
</li>
</ul>
<img src="PathCuts/1616258430770.png" style="zoom: 80%;" />

<ul>
<li><strong>interval arithmetic</strong>：区间算术</li>
<li>对于层次结构中的结点 $S_i$ 做<strong>包围盒</strong>（AABB）<ul>
<li>$P_i$ ：$S_i$ 中点的位置</li>
<li>$N_i$：$S_i$ 中法线的位置</li>
</ul>
</li>
<li>所有可能的从 $S_{i-1}$ 到 $S_i$ 的入射方向、出射方向<ul>
<li>$D_{in}^i&#x3D;normalize(P_{i-1} −P_i)$</li>
<li>$D_{out}^i&#x3D;-D_{in}^{i+1}&#x3D;normalize(P_{i+1}−P_i)$</li>
</ul>
</li>
<li>half vector<ul>
<li>$H_i&#x3D;normalize(D_{out}^i+D_{in}^i)$</li>
</ul>
</li>
<li>判断 $H_i\bigcap N_i$ 是否为空，即可判断是否存在法线和半角矢量对齐（相等）</li>
<li>对每一次 bounce 做上面的判断，如果存在一个 $i$ 使得 $H_i\bigcap N_i$ 为空，那么不可能产生一条可行的光路<ul>
<li>剪枝 prun</li>
</ul>
</li>
</ul>
<h3 id="3-3-Subdividing-a-path-cut"><a href="#3-3-Subdividing-a-path-cut" class="headerlink" title="3.3 Subdividing a path cut"></a>3.3 Subdividing a path cut</h3><ul>
<li>Once we know that a path cut has potential to contribute a pure specular path, we subdivide this path cut.<ul>
<li>如果一条 path cut 有可能产生纯反射光路，则对其进行细分</li>
</ul>
</li>
</ul>
<h4 id="细分方式"><a href="#细分方式" class="headerlink" title="细分方式"></a>细分方式</h4><p>（1）简单的细分</p>
<ul>
<li>把所有的非叶子结点都展开</li>
<li>复杂度变回去了，很高</li>
</ul>
<p>（2）随机选择一个非叶子结点进行展开</p>
<p>（3）展开最大的结点</p>
<ul>
<li>largest bounding box</li>
<li><strong>确实很直观</strong></li>
</ul>
<p>（4）展开 $H_i\bigcap N_i$ 区间最大的结点</p>
<ul>
<li>实验验证效果不好，能够看见比方法（3）更多的结点</li>
</ul>
<h4 id="细分结束"><a href="#细分结束" class="headerlink" title="细分结束"></a>细分结束</h4><ul>
<li>As we repeat the subdivision process, finally we will end up with path cuts that consist of <strong>only leaf nodes</strong>, i.e. <strong>one triangle per bounce</strong>.</li>
</ul>
<h4 id="一个细分的问题"><a href="#一个细分的问题" class="headerlink" title="一个细分的问题"></a>一个细分的问题</h4><ul>
<li><span style="color:red;font-weight:bold">怎么处理细分，结点数变化怎么处理，分成两条 path cut 吗？</span><ul>
<li>感觉确实没问题，复杂度也不高，只需要检查当前展开的结点和两边结点的连接关系即可</li>
</ul>
</li>
</ul>
<h2 id="4-SOLVING-FOR-A-SPECULAR-LIGHT-PATH"><a href="#4-SOLVING-FOR-A-SPECULAR-LIGHT-PATH" class="headerlink" title="4. SOLVING FOR A SPECULAR LIGHT PATH"></a>4. SOLVING FOR A SPECULAR LIGHT PATH</h2><ul>
<li>现在的结果是找到了一条 path cut，每个结点都是三角形</li>
</ul>
<p>$$<br>L\to(x_1\in T_1)\to(x_2\in T_2)\to\cdots\to(x_k\in T_k)\to E<br>$$</p>
<ul>
<li>现在的问题<ul>
<li>find its <strong>contribution</strong> to the image plane</li>
<li>也就是说找到光路</li>
</ul>
</li>
</ul>
<h3 id="4-1-Finding-an-admissible-path"><a href="#4-1-Finding-an-admissible-path" class="headerlink" title="4.1 Finding an admissible path"></a>4.1 Finding an admissible path</h3><ul>
<li>Finding such a light path is trivial <strong>if the triangles are flat mirrors</strong> (i.e. they <strong>do not have interpolated shading normals</strong> distinct from the geometric normal).<ul>
<li>We just need to repeatedly take the virtual image of the point light across the plane containing $T_i$ and finally connect it to the camera.</li>
<li>把光源 $L$ 做 $T_1$ 的虚像得到 $I_1$，然后把 $I_1$ 做 $T_2$ 的虚像得到 $I_2$，重复这个过程得到 $I_K$，连接 $I_K$ 和 $E$ 即可得到光路</li>
<li><strong>平面镜成像原理</strong></li>
</ul>
</li>
<li>However, this does not cover common situations with <strong>refractions</strong> and <strong>normal interpolation</strong> (curvature).<ul>
<li>curvature：曲率</li>
</ul>
</li>
<li>In the general case, we need to find the vertex locations using a <strong>root solver</strong>.</li>
<li>使用重心坐标系 $\alpha_i,\beta_i,\gamma_i$<ul>
<li>$\alpha_i+\beta_i+\gamma_i&#x3D;1$</li>
</ul>
</li>
<li>知道了 $\alpha_i,\beta_i$ 可以通过三个顶点插值出法线 $n_i(\alpha_i,\beta_i)$ 和顶点的位置 $x_i(\alpha_i,\beta_i)$</li>
<li>继而可以求出入射光线的方向 $normalize(x_{i-1}-x_i)$，入射光线的方向 $normalize(x_{i+1}-x_i)$</li>
<li>接着求出半角矢量 $h_i(\alpha_i,\beta_i)$<ul>
<li><span style="color:red;font-weight:bold">感觉不太对，应该是下面这个，但是不影响</span><ul>
<li>${\color{red}h_i(\alpha_i,\beta_i,\alpha_{i-1},\beta_{i-1},\alpha_{i+1},\beta_{i+1})}$</li>
</ul>
</li>
<li>半角矢量可以应用在<strong>反射</strong>和<strong>折射</strong>上面</li>
</ul>
</li>
<li>按照惯例，我们假设法线和半角矢量指向折射率较低的介质（一般但不一定是空气）</li>
<li>约束条件：逐渐缩小如下值（希望相等）<ul>
<li>$C_i(\alpha_i,\beta_i)&#x3D;\mathrm{n}_i(\alpha_i,\beta_i)-\mathrm{h}_i(\alpha_i,\beta_i)$</li>
</ul>
</li>
<li>在三角形内部<ul>
<li>$\alpha_i\ge0,\beta_i\ge0,\alpha_i+\beta_i\le1$</li>
</ul>
</li>
<li>整条路径的限制条件</li>
</ul>
<p>$$<br>C(\alpha_1,\beta_1,\cdots,\alpha_k,\beta_k)&#x3D;(C_1,C_2,\cdots,C_k)<br>$$</p>
<ul>
<li>the constraint function has 2k variables and 3k output values.<ul>
<li>An alternative with 2k output values can be defined by projecting the normals and half vectors into the local geometric space, and dropping their 𝑧 coordinates. We found this alternative formulation gives equivalent results and is slightly slower due to the extra vector transformations.</li>
</ul>
</li>
<li><strong>Newton iteration</strong><ul>
<li>This requires solving a 3k × 2k linear system, in the least-squares sense, at each iteration.</li>
<li>限制迭代次数<ul>
<li>We bound the maximum number of iterations to 5.</li>
<li>If after reaching the maximum terations, the resulting vertices are not all within their respective triangles, we assume there is no solution.</li>
</ul>
</li>
<li>求解出来之后，我们对相邻的两个三角形做<strong>可见性测试</strong><ul>
<li>The visibility test can be skipped for objects known to be convex.</li>
<li><span style="color:red;font-weight:bold">为什么不需要</span></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="4-2-The-contribution-of-an-admissible-path"><a href="#4-2-The-contribution-of-an-admissible-path" class="headerlink" title="4.2 The contribution of an admissible path"></a>4.2 The contribution of an admissible path</h3><ul>
<li>影响强度的因素<ul>
<li>The contribution of the path to the image consists of the product of several terms:<ul>
<li>visibility (already handled above)</li>
<li>light intensity</li>
<li>the product of Fresnel terms along the path</li>
<li>volumetric absorption</li>
<li><strong>the generalized geometry term</strong></li>
<li><strong>and the pixel importance function value</strong></li>
</ul>
</li>
</ul>
</li>
<li>这里只考虑最后两个因素（其他不需要在这里讨论）</li>
<li>precisely define our camera model as a <strong>pinhole camera</strong>, with <strong>a sensor plane</strong> at a distance of <strong>1 world unit</strong> from the camera position (pinhole)</li>
<li><strong>For the purposes of the explanation below, the camera endpoint P of the path is thus on the sensor, not on the pinhole C itself.</strong></li>
</ul>
<h4 id="Pixel-importance-function-value"><a href="#Pixel-importance-function-value" class="headerlink" title="Pixel importance function value"></a>Pixel importance function value</h4><ul>
<li>Consider a ray $(P,\omega)$ leaving the sensor point $P$ in direction $\omega &#x3D; normalize(C-P)$</li>
<li>$W_{ij}(P,\omega)$</li>
<li>We will need to include the corresponding $W_{ij}$ in the path contribution</li>
<li>$W_{ij}$ 对谁归一化（和为1）<ul>
<li>These units <strong>cannot</strong> be <strong>pixels</strong>, otherwise the brightness of specular contributions would change with image resolution.</li>
<li>Instead, we find that the normalization has to be with respect to real world units, on the image sensor <strong>at a distance of 1 unit from C</strong>.</li>
</ul>
</li>
<li>if the horizontal field-of- view is $\theta$ and the aspect ratio (height&#x2F;width) is $r$ , the area of the image plane in world units is $A$<ul>
<li>$A&#x3D;4r\tan^2(\dfrac{\theta}{2})$</li>
</ul>
</li>
<li>归一化<ul>
<li>$W_{ij}(P,\omega)&#x3D;\dfrac{K_{ij}mn}{A}$<ul>
<li>像素分辨率 $m\times n$</li>
</ul>
</li>
<li>Here we first define $K_{ij}$ to be the pixel reconstruction filter normalized in pixel units,</li>
<li>and then include the additional factor of $\dfrac{mn}{A}$ to make $W_{ij}$ normalized in world units.</li>
</ul>
</li>
<li>图形学渲染：radiance meter<ul>
<li>brightness to change with image resolution</li>
</ul>
</li>
<li>实际的摄像机：photon counter<ul>
<li>brightness to change with image resolution</li>
</ul>
</li>
</ul>
<h4 id="Generalized-geometry-term-GGT"><a href="#Generalized-geometry-term-GGT" class="headerlink" title="Generalized geometry term(GGT)"></a>Generalized geometry term(GGT)</h4><ul>
<li><span style="color:red;font-weight:bold">这部分暂时没啥看懂</span></li>
<li>“intensity” or “distance correction factor”</li>
<li>Consider the ray propagation function $F:\mathbb{R^2}\to\mathbb{R^2}$ that maps a neighborhood of the camera sensor point $P$ through the admissible specular path $\bar{x}$ to the imaginary plane crossing the point light position, orthogonal to the last path segment. The GGT is the value</li>
</ul>
<p>$$<br>G(\bar{x})&#x3D;\dfrac{1}{|\det J_F(P)|}<br>$$</p>
<ul>
<li>We initialize position differentials $P_x$ and $P_y$ of unit length on the camera sensor plane, and trace them along the specular path to the imaginary plane crossing the point light position, orthogonal to the last path segment, finding the final position differentials $L_x$ and $L_y$. Finally, we can compute the GGT as</li>
</ul>
<p>$$<br>G(\bar{x})&#x3D;\dfrac{1}{|L_x\times L_y|}<br>$$</p>
<ul>
<li>$|L_x\times L_y|$ 很小，结果不真实<ul>
<li>$|L_x\times L_y|\approx||L_x||\cdot||L_y||\cdot\max{\epsilon,|normalize(L_y)\times normalize(L_y)|),}$</li>
<li>A value of $\epsilon &#x3D; 0.01$ works well in general.</li>
<li>We observe that this regularization solves the issue of occasional very bright glints, while not affecting the remaining glints.</li>
</ul>
</li>
</ul>
<h3 id="4-3-Multiple-solutions"><a href="#4-3-Multiple-solutions" class="headerlink" title="4.3 Multiple solutions"></a>4.3 Multiple solutions</h3><ul>
<li>解可能不止一个<ul>
<li>虽然我们实验上都是得到一个解，但是这不一定理论正确</li>
</ul>
</li>
</ul>
<h4 id="Finding-all-discrete-solutions"><a href="#Finding-all-discrete-solutions" class="headerlink" title="Finding all discrete solutions"></a>Finding all discrete solutions</h4><ul>
<li>问题<ul>
<li>Even if a single solution exists, standard Newton’s method still does not theoretically guarantee that the solution will be found.<ul>
<li>一个解但是没找到</li>
</ul>
</li>
<li>Furthermore, there is a possibility of multiple discrete solutions<ul>
<li>多个解</li>
</ul>
</li>
</ul>
</li>
<li>Both of these issues can be theoretically handled with the interval version of Newton’s method, as suggested by Mitchell and Hanrahan [1992] and Walter [2009].</li>
<li>我们实验发现差不多<ul>
<li>可能的解释</li>
<li>our meshes already subdivided to small enough triangles, so multiple solutions within a single triangle do not frequently occur in practice</li>
</ul>
</li>
</ul>
<h4 id="Infinite-solution-regions"><a href="#Infinite-solution-regions" class="headerlink" title="Infinite solution regions"></a>Infinite solution regions</h4><ul>
<li>圆柱体，内部纯反射，光源和针孔摄像机放置在两头，中间的圆给出无穷多个解<ul>
<li>无法求解</li>
<li>法线并非插值得到</li>
</ul>
</li>
<li>只能求解三角形，而且内部的法线是由插值得到的图形</li>
</ul>
<h2 id="7-CONCLUSION-AND-FUTURE-WORK"><a href="#7-CONCLUSION-AND-FUTURE-WORK" class="headerlink" title="7. CONCLUSION AND FUTURE WORK"></a>7. CONCLUSION AND FUTURE WORK</h2><ul>
<li>We use a path space hierarchy combined with interval arithmetic bounds to efficiently prune non-contributing regions of path space, and to slice the path space into small region where the search problem becomes local. Finally, we isolate admissible specular paths by a Newton solver applied to a constraint function, whose gradients are computed by automatic differentiation.We discuss in detail how such discovered paths should contribute to the image plane.</li>
</ul>
<h1 id="作者报告"><a href="#作者报告" class="headerlink" title="作者报告"></a>作者报告</h1><ul>
<li>视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1Mi4y1N7Np">https://www.bilibili.com/video/BV1Mi4y1N7Np</a></li>
<li>南京理工大学 王贝贝</li>
<li>GAMES 链接：<a target="_blank" rel="noopener" href="http://games-cn.org/games-webinar-20210401-177/">http://games-cn.org/games-webinar-20210401-177/</a></li>
<li>代码：<a target="_blank" rel="noopener" href="https://github.com/wangningbei/mbglints">https://github.com/wangningbei/mbglints</a></li>
</ul>
<h2 id="notes"><a href="#notes" class="headerlink" title="notes"></a>notes</h2><ul>
<li><p>现有的方法解决不能解决问题</p>
<ul>
<li>BDPT：很难在交汇处实现完美的镜面反射。折射</li>
<li>MLT：思路是在一开始的种子路径上，使用小的偏移找到新的路径<ul>
<li>一开始的种子路径很难找到</li>
</ul>
</li>
</ul>
</li>
<li><p>论文的方法是确定性的结果，是没有噪声的</p>
</li>
<li><p>我们的方法可以作为 MLT 的种子路径</p>
</li>
<li><p>只能支持点光源</p>
</li>
<li><p>展示是基于 CPU</p>
</li>
</ul>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li>bounce 比较多的时候，搜索代价变大<ul>
<li>论文最多 4-bounces</li>
</ul>
</li>
<li>牛顿法不能求出所有解<ul>
<li>区间牛顿法可以，但是代价大</li>
<li>划分区间，用一个条件判断使得否只有唯一解，如果只有唯一解，利用牛顿法求解，否则继续细分</li>
</ul>
</li>
<li>AABB 包围盒比较松，在做法线和半角矢量是否有交判断中比较松（不能提前排除无解可能性）</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/20/CG/Papers/2020/PathCuts/" data-id="cl9lj74e001bb64tzblvgb5ar" data-title="(论文)[2020] Path Cuts, Efficient Rendering of Pure Specular Light Transport" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES101/06" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/18/CG/YLQ-GAMES101/06/" class="article-date">
  <time class="dt-published" datetime="2021-03-18T07:25:18.000Z" itemprop="datePublished">2021-03-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES101/">CG.GAMES101</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/18/CG/YLQ-GAMES101/06/">GAMES101.闫令琪.06.光线追踪(3).蒙特卡洛路径追踪(Lecture 15-16)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90798049">https://www.bilibili.com/video/av90798049</a></li>
</ul>
<h1 id="概率论回顾"><a href="#概率论回顾" class="headerlink" title="概率论回顾"></a>概率论回顾</h1><ul>
<li>随机变量 $X$</li>
</ul>
<h2 id="离散"><a href="#离散" class="headerlink" title="离散"></a>离散</h2><ul>
<li>概率分布函数 $X \sim p(x)$<ul>
<li>Probability Density Function (PDF)</li>
</ul>
</li>
<li>性质<ul>
<li>$p_i\ge0$</li>
<li>$\sum_{i&#x3D;1}^np_i&#x3D;1$</li>
</ul>
</li>
<li>期望 $E(X)$<ul>
<li>$E[X]&#x3D;\sum_{i&#x3D;1}^{n} x_{i} p_{i}$</li>
</ul>
</li>
</ul>
<h2 id="连续"><a href="#连续" class="headerlink" title="连续"></a>连续</h2><ul>
<li>概率密度函数 $X \sim p(x)$<ul>
<li>Probability Distribution Function (PDF)</li>
</ul>
</li>
<li>某一个 $x$ 对应的微元对应的概率  $p(x)dx$<ul>
<li>长条面积</li>
</ul>
</li>
<li>性质<ul>
<li>$p(x)\ge0$</li>
<li>$\int p(x)dx&#x3D;1$</li>
</ul>
</li>
<li>期望<ul>
<li>$E[X]&#x3D;\int x p(x) d x$</li>
</ul>
</li>
</ul>
<h2 id="随机变量的函数"><a href="#随机变量的函数" class="headerlink" title="随机变量的函数"></a>随机变量的函数</h2><ul>
<li>如果某个随机变量 $Y$ 是随机变量 $X$ 的函数<ul>
<li>$Y&#x3D;f(X)$</li>
</ul>
</li>
<li>期望的关系<ul>
<li>$E[Y]&#x3D;E[f(X)]&#x3D;\int f(x)p(x)dx$</li>
</ul>
</li>
</ul>
<h1 id="蒙特卡洛积分"><a href="#蒙特卡洛积分" class="headerlink" title="蒙特卡洛积分"></a>蒙特卡洛积分</h1><ul>
<li>Monte Carlo Integration</li>
<li>用于求定积分<ul>
<li>数值形式是比较难求的定积分</li>
</ul>
</li>
<li>黎曼积分：划分为若干段，每段围成的小矩形之和（极限）</li>
</ul>
<h2 id="Monte-Carlo-积分"><a href="#Monte-Carlo-积分" class="headerlink" title="Monte Carlo 积分"></a>Monte Carlo 积分</h2><ul>
<li>定积分 $\int_a^bf(x)dx$</li>
<li>随机变量 $X_i\sim p(x)$</li>
<li>蒙特卡洛积分 $F_{N}&#x3D;\dfrac{1}{N} \sum_{i&#x3D;1}^{N} \dfrac{f(X_{i})}{p(X_{i})}$</li>
</ul>
<h2 id="例子：均匀分布"><a href="#例子：均匀分布" class="headerlink" title="例子：均匀分布"></a>例子：均匀分布</h2><ul>
<li>$X_i\sim p(x)&#x3D;C$<ul>
<li>$\int_a^bCdx&#x3D;C(b-a)&#x3D;1$</li>
<li>$C&#x3D;\dfrac{1}{b-a}$</li>
</ul>
</li>
<li>$F_N&#x3D;\dfrac{b-a}{N} \sum_{i&#x3D;1}^{N}f(X_{i})$</li>
</ul>
<h2 id="性质"><a href="#性质" class="headerlink" title="性质"></a>性质</h2><ul>
<li>样本越多，越准确<ul>
<li>The more samples, the less variance.</li>
</ul>
</li>
<li>对 x 采样，只能对 x 做积分<ul>
<li>Sample on x, integrate on x.</li>
</ul>
</li>
</ul>
<h1 id="Path-Tracing"><a href="#Path-Tracing" class="headerlink" title="Path Tracing"></a>Path Tracing</h1><h2 id="Whitted-Style-Ray-Tracing"><a href="#Whitted-Style-Ray-Tracing" class="headerlink" title="Whitted-Style Ray Tracing"></a>Whitted-Style Ray Tracing</h2><ul>
<li>具体运作<ul>
<li>Always perform <strong>specular</strong> reflections &#x2F; refractions</li>
<li><strong>Stop</strong> bouncing at <strong>diffuse</strong> surfaces</li>
</ul>
</li>
</ul>
<h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul>
<li>不能很好的模拟 <strong>Glossy</strong>（金属，类似磨砂的感觉） 材质的物体</li>
<li>能产生高光，但是又有点糊，没有那么光滑</li>
<li>The Utah Teapot（经典模型）</li>
</ul>
<img src="06/1616057889780.png" style="zoom:50%;" />

<ul>
<li>漫反射物体之间的反射光无法模拟<ul>
<li><strong>Color Bleeding</strong> 效果<ul>
<li>右图中盒子的侧面产生红色 &#x2F; 绿色的效果</li>
</ul>
</li>
</ul>
</li>
<li>The Cornell Box（经典模型）<ul>
<li>广泛用于测试全局光照</li>
</ul>
</li>
</ul>
<img src="06/1616058100814.png" style="zoom:50%;" />



<h2 id="路径追踪"><a href="#路径追踪" class="headerlink" title="路径追踪"></a>路径追踪</h2><ul>
<li>基于渲染方程</li>
</ul>
<p>$$<br>L_{o}(p, \omega_{o})&#x3D;L_{e}(p, \omega_{o})+\int_{\Omega^{+}} L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})(n \cdot \omega_{i}) d \omega_{i}<br>$$</p>
<ul>
<li>问题<ul>
<li>积分：蒙特卡洛方法求解</li>
<li>递归定义</li>
</ul>
</li>
</ul>
<h2 id="简单的蒙特卡洛方法求积分"><a href="#简单的蒙特卡洛方法求积分" class="headerlink" title="简单的蒙特卡洛方法求积分"></a>简单的蒙特卡洛方法求积分</h2><ul>
<li>忽略发光项</li>
</ul>
<p>$$<br>L_{o}(p, \omega_{o})&#x3D;\int_{\Omega^{+}} L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})(n \cdot \omega_{i}) d \omega_{i}<br>$$</p>
<ul>
<li>待求的就是上面的方程</li>
<li>蒙特卡洛积分方程</li>
</ul>
<p>$$<br>\int_a^bf(x)dx\approx\dfrac{1}{N} \sum_{i&#x3D;1}^{N} \dfrac{f(X_{i})}{p(X_{i})},X_k\sim p(x)<br>$$</p>
<p>$$<br>f(x)&#x3D; L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})(n \cdot \omega_{i}) d \omega_{i}<br>$$</p>
<ul>
<li>简单的 PDF<ul>
<li>半球立体为 $2\pi$</li>
</ul>
</li>
</ul>
<p>$$<br>p(\omega_i)&#x3D;\dfrac{1}{2\pi}<br>$$</p>
<ul>
<li>积分方程</li>
</ul>
<p>$$<br>L_{o}(p, \omega_{o})\approx\dfrac{2\pi}{N} \sum_{i&#x3D;1}^{N} L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})(n \cdot \omega_{i}) d \omega_{i}<br>$$</p>
<ul>
<li>根据这个方程，那么就可以得出一个算法<ul>
<li>递归算法</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">shade(p, wo):</span><br><span class="line">    Randomly choose N directions wi~pdf</span><br><span class="line">    Lo = <span class="number">0.0</span></span><br><span class="line">    For each wi:</span><br><span class="line">        Trace a ray r(p, wi)</span><br><span class="line">        <span class="comment"># 碰到光源, 直接光照</span></span><br><span class="line">        If ray r hit the light:</span><br><span class="line">            Lo += (<span class="number">1</span> / N) * L_i * f_r * cosine / pdf(wi)</span><br><span class="line">        <span class="comment"># 碰到物体, 间接光照</span></span><br><span class="line">        Else If ray r hit an <span class="built_in">object</span> at q:</span><br><span class="line">            Lo += (<span class="number">1</span> / N) * shade(q, -wi) * f_r * cosine/ pdf(wi)</span><br><span class="line">    <span class="keyword">return</span> Lo</span><br></pre></td></tr></table></figure>



<h3 id="问题1：指数爆炸"><a href="#问题1：指数爆炸" class="headerlink" title="问题1：指数爆炸"></a>问题1：指数爆炸</h3><ul>
<li>光线数量：$N^{bounces}$</li>
<li>$N&#x3D;1$ 则不会有问题：近似效果会变差</li>
<li>近似效果很差，noisy</li>
</ul>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><ul>
<li><strong>可以为同一个像素，多次发射光线</strong><ul>
<li>Trace <strong>more paths</strong> through each <strong>pixel</strong> and <strong>average</strong> their radiance!</li>
</ul>
</li>
</ul>
<img src="06/1616059764715.png" style="zoom:50%;" />

<ul>
<li>Ray Generation</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ray_generation(camPos, pixel):</span><br><span class="line">    Uniformly choose N sample positions within the pixel</span><br><span class="line">    pixel_radiance = <span class="number">0.0</span></span><br><span class="line">    For each sample <span class="keyword">in</span> the pixel:</span><br><span class="line">        Shoot a ray r(camPos, cam_to_sample)</span><br><span class="line">        If ray r hit the scene at p:</span><br><span class="line">            pixel_radiance += <span class="number">1</span> / N * shade(p, sample_to_cam)</span><br><span class="line">    <span class="keyword">return</span> pixel_radiance</span><br></pre></td></tr></table></figure>



<h3 id="问题2：停不下来"><a href="#问题2：停不下来" class="headerlink" title="问题2：停不下来"></a>问题2：停不下来</h3><ul>
<li>互相调用：概率是很小的</li>
<li>事先设置一个递归深度<ul>
<li>不行，之前的例子</li>
<li>玻璃灯，当设置的 bounces 比较小的时候，由于光线没有从玻璃外壳内出来，看不到里面的灯</li>
<li>能量损失了<ul>
<li>Cutting #bounces &#x3D;&#x3D; cutting energy!</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h4><ul>
<li>Russian Roulette（RR）<ul>
<li>俄罗斯轮盘赌</li>
</ul>
</li>
<li>一定的概率停止光线追踪<ul>
<li>概率 $p$ 发出一条光线，将得到的结果除以 $p$<ul>
<li>$\dfrac{L_o}{p}$</li>
</ul>
</li>
<li>概率 $1-p$ 不发出光线，得到结果 $0$</li>
<li>巧妙的一点：期望还是 $L_o$<ul>
<li>$E(X)&#x3D;p\times\dfrac{L_O}{p}+(1-p)*0&#x3D;L_O$</li>
</ul>
</li>
</ul>
</li>
<li>伪代码如下（$N&#x3D;1$）</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">shade(p, wo):</span><br><span class="line">    Manually specify a probability P_RR</span><br><span class="line">    Randomly select ksi <span class="keyword">in</span> a uniform dist. <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    If (ksi &gt; P_RR):</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    Randomly choose ONE direction wi~pdf(w)</span><br><span class="line">    Trace a ray r(p, wi)</span><br><span class="line">    If ray r hit the light:</span><br><span class="line">        <span class="keyword">return</span> L_i * f_r * cosine / pdf(wi) / P_RR</span><br><span class="line">    Else If ray r hit an <span class="built_in">object</span> at q:</span><br><span class="line">        <span class="keyword">return</span> shade(q, -wi) * f_r * cosine / pdf(wi) / P_RR</span><br></pre></td></tr></table></figure>

<ul>
<li>bounces 的期望</li>
</ul>
<p>$$<br>\sum_i^{\infty}i(p^{i})(1-p)&#x3D;\dfrac{p}{1-p}<br>$$</p>
<h3 id="问题3：SSP-小时效果不好"><a href="#问题3：SSP-小时效果不好" class="headerlink" title="问题3：SSP 小时效果不好"></a>问题3：SSP 小时效果不好</h3><ul>
<li>SSP：Samples Per Pixels</li>
<li>SSP 高的时候，运行很慢</li>
</ul>
<img src="06/1616060900428.png" style="zoom:50%;" />

<ul>
<li>光源比较小的时候，发射出较少的光线<strong>很难打到光源</strong></li>
</ul>
<h4 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h4><ul>
<li>修改 PDF</li>
<li>对光源采样</li>
</ul>
<h4 id="Sampling-to-the-light"><a href="#Sampling-to-the-light" class="headerlink" title="Sampling to the light"></a>Sampling to the light</h4><ul>
<li>对光源均匀采样</li>
<li>面光源面积为 A<ul>
<li>$PDF &#x3D; \dfrac{1}{A}$</li>
</ul>
</li>
<li>蒙特卡洛方法满足的条件：对谁积分，对谁采样<ul>
<li>把渲染方程写成对光源表面的积分</li>
<li>找出 $dA$ 和 $d\omega$ 的关系<ul>
<li>$dw&#x3D;\dfrac{dA\cos\theta’}{||x’-x||^2}$</li>
<li>向球面做投影</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="06/1616070852888.png" alt="1616070852888" style="zoom:50%;" />

<ul>
<li>重写渲染方程</li>
</ul>
<p>$$<br>\begin{aligned}<br>L_{o}(p, \omega_{o})&amp;&#x3D;\int_{\Omega^{+}} L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})(n \cdot \omega_{i}) d \omega_{i}\<br>&amp;&#x3D;\int_{A} L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})(n \cdot \omega_{i}) \dfrac{dA\cos\theta’}{||x’-x||^2}\<br>&amp;&#x3D;\int_{A} L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})\dfrac{\cos\theta\cos\theta’}{||x’-x||^2}dA\<br>\end{aligned}<br>$$</p>
<ul>
<li>我们将光照分为两个部分<ul>
<li><strong>light source</strong> (direct, no need to have RR)<ul>
<li>光源对这个点的共享</li>
</ul>
</li>
<li><strong>other reflectors</strong> (indirect, RR)<ul>
<li>所有其他非光源对这个点的贡献</li>
</ul>
</li>
</ul>
</li>
<li>伪代码</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">shade(p, wo):</span><br><span class="line">    <span class="comment"># Contribution from the light source.</span></span><br><span class="line">    <span class="comment"># 对光源采样</span></span><br><span class="line">    Uniformly sample the light at x’ (pdf_light = <span class="number">1</span> / A)</span><br><span class="line">    L_dir = L_i * f_r * cos θ * cos θ’ / |x’ - p|^<span class="number">2</span> / pdf_light</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Contribution from other reflectors.</span></span><br><span class="line">    <span class="comment"># 对其他物体采样</span></span><br><span class="line">    L_indir = <span class="number">0.0</span></span><br><span class="line">    <span class="comment"># 俄罗斯轮盘赌测试</span></span><br><span class="line">    Test Russian Roulette <span class="keyword">with</span> probability P_RR</span><br><span class="line">    Uniformly sample the hemisphere toward wi (pdf_hemi = <span class="number">1</span> / 2pi)</span><br><span class="line">    Trace a ray r(p, wi)</span><br><span class="line">    <span class="comment"># 得判断不是光源</span></span><br><span class="line">    If ray r hit a non-emitting <span class="built_in">object</span> at q:</span><br><span class="line">        L_indir = shade(q, -wi) * f_r * cos θ / pdf_hemi / P_RR</span><br><span class="line"></span><br><span class="line">    Return L_dir + L_indir</span><br></pre></td></tr></table></figure>

<ul>
<li>问题：如果光源和待求的点之间有物体<ul>
<li>采样点和待求的点之间打一条光线，判断是否会相交</li>
</ul>
</li>
<li><strong>点光源不好处理</strong><ul>
<li>做成一个很小的光源</li>
</ul>
</li>
</ul>
<h2 id="Path-Tracing-评价"><a href="#Path-Tracing-评价" class="headerlink" title="Path Tracing 评价"></a>Path Tracing 评价</h2><ul>
<li>Path tracing (PT) is indeed difficult<ul>
<li>Consider it the most challenging in undergrad CS</li>
<li>Why: physics, probability, calculus（微积分学）, coding</li>
<li>Learning PT will help you understand deeper in these</li>
</ul>
</li>
<li>Path Tracing 能够做到几乎 100% 真实<ul>
<li><span style="color:red;font-weight:bold">PHOTO-REALISTIC</span></li>
<li>照片级的真实感</li>
<li>例子：<a target="_blank" rel="noopener" href="http://www.graphics.cornell.edu/online/box/compare.html">http://www.graphics.cornell.edu/online/box/compare.html</a></li>
</ul>
</li>
</ul>
<h2 id="关于-Ray-Tracing-这个概念"><a href="#关于-Ray-Tracing-这个概念" class="headerlink" title="关于 Ray Tracing 这个概念"></a>关于 Ray Tracing 这个概念</h2><ul>
<li>Ray tracing: Previous vs. Modern Concept</li>
<li>以前<ul>
<li>一般指的就是 Whitted 风格的 Ray-Tracing</li>
</ul>
</li>
<li>现代<ul>
<li>所有关于光线传播方法的一个大集合</li>
<li>(Unidirectional &amp; bidirectional) path tracing</li>
<li>Photon mapping<ul>
<li>光子映射</li>
</ul>
</li>
<li>Metropolis light transport</li>
<li>VCM &#x2F; UPBP…</li>
</ul>
</li>
</ul>
<h2 id="未涵盖的话题"><a href="#未涵盖的话题" class="headerlink" title="未涵盖的话题"></a>未涵盖的话题</h2><ul>
<li>怎么样在半球上均匀的采样</li>
<li>给一个任何函数，怎么对它进行采样</li>
<li>对于蒙特卡洛采样方法，对于一个函数，怎么选择 PDF 使得最优<ul>
<li>重要性采样理论<ul>
<li>important sampling</li>
</ul>
</li>
<li>用随机数怎么样<ul>
<li>随机数有质量之分</li>
<li>好的随机数：均匀分布在空间内，随机数之间的距离也能控制得很好<ul>
<li>low discrepancy sequences</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>能不能把对光源和物体的采样结合起来<ul>
<li>可以，把不同的采样方法结合起来，使得效果不会比原来的任何一种方法差</li>
<li>MIS 采样理论</li>
<li>multiple imp. sampling</li>
</ul>
</li>
<li>对于同一个像素的不同 path，简单的做平均行不行，需不需要对靠近中心一点的 path 加一个更大的权<ul>
<li>pixel reconstruction filter</li>
</ul>
</li>
<li>最终计算出来的是一个 radiance，怎么转化为颜色<ul>
<li>gamma correction</li>
<li>color space</li>
<li>HDR（curve）</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/18/CG/YLQ-GAMES101/06/" data-id="cl9lj74a200a464tz01w2614t" data-title="GAMES101.闫令琪.06.光线追踪(3).蒙特卡洛路径追踪(Lecture 15-16)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GI/" rel="tag">GI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES101/05" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/17/CG/YLQ-GAMES101/05/" class="article-date">
  <time class="dt-published" datetime="2021-03-17T09:36:53.000Z" itemprop="datePublished">2021-03-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES101/">CG.GAMES101</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/17/CG/YLQ-GAMES101/05/">GAMES101.闫令琪.05.光线追踪(2).辐射度量学(Lecture 14-15)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90798049">https://www.bilibili.com/video/av90798049</a></li>
</ul>
<h1 id="辐射度量学"><a href="#辐射度量学" class="headerlink" title="辐射度量学"></a>辐射度量学</h1><ul>
<li>Basic Radiometry</li>
<li>Blinn-Phong 模型只是一个近似模型</li>
<li>辐射度量学是一个精确模型<ul>
<li>基于几何光学来做的</li>
<li>物理上的准确定义</li>
</ul>
</li>
<li>学习思路：WHY, WHAT, HOW</li>
<li>一些量的定义<ul>
<li>Radiant Energy，Flux(Power)</li>
<li>Radiant Intensity，Irradiance， Radiance</li>
</ul>
</li>
<li>图形学中很少用能量的概念，都是考虑功率较多<ul>
<li>能量则需要考虑时间</li>
<li>帧一般时间较短</li>
</ul>
</li>
</ul>
<h1 id="一些物理量的定义"><a href="#一些物理量的定义" class="headerlink" title="一些物理量的定义"></a>一些物理量的定义</h1><h2 id="Radiant-Energy"><a href="#Radiant-Energy" class="headerlink" title="Radiant Energy"></a>Radiant Energy</h2><ul>
<li>电磁辐射的<strong>能量</strong></li>
<li>Radiant energy is the energy of electromagnetic radiation. It is measured in units of joules, and denoted by the symbol:</li>
</ul>
<p>$$<br>Q\left[J&#x3D;Joule\right]<br>$$</p>
<h2 id="Radiant-Flux-x2F-Power"><a href="#Radiant-Flux-x2F-Power" class="headerlink" title="Radiant Flux &#x2F; Power"></a>Radiant Flux &#x2F; Power</h2><ul>
<li><strong>功率</strong></li>
<li>单位时间的能量</li>
<li>Radiant flux (power) is the <strong>energy</strong> emitted, reflected, transmitted or received, <strong>per unit time</strong>.</li>
</ul>
<p>$$<br>\Phi\equiv\dfrac{dQ}{dt}\left[W&#x3D;Watt\right]\left[lm&#x3D;lumen\right]<br>$$</p>
<ul>
<li>单位：瓦特<ul>
<li>光学中描述功率：<strong>流明</strong></li>
<li>灯泡多亮</li>
</ul>
</li>
<li>另外的定义<ul>
<li>Flux – #photons flowing through a sensor in unit time</li>
<li>单位时间通过的光子数量</li>
</ul>
</li>
</ul>
<h2 id="一些感兴趣的量"><a href="#一些感兴趣的量" class="headerlink" title="一些感兴趣的量"></a>一些感兴趣的量</h2><ul>
<li>Radiant Intensity，Irradiance， Radiance</li>
</ul>
<img src="05/1616037426480.png" style="zoom:50%;" />



<h2 id="Radiant-Intensity"><a href="#Radiant-Intensity" class="headerlink" title="Radiant Intensity"></a>Radiant Intensity</h2><ul>
<li>The radiant (luminous) intensity is the <strong>power</strong> <strong>per unit solid angle</strong> emitted by a point light source.</li>
<li>单位立体角的 power（flux）</li>
</ul>
<p>$$<br>I(\omega)\equiv\dfrac{d\Phi}{d\omega}\left[\dfrac{W}{sr}\right]\left[\dfrac{lm}{sr}&#x3D;cd&#x3D;candela\right]<br>$$</p>
<ul>
<li>sr：立体角的单位</li>
<li>The candela is one of the <strong>seven SI base units</strong>.<ul>
<li>坎德拉：基本单位之一</li>
</ul>
</li>
</ul>
<h3 id="立体角"><a href="#立体角" class="headerlink" title="立体角"></a>立体角</h3><ul>
<li>球面面积占球面表面积的比例 x 一个常数，二维弧度制的延伸</li>
<li>A：投影到球面上的面积</li>
</ul>
<p>$$<br>\Omega&#x3D;\dfrac{A}{r^2}<br>$$</p>
<ul>
<li>整个球的立体角：$4\pi$</li>
</ul>
<img src="05/1616037958039.png" style="zoom:50%;" />

<ul>
<li>微分立体角</li>
</ul>
<img src="05/1616038007273.png" style="zoom:50%;" />
$$
dA=r\sin\theta d\phi\cdot rd\theta=r^2\sin\theta d\theta d\phi
$$

<ul>
<li>此时立体角</li>
</ul>
<p>$$<br>d\omega&#x3D;\dfrac{dA}{r^2}&#x3D;\sin\theta d\theta d\phi<br>$$</p>
<ul>
<li>球的立体角</li>
</ul>
<p>$$<br>\Omega&#x3D;\int_{S^2}dw&#x3D;\int_0^{2\pi}\int_0^{\pi}\sin\theta d\theta d\phi&#x3D;4\pi<br>$$</p>
<ul>
<li>各向同性点光源<ul>
<li>Isotropic Point Source</li>
</ul>
</li>
</ul>
<p>$$<br>\Phi&#x3D;\int_{S^2}Id\omega&#x3D;4\pi I<br>$$</p>
<p>$$<br>I&#x3D;\dfrac{\Phi}{4\pi}<br>$$</p>
<ul>
<li>LED 灯：标识的多少瓦实际上表示和白炽灯相比等价于多少瓦<ul>
<li>标 60W 的 LED 灯实际开销只有 11W</li>
</ul>
</li>
</ul>
<h2 id="Irradiance"><a href="#Irradiance" class="headerlink" title="Irradiance"></a>Irradiance</h2><ul>
<li><strong>无方向性</strong></li>
<li>单位面积的 power</li>
<li>The irradiance is the <strong>power</strong> <strong>per unit area</strong> incident on a surface point</li>
</ul>
<p>$$<br>E(x)\equiv \dfrac{d\Phi(x)}{dA}\left[\dfrac{W}{m^2}\right]\left[\dfrac{lm}{m^2}&#x3D;lux\right]<br>$$</p>
<ul>
<li>光线不垂直于面的时候，需要投影到垂直方向<ul>
<li>一个例子：四季的产生</li>
</ul>
</li>
<li>解释现象<ul>
<li>Blinn-Phong 模型中漫反射的计算</li>
<li>光线的衰减<ul>
<li>Intensity 没有衰减，Irradiance 在衰减</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Radiance"><a href="#Radiance" class="headerlink" title="Radiance"></a>Radiance</h2><ul>
<li><strong>有方向性</strong></li>
<li>描述光线</li>
<li>The radiance (luminance) is the <strong>power</strong> emitted, reflected, transmitted or received by a surface, <strong>per unit solid angle</strong>, <strong>per projected unit area</strong></li>
</ul>
<p>$$<br>L(p,\omega)\equiv\dfrac{d^2\Phi(p,\omega)}{d\omega dA \cos\theta}\left[\dfrac{W}{sr\ m^2}\right]\left[\dfrac{cd}{m^2}&#x3D;\dfrac{lm}{sr\ m^2}&#x3D;nit\right]<br>$$</p>
<img src="05/1616040769472.png" style="zoom:50%;" />

<ul>
<li>dA：发射光的面积</li>
<li>$\cos\theta$：投影</li>
<li>联系<ul>
<li>Radiance: Irradiance per solid angle</li>
<li>Radiance: Intensity per projected unit area</li>
</ul>
</li>
</ul>
<h3 id="Incident-Radiance"><a href="#Incident-Radiance" class="headerlink" title="Incident Radiance"></a>Incident Radiance</h3><ul>
<li>it is the light arriving at the surface along a given ray (point on surface and incident direction)</li>
</ul>
<p>$$<br>L(p,\omega) &#x3D; \dfrac{dE(p)}{d\omega\cos\theta}<br>$$</p>
<h3 id="Exiting-Radiance"><a href="#Exiting-Radiance" class="headerlink" title="Exiting Radiance"></a>Exiting Radiance</h3><ul>
<li>for an area light it is the light emitted along a given ray (point on surface and exit direction)</li>
</ul>
<p>$$<br>L(p,\omega) &#x3D; \dfrac{dI(p,w)}{dA\cos\theta}<br>$$</p>
<h2 id="Irradiance-和-Radiance-的关系"><a href="#Irradiance-和-Radiance-的关系" class="headerlink" title="Irradiance 和 Radiance 的关系"></a>Irradiance 和 Radiance 的关系</h2><ul>
<li>Radiance 在 Irradiance 的基础上增加了方向性</li>
<li>某个点接受&#x2F;发射光线总能量：Irradiance</li>
<li>某个点从某个方向接受&#x2F;向某个方向发射光线能量：Radiance</li>
</ul>
<img src="05/1616041925127.png" style="zoom:50%;" />

<p>$$<br>\begin{array}{c}<br>dE(p,\omega)&#x3D;L_i(p.\omega)\cos\theta d\omega\<br>E(p,\omega)&#x3D;\int_{H^2}L_i(p.\omega)\cos\theta d\omega\<br>\end{array}<br>$$</p>
<h1 id="BRDF"><a href="#BRDF" class="headerlink" title="BRDF"></a>BRDF</h1><ul>
<li>Bidirectional Reflectance Distribution Function<ul>
<li>双向反射分布函数</li>
</ul>
</li>
</ul>
<img src="05/1616048740113.png" style="zoom:50%;" />

<ul>
<li>进入的 irradiance：$dE(\omega_i)&#x3D;L(\omega_i)\cos\theta_i d\omega_i$</li>
<li>出去的 irradiance（某个特定方向）：$dL_r(\omega_r)$</li>
<li>The BRDF represents how much light is reflected into <strong>each outgoing direction</strong> from <strong>each incoming direction</strong><ul>
<li>是一个比例</li>
</ul>
</li>
</ul>
<p>$$<br>f_{r}(\omega_{i} \to \omega_{r})&#x3D;\frac{d L_{r}(\omega_{r})}{d E_{i}(\omega_{i})}&#x3D;\frac{d L_{r}(\omega_{r})}{L_{i}(\omega_{i}) \cos \theta_{i} d \omega_{i}}\left[\frac{1}{\mathrm{sr}}\right]<br>$$</p>
<img src="05/1616049786681.png" style="zoom:50%;" />

<ul>
<li>BRDF 定义了物体的材质</li>
</ul>
<h2 id="反射方程"><a href="#反射方程" class="headerlink" title="反射方程"></a>反射方程</h2><ul>
<li>对所有的入射方向求积分</li>
</ul>
<p>$$<br>L_{r}\left(p, \omega_{r}\right)&#x3D;\int_{H^{2}} f_{r}\left(p, \omega_{i} \rightarrow \omega_{r}\right) L_{i}\left(p, \omega_{i}\right) \cos \theta_{i} d \omega_{i}<br>$$</p>
<ul>
<li>$p$：入射点</li>
<li>$\omega_r$：出射方向</li>
<li>$\omega_i$：入射方向</li>
</ul>
<h2 id="渲染方程"><a href="#渲染方程" class="headerlink" title="渲染方程"></a>渲染方程</h2><ul>
<li><strong>Rendering Equation (Kajiya 86)</strong></li>
<li>加上自己的发光成分</li>
</ul>
<p>$$<br>L_{o}(p, \omega_{o})&#x3D;L_{e}(p, \omega_{o})+\int_{\Omega^{+}} L_{i}(p, \omega_{i}) f_{r}(p, \omega_{i}, \omega_{o})(n \cdot \omega_{i}) d \omega_{i}<br>$$</p>
<h2 id="反射方程到渲染方程"><a href="#反射方程到渲染方程" class="headerlink" title="反射方程到渲染方程"></a>反射方程到渲染方程</h2><h3 id="点光源"><a href="#点光源" class="headerlink" title="点光源"></a>点光源</h3><img src="05/1616051060406.png" style="zoom:50%;" />

<h3 id="多个光源"><a href="#多个光源" class="headerlink" title="多个光源"></a>多个光源</h3><ul>
<li>求和</li>
</ul>
<img src="05/1616051097562.png" style="zoom:50%;" />

<h3 id="面光源"><a href="#面光源" class="headerlink" title="面光源"></a>面光源</h3><ul>
<li>积分</li>
</ul>
<img src="05/1616051126190.png" style="zoom:50%;" />

<h3 id="渲染方程-1"><a href="#渲染方程-1" class="headerlink" title="渲染方程"></a>渲染方程</h3><ul>
<li>间接光照</li>
<li>把物体当成是光源</li>
<li>现在解渲染方程，相当于求解 $L$</li>
</ul>
<img src="05/1616051477446.png" style="zoom:50%;" />



<h2 id="Integral-Equation"><a href="#Integral-Equation" class="headerlink" title="Integral Equation"></a>Integral Equation</h2><ul>
<li>渲染方程转化为积分方程</li>
</ul>
<p>$$<br>I(u)&#x3D;e(u)+\int l(v)K(u,v)dv<br>$$</p>
<ul>
<li>$K(u,v)dv$：Kernel of equation Light Transport Operator</li>
</ul>
<h2 id="Linear-Operator-Equation"><a href="#Linear-Operator-Equation" class="headerlink" title="Linear Operator Equation"></a>Linear Operator Equation</h2><ul>
<li>通过算符的抽象还可极度简化成如下形式</li>
</ul>
<p>$$<br>L &#x3D; E + KL<br>$$</p>
<ul>
<li>解渲染方程</li>
</ul>
<p>$$<br>L&#x3D;(I-K)^{-1}E<br>$$</p>
<p>$$<br>L&#x3D;(I+K+K^2+K^3+K^2+\cdots)E<br>$$</p>
<ul>
<li>$E$：自发光</li>
<li>$KE$：直接光照</li>
<li>$KE^2$：one-bounce indirect</li>
<li>光栅化着色：$E+KE$</li>
<li>全局光照：直接和间接光照的集合</li>
<li>光线跟踪的结果次数增加<ul>
<li><strong>会收敛到一个亮度</strong></li>
<li>能量守恒</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/17/CG/YLQ-GAMES101/05/" data-id="cl9lj74a100a064tz879t0p58" data-title="GAMES101.闫令琪.05.光线追踪(2).辐射度量学(Lecture 14-15)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GI/" rel="tag">GI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Radiometry/" rel="tag">Radiometry</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES101/04" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/17/CG/YLQ-GAMES101/04/" class="article-date">
  <time class="dt-published" datetime="2021-03-17T07:16:46.000Z" itemprop="datePublished">2021-03-17</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES101/">CG.GAMES101</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/17/CG/YLQ-GAMES101/04/">GAMES101.闫令琪.04.光线追踪(1).Whitted 风格的光线追踪(Lecture 13-14)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90798049">https://www.bilibili.com/video/av90798049</a></li>
</ul>
<h1 id="光栅化的问题"><a href="#光栅化的问题" class="headerlink" title="光栅化的问题"></a>光栅化的问题</h1><ul>
<li>不好去表示一些全局的效果（Global Effects）</li>
<li>软阴影（Soft Shadow）<ul>
<li>光栅化 VSM</li>
</ul>
</li>
<li>Glossy Reflection<ul>
<li>Glossy：有高光的效果，但是同时本身具有粗糙性的材质</li>
</ul>
</li>
<li>间接光照（Indirect Illumination）<ul>
<li>light bounce more than once</li>
<li>光栅化有一些效果可以模拟，但是效果不太好</li>
</ul>
</li>
<li>光栅化方法<ul>
<li>快，但是是一种近似算法</li>
<li>Real-Time</li>
</ul>
</li>
<li>光线追踪方法<ul>
<li>准确，但是慢</li>
<li>Offline（离线）</li>
</ul>
</li>
</ul>
<h1 id="Ray-Tracing"><a href="#Ray-Tracing" class="headerlink" title="Ray Tracing"></a>Ray Tracing</h1><h2 id="光线的-3-个假定"><a href="#光线的-3-个假定" class="headerlink" title="光线的 3 个假定"></a>光线的 3 个假定</h2><ul>
<li>Light travels in straight lines (though this is wrong)<ul>
<li>光沿直线传播</li>
</ul>
</li>
<li>Light rays do not “collide” with each other if they cross (though this is still wrong)<ul>
<li>光线发生交互的时候互不干扰</li>
</ul>
</li>
<li>Light rays travel from the light sources to the eye<ul>
<li>(but the physics is invariant under path reversal - reciprocity).</li>
<li>光线（光路）的可逆性</li>
</ul>
</li>
</ul>
<h2 id="Ray-Casting"><a href="#Ray-Casting" class="headerlink" title="Ray Casting"></a>Ray Casting</h2><ul>
<li>Appel 1968 - Ray casting<ul>
<li>Generate an image by casting one ray per pixel<ul>
<li>对每个像素，从视点向像素发出一条光线（reciprocity）</li>
</ul>
</li>
<li>Check for shadows by sending a ray to the light<ul>
<li>对于找到的点，判断其是否处在阴影中（对光源可见）</li>
</ul>
</li>
</ul>
</li>
<li>其他的假设<ul>
<li>视点就是一个点</li>
</ul>
</li>
<li>投射光线<ul>
<li>eye ray：从眼睛射向像素的光线</li>
</ul>
</li>
</ul>
<img src="04/1615966794240.png" style="zoom:50%;" />

<ul>
<li>判断是否可见，若可见利用之前的模型进行计算光照</li>
</ul>
<img src="04/1615967125590.png" style="zoom: 50%;" />



<h1 id="Recursive-Whitted-Style-Ray-Tracing"><a href="#Recursive-Whitted-Style-Ray-Tracing" class="headerlink" title="Recursive (Whitted-Style) Ray Tracing"></a>Recursive (Whitted-Style) Ray Tracing</h1><ul>
<li>考虑第一次接触点的折射、反射<ul>
<li>递归计算</li>
<li>shadow rays（判断是否对光源可见）</li>
<li>着色计算：对每一个接触点进行计算<ul>
<li>多条光路的叠加</li>
</ul>
</li>
<li>需要考虑<strong>能量损失</strong></li>
</ul>
</li>
<li>eye ray 又被称为 primary ray</li>
<li>secondary ray：经过一次折射&#x2F;反射之后的线</li>
</ul>
<img src="04/1615967375006.png" style="zoom:50%;" />

<h1 id="光线求交"><a href="#光线求交" class="headerlink" title="光线求交"></a>光线求交</h1><ul>
<li>Ray-Surface Intersection</li>
<li>光线的定义<ul>
<li>光线的起点 $\mathbf{o}$</li>
<li>光线的方向 $\mathbf{d}$<ul>
<li>单位向量</li>
</ul>
</li>
</ul>
</li>
<li>光线的方程<ul>
<li>Ray Equation</li>
<li>$\mathbf{r}(t)&#x3D;\mathbf{o}+t\mathbf{d},0\le t\le \infty$</li>
</ul>
</li>
</ul>
<h2 id="光线与球体求交"><a href="#光线与球体求交" class="headerlink" title="光线与球体求交"></a>光线与球体求交</h2><ul>
<li>Sphere<ul>
<li>$\mathbf{p}:(\mathbf{p}-\mathbf{c})^2-R^2&#x3D;0$</li>
</ul>
</li>
<li>联立方程组求解即可<ul>
<li>解的个数：$0,1,2$</li>
<li>不相交，相切，两个交点（取小的）</li>
</ul>
</li>
</ul>
<h2 id="一般的曲面"><a href="#一般的曲面" class="headerlink" title="一般的曲面"></a>一般的曲面</h2><p>$$<br>\left{<br>\begin{array}{<strong>lr</strong>}<br>    \mathbf{r}(t)&#x3D;\mathbf{o}+t\mathbf{d},0\le t\le \infty\<br>    f(\mathbf{p})&#x3D;0<br>\end{array}<br>\right.<br>$$</p>
<h2 id="显式表面求交"><a href="#显式表面求交" class="headerlink" title="显式表面求交"></a>显式表面求交</h2><ul>
<li>和三角形求交</li>
<li>可以用于判断点是否在物体内部<ul>
<li>内部的点，引一条射线，和物体的交点必为<strong>奇数个</strong></li>
<li>外部的点，引一条射线，和物体的交点必为<strong>偶数个</strong></li>
</ul>
</li>
<li>很慢，每个三角都需要求交</li>
</ul>
<h3 id="光线和三角形求交方法"><a href="#光线和三角形求交方法" class="headerlink" title="光线和三角形求交方法"></a>光线和三角形求交方法</h3><ul>
<li>光线和三角形所在的平面求交</li>
<li>判断这个交点是否在三角形内部</li>
<li>平面的定义<ul>
<li>法线 $\mathbf{N}$</li>
<li>平面上任意一个点 $\mathbf{p’}$</li>
</ul>
</li>
<li>平面上的一个点 $\mathbf{p}:(\mathbf{p’}-\mathbf{p})\cdot\mathbf{N}&#x3D;0$<ul>
<li>展开后和平面方程相同 $ax+by+cz+d&#x3D;0$</li>
</ul>
</li>
<li>联立方程组求解</li>
</ul>
<h3 id="Moller-Trumbore-Algorithm"><a href="#Moller-Trumbore-Algorithm" class="headerlink" title="Moller Trumbore Algorithm"></a>Moller Trumbore Algorithm</h3><ul>
<li>怎么直接把结果解出来用于判断</li>
<li><strong>重心坐标</strong></li>
</ul>
<p>$$<br>\mathbf{r}(t)&#x3D;\mathbf{o}+t\mathbf{d}&#x3D;(1-b_1-b_2)\mathbf{P_0}+b_1\mathbf{P_1}+b_2\mathbf{P2}<br>$$</p>
<p>$$<br>\begin{aligned}<br>&amp;0\le t\le \infty\<br>&amp;0\le b_1\le1\<br>&amp;0\le b_2\le1\<br>&amp;0\le 1-b_1-b_2\le1\<br>\end{aligned}<br>$$</p>
<ul>
<li>3 个未知量，3 个方程（3维）</li>
<li>解的显式表达</li>
</ul>
<img src="04/image-20210403111154716.png" style="zoom:50%;" />





<h1 id="加速求交"><a href="#加速求交" class="headerlink" title="加速求交"></a>加速求交</h1><ul>
<li>Accelerating Ray-Surface Intersection</li>
<li>如果不加速，算法复杂度<ul>
<li>pixels x triangles x bounces</li>
</ul>
</li>
</ul>
<h2 id="Bounding-Volumn"><a href="#Bounding-Volumn" class="headerlink" title="Bounding Volumn"></a>Bounding Volumn</h2><ul>
<li>包围盒：包围整个模型</li>
<li>先对包围盒求交，如果无交点，则不需要对模型求交</li>
<li>简单的包围盒：长方体<ul>
<li>三个对面</li>
<li>box is the intersection of 3 pairs of slabs</li>
</ul>
</li>
</ul>
<h3 id="AABB"><a href="#AABB" class="headerlink" title="AABB"></a>AABB</h3><ul>
<li>Axis-Aligned Bounding Box<ul>
<li>轴对齐包围盒</li>
<li>计算快</li>
</ul>
</li>
<li>如何计算 （2D 的例子）<ul>
<li>每个对面求交</li>
<li>$t_{enter}&#x3D;\max{t_{min}},t_{exit}&#x3D;\min{t_{max}}$</li>
<li>思想<ul>
<li>The ray enters the box only when it enters all pairs of slabs<ul>
<li>三个对面都进入，才是进入</li>
</ul>
</li>
<li>The ray exits the box as long as it exits any pair of slabs<ul>
<li>离开一个对面，即离开</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/04/1615973061088.png"></p>
<ul>
<li>如果不相交：$t_{exit}\le t_{enter}$</li>
<li>光线是射线，考虑 $t$ 的正负<ul>
<li>$t_{exit}&lt;0$：无交点（物体在光线背后）</li>
<li>$t_{enter}&lt;0,t_{exit}\ge0$：光源在物体里面</li>
</ul>
</li>
</ul>
<h1 id="GTC-一些新闻"><a href="#GTC-一些新闻" class="headerlink" title="GTC 一些新闻"></a>GTC 一些新闻</h1><ul>
<li>GTC news: DLSS 2.0<ul>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/116211994">https://zhuanlan.zhihu.com/p/116211994</a></li>
</ul>
</li>
<li>GTC news: RTXGI<ul>
<li><a target="_blank" rel="noopener" href="https://developer.nvidia.com/rtxgi">https://developer.nvidia.com/rtxgi</a></li>
</ul>
</li>
</ul>
<h1 id="基于-AABB-的光线求交加速结构"><a href="#基于-AABB-的光线求交加速结构" class="headerlink" title="基于 AABB 的光线求交加速结构"></a>基于 AABB 的光线求交加速结构</h1><ul>
<li>光线与 AABB 求交</li>
</ul>
<h2 id="均匀的格子"><a href="#均匀的格子" class="headerlink" title="均匀的格子"></a>均匀的格子</h2><ul>
<li>Uniform Spatial Partitions (Grids)</li>
<li>场景预处理<ul>
<li>网格化</li>
</ul>
</li>
<li>算法步骤<ul>
<li>光线与沿途每个盒子求交</li>
<li>若盒子里面含有物体，则于保存的物体部分求交</li>
<li>没有物体，则光线前进（找下一个盒子）</li>
</ul>
</li>
</ul>
<img src="04/1615974169938.png" style="zoom:50%;" />

<ul>
<li>基于想法如下<ul>
<li><strong>光线和盒子求交比光线与物体求交快</strong></li>
</ul>
</li>
<li>光线与盒子求交<ul>
<li>怎么找光线下一次相交的盒子<ul>
<li>最朴素的想法：周围两个都算一遍（向前 2 个测试，向后的 2 个不用管）</li>
</ul>
</li>
<li>高级算法：类似于光栅化一条线的算法</li>
</ul>
</li>
</ul>
<h3 id="加速程度"><a href="#加速程度" class="headerlink" title="加速程度"></a>加速程度</h3><ul>
<li><p>网格：1 x 1（无加速效果）</p>
</li>
<li><p>网格过于密集：与盒子求交的成本变大</p>
</li>
<li><p>经验性划分</p>
<ul>
<li>#cells &#x3D; C x #objs</li>
<li>C &#x3D; 3 x 3 x 3</li>
</ul>
</li>
<li><p>适合场景</p>
<ul>
<li>物体多，在场景中分布均匀</li>
</ul>
</li>
<li><p>不适合场景</p>
<ul>
<li>场景较空，分布不均匀<ul>
<li>大规模空白，和物体相交前需要经过大量空白</li>
</ul>
</li>
<li>“Teapot in a stadium” problem</li>
</ul>
</li>
</ul>
<h2 id="空间划分"><a href="#空间划分" class="headerlink" title="空间划分"></a>空间划分</h2><ul>
<li>Spatial Partitions</li>
<li>划分方法<ul>
<li>八叉树<ul>
<li>维度相关（$2^n$ 叉树）</li>
</ul>
</li>
<li><strong>KD 树</strong><ul>
<li>每次只沿着一个轴展开（二叉树）</li>
<li>横竖交划分（相对均匀）</li>
</ul>
</li>
<li>BSP 树<ul>
<li>空间二分</li>
<li>每次选择一个方向做划分</li>
<li>不是横平竖直的<ul>
<li>维度高了就不好计算</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="04/1615975085492.png" alt="1615975085492" style="zoom:67%;" />

<h3 id="KD-Tree"><a href="#KD-Tree" class="headerlink" title="KD-Tree"></a>KD-Tree</h3><ul>
<li>在光线跟踪之前先建立 KD 树</li>
<li>数据结构<ul>
<li>内部结点<ul>
<li>记录划分方向（x，y，z）</li>
<li>记录划分位置（不一定是正中间）</li>
<li>子结点（指向子节点的指针）</li>
<li><strong>不需要存储物体信息</strong></li>
</ul>
</li>
<li>外部结点（叶结点）<ul>
<li>存储物体列表</li>
</ul>
</li>
</ul>
</li>
<li>光线遍历<ul>
<li>先判断和 A 是否有交点</li>
<li>有交点，接着和 A 的两个子结点判断是否有交点</li>
<li>1 有交点，但是是叶子结点了，计算光照<ul>
<li>其实 1 还需要继续划分<ul>
<li>内部还有多个物体，可能规则上认为可以停止</li>
</ul>
</li>
<li>但是这里已经当作叶子结点了，就不划分了</li>
</ul>
</li>
<li>B 有交点，重复上述步骤，进入 B</li>
</ul>
</li>
</ul>
<img src="04/1615984666604.png" style="zoom:60%;" />

<ul>
<li>无交点的块不需要计算光照了</li>
</ul>
<h4 id="存在的问题"><a href="#存在的问题" class="headerlink" title="存在的问题"></a>存在的问题</h4><ul>
<li>KD-Tree 的建立不简单</li>
<li>难以判断一个三角形和某个包围盒有交集<ul>
<li>3 个顶点都在包围盒外也可能有交点<ul>
<li>包围盒穿透三角形</li>
<li>截面整个在三角形内部</li>
</ul>
</li>
</ul>
</li>
<li>一个在边界的物体可能属于多个包围盒<ul>
<li>多个叶子节点里面都需要计算光照</li>
</ul>
</li>
<li><strong>现在很少用这种方法了</strong></li>
</ul>
<h3 id="BVH"><a href="#BVH" class="headerlink" title="BVH"></a>BVH</h3><ul>
<li>Bounding Volumn Hierarchy</li>
<li>基于<span style="color:red;font-weight:bold">物体</span>的划分</li>
<li>Object Partition</li>
<li><strong>现在常用的方法</strong></li>
<li>算法<ul>
<li>把当前包围盒内的三角形做一个划分</li>
<li>然后把划分得到的两个部分分别求包围盒</li>
</ul>
</li>
</ul>
<img src="04/1615985336608.png" style="zoom:50%;" />

<ul>
<li><strong>一个物体只可能属于一个叶子结点</strong></li>
<li>不需要求三角形和包围盒的交点</li>
<li>避免了 KD-Tree 的问题</li>
<li>但是 BVH 并没有把整个空间划分开，两个子结点可能有重合部分<ul>
<li>一个好的划分，重叠部分尽量小</li>
<li>BVH 的研究</li>
</ul>
</li>
</ul>
<img src="04/1615985641979.png" style="zoom:50%;" />

<ul>
<li>怎么选取划分方向<ul>
<li>可以学习 KD-Tree，横竖交替划分，尽量均匀</li>
<li>但是可能有一个轴还是很长<ul>
<li>所以可以每次选择较长的轴进行划分</li>
</ul>
</li>
<li>可以选取中间的物体进行划分<ul>
<li>保证三角形数量差不多</li>
<li>树的深度小，更平衡<ul>
<li>涉及排序问题，重心排序</li>
<li>找第 $k$ 大的数有 $O(n)$ 的算法<ul>
<li>快排思想算法</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>适合静态场景<ul>
<li>动态需要修改</li>
</ul>
</li>
<li>BVH 的存储和 KD-Tree 类似</li>
<li>伪代码</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Intersect</span>(Ray ray, BVH node) &#123;</span><br><span class="line">    <span class="keyword">if</span> (ray misses node.bbox) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (node is a leaf node)&#123;</span><br><span class="line">        test intersection with all objs;</span><br><span class="line">        <span class="keyword">return</span> closest intersection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    hit1 = <span class="built_in">Intersect</span>(ray, node.child1);</span><br><span class="line">    hit2 = <span class="built_in">Intersect</span>(ray, node.child2);</span><br><span class="line">    <span class="keyword">return</span> the closer of hit1, hit2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/17/CG/YLQ-GAMES101/04/" data-id="cl9lj74a1009x64tzc5boe5up" data-title="GAMES101.闫令琪.04.光线追踪(1).Whitted 风格的光线追踪(Lecture 13-14)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/GI/" rel="tag">GI</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/RayTracing/" rel="tag">RayTracing</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-CG/YLQ-GAMES101/03" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/03/13/CG/YLQ-GAMES101/03/" class="article-date">
  <time class="dt-published" datetime="2021-03-13T13:44:42.000Z" itemprop="datePublished">2021-03-13</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/CG-GAMES101/">CG.GAMES101</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2021/03/13/CG/YLQ-GAMES101/03/">GAMES101.闫令琪.03.几何(Lecture 10-12)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90798049">https://www.bilibili.com/video/av90798049</a></li>
</ul>
<h1 id="Lecture-10"><a href="#Lecture-10" class="headerlink" title="Lecture 10"></a>Lecture 10</h1><ul>
<li>Geometry (Introduction)</li>
<li>几何（基本表示方法）</li>
</ul>
<h2 id="现实"><a href="#现实" class="headerlink" title="现实"></a>现实</h2><ul>
<li>曲面<ul>
<li>现实生活中，我们不管离得多近，也看到不到小三角形，是真正的曲面</li>
</ul>
</li>
<li>布料，透明现象，摩擦力<ul>
<li>纤维（fiber）</li>
<li>股（ply）</li>
<li>线（thread）</li>
<li>布料</li>
</ul>
</li>
<li>水滴<ul>
<li>水花飞溅</li>
<li>水的表面张力</li>
</ul>
</li>
<li>城市<ul>
<li>内部物体很多，树（树叶），草</li>
<li>怎么存储</li>
<li>怎么渲染这么多物体<ul>
<li>Big Hero 6 （超能陆战队）</li>
<li>城市远景的渲染，怎么快，怎么优化</li>
</ul>
</li>
</ul>
</li>
<li>动物的毛发</li>
<li>细胞（微观几何）</li>
<li>树，树枝</li>
</ul>
<h2 id="几何的表示"><a href="#几何的表示" class="headerlink" title="几何的表示"></a>几何的表示</h2><ul>
<li>隐式（Implicit）、显式（Explicit）</li>
</ul>
<h3 id="隐式表示方法"><a href="#隐式表示方法" class="headerlink" title="隐式表示方法"></a>隐式表示方法</h3><ul>
<li>不告诉你点具体在哪，但是告诉你这些点满足的<strong>关系</strong></li>
<li>例如球：$x^2+y^2+z^2&#x3D;1$</li>
<li>一般化的函数：$f(x,y,z)&#x3D;0$</li>
</ul>
<h4 id="好处"><a href="#好处" class="headerlink" title="好处"></a>好处</h4><ul>
<li>容易判断位置关系<ul>
<li>例如判断一个点是否在内部</li>
</ul>
</li>
<li>很难找到所有满足关系的所有点，但是给定一个点后，容易判断是否在它上面</li>
</ul>
<h4 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>给你一个表达式，很难看出表达的是什么</li>
</ul>
<p>$$<br>f(x,y,z)&#x3D;(2-\sqrt{x^2+y^2})^2+z^2-1&#x3D;0<br>$$</p>
<img src="03/1615648598629.png" style="zoom:70%;" />



<h3 id="显示的表达方法"><a href="#显示的表达方法" class="headerlink" title="显示的表达方法"></a>显示的表达方法</h3><ul>
<li>直接给出点（given directly）<ul>
<li>例如之前给出的三角形面</li>
</ul>
</li>
<li>通过参数映射的方法定义的表面（parameter mapping）<ul>
<li>把 $(u,v)$ 全过一遍就找到了结果</li>
<li><strong>类似纹理</strong></li>
</ul>
</li>
</ul>
<img src="03/1615648943112.png" style="zoom:70%;" />



<h4 id="缺点-1"><a href="#缺点-1" class="headerlink" title="缺点"></a>缺点</h4><ul>
<li>很难判断一个点是否在内部 &#x2F;上面</li>
</ul>
<p>$$<br>f(u,v)&#x3D;(\cos u\sin v,\sin u\sin v,\cos v)<br>$$</p>
<ul>
<li>是一个球面（单位球），但是直接给你一个表达式很难看出，而且不好判断点和几何体的位置关系</li>
</ul>
<h2 id="隐式表示方法-1"><a href="#隐式表示方法-1" class="headerlink" title="隐式表示方法"></a>隐式表示方法</h2><h3 id="Algebraic-Surfaces-Implicit"><a href="#Algebraic-Surfaces-Implicit" class="headerlink" title="Algebraic Surfaces (Implicit)"></a>Algebraic Surfaces (Implicit)</h3><ul>
<li>数学公式</li>
<li>如下是一个<strong>爱心</strong></li>
</ul>
<p>$$<br>(x^2+\dfrac{9y^2}{4}+z^2-1)^3&#x3D;x^2z^3+\dfrac{9y^2z^3}{80}<br>$$</p>
<h3 id="Constructive-Solid-Geometry-Implicit"><a href="#Constructive-Solid-Geometry-Implicit" class="headerlink" title="Constructive Solid Geometry (Implicit)"></a>Constructive Solid Geometry (Implicit)</h3><ul>
<li>CSD</li>
<li>通过定义几何体之间的集合运算获取新的集合体</li>
<li>布尔运算 Boolean operation</li>
</ul>
<h3 id="Distance-Functions-Implicit"><a href="#Distance-Functions-Implicit" class="headerlink" title="Distance Functions (Implicit)"></a>Distance Functions (Implicit)</h3><ul>
<li>距离函数</li>
<li>SDF：Signed Distance Function</li>
<li>对空间中的每一个点，都求其到物体表面的最短距离（外部为正、内部为负）</li>
</ul>
<img src="03/1615649746896.png" style="zoom:80%;" />

<ul>
<li>对 SDF 进行 blend</li>
<li>一个例子<ul>
<li>A 到 B 的一个运动状态，阴影表示被遮挡</li>
<li>想通过 A 和 B 得到中间状态（理想：左边一半黑色、右边一半白色）</li>
<li>直接作 blend，变成黑、灰、白各占 $\dfrac{1}{3}$</li>
<li>对 SDF 做 blend，与理想一致</li>
</ul>
</li>
</ul>
<img src="03/1615649813984.png" style="zoom:80%;" />

<ul>
<li>另外一个例子</li>
</ul>
<p><img src="/03/1615650031168.png"></p>
<ul>
<li><strong>距离函数很强</strong></li>
<li>怎么从距离函数还原出原来的点<ul>
<li>把距离函数为 0 的位置全找出来就得到了表面</li>
</ul>
</li>
<li>距离函数不太好写成解析的形式<ul>
<li>水平集方法</li>
</ul>
</li>
</ul>
<h3 id="Level-Set-Methods-Also-implicit"><a href="#Level-Set-Methods-Also-implicit" class="headerlink" title="Level Set Methods (Also implicit)"></a>Level Set Methods (Also implicit)</h3><ul>
<li>水平集方法</li>
<li>也是距离函数，把距离存在网格里，只是表示方式不同<ul>
<li>非网格上的点：<strong>双线性插值</strong></li>
</ul>
</li>
<li>地理：等高线</li>
<li>三维空间水平集，纹理</li>
<li>医学：CT，MRI</li>
<li>Level Sets in Physical Simulatio<ul>
<li>水滴滴到水里</li>
</ul>
</li>
</ul>
<h3 id="Fractals-Implicit"><a href="#Fractals-Implicit" class="headerlink" title="Fractals (Implicit)"></a>Fractals (Implicit)</h3><ul>
<li>分形</li>
<li>Exhibit self-similarity, detail at all scales</li>
<li>自相似性<ul>
<li>渲染的时候会引起强烈的走样</li>
</ul>
</li>
</ul>
<h2 id="隐式表示方法评价"><a href="#隐式表示方法评价" class="headerlink" title="隐式表示方法评价"></a>隐式表示方法评价</h2><ul>
<li>缺点<ul>
<li>difficult to model complex shapes<ul>
<li>复杂形体难以表示</li>
</ul>
</li>
</ul>
</li>
<li>优点<ul>
<li>compact description (e.g., a function)<ul>
<li>表示简单</li>
</ul>
</li>
<li>certain queries easy (inside object, distance to surface)<ul>
<li>方便查询（内部、外部）</li>
</ul>
</li>
<li>good for ray-to-surface intersection (more later)<ul>
<li>容易与光线求交（光线跟踪算法）</li>
</ul>
</li>
<li>for simple shapes, exact description &#x2F; no sampling error<ul>
<li>准确描述物体</li>
</ul>
</li>
<li>easy to handle changes in topology (e.g., fluid)<ul>
<li>容易控制几何变化</li>
</ul>
</li>
</ul>
</li>
</ul>
<h1 id="Lecture-11"><a href="#Lecture-11" class="headerlink" title="Lecture 11"></a>Lecture 11</h1><ul>
<li>Geometry 2 (Curves and Surfaces)</li>
<li>曲线与曲面</li>
</ul>
<h2 id="显式表示方法"><a href="#显式表示方法" class="headerlink" title="显式表示方法"></a>显式表示方法</h2><ul>
<li>triangle meshes</li>
<li>Bezier surfaces</li>
<li>subdivision surfaces</li>
<li>NURBS</li>
<li>point clouds</li>
</ul>
<h3 id="Point-Cloud-Explicit"><a href="#Point-Cloud-Explicit" class="headerlink" title="Point Cloud (Explicit)"></a>Point Cloud (Explicit)</h3><ul>
<li>点云</li>
<li>点表示的够细，就看不出来点与点之间的间隔</li>
<li>精细模型：特别密集的点</li>
<li>三维扫描的输出</li>
<li>点云如何变成（三角形的）面<ul>
<li>一个研究问题</li>
</ul>
</li>
</ul>
<h3 id="Polygon-Mesh-Explicit"><a href="#Polygon-Mesh-Explicit" class="headerlink" title="Polygon Mesh (Explicit)"></a>Polygon Mesh (Explicit)</h3><ul>
<li>多边形面<ul>
<li>三角形面、四边形面</li>
</ul>
</li>
<li>Perhaps <strong>most common</strong> representation in graph</li>
</ul>
<h4 id="文件格式-obj"><a href="#文件格式-obj" class="headerlink" title="文件格式 .obj"></a>文件格式 .obj</h4><ul>
<li>The Wavefront Object File (.obj) Format</li>
<li>Just a text file that specifies vertices, normals, texture coordinates and their connectivities</li>
<li>一个<strong>立方体</strong>的例子<ul>
<li>以下数据存在冗余（自动建模产生的）</li>
<li>f 表示怎么形成三角形</li>
<li>f 5&#x2F;1&#x2F;1 1&#x2F;2&#x2F;1 4&#x2F;3&#x2F;1</li>
<li>三角形的三个顶点（v &#x2F; vt &#x2F; vn）<ul>
<li>第 5 个顶点（第 1 个纹理坐标、第 1 个法线）</li>
<li>第 1 个顶点（第 2 个纹理坐标、第 1 个法线）</li>
<li>第 4 个顶点（第 3 个纹理坐标、第 1 个法线）</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="/03/1615710980473.png"></p>
<h3 id="Curves"><a href="#Curves" class="headerlink" title="Curves"></a>Curves</h3><ul>
<li>曲线</li>
<li>Camera Path<ul>
<li>摄像机沿着某条曲线运动（转换视点方向）</li>
</ul>
</li>
<li>定义字体</li>
</ul>
<h3 id="Bezier-Curves-Explict"><a href="#Bezier-Curves-Explict" class="headerlink" title="Bezier Curves(Explict)"></a>Bezier Curves(Explict)</h3><ul>
<li>贝塞尔曲线</li>
<li>通过参数定义的，因此是显式的</li>
<li>通过控制点定义曲线（4&#x2F;3）<ul>
<li>控制点：定义切线、起始点、终点</li>
</ul>
</li>
</ul>
<h4 id="Bezier-Curves-–-de-Casteljau-Algorithm"><a href="#Bezier-Curves-–-de-Casteljau-Algorithm" class="headerlink" title="Bézier Curves – de Casteljau Algorithm"></a>Bézier Curves – de Casteljau Algorithm</h4><ul>
<li>通过任意个控制点生成曲线</li>
<li>quadratic Bezier（3 个点）</li>
</ul>
<img src="03/1615711727481.png" style="zoom:50%;" />

<ul>
<li>$b_0$ 出发，$b_2$ 结束，$b_1$ 控制方向</li>
<li>Insert a point using linear interpolation</li>
<li>时间 0 在点 $b_0$，时间 $1$ 在点 $b_2$，问时间 t 点在哪里？</li>
<li>对当前的所有线段进行一个插值，直到无法插值（只有一条线段上的一个点）<ul>
<li>每趟插值减少一条线段</li>
</ul>
</li>
<li>例如<ul>
<li>$b_0b_1$ 插值出 $b_0^1$，$b_1b_2$ 插值出 $b_1^1$</li>
<li>例如 $b_0^1b_1^1$ 插值出 $b_0^2$</li>
</ul>
</li>
</ul>
<img src="03/1615711935263.png" style="zoom:50%;" />



<h4 id="Evaluating-Bezier-Curves-Algebraic-Formula"><a href="#Evaluating-Bezier-Curves-Algebraic-Formula" class="headerlink" title="Evaluating Bézier Curves Algebraic Formula"></a>Evaluating Bézier Curves Algebraic Formula</h4><ul>
<li>代数形式</li>
<li>4 个点</li>
</ul>
<img src="03/1615712363260.png" style="zoom:50%;" />

<ul>
<li>3 个点</li>
</ul>
<p>$$<br>\begin{aligned}<br>b_0^2&amp;&#x3D;tb_0^1+(1-t)b_1^1\<br>&amp;&#x3D;t[tb_0+(1-t)b_1]+(1-t)[tb_1+(1-t)b_2]\<br>&amp;&#x3D;t^2b_0+2t(1-t)b_1+(1-t)^2b_2<br>\end{aligned}<br>$$</p>
<ul>
<li>4 个点</li>
</ul>
<p>$$<br>b^n(t)&#x3D;b_0(1-t)^3+b_13t(1-t)^2+b_23t^2(1-t)+b_3t^3<br>$$</p>
<ul>
<li>是 1 的二项式展开</li>
</ul>
<p>$$<br>b^n(t)&#x3D;b_0^n&#x3D;\sum_{j&#x3D;0}^{n}b_jB_j^n(t)<br>$$</p>
<p>$$<br>B_j^n(t)&#x3D;\mathbf{C}_n^it^i(1-t)^{n-i}&#x3D;{n\choose i}t^i(1-t)^{n-i}<br>$$</p>
<ul>
<li>输入为三维坐标，三维贝塞尔曲线</li>
<li>一些性质（4个控制点情况下）<ul>
<li>$b(0)&#x3D;b_0$</li>
<li>$b(1)&#x3D;b_3$</li>
<li>$b’(0)&#x3D;3(b_1-b_0)$</li>
<li>$b’(1)&#x3D;3(b_3-b_2)$</li>
</ul>
</li>
<li><strong>控制点做仿射变换后生成的贝塞尔曲线和原来的贝塞尔曲线仿射变换后形成的曲线是一样的</strong><ul>
<li>投影变换不行</li>
</ul>
</li>
<li>凸包性质<ul>
<li>画出来的贝塞尔曲线一定在控制点形成的<strong>凸包</strong>内</li>
</ul>
</li>
</ul>
<img src="03/1615713622062.png" style="zoom:67%;" />

<h4 id="Piecewise-Bezier-Curves"><a href="#Piecewise-Bezier-Curves" class="headerlink" title="Piecewise Bezier Curves"></a>Piecewise Bezier Curves</h4><ul>
<li>分段考虑<ul>
<li>在线演示：<a target="_blank" rel="noopener" href="http://math.hws.edu/eck/cs424/notes2013/canvas/bezier.html">http://math.hws.edu/eck/cs424/notes2013/canvas/bezier.html</a></li>
</ul>
</li>
<li>控制点多了，不太好控制形成想要的形状</li>
</ul>
<img src="03/1615713780545.png" style="zoom:50%;" />

<ul>
<li>每 4 个控制点定义一个贝塞尔曲线<ul>
<li>广泛应用：fonts, paths, Illustrator, Keynote</li>
<li>PhotoShop 的钢笔工具</li>
</ul>
</li>
<li>怎么样让连接点光滑？<ul>
<li>切线的斜率相同</li>
<li>$3(b_3-b_2)&#x3D;3(b_4-b_3)$</li>
<li>$b_2+b_4&#x3D;2b_3$</li>
</ul>
</li>
<li>$C^0$ 连续：点是同一个点</li>
<li>$C^1$ 连续：斜率（一阶导数）连续</li>
</ul>
<h4 id="其他问题"><a href="#其他问题" class="headerlink" title="其他问题"></a>其他问题</h4><ul>
<li>高阶贝塞尔曲线转低阶</li>
</ul>
<h3 id="Splines-样条"><a href="#Splines-样条" class="headerlink" title="Splines 样条"></a>Splines 样条</h3><ul>
<li>a continuous curve constructed so as to pass through a given set of points and have a certain number of continuous derivatives.</li>
<li>In short, a curve under control</li>
<li>通过这些点</li>
</ul>
<h3 id="B-Splines"><a href="#B-Splines" class="headerlink" title="B-Splines"></a>B-Splines</h3><ul>
<li>B样条曲线</li>
<li>basis splines（基函数样条）<ul>
<li>伯恩斯坦多项式作为基函数，进行一个加权平均</li>
</ul>
</li>
<li>Require more information than Bezier curves</li>
<li>Satisfy all important properties that Bézier curves have (i.e. superset)</li>
<li>提出动机<ul>
<li>如果使用贝塞尔曲线，改动一个点，可能会影响整条曲线<ul>
<li>分段贝塞尔曲线没有这个问题（边界问题）</li>
</ul>
</li>
<li>然而我们希望只影响<strong>局部</strong>的曲线</li>
</ul>
</li>
</ul>
<h3 id="NUBRBS"><a href="#NUBRBS" class="headerlink" title="NUBRBS"></a>NUBRBS</h3><ul>
<li>非均匀有理 B 样条</li>
</ul>
<h3 id="深入几何内容"><a href="#深入几何内容" class="headerlink" title="深入几何内容"></a>深入几何内容</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/av66548502">https://www.bilibili.com/video/av66548502</a></li>
</ul>
<h3 id="贝塞尔曲面"><a href="#贝塞尔曲面" class="headerlink" title="贝塞尔曲面"></a>贝塞尔曲面</h3><img src="03/1615718816431.png" style="zoom:50%;" />

<ul>
<li>双线性插值的思想</li>
<li>两个方向上做两趟贝塞尔曲线</li>
<li>复杂的问题：贝塞尔曲面的混合</li>
</ul>
<h2 id="网格计算"><a href="#网格计算" class="headerlink" title="网格计算"></a>网格计算</h2><ul>
<li><p>网格细分：mesh subdivision</p>
<ul>
<li>upsampling</li>
</ul>
</li>
<li><p>网格简化：mesh simplification</p>
<ul>
<li>downsampling</li>
</ul>
</li>
<li><p>网格正则化：mesh regulation</p>
<ul>
<li>网格正则化</li>
<li>原来的三角形可能有大有小，渲染困难</li>
</ul>
</li>
</ul>
<h1 id="Lecture-12"><a href="#Lecture-12" class="headerlink" title="Lecture 12"></a>Lecture 12</h1><ul>
<li><p>Geometry (Mesh Operation)</p>
</li>
<li><p>几何（网格处理）</p>
</li>
<li><p>2019 图灵奖：Ed Catmull，Pat Hanrahan</p>
</li>
</ul>
<h2 id="细分-Mesh-Subdivision"><a href="#细分-Mesh-Subdivision" class="headerlink" title="细分 Mesh Subdivision"></a>细分 Mesh Subdivision</h2><ul>
<li>引入更多三角形</li>
<li>三角形的位置发生点变化，更加光滑</li>
</ul>
<h3 id="Loop-Subdivision"><a href="#Loop-Subdivision" class="headerlink" title="Loop Subdivision"></a>Loop Subdivision</h3><ul>
<li>Loop：发明这个算法的人叫 Loop</li>
<li>前提假设是原来表示物体的方式i就全都是<strong>三角形</strong></li>
<li>三角形分为 4 个</li>
</ul>
<img src="03/1615957320024.png" style="zoom:50%;" />

<ul>
<li>将顶点划分为新&#x2F;老顶点，使用不同的更新方法去更新<ul>
<li>新：边的中间</li>
<li>老：原来存在的</li>
</ul>
</li>
<li>新的顶点的更新方法<ul>
<li>AB 指更新的点所在的边（被两个三角形共享）</li>
<li>CD 指上面个的两个三角形剩下的两个点</li>
<li>直观上的理解：AB 近（贡献大），CD 远（贡献小）</li>
</ul>
</li>
</ul>
<img src="03/1615957373007.png" style="zoom:40%;" />



<ul>
<li>老的顶点的更新方式<ul>
<li>老的顶点被若干（$n$）个三角形共享，结点度为 $n$</li>
<li>考虑<strong>周围顶点</strong>的影响同时还要考虑<strong>自己原来</strong>的位置<ul>
<li>周围顶点的平均 &#x2F; 和</li>
<li>自己原来的位置</li>
</ul>
</li>
<li>$u$ ：一个与 $n$ 相关的数</li>
</ul>
</li>
</ul>
<img src="03/1615957500126.png" style="zoom:40%;" />



<h3 id="Catmull-Clark-Subdivision"><a href="#Catmull-Clark-Subdivision" class="headerlink" title="Catmull-Clark Subdivision"></a>Catmull-Clark Subdivision</h3><ul>
<li>适用于一般的形状表示</li>
<li>一些定义<ul>
<li>Quad face：四边形面</li>
<li>Non-quad face：非四边形面</li>
<li>Extraordinary point：奇异点<ul>
<li>度不为 4 的点</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="产生新的点"><a href="#产生新的点" class="headerlink" title="产生新的点"></a>产生新的点</h4><ul>
<li>产生算法<ul>
<li>对于每个面，我们取<strong>所有边的中点</strong>以及<strong>面上的中点</strong>（重心）</li>
<li>将边上的中点和面的中点连起来</li>
</ul>
</li>
<li>经过一次细分之后<ul>
<li>奇异点<ul>
<li>原来的奇异点还是奇异点</li>
<li>增加的奇异点个数：原来非四边形面的个数</li>
</ul>
</li>
<li>非四边形面<ul>
<li>非四边形面全都消失了</li>
</ul>
</li>
<li><strong>每一个非四边形面都会消失，并且引入一个奇异点</strong></li>
</ul>
</li>
<li>Catmull-Clark 细分，在第一步操作时会引入 $n$ 个奇异点，之后的操作不会再引入奇异点<ul>
<li>$n$：初始非四边形面的个数</li>
</ul>
</li>
</ul>
<img src="03/1615959072991.png" style="zoom: 33%;" />

<img src="03/1615959044715.png" style="zoom:33%;" />

<h4 id="新的点的位置计算"><a href="#新的点的位置计算" class="headerlink" title="新的点的位置计算"></a>新的点的位置计算</h4><ul>
<li>点分为 3 类<ul>
<li>Face Point：在<strong>面的中心</strong>的<strong>新</strong>的点<ul>
<li>关联的顶点</li>
</ul>
</li>
<li>Edge Point：在<strong>边的中心</strong>的<strong>新</strong>的点<ul>
<li>关联的边的两个顶点、关联的边关联的面的中心</li>
</ul>
</li>
<li>Vertex Point：老的顶点<ul>
<li>自己、关联的面的中心、关联的边的中心</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="03/1615959340053.png" style="zoom: 67%;" />

<ul>
<li>Geri’s Game<ul>
<li>最早的一批利用曲面细分做的动画</li>
</ul>
</li>
</ul>
<h2 id="简化-Mesh-Simplification"><a href="#简化-Mesh-Simplification" class="headerlink" title="简化 Mesh Simplification"></a>简化 Mesh Simplification</h2><img src="03/1615959972772.png" style="zoom:70%;" />

<ul>
<li>简化需求的产生<ul>
<li>如果一个物体离得很远，没必要划分得很细致<ul>
<li>简化后，效果差不多，但是计算量小很多</li>
</ul>
</li>
<li>不同情况下我们会选用不同复杂程度的三角形（几何模型）</li>
</ul>
</li>
<li>几何层次结构的变化、切换很难<ul>
<li>例如远处用精细模型，近处用简化模型，但是什么时候切换、怎么平滑切换是个问题</li>
</ul>
</li>
<li>怎么简化<ul>
<li>不能直接删除三角形，会有洞</li>
</ul>
</li>
<li>一种方法：边坍缩（Collapsing An Edge）<ul>
<li>找到一条边，然后把这条边收缩为一个点</li>
</ul>
</li>
</ul>
<h3 id="边坍缩"><a href="#边坍缩" class="headerlink" title="边坍缩"></a>边坍缩</h3><ul>
<li>坍缩哪些点？怎么坍缩<ul>
<li>二次误差度量</li>
</ul>
</li>
<li>二次误差度量（Quadric Error Metrics）<ul>
<li>怎么放置新的点（下图为例）<ul>
<li>5 点平均：矮了很多</li>
<li>3 点平均：还是会比轮廓矮</li>
<li>找一个点，满足这个点到原来 4 个面的平方和最小</li>
</ul>
</li>
</ul>
</li>
</ul>
<img src="03/1615960495957.png" style="zoom: 67%;" />

<ul>
<li>算法：为每一条边用最小二次误差进行打分，首先坍缩误差最小的边<ul>
<li>算法问题<ul>
<li>坍缩一条边之后会影响其他边的最小二次误差</li>
<li>需要重新计算被这条边影响的边的最小二次误差</li>
</ul>
</li>
<li>数据结构：堆（优先队列）</li>
<li>算法正确性<ul>
<li>贪心算法，并不保证最重的是全局最优解（可能陷入局部最优）</li>
</ul>
</li>
<li>实际效果还不错<ul>
<li>图形学本身的特点</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2021/03/13/CG/YLQ-GAMES101/03/" data-id="cl9lj74a200a864tz9mo2g8v0" data-title="GAMES101.闫令琪.03.几何(Lecture 10-12)" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/22/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="page-number" href="/page/22/">22</a><span class="page-number current">23</span><a class="page-number" href="/page/24/">24</a><a class="page-number" href="/page/25/">25</a><a class="page-number" href="/page/26/">26</a><a class="extend next" rel="next" href="/page/24/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/0/">0</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Algebra/">Algebra</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C-Kits/">C++.Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG/">CG</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Algorithm/">CG.Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES101/">CG.GAMES101</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES102/">CG.GAMES102</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES103/">CG.GAMES103</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES104/">CG.GAMES104</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES202/">CG.GAMES202</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-GAMES203/">CG.GAMES203</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Kits/">CG.Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-LS/">CG.LS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-PBRT/">CG.PBRT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CG-Paper/">CG.Paper</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/CV/">CV</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Code/">Code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-CLJ/">DB.CLJ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-MySQL/">DB.MySQL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DB-SQLServer/">DB.SQLServer</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/DSA/">DSA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Kits/">Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-CXQ/">OS.CXQ</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-OSTEP/">OS.OSTEP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-xv6-labs/">OS.xv6-labs</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS-xv6-source-code/">OS.xv6-source-code</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/TODO/">TODO</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/book-directory/">book.directory</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/computation-pyr/">computation.pyr</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/csharp-kits/">csharp.kits</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/csharp-tds/">csharp.tds</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/images/">images</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/installation/">installation</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mitsuba/">mitsuba</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/nothing/">nothing</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-Maya/">software.Maya</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-ps/">software.ps</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-vscode/">software.vscode</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/win/">win</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algebra/" rel="tag">Algebra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BFS/" rel="tag">BFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BST/" rel="tag">BST</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BVH/" rel="tag">BVH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C++</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CG/" rel="tag">CG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CG-Algorithm/" rel="tag">CG-Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CV/" rel="tag">CV</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Code/" rel="tag">Code</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB/" rel="tag">DB</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DFS/" rel="tag">DFS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DP/" rel="tag">DP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/DSA/" rel="tag">DSA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dijkstra/" rel="tag">Dijkstra</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EG/" rel="tag">EG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Floyd/" rel="tag">Floyd</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GI/" rel="tag">GI</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Glints/" rel="tag">Glints</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HDR/" rel="tag">HDR</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HQX/" rel="tag">HQX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Heap/" rel="tag">Heap</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kits/" rel="tag">Kits</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LCA/" rel="tag">LCA</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LLG/" rel="tag">LLG</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MCMC/" rel="tag">MCMC</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MIS/" rel="tag">MIS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MLT/" rel="tag">MLT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maya/" rel="tag">Maya</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NEE/" rel="tag">NEE</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OS/" rel="tag">OS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PBRT/" rel="tag">PBRT</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Paper/" rel="tag">Paper</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Radiometry/" rel="tag">Radiometry</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/RayTracing/" rel="tag">RayTracing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SAH/" rel="tag">SAH</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SDF/" rel="tag">SDF</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SGJ/" rel="tag">SGJ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQLServer/" rel="tag">SQLServer</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/STL/" rel="tag">STL</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Shadow/" rel="tag">Shadow</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WHM/" rel="tag">WHM</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/WX/" rel="tag">WX</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/YLQ/" rel="tag">YLQ</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/book/" rel="tag">book</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/computation/" rel="tag">computation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csharp/" rel="tag">csharp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/images/" rel="tag">images</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/installation/" rel="tag">installation</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/js/" rel="tag">js</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/linux/" rel="tag">linux</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/math/" rel="tag">math</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mitsuba/" rel="tag">mitsuba</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobaxterm/" rel="tag">mobaxterm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nothing/" rel="tag">nothing</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/obs/" rel="tag">obs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/occlusion/" rel="tag">occlusion</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ps/" rel="tag">ps</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/software/" rel="tag">software</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/test/" rel="tag">test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tree/" rel="tag">tree</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vscode/" rel="tag">vscode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/win/" rel="tag">win</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xv6/" rel="tag">xv6</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E4%BA%8C%E5%88%86/" rel="tag">二分</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%85%83%E5%AE%87%E5%AE%99/" rel="tag">元宇宙</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%87%A0%E4%BD%95/" rel="tag">几何</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/" rel="tag">可见性</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" rel="tag">并查集</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" rel="tag">拓扑排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%8E%92%E5%BA%8F/" rel="tag">排序</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%99%AE%E5%90%95%E5%85%8B%E5%9D%90%E6%A0%87/" rel="tag">普吕克坐标</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" rel="tag">最小生成树</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/" rel="tag">最短路</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" rel="tag">线段树</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algebra/" style="font-size: 10px;">Algebra</a> <a href="/tags/BFS/" style="font-size: 10px;">BFS</a> <a href="/tags/BST/" style="font-size: 10px;">BST</a> <a href="/tags/BVH/" style="font-size: 12.5px;">BVH</a> <a href="/tags/C/" style="font-size: 10px;">C++</a> <a href="/tags/CG/" style="font-size: 20px;">CG</a> <a href="/tags/CG-Algorithm/" style="font-size: 10px;">CG-Algorithm</a> <a href="/tags/CV/" style="font-size: 10.63px;">CV</a> <a href="/tags/Code/" style="font-size: 14.38px;">Code</a> <a href="/tags/DB/" style="font-size: 19.38px;">DB</a> <a href="/tags/DFS/" style="font-size: 12.5px;">DFS</a> <a href="/tags/DP/" style="font-size: 13.13px;">DP</a> <a href="/tags/DSA/" style="font-size: 11.25px;">DSA</a> <a href="/tags/Dijkstra/" style="font-size: 10px;">Dijkstra</a> <a href="/tags/EG/" style="font-size: 12.5px;">EG</a> <a href="/tags/Floyd/" style="font-size: 10.63px;">Floyd</a> <a href="/tags/GI/" style="font-size: 11.25px;">GI</a> <a href="/tags/Glints/" style="font-size: 10px;">Glints</a> <a href="/tags/HDR/" style="font-size: 10px;">HDR</a> <a href="/tags/HQX/" style="font-size: 10px;">HQX</a> <a href="/tags/Heap/" style="font-size: 10px;">Heap</a> <a href="/tags/Kits/" style="font-size: 13.75px;">Kits</a> <a href="/tags/LCA/" style="font-size: 10px;">LCA</a> <a href="/tags/LLG/" style="font-size: 12.5px;">LLG</a> <a href="/tags/MCMC/" style="font-size: 10.63px;">MCMC</a> <a href="/tags/MIS/" style="font-size: 10px;">MIS</a> <a href="/tags/MLT/" style="font-size: 10px;">MLT</a> <a href="/tags/Maya/" style="font-size: 10px;">Maya</a> <a href="/tags/MySQL/" style="font-size: 11.88px;">MySQL</a> <a href="/tags/NEE/" style="font-size: 10px;">NEE</a> <a href="/tags/OS/" style="font-size: 17.5px;">OS</a> <a href="/tags/PBRT/" style="font-size: 10px;">PBRT</a> <a href="/tags/Paper/" style="font-size: 15.63px;">Paper</a> <a href="/tags/Radiometry/" style="font-size: 10px;">Radiometry</a> <a href="/tags/RayTracing/" style="font-size: 10px;">RayTracing</a> <a href="/tags/SAH/" style="font-size: 10px;">SAH</a> <a href="/tags/SDF/" style="font-size: 10px;">SDF</a> <a href="/tags/SGJ/" style="font-size: 10.63px;">SGJ</a> <a href="/tags/SQL/" style="font-size: 13.13px;">SQL</a> <a href="/tags/SQLServer/" style="font-size: 10.63px;">SQLServer</a> <a href="/tags/STL/" style="font-size: 11.25px;">STL</a> <a href="/tags/Shadow/" style="font-size: 10px;">Shadow</a> <a href="/tags/WHM/" style="font-size: 16.88px;">WHM</a> <a href="/tags/WX/" style="font-size: 11.88px;">WX</a> <a href="/tags/YLQ/" style="font-size: 18.13px;">YLQ</a> <a href="/tags/book/" style="font-size: 10.63px;">book</a> <a href="/tags/computation/" style="font-size: 18.75px;">computation</a> <a href="/tags/csharp/" style="font-size: 16.25px;">csharp</a> <a href="/tags/images/" style="font-size: 10px;">images</a> <a href="/tags/installation/" style="font-size: 11.88px;">installation</a> <a href="/tags/js/" style="font-size: 10px;">js</a> <a href="/tags/linux/" style="font-size: 11.25px;">linux</a> <a href="/tags/math/" style="font-size: 10px;">math</a> <a href="/tags/mitsuba/" style="font-size: 11.88px;">mitsuba</a> <a href="/tags/mobaxterm/" style="font-size: 10px;">mobaxterm</a> <a href="/tags/nothing/" style="font-size: 10.63px;">nothing</a> <a href="/tags/obs/" style="font-size: 10px;">obs</a> <a href="/tags/occlusion/" style="font-size: 15px;">occlusion</a> <a href="/tags/ps/" style="font-size: 10px;">ps</a> <a href="/tags/software/" style="font-size: 10px;">software</a> <a href="/tags/test/" style="font-size: 10px;">test</a> <a href="/tags/tree/" style="font-size: 11.25px;">tree</a> <a href="/tags/vscode/" style="font-size: 10.63px;">vscode</a> <a href="/tags/win/" style="font-size: 10.63px;">win</a> <a href="/tags/xv6/" style="font-size: 16.25px;">xv6</a> <a href="/tags/%E4%BA%8C%E5%88%86/" style="font-size: 10.63px;">二分</a> <a href="/tags/%E5%85%83%E5%AE%87%E5%AE%99/" style="font-size: 10.63px;">元宇宙</a> <a href="/tags/%E5%87%A0%E4%BD%95/" style="font-size: 10px;">几何</a> <a href="/tags/%E5%8F%AF%E8%A7%81%E6%80%A7/" style="font-size: 11.88px;">可见性</a> <a href="/tags/%E5%B9%B6%E6%9F%A5%E9%9B%86/" style="font-size: 10.63px;">并查集</a> <a href="/tags/%E6%8B%93%E6%89%91%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">拓扑排序</a> <a href="/tags/%E6%8E%92%E5%BA%8F/" style="font-size: 10px;">排序</a> <a href="/tags/%E6%99%AE%E5%90%95%E5%85%8B%E5%9D%90%E6%A0%87/" style="font-size: 10px;">普吕克坐标</a> <a href="/tags/%E6%9C%80%E5%B0%8F%E7%94%9F%E6%88%90%E6%A0%91/" style="font-size: 10px;">最小生成树</a> <a href="/tags/%E6%9C%80%E7%9F%AD%E8%B7%AF/" style="font-size: 13.13px;">最短路</a> <a href="/tags/%E7%BA%BF%E6%AE%B5%E6%A0%91/" style="font-size: 10px;">线段树</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/10/">October 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2022/10/23/CG/WHM-GAMES103/11/">GAMES103.王华民.11.Incompressible Fluid Dynamics and Eulerian Fluids</a>
          </li>
        
          <li>
            <a href="/2022/10/23/CG/Papers/2021/bvh-survey-3/">(论文)[2021] A Survey on Bounding Volume Hierarchies for Ray Tracing(4)</a>
          </li>
        
          <li>
            <a href="/2022/04/28/CG/Kits/MIS-NEE/">NEE、MIS(多重重要性采样)</a>
          </li>
        
          <li>
            <a href="/2022/04/18/CG/WHM-GAMES103/10/">GAMES103.王华民.10.Surface Waves</a>
          </li>
        
          <li>
            <a href="/2022/04/17/CG/WHM-GAMES103/09-1/">GAMES103.王华民.09.Collision Handling(1)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2022 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>